<!DOCTYPE html>
<html lang="" xml:lang="">
<head>

  <meta charset="utf-8" />
  <meta http-equiv="X-UA-Compatible" content="IE=edge" />
  <title>Chapter 9 Compartment Models | Statistical Learning of Infectious Disease Data Analytics</title>
  <meta name="description" content="The use of statistical models to understand infectious disease dynamics has a very rich history in epidemiology. This book introduces modern statistical models and state-of-the-art learning methods to analyze infectious disease data. Many of the key approaches, examples and case studies will be presented. The primary emphasis will be interpretation, inference and hands-on data analyses. This course also provides practical concepts and R computing skills to perform infectious disease data analysis and visualization." />
  <meta name="generator" content="bookdown 0.21 and GitBook 2.6.7" />

  <meta property="og:title" content="Chapter 9 Compartment Models | Statistical Learning of Infectious Disease Data Analytics" />
  <meta property="og:type" content="book" />
  
  
  <meta property="og:description" content="The use of statistical models to understand infectious disease dynamics has a very rich history in epidemiology. This book introduces modern statistical models and state-of-the-art learning methods to analyze infectious disease data. Many of the key approaches, examples and case studies will be presented. The primary emphasis will be interpretation, inference and hands-on data analyses. This course also provides practical concepts and R computing skills to perform infectious disease data analysis and visualization." />
  <meta name="github-repo" content="rstudio/bookdown-demo" />

  <meta name="twitter:card" content="summary" />
  <meta name="twitter:title" content="Chapter 9 Compartment Models | Statistical Learning of Infectious Disease Data Analytics" />
  
  <meta name="twitter:description" content="The use of statistical models to understand infectious disease dynamics has a very rich history in epidemiology. This book introduces modern statistical models and state-of-the-art learning methods to analyze infectious disease data. Many of the key approaches, examples and case studies will be presented. The primary emphasis will be interpretation, inference and hands-on data analyses. This course also provides practical concepts and R computing skills to perform infectious disease data analysis and visualization." />
  

<meta name="author" content="Lily Wang" />


<meta name="date" content="2021-04-28" />

  <meta name="viewport" content="width=device-width, initial-scale=1" />
  <meta name="apple-mobile-web-app-capable" content="yes" />
  <meta name="apple-mobile-web-app-status-bar-style" content="black" />
  
  
<link rel="prev" href="modeling.html"/>
<link rel="next" href="timeseries.html"/>
<script src="libs/header-attrs-2.6/header-attrs.js"></script>
<script src="libs/jquery-3.5.1/jquery.min.js"></script>
<link href="libs/gitbook-2.6.7/css/style.css" rel="stylesheet" />
<link href="libs/gitbook-2.6.7/css/plugin-table.css" rel="stylesheet" />
<link href="libs/gitbook-2.6.7/css/plugin-bookdown.css" rel="stylesheet" />
<link href="libs/gitbook-2.6.7/css/plugin-highlight.css" rel="stylesheet" />
<link href="libs/gitbook-2.6.7/css/plugin-search.css" rel="stylesheet" />
<link href="libs/gitbook-2.6.7/css/plugin-fontsettings.css" rel="stylesheet" />
<link href="libs/gitbook-2.6.7/css/plugin-clipboard.css" rel="stylesheet" />









<script src="libs/htmlwidgets-1.5.3/htmlwidgets.js"></script>
<script src="libs/plotly-binding-4.9.3.9000/plotly.js"></script>
<script src="libs/typedarray-0.1/typedarray.min.js"></script>
<link href="libs/crosstalk-1.1.1/css/crosstalk.css" rel="stylesheet" />
<script src="libs/crosstalk-1.1.1/js/crosstalk.min.js"></script>
<link href="libs/plotly-htmlwidgets-css-1.57.1/plotly-htmlwidgets.css" rel="stylesheet" />
<script src="libs/plotly-main-1.57.1/plotly-latest.min.js"></script>
<link href="libs/leaflet-1.3.1/leaflet.css" rel="stylesheet" />
<script src="libs/leaflet-1.3.1/leaflet.js"></script>
<link href="libs/leafletfix-1.0.0/leafletfix.css" rel="stylesheet" />
<script src="libs/proj4-2.6.2/proj4.min.js"></script>
<script src="libs/Proj4Leaflet-1.0.1/proj4leaflet.js"></script>
<link href="libs/rstudio_leaflet-1.3.1/rstudio_leaflet.css" rel="stylesheet" />
<script src="libs/leaflet-binding-2.0.4.1/leaflet.js"></script>
<script src="libs/kePrint-0.0.1/kePrint.js"></script>
<link href="libs/lightable-0.0.1/lightable.css" rel="stylesheet" />
<link href="libs/bsTable-3.3.7/bootstrapTable.min.css" rel="stylesheet" />
<script src="libs/bsTable-3.3.7/bootstrapTable.js"></script>


<style type="text/css">
pre > code.sourceCode { white-space: pre; position: relative; }
pre > code.sourceCode > span { display: inline-block; line-height: 1.25; }
pre > code.sourceCode > span:empty { height: 1.2em; }
.sourceCode { overflow: visible; }
code.sourceCode > span { color: inherit; text-decoration: inherit; }
pre.sourceCode { margin: 0; }
@media screen {
div.sourceCode { overflow: auto; }
}
@media print {
pre > code.sourceCode { white-space: pre-wrap; }
pre > code.sourceCode > span { text-indent: -5em; padding-left: 5em; }
}
pre.numberSource code
  { counter-reset: source-line 0; }
pre.numberSource code > span
  { position: relative; left: -4em; counter-increment: source-line; }
pre.numberSource code > span > a:first-child::before
  { content: counter(source-line);
    position: relative; left: -1em; text-align: right; vertical-align: baseline;
    border: none; display: inline-block;
    -webkit-touch-callout: none; -webkit-user-select: none;
    -khtml-user-select: none; -moz-user-select: none;
    -ms-user-select: none; user-select: none;
    padding: 0 4px; width: 4em;
    color: #aaaaaa;
  }
pre.numberSource { margin-left: 3em; border-left: 1px solid #aaaaaa;  padding-left: 4px; }
div.sourceCode
  {   }
@media screen {
pre > code.sourceCode > span > a:first-child::before { text-decoration: underline; }
}
code span.al { color: #ff0000; font-weight: bold; } /* Alert */
code span.an { color: #60a0b0; font-weight: bold; font-style: italic; } /* Annotation */
code span.at { color: #7d9029; } /* Attribute */
code span.bn { color: #40a070; } /* BaseN */
code span.bu { } /* BuiltIn */
code span.cf { color: #007020; font-weight: bold; } /* ControlFlow */
code span.ch { color: #4070a0; } /* Char */
code span.cn { color: #880000; } /* Constant */
code span.co { color: #60a0b0; font-style: italic; } /* Comment */
code span.cv { color: #60a0b0; font-weight: bold; font-style: italic; } /* CommentVar */
code span.do { color: #ba2121; font-style: italic; } /* Documentation */
code span.dt { color: #902000; } /* DataType */
code span.dv { color: #40a070; } /* DecVal */
code span.er { color: #ff0000; font-weight: bold; } /* Error */
code span.ex { } /* Extension */
code span.fl { color: #40a070; } /* Float */
code span.fu { color: #06287e; } /* Function */
code span.im { } /* Import */
code span.in { color: #60a0b0; font-weight: bold; font-style: italic; } /* Information */
code span.kw { color: #007020; font-weight: bold; } /* Keyword */
code span.op { color: #666666; } /* Operator */
code span.ot { color: #007020; } /* Other */
code span.pp { color: #bc7a00; } /* Preprocessor */
code span.sc { color: #4070a0; } /* SpecialChar */
code span.ss { color: #bb6688; } /* SpecialString */
code span.st { color: #4070a0; } /* String */
code span.va { color: #19177c; } /* Variable */
code span.vs { color: #4070a0; } /* VerbatimString */
code span.wa { color: #60a0b0; font-weight: bold; font-style: italic; } /* Warning */
</style>

<link rel="stylesheet" href="style.css" type="text/css" />
</head>

<body>



  <div class="book without-animation with-summary font-size-2 font-family-1" data-basepath=".">

    <div class="book-summary">
      <nav role="navigation">

<ul class="summary">
<li><a href="./">A Minimal Book Example</a></li>

<li class="divider"></li>
<li class="chapter" data-level="1" data-path="index.html"><a href="index.html"><i class="fa fa-check"></i><b>1</b> Preface</a>
<ul>
<li class="chapter" data-level="1.1" data-path="index.html"><a href="index.html#data-sets-used-in-labs-and-exercises"><i class="fa fa-check"></i><b>1.1</b> Data Sets Used in Labs and Exercises</a></li>
<li class="chapter" data-level="1.2" data-path="index.html"><a href="index.html#acknowledgements"><i class="fa fa-check"></i><b>1.2</b> Acknowledgements</a></li>
<li class="chapter" data-level="1.3" data-path="index.html"><a href="index.html#about-the-author"><i class="fa fa-check"></i><b>1.3</b> About the Author</a></li>
</ul></li>
<li class="chapter" data-level="2" data-path="intro.html"><a href="intro.html"><i class="fa fa-check"></i><b>2</b> Introduction</a>
<ul>
<li class="chapter" data-level="2.1" data-path="intro.html"><a href="intro.html#aims-and-scope-of-this-book"><i class="fa fa-check"></i><b>2.1</b> Aims and Scope of This Book</a></li>
<li class="chapter" data-level="2.2" data-path="intro.html"><a href="intro.html#the-structure-of-this-book"><i class="fa fa-check"></i><b>2.2</b> The Structure of This Book</a>
<ul>
<li class="chapter" data-level="2.2.1" data-path="intro.html"><a href="intro.html#infectious-disease-data"><i class="fa fa-check"></i><b>2.2.1</b> Infectious disease data</a></li>
<li class="chapter" data-level="2.2.2" data-path="intro.html"><a href="intro.html#basic-characteristics-of-the-infection-process"><i class="fa fa-check"></i><b>2.2.2</b> Basic characteristics of the infection process</a></li>
<li class="chapter" data-level="2.2.3" data-path="intro.html"><a href="intro.html#data-visualization"><i class="fa fa-check"></i><b>2.2.3</b> Data visualization</a></li>
<li class="chapter" data-level="2.2.4" data-path="intro.html"><a href="intro.html#modeling-and-forecasting"><i class="fa fa-check"></i><b>2.2.4</b> Modeling and Forecasting</a></li>
</ul></li>
</ul></li>
<li class="chapter" data-level="3" data-path="dplyr.html"><a href="dplyr.html"><i class="fa fa-check"></i><b>3</b> Data Wrangling with <code>dplyr</code> and <code>tidyr</code></a>
<ul>
<li class="chapter" data-level="3.1" data-path="dplyr.html"><a href="dplyr.html#learning-dplyr"><i class="fa fa-check"></i><b>3.1</b> Learning <code>dplyr</code></a>
<ul>
<li class="chapter" data-level="3.1.1" data-path="dplyr.html"><a href="dplyr.html#tibbles"><i class="fa fa-check"></i><b>3.1.1</b> Tibbles</a></li>
<li class="chapter" data-level="3.1.2" data-path="dplyr.html"><a href="dplyr.html#import-data"><i class="fa fa-check"></i><b>3.1.2</b> Import data</a></li>
<li class="chapter" data-level="3.1.3" data-path="dplyr.html"><a href="dplyr.html#common-dplyr-functions"><i class="fa fa-check"></i><b>3.1.3</b> Common <code>dplyr</code> functions</a></li>
</ul></li>
<li class="chapter" data-level="3.2" data-path="dplyr.html"><a href="dplyr.html#selecting-columns-and-filtering-rows"><i class="fa fa-check"></i><b>3.2</b> Selecting Columns and Filtering Rows</a>
<ul>
<li class="chapter" data-level="3.2.1" data-path="dplyr.html"><a href="dplyr.html#subset-variables-columns"><i class="fa fa-check"></i><b>3.2.1</b> Subset Variables (Columns)</a></li>
<li class="chapter" data-level="3.2.2" data-path="dplyr.html"><a href="dplyr.html#subset-observations-rows"><i class="fa fa-check"></i><b>3.2.2</b> Subset Observations (Rows)</a></li>
<li class="chapter" data-level="3.2.3" data-path="dplyr.html"><a href="dplyr.html#pipes"><i class="fa fa-check"></i><b>3.2.3</b> Pipes</a></li>
<li class="chapter" data-level="3.2.4" data-path="dplyr.html"><a href="dplyr.html#select-and-order-top-n-entries-by-group-if-grouped-data."><i class="fa fa-check"></i><b>3.2.4</b> Select and order top n entries (by group if grouped data).</a></li>
</ul></li>
<li class="chapter" data-level="3.3" data-path="dplyr.html"><a href="dplyr.html#make-new-variables-mutate"><i class="fa fa-check"></i><b>3.3</b> Make New Variables: Mutate</a></li>
<li class="chapter" data-level="3.4" data-path="dplyr.html"><a href="dplyr.html#summarize-data"><i class="fa fa-check"></i><b>3.4</b> Summarize Data</a></li>
<li class="chapter" data-level="3.5" data-path="dplyr.html"><a href="dplyr.html#combine-data-sets"><i class="fa fa-check"></i><b>3.5</b> Combine Data Sets</a>
<ul>
<li class="chapter" data-level="3.5.1" data-path="dplyr.html"><a href="dplyr.html#the-join-family"><i class="fa fa-check"></i><b>3.5.1</b> The join family</a></li>
<li class="chapter" data-level="3.5.2" data-path="dplyr.html"><a href="dplyr.html#toy-examples-with-joins"><i class="fa fa-check"></i><b>3.5.2</b> Toy examples with joins</a></li>
<li class="chapter" data-level="3.5.3" data-path="dplyr.html"><a href="dplyr.html#practice-with-joins-for-real-data"><i class="fa fa-check"></i><b>3.5.3</b> Practice with joins for real data</a></li>
</ul></li>
<li class="chapter" data-level="3.6" data-path="dplyr.html"><a href="dplyr.html#reshaping-data"><i class="fa fa-check"></i><b>3.6</b> Reshaping Data</a>
<ul>
<li class="chapter" data-level="3.6.1" data-path="dplyr.html"><a href="dplyr.html#from-wide-to-long"><i class="fa fa-check"></i><b>3.6.1</b> From wide to long</a></li>
<li class="chapter" data-level="3.6.2" data-path="dplyr.html"><a href="dplyr.html#from-long-to-wide"><i class="fa fa-check"></i><b>3.6.2</b> From long to wide</a></li>
</ul></li>
<li class="chapter" data-level="3.7" data-path="dplyr.html"><a href="dplyr.html#exercises"><i class="fa fa-check"></i><b>3.7</b> Exercises</a></li>
</ul></li>
<li class="chapter" data-level="4" data-path="ggplot2.html"><a href="ggplot2.html"><i class="fa fa-check"></i><b>4</b> Data Visualization with ggplot2</a>
<ul>
<li class="chapter" data-level="4.1" data-path="ggplot2.html"><a href="ggplot2.html#introduction"><i class="fa fa-check"></i><b>4.1</b> Introduction</a></li>
<li class="chapter" data-level="4.2" data-path="ggplot2.html"><a href="ggplot2.html#types-of-variables-and-preparation"><i class="fa fa-check"></i><b>4.2</b> Types of Variables and Preparation</a>
<ul>
<li class="chapter" data-level="4.2.1" data-path="ggplot2.html"><a href="ggplot2.html#types-of-variables"><i class="fa fa-check"></i><b>4.2.1</b> Types of Variables</a></li>
<li class="chapter" data-level="4.2.2" data-path="ggplot2.html"><a href="ggplot2.html#rules-for-graph-designing"><i class="fa fa-check"></i><b>4.2.2</b> Rules for Graph Designing</a></li>
<li class="chapter" data-level="4.2.3" data-path="ggplot2.html"><a href="ggplot2.html#installing-packages-and-loading-data"><i class="fa fa-check"></i><b>4.2.3</b> Installing packages and loading data</a></li>
<li class="chapter" data-level="4.2.4" data-path="ggplot2.html"><a href="ggplot2.html#your-first-scatterplot"><i class="fa fa-check"></i><b>4.2.4</b> Your first scatterplot</a></li>
</ul></li>
<li class="chapter" data-level="4.3" data-path="ggplot2.html"><a href="ggplot2.html#position-scales-and-axes"><i class="fa fa-check"></i><b>4.3</b> Position Scales and Axes</a>
<ul>
<li class="chapter" data-level="4.3.1" data-path="ggplot2.html"><a href="ggplot2.html#change-the-labels-of-the-axis-using-xlab-and-ylab"><i class="fa fa-check"></i><b>4.3.1</b> Change the labels of the axis using <code>xlab()</code> and <code>ylab()</code></a></li>
<li class="chapter" data-level="4.3.2" data-path="ggplot2.html"><a href="ggplot2.html#change-the-range-of-the-axis-using-xlim-and-ylim"><i class="fa fa-check"></i><b>4.3.2</b> Change the range of the axis using <code>xlim()</code> and <code>ylim()</code></a></li>
</ul></li>
<li class="chapter" data-level="4.4" data-path="ggplot2.html"><a href="ggplot2.html#color-scales-and-size-of-geom_points"><i class="fa fa-check"></i><b>4.4</b> Color Scales and Size of <code>geom_points()</code></a>
<ul>
<li class="chapter" data-level="4.4.1" data-path="ggplot2.html"><a href="ggplot2.html#change-the-color-of-all-points"><i class="fa fa-check"></i><b>4.4.1</b> Change the color of all points</a></li>
<li class="chapter" data-level="4.4.2" data-path="ggplot2.html"><a href="ggplot2.html#color-the-observations-by-the-value-of-a-feature"><i class="fa fa-check"></i><b>4.4.2</b> Color the observations by the value of a feature</a></li>
<li class="chapter" data-level="4.4.3" data-path="ggplot2.html"><a href="ggplot2.html#change-the-color-palette"><i class="fa fa-check"></i><b>4.4.3</b> Change the color palette</a></li>
<li class="chapter" data-level="4.4.4" data-path="ggplot2.html"><a href="ggplot2.html#change-the-size-by-the-value-of-a-feature"><i class="fa fa-check"></i><b>4.4.4</b> Change the size by the value of a feature</a></li>
</ul></li>
<li class="chapter" data-level="4.5" data-path="ggplot2.html"><a href="ggplot2.html#individual-geoms"><i class="fa fa-check"></i><b>4.5</b> Individual geoms</a>
<ul>
<li class="chapter" data-level="4.5.1" data-path="ggplot2.html"><a href="ggplot2.html#histogram"><i class="fa fa-check"></i><b>4.5.1</b> Histogram</a></li>
<li class="chapter" data-level="4.5.2" data-path="ggplot2.html"><a href="ggplot2.html#bar-chart"><i class="fa fa-check"></i><b>4.5.2</b> Bar chart</a></li>
<li class="chapter" data-level="4.5.3" data-path="ggplot2.html"><a href="ggplot2.html#default-bar-chart"><i class="fa fa-check"></i><b>4.5.3</b> Default bar chart</a></li>
<li class="chapter" data-level="4.5.4" data-path="ggplot2.html"><a href="ggplot2.html#bar-chart-with-assigned-value"><i class="fa fa-check"></i><b>4.5.4</b> Bar chart with assigned value</a></li>
<li class="chapter" data-level="4.5.5" data-path="ggplot2.html"><a href="ggplot2.html#legend"><i class="fa fa-check"></i><b>4.5.5</b> Legend</a></li>
<li class="chapter" data-level="4.5.6" data-path="ggplot2.html"><a href="ggplot2.html#boxplots-jittering-and-violin-plots"><i class="fa fa-check"></i><b>4.5.6</b> Boxplots, jittering and violin plots</a></li>
</ul></li>
<li class="chapter" data-level="4.6" data-path="ggplot2.html"><a href="ggplot2.html#collective-geoms"><i class="fa fa-check"></i><b>4.6</b> Collective geoms</a>
<ul>
<li class="chapter" data-level="4.6.1" data-path="ggplot2.html"><a href="ggplot2.html#smoother"><i class="fa fa-check"></i><b>4.6.1</b> Smoother</a></li>
</ul></li>
<li class="chapter" data-level="4.7" data-path="ggplot2.html"><a href="ggplot2.html#time-series"><i class="fa fa-check"></i><b>4.7</b> Time Series</a>
<ul>
<li class="chapter" data-level="4.7.1" data-path="ggplot2.html"><a href="ggplot2.html#basic-line-plots"><i class="fa fa-check"></i><b>4.7.1</b> Basic line plots</a></li>
<li class="chapter" data-level="4.7.2" data-path="ggplot2.html"><a href="ggplot2.html#add-a-second-line"><i class="fa fa-check"></i><b>4.7.2</b> Add a second line</a></li>
<li class="chapter" data-level="4.7.3" data-path="ggplot2.html"><a href="ggplot2.html#add-ribbons"><i class="fa fa-check"></i><b>4.7.3</b> Add ribbons</a></li>
<li class="chapter" data-level="4.7.4" data-path="ggplot2.html"><a href="ggplot2.html#adjust-the-scale-of-time-axis"><i class="fa fa-check"></i><b>4.7.4</b> Adjust the scale of time axis</a></li>
<li class="chapter" data-level="4.7.5" data-path="ggplot2.html"><a href="ggplot2.html#add-annotations"><i class="fa fa-check"></i><b>4.7.5</b> Add annotations</a></li>
</ul></li>
<li class="chapter" data-level="4.8" data-path="ggplot2.html"><a href="ggplot2.html#maps"><i class="fa fa-check"></i><b>4.8</b> Maps</a>
<ul>
<li class="chapter" data-level="4.8.1" data-path="ggplot2.html"><a href="ggplot2.html#making-a-base-map"><i class="fa fa-check"></i><b>4.8.1</b> Making a base map</a></li>
<li class="chapter" data-level="4.8.2" data-path="ggplot2.html"><a href="ggplot2.html#customizing-choropleth-map"><i class="fa fa-check"></i><b>4.8.2</b> Customizing <code>choropleth</code> map</a></li>
<li class="chapter" data-level="4.8.3" data-path="ggplot2.html"><a href="ggplot2.html#overlay-polygon-maps"><i class="fa fa-check"></i><b>4.8.3</b> Overlay polygon maps</a></li>
</ul></li>
<li class="chapter" data-level="4.9" data-path="ggplot2.html"><a href="ggplot2.html#arranging-plots"><i class="fa fa-check"></i><b>4.9</b> Arranging Plots</a>
<ul>
<li class="chapter" data-level="4.9.1" data-path="ggplot2.html"><a href="ggplot2.html#facet"><i class="fa fa-check"></i><b>4.9.1</b> Facet</a></li>
<li class="chapter" data-level="4.9.2" data-path="ggplot2.html"><a href="ggplot2.html#combining-plots-using-patchwork-package"><i class="fa fa-check"></i><b>4.9.2</b> Combining plots using <code>patchwork</code> package</a></li>
</ul></li>
<li class="chapter" data-level="4.10" data-path="ggplot2.html"><a href="ggplot2.html#output"><i class="fa fa-check"></i><b>4.10</b> Output</a>
<ul>
<li class="chapter" data-level="4.10.1" data-path="ggplot2.html"><a href="ggplot2.html#save-in-figure-format"><i class="fa fa-check"></i><b>4.10.1</b> Save in figure format</a></li>
<li class="chapter" data-level="4.10.2" data-path="ggplot2.html"><a href="ggplot2.html#save-in-rds-format"><i class="fa fa-check"></i><b>4.10.2</b> Save in RDS format</a></li>
</ul></li>
<li class="chapter" data-level="4.11" data-path="ggplot2.html"><a href="ggplot2.html#exercises-1"><i class="fa fa-check"></i><b>4.11</b> Exercises</a></li>
</ul></li>
<li class="chapter" data-level="5" data-path="plotly.html"><a href="plotly.html"><i class="fa fa-check"></i><b>5</b> Interactive Visualization</a>
<ul>
<li class="chapter" data-level="5.1" data-path="plotly.html"><a href="plotly.html#an-introduction"><i class="fa fa-check"></i><b>5.1</b> An Introduction</a></li>
<li class="chapter" data-level="5.2" data-path="plotly.html"><a href="plotly.html#creating-plotly-objects"><i class="fa fa-check"></i><b>5.2</b> Creating Plotly Objects</a>
<ul>
<li class="chapter" data-level="5.2.1" data-path="plotly.html"><a href="plotly.html#using-plot_ly-to-create-a-plotly-object"><i class="fa fa-check"></i><b>5.2.1</b> Using <code>plot_ly()</code> to create a plotly object</a></li>
<li class="chapter" data-level="5.2.2" data-path="plotly.html"><a href="plotly.html#use-dplyr-verbs-to-modify-data"><i class="fa fa-check"></i><b>5.2.2</b> Use <code>dplyr</code> verbs to modify data</a></li>
<li class="chapter" data-level="5.2.3" data-path="plotly.html"><a href="plotly.html#using-ggplotly-to-create-a-plotly-object"><i class="fa fa-check"></i><b>5.2.3</b> Using <code>ggplotly()</code> to create a <code>plotly</code> object</a></li>
</ul></li>
<li class="chapter" data-level="5.3" data-path="plotly.html"><a href="plotly.html#scatterplots-and-line-plots"><i class="fa fa-check"></i><b>5.3</b> Scatterplots and Line Plots</a>
<ul>
<li class="chapter" data-level="5.3.1" data-path="plotly.html"><a href="plotly.html#make-a-scatterplot"><i class="fa fa-check"></i><b>5.3.1</b> Make a scatterplot</a></li>
<li class="chapter" data-level="5.3.2" data-path="plotly.html"><a href="plotly.html#markers"><i class="fa fa-check"></i><b>5.3.2</b> Markers</a></li>
<li class="chapter" data-level="5.3.3" data-path="plotly.html"><a href="plotly.html#a-single-time-series-plot"><i class="fa fa-check"></i><b>5.3.3</b> A single time series plot</a></li>
<li class="chapter" data-level="5.3.4" data-path="plotly.html"><a href="plotly.html#hover-text-and-template"><i class="fa fa-check"></i><b>5.3.4</b> Hover text and template</a></li>
<li class="chapter" data-level="5.3.5" data-path="plotly.html"><a href="plotly.html#multiple-time-series-plots"><i class="fa fa-check"></i><b>5.3.5</b> Multiple time series plots</a></li>
<li class="chapter" data-level="5.3.6" data-path="plotly.html"><a href="plotly.html#more-features-about-the-lines"><i class="fa fa-check"></i><b>5.3.6</b> More features about the lines</a></li>
<li class="chapter" data-level="5.3.7" data-path="plotly.html"><a href="plotly.html#add-ribbons-1"><i class="fa fa-check"></i><b>5.3.7</b> Add ribbons</a></li>
</ul></li>
<li class="chapter" data-level="5.4" data-path="plotly.html"><a href="plotly.html#pie-charts"><i class="fa fa-check"></i><b>5.4</b> Pie Charts</a>
<ul>
<li class="chapter" data-level="5.4.1" data-path="plotly.html"><a href="plotly.html#draw-static-pie-charts-using-ggplot2"><i class="fa fa-check"></i><b>5.4.1</b> Draw static pie charts using ggplot2</a></li>
<li class="chapter" data-level="5.4.2" data-path="plotly.html"><a href="plotly.html#draw-interactive-pie-charts"><i class="fa fa-check"></i><b>5.4.2</b> Draw interactive pie charts</a></li>
</ul></li>
<li class="chapter" data-level="5.5" data-path="plotly.html"><a href="plotly.html#animation"><i class="fa fa-check"></i><b>5.5</b> Animation</a>
<ul>
<li class="chapter" data-level="5.5.1" data-path="plotly.html"><a href="plotly.html#an-animation-of-the-evolution-of-infected-vs.-death-count"><i class="fa fa-check"></i><b>5.5.1</b> An animation of the evolution of infected vs. death count</a></li>
<li class="chapter" data-level="5.5.2" data-path="plotly.html"><a href="plotly.html#an-animation-of-the-state-level-time-series-plot-of-infected-count"><i class="fa fa-check"></i><b>5.5.2</b> An animation of the state-level time series plot of infected count</a></li>
</ul></li>
<li class="chapter" data-level="5.6" data-path="plotly.html"><a href="plotly.html#saving-html"><i class="fa fa-check"></i><b>5.6</b> Saving HTML</a>
<ul>
<li class="chapter" data-level="5.6.1" data-path="plotly.html"><a href="plotly.html#save-as-a-standalone-html-file"><i class="fa fa-check"></i><b>5.6.1</b> Save as a standalone HTML file</a></li>
<li class="chapter" data-level="5.6.2" data-path="plotly.html"><a href="plotly.html#save-as-non-selfcontained-html-file"><i class="fa fa-check"></i><b>5.6.2</b> Save as non-selfcontained HTML file</a></li>
</ul></li>
<li class="chapter" data-level="5.7" data-path="plotly.html"><a href="plotly.html#exercises-2"><i class="fa fa-check"></i><b>5.7</b> Exercises</a></li>
</ul></li>
<li class="chapter" data-level="6" data-path="shiny.html"><a href="shiny.html"><i class="fa fa-check"></i><b>6</b> R Shiny</a>
<ul>
<li class="chapter" data-level="6.1" data-path="shiny.html"><a href="shiny.html#an-introduction-to-shiny"><i class="fa fa-check"></i><b>6.1</b> An Introduction to Shiny</a>
<ul>
<li class="chapter" data-level="6.1.1" data-path="shiny.html"><a href="shiny.html#your-first-shiny-app"><i class="fa fa-check"></i><b>6.1.1</b> Your first shiny app</a></li>
<li class="chapter" data-level="6.1.2" data-path="shiny.html"><a href="shiny.html#create-a-new-shiny-app-in-rstudio"><i class="fa fa-check"></i><b>6.1.2</b> Create a new shiny app in RStudio</a></li>
<li class="chapter" data-level="6.1.3" data-path="shiny.html"><a href="shiny.html#share-your-app"><i class="fa fa-check"></i><b>6.1.3</b> Share your app</a></li>
</ul></li>
<li class="chapter" data-level="6.2" data-path="shiny.html"><a href="shiny.html#useful-input-widgets"><i class="fa fa-check"></i><b>6.2</b> Useful Input Widgets</a></li>
<li class="chapter" data-level="6.3" data-path="shiny.html"><a href="shiny.html#displaying-reactive-output"><i class="fa fa-check"></i><b>6.3</b> Displaying Reactive Output</a></li>
<li class="chapter" data-level="6.4" data-path="shiny.html"><a href="shiny.html#rendering-plotly-inside-shiny"><i class="fa fa-check"></i><b>6.4</b> Rendering Plotly Inside Shiny</a></li>
</ul></li>
<li class="chapter" data-level="7" data-path="map.html"><a href="map.html"><i class="fa fa-check"></i><b>7</b> Interactive Geospatial Visualization</a>
<ul>
<li class="chapter" data-level="7.1" data-path="map.html"><a href="map.html#an-introduction-to-leaflet"><i class="fa fa-check"></i><b>7.1</b> An Introduction to Leaflet</a>
<ul>
<li class="chapter" data-level="7.1.1" data-path="map.html"><a href="map.html#more-references"><i class="fa fa-check"></i><b>7.1.1</b> More References</a></li>
<li class="chapter" data-level="7.1.2" data-path="map.html"><a href="map.html#features-and-installation"><i class="fa fa-check"></i><b>7.1.2</b> Features and installation</a></li>
<li class="chapter" data-level="7.1.3" data-path="map.html"><a href="map.html#basic-usage"><i class="fa fa-check"></i><b>7.1.3</b> Basic Usage</a></li>
</ul></li>
<li class="chapter" data-level="7.2" data-path="map.html"><a href="map.html#the-data-object"><i class="fa fa-check"></i><b>7.2</b> The Data Object</a></li>
<li class="chapter" data-level="7.3" data-path="map.html"><a href="map.html#choropleth-map"><i class="fa fa-check"></i><b>7.3</b> Choropleth map</a>
<ul>
<li class="chapter" data-level="7.3.1" data-path="map.html"><a href="map.html#create-a-base-map"><i class="fa fa-check"></i><b>7.3.1</b> Create a base map</a></li>
<li class="chapter" data-level="7.3.2" data-path="map.html"><a href="map.html#color-the-map"><i class="fa fa-check"></i><b>7.3.2</b> Color the map</a></li>
<li class="chapter" data-level="7.3.3" data-path="map.html"><a href="map.html#interactive-map"><i class="fa fa-check"></i><b>7.3.3</b> Interactive map</a></li>
</ul></li>
<li class="chapter" data-level="7.4" data-path="map.html"><a href="map.html#legend-1"><i class="fa fa-check"></i><b>7.4</b> Legend</a>
<ul>
<li class="chapter" data-level="7.4.1" data-path="map.html"><a href="map.html#classification-schemes"><i class="fa fa-check"></i><b>7.4.1</b> Classification schemes</a></li>
<li class="chapter" data-level="7.4.2" data-path="map.html"><a href="map.html#mapping-variables-to-colors"><i class="fa fa-check"></i><b>7.4.2</b> Mapping variables to colors</a></li>
</ul></li>
<li class="chapter" data-level="7.5" data-path="map.html"><a href="map.html#an-example-of-county-level-map"><i class="fa fa-check"></i><b>7.5</b> An Example of County-level Map</a></li>
<li class="chapter" data-level="7.6" data-path="map.html"><a href="map.html#spot-maps"><i class="fa fa-check"></i><b>7.6</b> Spot Maps</a>
<ul>
<li class="chapter" data-level="7.6.1" data-path="map.html"><a href="map.html#adding-circles"><i class="fa fa-check"></i><b>7.6.1</b> Adding circles</a></li>
<li class="chapter" data-level="7.6.2" data-path="map.html"><a href="map.html#add-popups"><i class="fa fa-check"></i><b>7.6.2</b> Add popups</a></li>
<li class="chapter" data-level="7.6.3" data-path="map.html"><a href="map.html#add-labels"><i class="fa fa-check"></i><b>7.6.3</b> Add labels</a></li>
</ul></li>
<li class="chapter" data-level="7.7" data-path="map.html"><a href="map.html#integrating-leaflet-with-r-shiny"><i class="fa fa-check"></i><b>7.7</b> Integrating Leaflet with R Shiny</a></li>
<li class="chapter" data-level="7.8" data-path="map.html"><a href="map.html#exercises-3"><i class="fa fa-check"></i><b>7.8</b> Exercises</a></li>
</ul></li>
<li class="chapter" data-level="8" data-path="modeling.html"><a href="modeling.html"><i class="fa fa-check"></i><b>8</b> Epidemic Modeling</a>
<ul>
<li class="chapter" data-level="8.1" data-path="modeling.html"><a href="modeling.html#an-introduction-to-epidemic-modeling"><i class="fa fa-check"></i><b>8.1</b> An Introduction to Epidemic Modeling</a></li>
<li class="chapter" data-level="8.2" data-path="modeling.html"><a href="modeling.html#mechanistic-models"><i class="fa fa-check"></i><b>8.2</b> Mechanistic Models</a>
<ul>
<li class="chapter" data-level="8.2.1" data-path="modeling.html"><a href="modeling.html#compartment-modeling"><i class="fa fa-check"></i><b>8.2.1</b> Compartment Modeling</a></li>
<li class="chapter" data-level="8.2.2" data-path="modeling.html"><a href="modeling.html#agent-based-methods"><i class="fa fa-check"></i><b>8.2.2</b> Agent-based Methods</a></li>
</ul></li>
<li class="chapter" data-level="8.3" data-path="modeling.html"><a href="modeling.html#phenomenological-models"><i class="fa fa-check"></i><b>8.3</b> Phenomenological Models</a>
<ul>
<li class="chapter" data-level="8.3.1" data-path="modeling.html"><a href="modeling.html#time-series-analysis"><i class="fa fa-check"></i><b>8.3.1</b> Time Series Analysis</a></li>
<li class="chapter" data-level="8.3.2" data-path="modeling.html"><a href="modeling.html#regression-methods"><i class="fa fa-check"></i><b>8.3.2</b> Regression methods</a></li>
<li class="chapter" data-level="8.3.3" data-path="modeling.html"><a href="modeling.html#machine-learning-methods"><i class="fa fa-check"></i><b>8.3.3</b> Machine learning methods</a></li>
</ul></li>
<li class="chapter" data-level="8.4" data-path="modeling.html"><a href="modeling.html#hybrid-models-and-ensemble-methods"><i class="fa fa-check"></i><b>8.4</b> Hybrid Models and Ensemble Methods</a></li>
<li class="chapter" data-level="8.5" data-path="modeling.html"><a href="modeling.html#epidemic-modeling-mathematical-and-statistical-perspectives"><i class="fa fa-check"></i><b>8.5</b> Epidemic Modeling: Mathematical and Statistical Perspectives</a></li>
<li class="chapter" data-level="8.6" data-path="modeling.html"><a href="modeling.html#some-terminologies-in-epidemic-modeling"><i class="fa fa-check"></i><b>8.6</b> Some Terminologies in Epidemic Modeling</a></li>
</ul></li>
<li class="chapter" data-level="9" data-path="compartment.html"><a href="compartment.html"><i class="fa fa-check"></i><b>9</b> Compartment Models</a>
<ul>
<li class="chapter" data-level="9.1" data-path="compartment.html"><a href="compartment.html#a-simple-sis-model-a-model-for-diseases-with-no-immunity"><i class="fa fa-check"></i><b>9.1</b> A Simple SIS Model (A Model for Diseases with No Immunity)</a></li>
<li class="chapter" data-level="9.2" data-path="compartment.html"><a href="compartment.html#an-sir-model"><i class="fa fa-check"></i><b>9.2</b> An SIR Model</a>
<ul>
<li class="chapter" data-level="9.2.1" data-path="compartment.html"><a href="compartment.html#an-sir-model-with-births-and-deaths"><i class="fa fa-check"></i><b>9.2.1</b> An SIR model with births and deaths</a></li>
</ul></li>
<li class="chapter" data-level="9.3" data-path="compartment.html"><a href="compartment.html#sir-parameter-estimation"><i class="fa fa-check"></i><b>9.3</b> SIR parameter estimation</a></li>
<li class="chapter" data-level="9.4" data-path="compartment.html"><a href="compartment.html#implementation-of-parameter-estimation-in-r"><i class="fa fa-check"></i><b>9.4</b> Implementation of parameter estimation in R</a>
<ul>
<li class="chapter" data-level="9.4.1" data-path="compartment.html"><a href="compartment.html#example-1.-outbreak-of-measles-in-niamey"><i class="fa fa-check"></i><b>9.4.1</b> Example 1. Outbreak of measles in Niamey</a></li>
<li class="chapter" data-level="9.4.2" data-path="compartment.html"><a href="compartment.html#example-2.-covid-19"><i class="fa fa-check"></i><b>9.4.2</b> Example 2. COVID-19</a></li>
</ul></li>
<li class="chapter" data-level="9.5" data-path="compartment.html"><a href="compartment.html#basic-reproduction-number"><i class="fa fa-check"></i><b>9.5</b> Basic Reproduction Number</a>
<ul>
<li class="chapter" data-level="9.5.1" data-path="compartment.html"><a href="compartment.html#seir-model"><i class="fa fa-check"></i><b>9.5.1</b> SEIR Model</a></li>
</ul></li>
<li class="chapter" data-level="9.6" data-path="compartment.html"><a href="compartment.html#herd-immunity"><i class="fa fa-check"></i><b>9.6</b> Herd Immunity</a></li>
<li class="chapter" data-level="9.7" data-path="compartment.html"><a href="compartment.html#exercises-4"><i class="fa fa-check"></i><b>9.7</b> Exercises</a></li>
</ul></li>
<li class="chapter" data-level="10" data-path="timeseries.html"><a href="timeseries.html"><i class="fa fa-check"></i><b>10</b> Time Series Analysis of Infectious Disease Data</a>
<ul>
<li class="chapter" data-level="10.1" data-path="timeseries.html"><a href="timeseries.html#datasets-and-r-packages"><i class="fa fa-check"></i><b>10.1</b> Datasets and R Packages</a></li>
<li class="chapter" data-level="10.2" data-path="timeseries.html"><a href="timeseries.html#an-introduction-to-time-series-analysis"><i class="fa fa-check"></i><b>10.2</b> An Introduction to Time Series Analysis</a>
<ul>
<li class="chapter" data-level="10.2.1" data-path="timeseries.html"><a href="timeseries.html#tsibble-objects"><i class="fa fa-check"></i><b>10.2.1</b> “tsibble” objects</a></li>
<li class="chapter" data-level="10.2.2" data-path="timeseries.html"><a href="timeseries.html#working-with-tsibble-objects"><i class="fa fa-check"></i><b>10.2.2</b> Working with “tsibble” objects</a></li>
<li class="chapter" data-level="10.2.3" data-path="timeseries.html"><a href="timeseries.html#drawing-time-series-plots"><i class="fa fa-check"></i><b>10.2.3</b> Drawing time series plots</a></li>
<li class="chapter" data-level="10.2.4" data-path="timeseries.html"><a href="timeseries.html#objectives-of-time-series-analysis"><i class="fa fa-check"></i><b>10.2.4</b> Objectives of Time Series Analysis</a></li>
<li class="chapter" data-level="10.2.5" data-path="timeseries.html"><a href="timeseries.html#stationarity"><i class="fa fa-check"></i><b>10.2.5</b> Stationarity</a></li>
<li class="chapter" data-level="10.2.6" data-path="timeseries.html"><a href="timeseries.html#autocorrelation"><i class="fa fa-check"></i><b>10.2.6</b> Autocorrelation</a></li>
</ul></li>
<li class="chapter" data-level="10.3" data-path="timeseries.html"><a href="timeseries.html#time-series-decomposition"><i class="fa fa-check"></i><b>10.3</b> Time Series Decomposition</a>
<ul>
<li class="chapter" data-level="10.3.1" data-path="timeseries.html"><a href="timeseries.html#box-cox-transformations"><i class="fa fa-check"></i><b>10.3.1</b> Box-Cox transformations</a></li>
<li class="chapter" data-level="10.3.2" data-path="timeseries.html"><a href="timeseries.html#methods-for-estimating-the-trend"><i class="fa fa-check"></i><b>10.3.2</b> Methods for estimating the trend</a></li>
<li class="chapter" data-level="10.3.3" data-path="timeseries.html"><a href="timeseries.html#seasonal-component"><i class="fa fa-check"></i><b>10.3.3</b> Seasonal component</a></li>
<li class="chapter" data-level="10.3.4" data-path="timeseries.html"><a href="timeseries.html#trend-and-seasonal-estimation"><i class="fa fa-check"></i><b>10.3.4</b> Trend and seasonal estimation:</a></li>
<li class="chapter" data-level="10.3.5" data-path="timeseries.html"><a href="timeseries.html#seasonal-and-trend-decomposition-using-loess-stl"><i class="fa fa-check"></i><b>10.3.5</b> Seasonal and trend decomposition using Loess (STL)</a></li>
</ul></li>
<li class="chapter" data-level="10.4" data-path="timeseries.html"><a href="timeseries.html#simple-time-series-forecasting-approaches"><i class="fa fa-check"></i><b>10.4</b> Simple Time Series Forecasting Approaches</a>
<ul>
<li class="chapter" data-level="10.4.1" data-path="timeseries.html"><a href="timeseries.html#average-method"><i class="fa fa-check"></i><b>10.4.1</b> Average method</a></li>
<li class="chapter" data-level="10.4.2" data-path="timeseries.html"><a href="timeseries.html#random-walk-forecasts"><i class="fa fa-check"></i><b>10.4.2</b> Random walk forecasts</a></li>
<li class="chapter" data-level="10.4.3" data-path="timeseries.html"><a href="timeseries.html#seasonal-random-walk-forecasts"><i class="fa fa-check"></i><b>10.4.3</b> Seasonal random walk forecasts</a></li>
<li class="chapter" data-level="10.4.4" data-path="timeseries.html"><a href="timeseries.html#random-walk-with-drift-method"><i class="fa fa-check"></i><b>10.4.4</b> Random walk with drift method</a></li>
<li class="chapter" data-level="10.4.5" data-path="timeseries.html"><a href="timeseries.html#displaying-all-the-forecasting-results"><i class="fa fa-check"></i><b>10.4.5</b> Displaying all the forecasting results</a></li>
<li class="chapter" data-level="10.4.6" data-path="timeseries.html"><a href="timeseries.html#distributional-forecasts-and-prediction-intervals"><i class="fa fa-check"></i><b>10.4.6</b> Distributional forecasts and prediction intervals</a></li>
</ul></li>
<li class="chapter" data-level="10.5" data-path="timeseries.html"><a href="timeseries.html#residual-diagnostics-and-accuracy-evaluation"><i class="fa fa-check"></i><b>10.5</b> Residual Diagnostics and Accuracy Evaluation</a>
<ul>
<li class="chapter" data-level="10.5.1" data-path="timeseries.html"><a href="timeseries.html#residual-diagnostics"><i class="fa fa-check"></i><b>10.5.1</b> Residual diagnostics</a></li>
<li class="chapter" data-level="10.5.2" data-path="timeseries.html"><a href="timeseries.html#forecasting-accuracy"><i class="fa fa-check"></i><b>10.5.2</b> Forecasting accuracy</a></li>
</ul></li>
<li class="chapter" data-level="10.6" data-path="timeseries.html"><a href="timeseries.html#arima-models"><i class="fa fa-check"></i><b>10.6</b> ARIMA Models</a>
<ul>
<li class="chapter" data-level="10.6.1" data-path="timeseries.html"><a href="timeseries.html#differencing"><i class="fa fa-check"></i><b>10.6.1</b> Differencing</a></li>
<li class="chapter" data-level="10.6.2" data-path="timeseries.html"><a href="timeseries.html#arma-models"><i class="fa fa-check"></i><b>10.6.2</b> ARMA models</a></li>
<li class="chapter" data-level="10.6.3" data-path="timeseries.html"><a href="timeseries.html#simple-examples-of-arma-models"><i class="fa fa-check"></i><b>10.6.3</b> Simple examples of ARMA models</a></li>
<li class="chapter" data-level="10.6.4" data-path="timeseries.html"><a href="timeseries.html#arima-models-1"><i class="fa fa-check"></i><b>10.6.4</b> ARIMA models</a></li>
<li class="chapter" data-level="10.6.5" data-path="timeseries.html"><a href="timeseries.html#seasonal-arima-sarima-model"><i class="fa fa-check"></i><b>10.6.5</b> Seasonal ARIMA (SARIMA) model</a></li>
<li class="chapter" data-level="10.6.6" data-path="timeseries.html"><a href="timeseries.html#building-sarima-models"><i class="fa fa-check"></i><b>10.6.6</b> Building SARIMA Models</a></li>
</ul></li>
<li class="chapter" data-level="10.7" data-path="timeseries.html"><a href="timeseries.html#model-comparison"><i class="fa fa-check"></i><b>10.7</b> Model Comparison</a>
<ul>
<li class="chapter" data-level="10.7.1" data-path="timeseries.html"><a href="timeseries.html#exponential-smoothing-and-arima-models"><i class="fa fa-check"></i><b>10.7.1</b> Exponential smoothing and ARIMA models</a></li>
<li class="chapter" data-level="10.7.2" data-path="timeseries.html"><a href="timeseries.html#cross-validation-for-time-series-analysis"><i class="fa fa-check"></i><b>10.7.2</b> Cross-validation for Time series analysis</a></li>
</ul></li>
<li class="chapter" data-level="10.8" data-path="timeseries.html"><a href="timeseries.html#ensuring-forecasts-stay-within-limits"><i class="fa fa-check"></i><b>10.8</b> Ensuring Forecasts Stay Within Limits</a>
<ul>
<li class="chapter" data-level="10.8.1" data-path="timeseries.html"><a href="timeseries.html#positive-forecasts"><i class="fa fa-check"></i><b>10.8.1</b> Positive forecasts</a></li>
<li class="chapter" data-level="10.8.2" data-path="timeseries.html"><a href="timeseries.html#forecasts-constrained-to-an-interval"><i class="fa fa-check"></i><b>10.8.2</b> Forecasts constrained to an interval</a></li>
</ul></li>
<li class="chapter" data-level="10.9" data-path="timeseries.html"><a href="timeseries.html#prediction-and-prediction-intervals-for-aggregates"><i class="fa fa-check"></i><b>10.9</b> Prediction and Prediction Intervals for Aggregates</a></li>
<li class="chapter" data-level="10.10" data-path="timeseries.html"><a href="timeseries.html#exercises-5"><i class="fa fa-check"></i><b>10.10</b> Exercises</a></li>
</ul></li>
<li class="chapter" data-level="11" data-path="regression.html"><a href="regression.html"><i class="fa fa-check"></i><b>11</b> Regression Methods</a>
<ul>
<li class="chapter" data-level="11.1" data-path="regression.html"><a href="regression.html#parametric-regression-methods"><i class="fa fa-check"></i><b>11.1</b> Parametric Regression Methods</a>
<ul>
<li class="chapter" data-level="11.1.1" data-path="regression.html"><a href="regression.html#examples"><i class="fa fa-check"></i><b>11.1.1</b> Examples</a></li>
<li class="chapter" data-level="11.1.2" data-path="regression.html"><a href="regression.html#model-adequacy-checking"><i class="fa fa-check"></i><b>11.1.2</b> Model adequacy checking</a></li>
</ul></li>
<li class="chapter" data-level="11.2" data-path="regression.html"><a href="regression.html#nonparametric-regression-methods"><i class="fa fa-check"></i><b>11.2</b> Nonparametric Regression Methods</a>
<ul>
<li class="chapter" data-level="11.2.1" data-path="regression.html"><a href="regression.html#piecewise-constant-splines"><i class="fa fa-check"></i><b>11.2.1</b> Piecewise constant splines</a></li>
<li class="chapter" data-level="11.2.2" data-path="regression.html"><a href="regression.html#truncated-power-splines"><i class="fa fa-check"></i><b>11.2.2</b> Truncated power splines</a></li>
<li class="chapter" data-level="11.2.3" data-path="regression.html"><a href="regression.html#b-splines-and-natural-splines"><i class="fa fa-check"></i><b>11.2.3</b> B-splines and natural splines</a></li>
<li class="chapter" data-level="11.2.4" data-path="regression.html"><a href="regression.html#smoothing-splines"><i class="fa fa-check"></i><b>11.2.4</b> Smoothing splines</a></li>
</ul></li>
<li class="chapter" data-level="11.3" data-path="regression.html"><a href="regression.html#example-cdc-fluview-portal-data"><i class="fa fa-check"></i><b>11.3</b> Example: CDC FluView Portal Data</a></li>
<li class="chapter" data-level="11.4" data-path="regression.html"><a href="regression.html#poisson-regression"><i class="fa fa-check"></i><b>11.4</b> Poisson regression</a></li>
<li class="chapter" data-level="11.5" data-path="regression.html"><a href="regression.html#logistic-regression"><i class="fa fa-check"></i><b>11.5</b> Logistic regression</a>
<ul>
<li class="chapter" data-level="11.5.1" data-path="regression.html"><a href="regression.html#odds-and-odds-ratios"><i class="fa fa-check"></i><b>11.5.1</b> Odds and odds ratios</a></li>
<li class="chapter" data-level="11.5.2" data-path="regression.html"><a href="regression.html#estimating-logistic-regression-coefficients"><i class="fa fa-check"></i><b>11.5.2</b> Estimating logistic regression coefficients</a></li>
<li class="chapter" data-level="11.5.3" data-path="regression.html"><a href="regression.html#logistic-regression-with-multiple-explanatory-variables"><i class="fa fa-check"></i><b>11.5.3</b> Logistic regression with multiple explanatory variables</a></li>
</ul></li>
<li class="chapter" data-level="11.6" data-path="regression.html"><a href="regression.html#exercises-6"><i class="fa fa-check"></i><b>11.6</b> Exercises</a></li>
</ul></li>
<li class="chapter" data-level="12" data-path="NN.html"><a href="NN.html"><i class="fa fa-check"></i><b>12</b> Neural Networks</a>
<ul>
<li class="chapter" data-level="12.1" data-path="NN.html"><a href="NN.html#a-single-neuron"><i class="fa fa-check"></i><b>12.1</b> A Single Neuron</a></li>
<li class="chapter" data-level="12.2" data-path="NN.html"><a href="NN.html#neural-network-structure"><i class="fa fa-check"></i><b>12.2</b> Neural Network Structure</a>
<ul>
<li class="chapter" data-level="12.2.1" data-path="NN.html"><a href="NN.html#forward-propagation"><i class="fa fa-check"></i><b>12.2.1</b> Forward propagation</a></li>
<li class="chapter" data-level="12.2.2" data-path="NN.html"><a href="NN.html#back-propagation"><i class="fa fa-check"></i><b>12.2.2</b> Back-propagation</a></li>
</ul></li>
<li class="chapter" data-level="12.3" data-path="NN.html"><a href="NN.html#overfitting"><i class="fa fa-check"></i><b>12.3</b> Overfitting</a></li>
<li class="chapter" data-level="12.4" data-path="NN.html"><a href="NN.html#neural-network-auto-regressive-nnar-models"><i class="fa fa-check"></i><b>12.4</b> Neural Network Auto-Regressive (NNAR) models</a></li>
<li class="chapter" data-level="12.5" data-path="NN.html"><a href="NN.html#covid-19-forecasting"><i class="fa fa-check"></i><b>12.5</b> COVID-19 Forecasting</a></li>
<li class="chapter" data-level="12.6" data-path="NN.html"><a href="NN.html#exercises-7"><i class="fa fa-check"></i><b>12.6</b> Exercises</a></li>
</ul></li>
<li class="chapter" data-level="13" data-path="ensemble.html"><a href="ensemble.html"><i class="fa fa-check"></i><b>13</b> Hybrid Mdels</a>
<ul>
<li class="chapter" data-level="13.1" data-path="ensemble.html"><a href="ensemble.html#ensembling-time-series-models"><i class="fa fa-check"></i><b>13.1</b> Ensembling Time Series Models</a></li>
<li class="chapter" data-level="13.2" data-path="ensemble.html"><a href="ensemble.html#model-diagnostics"><i class="fa fa-check"></i><b>13.2</b> Model Diagnostics</a></li>
<li class="chapter" data-level="13.3" data-path="ensemble.html"><a href="ensemble.html#forecasting"><i class="fa fa-check"></i><b>13.3</b> Forecasting</a>
<ul>
<li class="chapter" data-level="13.3.1" data-path="ensemble.html"><a href="ensemble.html#perform-cross-validation-on-a-time-series"><i class="fa fa-check"></i><b>13.3.1</b> Perform cross validation on a time series</a></li>
</ul></li>
<li class="chapter" data-level="13.4" data-path="ensemble.html"><a href="ensemble.html#weights-selection-using-cross-validation"><i class="fa fa-check"></i><b>13.4</b> Weights Selection Using Cross Validation</a></li>
<li class="chapter" data-level="13.5" data-path="ensemble.html"><a href="ensemble.html#a-project"><i class="fa fa-check"></i><b>13.5</b> A Project</a>
<ul>
<li class="chapter" data-level="13.5.1" data-path="ensemble.html"><a href="ensemble.html#projection"><i class="fa fa-check"></i><b>13.5.1</b> Projection</a></li>
<li class="chapter" data-level="13.5.2" data-path="ensemble.html"><a href="ensemble.html#visualization"><i class="fa fa-check"></i><b>13.5.2</b> Visualization</a></li>
</ul></li>
</ul></li>
<li class="chapter" data-level="" data-path="references.html"><a href="references.html"><i class="fa fa-check"></i>References</a></li>
<li class="chapter" data-level="" data-path="appendix.html"><a href="appendix.html"><i class="fa fa-check"></i>Appendix</a></li>
<li class="chapter" data-level="14" data-path="appendix-a.html"><a href="appendix-a.html"><i class="fa fa-check"></i><b>14</b> Appendix A</a>
<ul>
<li class="chapter" data-level="14.1" data-path="appendix-a.html"><a href="appendix-a.html#r-introduction-and-preliminaries"><i class="fa fa-check"></i><b>14.1</b> R Introduction and Preliminaries</a>
<ul>
<li class="chapter" data-level="14.1.1" data-path="appendix-a.html"><a href="appendix-a.html#the-r-environment-and-language"><i class="fa fa-check"></i><b>14.1.1</b> The R Environment and Language</a></li>
<li class="chapter" data-level="14.1.2" data-path="appendix-a.html"><a href="appendix-a.html#r-and-statistics"><i class="fa fa-check"></i><b>14.1.2</b> R and Statistics</a></li>
<li class="chapter" data-level="14.1.3" data-path="appendix-a.html"><a href="appendix-a.html#obtaining-r-and-installation"><i class="fa fa-check"></i><b>14.1.3</b> Obtaining R and installation</a></li>
</ul></li>
<li class="chapter" data-level="14.2" data-path="appendix-a.html"><a href="appendix-a.html#starting-r"><i class="fa fa-check"></i><b>14.2</b> Starting R</a>
<ul>
<li class="chapter" data-level="14.2.1" data-path="appendix-a.html"><a href="appendix-a.html#description-of-three-panels-in-user-interface"><i class="fa fa-check"></i><b>14.2.1</b> Description of three panels in user interface</a></li>
<li class="chapter" data-level="14.2.2" data-path="appendix-a.html"><a href="appendix-a.html#r-help"><i class="fa fa-check"></i><b>14.2.2</b> R help</a></li>
<li class="chapter" data-level="14.2.3" data-path="appendix-a.html"><a href="appendix-a.html#some-mathematical-expressions"><i class="fa fa-check"></i><b>14.2.3</b> Some mathematical expressions</a></li>
<li class="chapter" data-level="14.2.4" data-path="appendix-a.html"><a href="appendix-a.html#r-packages"><i class="fa fa-check"></i><b>14.2.4</b> R Packages</a></li>
<li class="chapter" data-level="14.2.5" data-path="appendix-a.html"><a href="appendix-a.html#creating-a-project-and-setting-working-directory"><i class="fa fa-check"></i><b>14.2.5</b> Creating a project and setting working directory</a></li>
</ul></li>
<li class="chapter" data-level="14.3" data-path="appendix-a.html"><a href="appendix-a.html#exportimport-data"><i class="fa fa-check"></i><b>14.3</b> Export/Import Data</a>
<ul>
<li class="chapter" data-level="14.3.1" data-path="appendix-a.html"><a href="appendix-a.html#data-export"><i class="fa fa-check"></i><b>14.3.1</b> Data Export</a></li>
<li class="chapter" data-level="14.3.2" data-path="appendix-a.html"><a href="appendix-a.html#data-import"><i class="fa fa-check"></i><b>14.3.2</b> Data Import</a></li>
</ul></li>
</ul></li>
<li class="chapter" data-level="15" data-path="appendix-b.html"><a href="appendix-b.html"><i class="fa fa-check"></i><b>15</b> Appendix B</a>
<ul>
<li class="chapter" data-level="15.1" data-path="appendix-b.html"><a href="appendix-b.html#epidemic-data"><i class="fa fa-check"></i><b>15.1</b> Epidemic Data</a>
<ul>
<li class="chapter" data-level="15.1.1" data-path="appendix-b.html"><a href="appendix-b.html#state-level"><i class="fa fa-check"></i><b>15.1.1</b> State level</a></li>
<li class="chapter" data-level="15.1.2" data-path="appendix-b.html"><a href="appendix-b.html#county-level"><i class="fa fa-check"></i><b>15.1.2</b> County level</a></li>
</ul></li>
<li class="chapter" data-level="15.2" data-path="appendix-b.html"><a href="appendix-b.html#other-factors"><i class="fa fa-check"></i><b>15.2</b> Other Factors</a>
<ul>
<li class="chapter" data-level="15.2.1" data-path="appendix-b.html"><a href="appendix-b.html#policy-data"><i class="fa fa-check"></i><b>15.2.1</b> Policy Data</a></li>
<li class="chapter" data-level="15.2.2" data-path="appendix-b.html"><a href="appendix-b.html#demographic-characteristics"><i class="fa fa-check"></i><b>15.2.2</b> Demographic Characteristics</a></li>
<li class="chapter" data-level="15.2.3" data-path="appendix-b.html"><a href="appendix-b.html#healthcare-infrastructure"><i class="fa fa-check"></i><b>15.2.3</b> Healthcare Infrastructure</a></li>
<li class="chapter" data-level="15.2.4" data-path="appendix-b.html"><a href="appendix-b.html#socioeconomic-status"><i class="fa fa-check"></i><b>15.2.4</b> Socioeconomic Status</a></li>
<li class="chapter" data-level="15.2.5" data-path="appendix-b.html"><a href="appendix-b.html#environmental-factor"><i class="fa fa-check"></i><b>15.2.5</b> Environmental Factor</a></li>
<li class="chapter" data-level="15.2.6" data-path="appendix-b.html"><a href="appendix-b.html#mobility"><i class="fa fa-check"></i><b>15.2.6</b> Mobility</a></li>
<li class="chapter" data-level="15.2.7" data-path="appendix-b.html"><a href="appendix-b.html#geographic-information"><i class="fa fa-check"></i><b>15.2.7</b> Geographic Information</a></li>
</ul></li>
<li class="chapter" data-level="15.3" data-path="appendix-b.html"><a href="appendix-b.html#data-sets"><i class="fa fa-check"></i><b>15.3</b> Data Sets</a>
<ul>
<li class="chapter" data-level="15.3.1" data-path="appendix-b.html"><a href="appendix-b.html#chapter-2"><i class="fa fa-check"></i><b>15.3.1</b> Chapter 2</a></li>
<li class="chapter" data-level="15.3.2" data-path="appendix-b.html"><a href="appendix-b.html#chapter-3"><i class="fa fa-check"></i><b>15.3.2</b> Chapter 3</a></li>
</ul></li>
</ul></li>
<li class="divider"></li>
<li><a href="https://github.com/rstudio/bookdown" target="blank">Published with bookdown</a></li>

</ul>

      </nav>
    </div>

    <div class="book-body">
      <div class="body-inner">
        <div class="book-header" role="navigation">
          <h1>
            <i class="fa fa-circle-o-notch fa-spin"></i><a href="./">Statistical Learning of Infectious Disease Data Analytics</a>
          </h1>
        </div>

        <div class="page-wrapper" tabindex="-1" role="main">
          <div class="page-inner">

            <section class="normal" id="section-">
<div id="compartment" class="section level1" number="9">
<h1><span class="header-section-number">Chapter 9</span> Compartment Models</h1>
<p>Infectious disease dynamics mathematical models have a long history, dating back over a century. Simple mathematical formulations that describe the transition of individuals in a population between “compartments” that capture their infection status yield surprisingly significant insight. Their elegance and simplicity make it simple to expand to more complexities by adding compartments, for example. Although it is often simple to expand these models, the apparent simplicity can hide subtle but important model structure and parameterization choices. Their elegance and simplicity make it simple to add more complexity, such as compartments, to the design. Although it is often simple to expand these models, the apparent simplicity can hide important model structure and parameterization decisions.</p>
<p>We formulate our descriptions of disease transmission as compartmental models, with the population under study being divided into compartments.</p>
<p>At time <span class="math inline">\(t\)</span>, denote</p>
<ul>
<li><span class="math inline">\(S(t)\)</span>: the number of susceptible people;</li>
<li><span class="math inline">\(E(t)\)</span>: the number of infected but not yet infectious people;</li>
<li><span class="math inline">\(I(t)\)</span>: the number of infectious people;</li>
<li><span class="math inline">\(R(t)\)</span>: the number of recovered people.</li>
</ul>
<div id="a-simple-sis-model-a-model-for-diseases-with-no-immunity" class="section level2" number="9.1">
<h2><span class="header-section-number">9.1</span> A Simple SIS Model (A Model for Diseases with No Immunity)</h2>
<p>Because many diseases do not confer immunity, infectives revert to the susceptible class after recovery. Most diseases transmitted by bacterial or helminth agents, as well as most sexually transmitted diseases, can be studied using these models (including gonorrhea, but not such diseases as AIDS, from which there is no recovery).</p>
<div class="figure" style="text-align: center"><span id="fig:SIS"></span>
<img src="figures/SIS.png" alt="A simple SIS model." width="50%" />
<p class="caption">
Figure 9.1: A simple SIS model.
</p>
</div>
<p>In an SIS model, the total population size <span class="math inline">\(N = S(t) + I(t)\)</span>. The simplest SIS model, due to Kermack and McKendrick, is</p>
<p><span class="math display">\[\begin{eqnarray*}
\frac{dS(t)}{dt}&amp; = &amp; - \beta I(t)\frac{S(t)}{N} + \gamma I(t), \\
\frac{dI(t)}{dt}&amp; = &amp;\beta I(t)\frac{S(t)}{N} - \gamma I(t)
\end{eqnarray*}\]</span></p>
<p>where <span class="math inline">\(\beta\)</span> is the effective contact rate, and
<span class="math display">\[
\beta \propto \left(\frac{\mathrm{infection}}{\mathrm{contact}} \right) \times \left(\frac{\mathrm{contact}}{\mathrm{time}}\right). 
\]</span></p>
<p><strong>Assumptions of SIS models</strong></p>
<ol style="list-style-type: lower-roman">
<li>The rate of new infections is determined by the incidence of mass action.</li>
<li>Infectives leave the infective class and return to the susceptible class at a rate of <span class="math inline">\(\gamma I\)</span> per unit time.</li>
<li>No one enters or leaves the population.</li>
<li>No disease deaths occur, and the total population remains constant at <span class="math inline">\(N\)</span>.</li>
</ol>
</div>
<div id="an-sir-model" class="section level2" number="9.2">
<h2><span class="header-section-number">9.2</span> An SIR Model</h2>
<div class="figure" style="text-align: center"><span id="fig:SIR"></span>
<img src="figures/SIR.png" alt="An SIR model." width="75%" />
<p class="caption">
Figure 9.2: An SIR model.
</p>
</div>
<p>Consider the SIR model in a population of size <span class="math inline">\(N\)</span>, and note <span class="math inline">\(N = S(t) + I(t) + R(t)\)</span>:</p>
<p><span class="math display">\[\begin{eqnarray*}
\frac{dS(t)}{dt}&amp; = &amp; - \beta I(t)\frac{S(t)}{N}, \\
\frac{dI(t)}{dt}&amp; = &amp;\beta I(t)\frac{S(t)}{N} - \gamma I(t), \\
\frac{dR(t)}{dt}&amp; = &amp;\gamma I(t), 
\end{eqnarray*}\]</span></p>
<p>where <span class="math inline">\(\beta\)</span> is the effective contact rate, and
<span class="math display">\[
  \beta \propto \left(\frac{\mathrm{infection}}{\mathrm{contact}} \right) \times \left(\frac{\mathrm{contact}}{\mathrm{time}}\right),  
\]</span>
i.e., (probability of transmission given a contact between a susceptible and an infectious individual) <span class="math inline">\(\times\)</span> (average rate of contact between susceptible and infected individuals); <span class="math inline">\(\gamma\)</span> is the removal rate, and <span class="math inline">\(\gamma^{-1}\)</span> is the average infectious period. The logic of the transmission term is that <span class="math inline">\(\beta\)</span> is the contact rate among hosts times the probability of infection given a contact.</p>
<p>Let <span class="math inline">\(s = S / N\)</span>, <span class="math inline">\(i = I / N\)</span> and <span class="math inline">\(r = R / N\)</span>. Dividing the equations for <span class="math inline">\(S\)</span>, <span class="math inline">\(I\)</span> and <span class="math inline">\(R\)</span> by <span class="math inline">\(N\)</span> we get the deterministic SIR epidemic model for this process in the form:</p>
<p><span class="math display">\[\begin{eqnarray*}
\frac{ds(t)}{dt}&amp; = &amp; - \beta i(t)s(t), \\
\frac{di(t)}{dt}&amp; = &amp;\beta i(t)s(t) - \gamma i(t), \\
\frac{dr(t)}{dt}&amp; = &amp;\gamma i(t). 
\end{eqnarray*}\]</span></p>
<p><strong>Assumptions of SIR models</strong></p>
<p>SIR models for diseases assume that infectives recover with immunity against reinfection.</p>
<ul>
<li>Constant (closed) population size: <span class="math inline">\(N\)</span>;</li>
<li>Constant rates (e.g., transmission, removal rates);</li>
<li>No demography (i.e., births and deaths);</li>
<li>Well-mixed population: any infected person has a probability of contacting any susceptible person that is reasonably close to the average.</li>
</ul>
<div class="sourceCode" id="cb217"><pre class="sourceCode r"><code class="sourceCode r"><span id="cb217-1"><a href="compartment.html#cb217-1" aria-hidden="true" tabindex="-1"></a><span class="do">## Load deSolve package</span></span>
<span id="cb217-2"><a href="compartment.html#cb217-2" aria-hidden="true" tabindex="-1"></a><span class="fu">library</span>(deSolve)</span>
<span id="cb217-3"><a href="compartment.html#cb217-3" aria-hidden="true" tabindex="-1"></a><span class="do">## Create an SIR function</span></span>
<span id="cb217-4"><a href="compartment.html#cb217-4" aria-hidden="true" tabindex="-1"></a>sir <span class="ot">&lt;-</span> <span class="cf">function</span>(time, state, parameters) {</span>
<span id="cb217-5"><a href="compartment.html#cb217-5" aria-hidden="true" tabindex="-1"></a>  </span>
<span id="cb217-6"><a href="compartment.html#cb217-6" aria-hidden="true" tabindex="-1"></a>  <span class="fu">with</span>(<span class="fu">as.list</span>(<span class="fu">c</span>(state, parameters)), {</span>
<span id="cb217-7"><a href="compartment.html#cb217-7" aria-hidden="true" tabindex="-1"></a>    </span>
<span id="cb217-8"><a href="compartment.html#cb217-8" aria-hidden="true" tabindex="-1"></a>    dS <span class="ot">&lt;-</span> <span class="sc">-</span>beta <span class="sc">*</span> S <span class="sc">*</span> I</span>
<span id="cb217-9"><a href="compartment.html#cb217-9" aria-hidden="true" tabindex="-1"></a>    dI <span class="ot">&lt;-</span>  beta <span class="sc">*</span> S <span class="sc">*</span> I <span class="sc">-</span> gamma <span class="sc">*</span> I</span>
<span id="cb217-10"><a href="compartment.html#cb217-10" aria-hidden="true" tabindex="-1"></a>    dR <span class="ot">&lt;-</span> gamma <span class="sc">*</span> I</span>
<span id="cb217-11"><a href="compartment.html#cb217-11" aria-hidden="true" tabindex="-1"></a>    </span>
<span id="cb217-12"><a href="compartment.html#cb217-12" aria-hidden="true" tabindex="-1"></a>    <span class="fu">return</span>(<span class="fu">list</span>(<span class="fu">c</span>(dS, dI, dR)))</span>
<span id="cb217-13"><a href="compartment.html#cb217-13" aria-hidden="true" tabindex="-1"></a>  })</span>
<span id="cb217-14"><a href="compartment.html#cb217-14" aria-hidden="true" tabindex="-1"></a>}</span></code></pre></div>
<p>Below, we consider a simulation example with <span class="math inline">\(s(0)=0.999\)</span>, <span class="math inline">\(i(0)=0.001\)</span>, <span class="math inline">\(r(0)=0.0\)</span>, <span class="math inline">\(\beta=0.3\)</span> and <span class="math inline">\(\gamma=0.1\)</span>.</p>
<div class="sourceCode" id="cb218"><pre class="sourceCode r"><code class="sourceCode r"><span id="cb218-1"><a href="compartment.html#cb218-1" aria-hidden="true" tabindex="-1"></a><span class="co"># Set parameters</span></span>
<span id="cb218-2"><a href="compartment.html#cb218-2" aria-hidden="true" tabindex="-1"></a><span class="co"># Proportion in each compartment: Susceptible 0.999, </span></span>
<span id="cb218-3"><a href="compartment.html#cb218-3" aria-hidden="true" tabindex="-1"></a><span class="co"># Infected 0.001, Recovered 0</span></span>
<span id="cb218-4"><a href="compartment.html#cb218-4" aria-hidden="true" tabindex="-1"></a>init <span class="ot">&lt;-</span> <span class="fu">c</span>(<span class="at">S =</span> <span class="fl">0.999</span>, <span class="at">I =</span> <span class="fl">0.001</span>, <span class="at">R =</span> <span class="fl">0.0</span>)</span>
<span id="cb218-5"><a href="compartment.html#cb218-5" aria-hidden="true" tabindex="-1"></a><span class="co"># beta: infection parameter; gamma: recovery parameter</span></span>
<span id="cb218-6"><a href="compartment.html#cb218-6" aria-hidden="true" tabindex="-1"></a>parameters <span class="ot">&lt;-</span> <span class="fu">c</span>(<span class="at">beta =</span> <span class="fl">0.3</span>, <span class="at">gamma =</span> <span class="fl">0.1</span>)</span>
<span id="cb218-7"><a href="compartment.html#cb218-7" aria-hidden="true" tabindex="-1"></a><span class="co"># Time frame</span></span>
<span id="cb218-8"><a href="compartment.html#cb218-8" aria-hidden="true" tabindex="-1"></a>times <span class="ot">&lt;-</span> <span class="fu">seq</span>(<span class="dv">0</span>, <span class="dv">300</span>, <span class="at">by =</span> <span class="dv">1</span>)</span>
<span id="cb218-9"><a href="compartment.html#cb218-9" aria-hidden="true" tabindex="-1"></a></span>
<span id="cb218-10"><a href="compartment.html#cb218-10" aria-hidden="true" tabindex="-1"></a><span class="co"># Solve using ode </span></span>
<span id="cb218-11"><a href="compartment.html#cb218-11" aria-hidden="true" tabindex="-1"></a><span class="co"># (General Solver for Ordinary Differential Equations)</span></span>
<span id="cb218-12"><a href="compartment.html#cb218-12" aria-hidden="true" tabindex="-1"></a>out <span class="ot">&lt;-</span> <span class="fu">ode</span>(<span class="at">y =</span> init, <span class="at">times =</span> times, <span class="at">func =</span> sir, <span class="at">parms =</span> parameters)</span>
<span id="cb218-13"><a href="compartment.html#cb218-13" aria-hidden="true" tabindex="-1"></a><span class="co"># Change to data frame</span></span>
<span id="cb218-14"><a href="compartment.html#cb218-14" aria-hidden="true" tabindex="-1"></a>out <span class="ot">&lt;-</span> <span class="fu">as.data.frame</span>(out)</span>
<span id="cb218-15"><a href="compartment.html#cb218-15" aria-hidden="true" tabindex="-1"></a><span class="co"># Show data</span></span>
<span id="cb218-16"><a href="compartment.html#cb218-16" aria-hidden="true" tabindex="-1"></a><span class="fu">head</span>(out, <span class="dv">5</span>)</span></code></pre></div>
<pre><code>##   time         S           I            R
## 1    0 0.9990000 0.001000000 0.0000000000
## 2    1 0.9986676 0.001221467 0.0001109293
## 3    2 0.9982619 0.001491698 0.0002463585
## 4    3 0.9977671 0.001821286 0.0004116470
## 5    4 0.9971641 0.002222741 0.0006131418</code></pre>
<p>Figure <a href="compartment.html#fig:sim1">9.3</a> shows the evolution of the prevalence rate.</p>
<div class="figure" style="text-align: center"><span id="fig:sim1"></span>
<img src="SLID_book_files/figure-html/sim1-1.png" alt="Simulation example 1." width="100%" />
<p class="caption">
Figure 9.3: Simulation example 1.
</p>
</div>
<p>Next, we consider another simulation example with <span class="math inline">\(s(0)=0.999\)</span>, <span class="math inline">\(i(0)=0.001\)</span>, <span class="math inline">\(r(0)=0.0\)</span>, <span class="math inline">\(\beta=0.075\)</span> and <span class="math inline">\(\gamma=0.1\)</span>.</p>
<div class="sourceCode" id="cb220"><pre class="sourceCode r"><code class="sourceCode r"><span id="cb220-1"><a href="compartment.html#cb220-1" aria-hidden="true" tabindex="-1"></a><span class="co"># Set parameters</span></span>
<span id="cb220-2"><a href="compartment.html#cb220-2" aria-hidden="true" tabindex="-1"></a><span class="co"># Proportion in each compartment: Susceptible 0.999, </span></span>
<span id="cb220-3"><a href="compartment.html#cb220-3" aria-hidden="true" tabindex="-1"></a><span class="co"># Infected 0.001, Recovered 0</span></span>
<span id="cb220-4"><a href="compartment.html#cb220-4" aria-hidden="true" tabindex="-1"></a>init <span class="ot">&lt;-</span> <span class="fu">c</span>(<span class="at">S =</span> <span class="fl">0.999</span>, <span class="at">I =</span> <span class="fl">0.001</span>, <span class="at">R =</span> <span class="fl">0.0</span>)</span>
<span id="cb220-5"><a href="compartment.html#cb220-5" aria-hidden="true" tabindex="-1"></a><span class="co"># beta: infection parameter; gamma: recovery parameter</span></span>
<span id="cb220-6"><a href="compartment.html#cb220-6" aria-hidden="true" tabindex="-1"></a>parameters <span class="ot">&lt;-</span> <span class="fu">c</span>(<span class="at">beta =</span> <span class="fl">0.075</span>, <span class="at">gamma =</span> <span class="fl">0.1</span>)</span>
<span id="cb220-7"><a href="compartment.html#cb220-7" aria-hidden="true" tabindex="-1"></a><span class="co"># Time frame</span></span>
<span id="cb220-8"><a href="compartment.html#cb220-8" aria-hidden="true" tabindex="-1"></a>times <span class="ot">&lt;-</span> <span class="fu">seq</span>(<span class="dv">0</span>, <span class="dv">300</span>, <span class="at">by =</span> <span class="dv">1</span>)</span>
<span id="cb220-9"><a href="compartment.html#cb220-9" aria-hidden="true" tabindex="-1"></a></span>
<span id="cb220-10"><a href="compartment.html#cb220-10" aria-hidden="true" tabindex="-1"></a><span class="co"># Solve using ode </span></span>
<span id="cb220-11"><a href="compartment.html#cb220-11" aria-hidden="true" tabindex="-1"></a><span class="co"># (General Solver for Ordinary Differential Equations)</span></span>
<span id="cb220-12"><a href="compartment.html#cb220-12" aria-hidden="true" tabindex="-1"></a>out <span class="ot">&lt;-</span> <span class="fu">ode</span>(<span class="at">y =</span> init, <span class="at">times =</span> times, <span class="at">func =</span> sir, <span class="at">parms =</span> parameters)</span>
<span id="cb220-13"><a href="compartment.html#cb220-13" aria-hidden="true" tabindex="-1"></a><span class="co"># Change to data frame</span></span>
<span id="cb220-14"><a href="compartment.html#cb220-14" aria-hidden="true" tabindex="-1"></a>out <span class="ot">&lt;-</span> <span class="fu">as.data.frame</span>(out)</span></code></pre></div>
<p>Figure <a href="compartment.html#fig:sim2">9.4</a> shows the evolution of the prevalence rate.</p>
<div class="figure" style="text-align: center"><span id="fig:sim2"></span>
<img src="SLID_book_files/figure-html/sim2-1.png" alt="Simulation example 1." width="100%" />
<p class="caption">
Figure 9.4: Simulation example 1.
</p>
</div>
<div id="an-sir-model-with-births-and-deaths" class="section level3" number="9.2.1">
<h3><span class="header-section-number">9.2.1</span> An SIR model with births and deaths</h3>
<p>Because the time scale of an epidemic is generally much shorter than the demographic time scale, we have omitted births and deaths from our description of epidemic models. In effect, we’ve used a time scale with a negligible number of births and deaths per unit of time. There are, however, diseases that are endemic in many parts of the world and kill millions of people every year.</p>
<div class="figure" style="text-align: center"><span id="fig:SIRbd"></span>
<img src="figures/SIRBD.png" alt="An SIR model with birth and death." width="75%" />
<p class="caption">
Figure 9.5: An SIR model with birth and death.
</p>
</div>
<p>We consider the following SIR model with births and deaths:</p>
<p><span class="math display">\[\begin{eqnarray*}
\frac{dS(t)}{dt}&amp; = &amp;\mu\{N - S(t)\} - \beta I(t)\frac{S(t)}{N}, \\
\frac{dI(t)}{dt}&amp; = &amp;\beta I(t)\frac{S(t)}{N} - (\mu + \gamma)I(t), \\
\frac{dR(t)}{dt}&amp; = &amp;\gamma I(t) - \mu R(t), 
\end{eqnarray*}\]</span></p>
<p>where <span class="math inline">\(\beta\)</span> is the effective contact rate, and
<span class="math display">\[
  \beta \propto \left(\frac{\mathrm{infection}}{\mathrm{contact}} \right) \times \left(\frac{\mathrm{contact}}{\mathrm{time}}\right),  
\]</span>
i.e., (probability of transmission given a contact between a susceptible and an infectious individual) <span class="math inline">\(\times\)</span> (average rate of contact between susceptible and infected individuals).</p>
<ul>
<li><p>birth rate and death rate are equal, which is denoted as <span class="math inline">\(\mu\)</span>;</p></li>
<li><p><span class="math inline">\(\gamma\)</span> is the removal rate, and <span class="math inline">\(\gamma^{-1}\)</span> is the average infectious period.</p></li>
</ul>
<p>At the early stage of an SIR outbreak, when <span class="math inline">\(S(t) \approx N\)</span>, the number of infected individuals <span class="math inline">\(I(t)\)</span> is approximated by
<span class="math display">\[
I(t) \approx I_0 \exp \{(\beta - \gamma - \mu) t\} = I_0 \exp \{(R_0 - 1)(\gamma + \mu)t\}, 
\]</span>
where <span class="math inline">\(R_0 = \beta/(\gamma + \mu)\)</span> is the <em>basic reproduction number</em>, <span class="math inline">\(I_0\)</span> is the number of infectious people at time <span class="math inline">\(0\)</span>, <span class="math inline">\(\gamma^{-1}\)</span> is the infectious period and <span class="math inline">\(\mu^{-1}\)</span> is the host lifespan.</p>
<p>An epidemic occurs if the number of infected individuals increases,
<span class="math display">\[
\beta I \frac{S}{N} - (\mu + \gamma)I&gt;0 \Rightarrow \beta - (\mu + \gamma)&gt;0 \Rightarrow  R_0&gt;1.
\]</span></p>
</div>
</div>
<div id="sir-parameter-estimation" class="section level2" number="9.3">
<h2><span class="header-section-number">9.3</span> SIR parameter estimation</h2>
<ol style="list-style-type: decimal">
<li>Feature match</li>
</ol>
<p>At the early stage of an SIR outbreak, when <span class="math inline">\(S(t) \approx N\)</span>, the number of infected individuals <span class="math inline">\(I(t)\)</span> is approximated by
<span class="math display">\[
I(t) \approx I_0 \exp \{(\beta - \gamma - \mu) t\} = I_0 \exp \{(R_0 - 1)(\gamma + \mu)t\},
\]</span>
where <span class="math inline">\(R_0\)</span> is the <em>basic reproduction number</em>, <span class="math inline">\(I_0\)</span> is the number of infectious people at time <span class="math inline">\(0\)</span>, <span class="math inline">\(\gamma^{-1}\)</span> is the infectious period and <span class="math inline">\(\mu^{-1}\)</span> is the host lifespan. Taking logs of both sides, we get
<span class="math display">\[
\log(I_t)\approx \log(I_0)+(R_0-1)(\gamma+\mu)t,
\]</span>
which implies that we will be able to get a reasonable and cheerful estimate of <span class="math inline">\(R_0\)</span> by a simple linear regression.</p>
<ol start="2" style="list-style-type: decimal">
<li>Least squares</li>
</ol>
<p>The least squares method allows us to quantify the gap between the data and the model’s predictions. Then we can search through all of the possible values of a model’s parameters to find the ones that minimize the discrepancy.</p>
<p>Let <span class="math inline">\(\mu = 0\)</span>, for a given <span class="math inline">\((\beta, \gamma)\)</span>, we denote <span class="math inline">\(I(t;\beta, \gamma) = I(t)\)</span> and
<span class="math display">\[
  (\widehat{\beta}, \widehat{\gamma}) = \arg\min_{(\beta, \gamma)}\sum_{j = 1}^{n} \{I(t_j;\beta, \gamma) - Y_j\}^2, 
\]</span>
where <span class="math inline">\(Y_j\)</span> is the number of observed infected people at time <span class="math inline">\(t_j\)</span>.</p>
<ol start="3" style="list-style-type: decimal">
<li>Maximum likelihood</li>
</ol>
<p>Let <span class="math inline">\(Y_j\)</span> be the observed number of infected case. We can assume
<span class="math display">\[
  Y_j \sim \textrm{Poisson}\{pI(t_j;\beta, \gamma, \mu)\}, 
\]</span>
where the parameter <span class="math inline">\(p\)</span> reflects a combination of sampling efficiency and the detectability of infections.</p>
</div>
<div id="implementation-of-parameter-estimation-in-r" class="section level2" number="9.4">
<h2><span class="header-section-number">9.4</span> Implementation of parameter estimation in R</h2>
<p>Example code for implementing SIR to model the outbreak of measles in Niamey can be found in <a href="https://kingaa.github.io/short-course/parest/odes.html" class="uri">https://kingaa.github.io/short-course/parest/odes.html</a>. We mainly show how to use R to find the parameters in SIR model by minimizing the sum of squared errors. Here is the data of the outbreak of measles in Niamey: <a href="http://kingaa.github.io/clim-dis/parest/niamey.csv" class="uri">http://kingaa.github.io/clim-dis/parest/niamey.csv</a>.</p>
<div id="example-1.-outbreak-of-measles-in-niamey" class="section level3" number="9.4.1">
<h3><span class="header-section-number">9.4.1</span> Example 1. Outbreak of measles in Niamey</h3>
<div class="sourceCode" id="cb221"><pre class="sourceCode r"><code class="sourceCode r"><span id="cb221-1"><a href="compartment.html#cb221-1" aria-hidden="true" tabindex="-1"></a><span class="fu">library</span>(dplyr)</span>
<span id="cb221-2"><a href="compartment.html#cb221-2" aria-hidden="true" tabindex="-1"></a><span class="fu">library</span>(plotly)</span>
<span id="cb221-3"><a href="compartment.html#cb221-3" aria-hidden="true" tabindex="-1"></a><span class="fu">library</span>(slid)</span>
<span id="cb221-4"><a href="compartment.html#cb221-4" aria-hidden="true" tabindex="-1"></a>niamey <span class="ot">&lt;-</span> </span>
<span id="cb221-5"><a href="compartment.html#cb221-5" aria-hidden="true" tabindex="-1"></a>  <span class="fu">read.csv</span>(<span class="st">&quot;http://kingaa.github.io/clim-dis/parest/niamey.csv&quot;</span>)</span>
<span id="cb221-6"><a href="compartment.html#cb221-6" aria-hidden="true" tabindex="-1"></a><span class="fu">head</span>(niamey,<span class="dv">5</span>)</span></code></pre></div>
<pre><code>##   biweek community measles
## 1      1         A      22
## 2      2         A      27
## 3      3         A      64
## 4      4         A      84
## 5      5         A     116</code></pre>
<div class="sourceCode" id="cb223"><pre class="sourceCode r"><code class="sourceCode r"><span id="cb223-1"><a href="compartment.html#cb223-1" aria-hidden="true" tabindex="-1"></a><span class="fu">plot_ly</span>(<span class="at">data =</span> niamey) <span class="sc">%&gt;%</span> </span>
<span id="cb223-2"><a href="compartment.html#cb223-2" aria-hidden="true" tabindex="-1"></a>  <span class="fu">add_trace</span>(<span class="at">x =</span> <span class="sc">~</span>biweek, <span class="at">y =</span> <span class="sc">~</span>measles, <span class="at">color =</span> <span class="sc">~</span>community, </span>
<span id="cb223-3"><a href="compartment.html#cb223-3" aria-hidden="true" tabindex="-1"></a>            <span class="at">type =</span> <span class="st">&#39;scatter&#39;</span>, <span class="at">mode =</span> <span class="st">&#39;lines+markers&#39;</span>)</span></code></pre></div>
<div id="htmlwidget-7491d8eb93f1af81e4eb" style="width:672px;height:480px;" class="plotly html-widget"></div>
<script type="application/json" data-for="htmlwidget-7491d8eb93f1af81e4eb">{"x":{"visdat":{"f3331f5e593":["function () ","plotlyVisDat"]},"cur_data":"f3331f5e593","attrs":{"f3331f5e593":{"alpha_stroke":1,"sizes":[10,100],"spans":[1,20],"x":{},"y":{},"color":{},"type":"scatter","mode":"lines+markers","inherit":true}},"layout":{"margin":{"b":40,"l":60,"t":25,"r":10},"xaxis":{"domain":[0,1],"automargin":true,"title":"biweek"},"yaxis":{"domain":[0,1],"automargin":true,"title":"measles"},"hovermode":"closest","showlegend":true},"source":"A","config":{"showSendToCloud":false},"data":[{"x":[1,2,3,4,5,6,7,8,9,10,11,12,13,14,15,16],"y":[22,27,64,84,116,172,173,651,786,1041,842,903,745,211,83,11],"type":"scatter","mode":"lines+markers","name":"A","marker":{"color":"rgba(102,194,165,1)","line":{"color":"rgba(102,194,165,1)"}},"textfont":{"color":"rgba(102,194,165,1)"},"error_y":{"color":"rgba(102,194,165,1)"},"error_x":{"color":"rgba(102,194,165,1)"},"line":{"color":"rgba(102,194,165,1)"},"xaxis":"x","yaxis":"y","frame":null},{"x":[1,2,3,4,5,6,7,8,9,10,11,12,13,14,15,16],"y":[1,2,7,4,20,38,125,290,519,874,810,702,636,213,71,34],"type":"scatter","mode":"lines+markers","name":"B","marker":{"color":"rgba(252,141,98,1)","line":{"color":"rgba(252,141,98,1)"}},"textfont":{"color":"rgba(252,141,98,1)"},"error_y":{"color":"rgba(252,141,98,1)"},"error_x":{"color":"rgba(252,141,98,1)"},"line":{"color":"rgba(252,141,98,1)"},"xaxis":"x","yaxis":"y","frame":null},{"x":[1,2,3,4,null,6,7,8,9,10,11,12,13,14,15,16],"y":[0,0,0,2,null,4,3,20,49,81,116,164,159,33,16,5],"type":"scatter","mode":"lines+markers","name":"C","marker":{"color":"rgba(141,160,203,1)","line":{"color":"rgba(141,160,203,1)"}},"textfont":{"color":"rgba(141,160,203,1)"},"error_y":{"color":"rgba(141,160,203,1)"},"error_x":{"color":"rgba(141,160,203,1)"},"line":{"color":"rgba(141,160,203,1)"},"xaxis":"x","yaxis":"y","frame":null}],"highlight":{"on":"plotly_click","persistent":false,"dynamic":false,"selectize":false,"opacityDim":0.2,"selected":{"opacity":1},"debounce":0},"shinyEvents":["plotly_hover","plotly_click","plotly_selected","plotly_relayout","plotly_brushed","plotly_brushing","plotly_clickannotation","plotly_doubleclick","plotly_deselect","plotly_afterplot","plotly_sunburstclick"],"base_url":"https://plot.ly"},"evals":[],"jsHooks":[]}</script>
<ol style="list-style-type: decimal">
<li>Least squares method</li>
</ol>
<p>The R package “pomp” provides facilities for dealing with deterministic dynamics, which is an important special case.</p>
<div class="sourceCode" id="cb224"><pre class="sourceCode r"><code class="sourceCode r"><span id="cb224-1"><a href="compartment.html#cb224-1" aria-hidden="true" tabindex="-1"></a><span class="fu">library</span>(pomp)</span>
<span id="cb224-2"><a href="compartment.html#cb224-2" aria-hidden="true" tabindex="-1"></a>niameyA <span class="ot">&lt;-</span> <span class="fu">pomp</span>(</span>
<span id="cb224-3"><a href="compartment.html#cb224-3" aria-hidden="true" tabindex="-1"></a>  <span class="at">data =</span> <span class="fu">subset</span>(niamey, community <span class="sc">==</span> <span class="st">&quot;A&quot;</span>, <span class="at">select =</span> <span class="sc">-</span> community), </span>
<span id="cb224-4"><a href="compartment.html#cb224-4" aria-hidden="true" tabindex="-1"></a>  <span class="at">times =</span> <span class="st">&quot;biweek&quot;</span>, <span class="at">t0 =</span> <span class="dv">0</span>, </span>
<span id="cb224-5"><a href="compartment.html#cb224-5" aria-hidden="true" tabindex="-1"></a>  <span class="at">skeleton =</span> <span class="fu">vectorfield</span>(</span>
<span id="cb224-6"><a href="compartment.html#cb224-6" aria-hidden="true" tabindex="-1"></a>    <span class="fu">Csnippet</span>(<span class="st">&quot;</span></span>
<span id="cb224-7"><a href="compartment.html#cb224-7" aria-hidden="true" tabindex="-1"></a><span class="st">      DS = - Beta*S*I/N;</span></span>
<span id="cb224-8"><a href="compartment.html#cb224-8" aria-hidden="true" tabindex="-1"></a><span class="st">      DI = Beta*S*I/N - gamma*I;</span></span>
<span id="cb224-9"><a href="compartment.html#cb224-9" aria-hidden="true" tabindex="-1"></a><span class="st">      DR = gamma*I;&quot;</span>)), </span>
<span id="cb224-10"><a href="compartment.html#cb224-10" aria-hidden="true" tabindex="-1"></a>  <span class="at">rinit =</span> <span class="fu">Csnippet</span>(<span class="st">&quot;</span></span>
<span id="cb224-11"><a href="compartment.html#cb224-11" aria-hidden="true" tabindex="-1"></a><span class="st">      S = S_0;</span></span>
<span id="cb224-12"><a href="compartment.html#cb224-12" aria-hidden="true" tabindex="-1"></a><span class="st">      I = I_0;</span></span>
<span id="cb224-13"><a href="compartment.html#cb224-13" aria-hidden="true" tabindex="-1"></a><span class="st">      R = N - S_0 - I_0;&quot;</span>), </span>
<span id="cb224-14"><a href="compartment.html#cb224-14" aria-hidden="true" tabindex="-1"></a>  <span class="at">statenames =</span> <span class="fu">c</span>(<span class="st">&quot;S&quot;</span>, <span class="st">&quot;I&quot;</span>, <span class="st">&quot;R&quot;</span>), </span>
<span id="cb224-15"><a href="compartment.html#cb224-15" aria-hidden="true" tabindex="-1"></a>  <span class="at">paramnames =</span> <span class="fu">c</span>(<span class="st">&quot;Beta&quot;</span>, <span class="st">&quot;gamma&quot;</span>, <span class="st">&quot;N&quot;</span>, <span class="st">&quot;S_0&quot;</span>, <span class="st">&quot;I_0&quot;</span>))</span></code></pre></div>
<ul>
<li><strong>Grid search method</strong></li>
</ul>
<p>If we assume all the other parameters are known, one simple option to find optimal <span class="math inline">\(\beta\)</span> would be grid searching a value that minimizes the sum of squared error (SSE), which is the difference between the fitted infection curve with given <span class="math inline">\(beta\)</span> compared to the true observations. For example, it is well known that measles’ infectious period is about two weeks, so we can safely assume that <span class="math inline">\(\gamma = 1\)</span>.</p>
<div class="sourceCode" id="cb225"><pre class="sourceCode r"><code class="sourceCode r"><span id="cb225-1"><a href="compartment.html#cb225-1" aria-hidden="true" tabindex="-1"></a>sse <span class="ot">&lt;-</span> <span class="cf">function</span> (params) {</span>
<span id="cb225-2"><a href="compartment.html#cb225-2" aria-hidden="true" tabindex="-1"></a>  x <span class="ot">&lt;-</span> <span class="fu">trajectory</span>(niameyA, <span class="at">params =</span> params)</span>
<span id="cb225-3"><a href="compartment.html#cb225-3" aria-hidden="true" tabindex="-1"></a>  discrep <span class="ot">&lt;-</span> x[<span class="st">&quot;I&quot;</span>, , ] <span class="sc">-</span> <span class="fu">obs</span>(niameyA)</span>
<span id="cb225-4"><a href="compartment.html#cb225-4" aria-hidden="true" tabindex="-1"></a>  <span class="fu">sum</span>(discrep<span class="sc">^</span><span class="dv">2</span>)</span>
<span id="cb225-5"><a href="compartment.html#cb225-5" aria-hidden="true" tabindex="-1"></a>}</span>
<span id="cb225-6"><a href="compartment.html#cb225-6" aria-hidden="true" tabindex="-1"></a><span class="co"># assume gamma = 1 is known</span></span>
<span id="cb225-7"><a href="compartment.html#cb225-7" aria-hidden="true" tabindex="-1"></a><span class="co"># grid search for beta</span></span>
<span id="cb225-8"><a href="compartment.html#cb225-8" aria-hidden="true" tabindex="-1"></a>f1 <span class="ot">&lt;-</span> <span class="cf">function</span> (beta) {</span>
<span id="cb225-9"><a href="compartment.html#cb225-9" aria-hidden="true" tabindex="-1"></a>  params <span class="ot">&lt;-</span> <span class="fu">c</span>(<span class="at">Beta =</span> beta, <span class="at">gamma =</span> <span class="dv">1</span>, <span class="at">N =</span> <span class="dv">50000</span>, </span>
<span id="cb225-10"><a href="compartment.html#cb225-10" aria-hidden="true" tabindex="-1"></a>              <span class="at">S_0 =</span> <span class="dv">10000</span>, <span class="at">I_0 =</span> <span class="dv">10</span>)</span>
<span id="cb225-11"><a href="compartment.html#cb225-11" aria-hidden="true" tabindex="-1"></a>  <span class="fu">sse</span>(params)</span>
<span id="cb225-12"><a href="compartment.html#cb225-12" aria-hidden="true" tabindex="-1"></a>}</span>
<span id="cb225-13"><a href="compartment.html#cb225-13" aria-hidden="true" tabindex="-1"></a>beta <span class="ot">&lt;-</span> <span class="fu">seq</span>(<span class="at">from =</span> <span class="dv">0</span>, <span class="at">to =</span> <span class="dv">40</span>, <span class="at">by =</span> <span class="fl">0.5</span>)</span>
<span id="cb225-14"><a href="compartment.html#cb225-14" aria-hidden="true" tabindex="-1"></a>SSE <span class="ot">&lt;-</span> <span class="fu">sapply</span>(beta, f1)</span>
<span id="cb225-15"><a href="compartment.html#cb225-15" aria-hidden="true" tabindex="-1"></a></span>
<span id="cb225-16"><a href="compartment.html#cb225-16" aria-hidden="true" tabindex="-1"></a><span class="fu">plot</span>(beta, SSE, <span class="at">type =</span> <span class="st">&#39;l&#39;</span>)</span>
<span id="cb225-17"><a href="compartment.html#cb225-17" aria-hidden="true" tabindex="-1"></a>beta.hat1 <span class="ot">&lt;-</span> beta[<span class="fu">which.min</span>(SSE)]</span>
<span id="cb225-18"><a href="compartment.html#cb225-18" aria-hidden="true" tabindex="-1"></a><span class="fu">abline</span>(<span class="at">v =</span> beta.hat1, <span class="at">lty =</span> <span class="dv">2</span>)</span></code></pre></div>
<p><img src="SLID_book_files/figure-html/unnamed-chunk-144-1.png" width="672" /></p>
<p>Next, we plugin the estimated <span class="math inline">\(\hat{\beta}\)</span> to the process and visualize the fitted curve for <span class="math inline">\(I(t)\)</span> compared to the observed path.</p>
<div class="sourceCode" id="cb226"><pre class="sourceCode r"><code class="sourceCode r"><span id="cb226-1"><a href="compartment.html#cb226-1" aria-hidden="true" tabindex="-1"></a><span class="fu">coef</span>(niameyA) <span class="ot">&lt;-</span> <span class="fu">c</span>(<span class="at">Beta =</span> beta.hat1, <span class="at">gamma =</span> <span class="dv">1</span>, </span>
<span id="cb226-2"><a href="compartment.html#cb226-2" aria-hidden="true" tabindex="-1"></a>                   <span class="at">N =</span> <span class="dv">50000</span>, <span class="at">S_0 =</span> <span class="dv">10000</span>, <span class="at">I_0 =</span> <span class="dv">10</span>)</span>
<span id="cb226-3"><a href="compartment.html#cb226-3" aria-hidden="true" tabindex="-1"></a>x1 <span class="ot">&lt;-</span> <span class="fu">trajectory</span>(niameyA, <span class="at">format =</span> <span class="st">&quot;data.frame&quot;</span>)</span>
<span id="cb226-4"><a href="compartment.html#cb226-4" aria-hidden="true" tabindex="-1"></a>sir.fit.df <span class="ot">&lt;-</span> <span class="fu">left_join</span>(<span class="fu">as.data.frame</span>(niameyA), x1, <span class="at">by =</span> <span class="st">&#39;biweek&#39;</span>)</span>
<span id="cb226-5"><a href="compartment.html#cb226-5" aria-hidden="true" tabindex="-1"></a></span>
<span id="cb226-6"><a href="compartment.html#cb226-6" aria-hidden="true" tabindex="-1"></a><span class="fu">plot_ly</span>(<span class="at">data =</span> sir.fit.df) <span class="sc">%&gt;%</span> </span>
<span id="cb226-7"><a href="compartment.html#cb226-7" aria-hidden="true" tabindex="-1"></a>  <span class="fu">add_trace</span>(<span class="at">x =</span> <span class="sc">~</span>biweek, <span class="at">y =</span> <span class="sc">~</span>measles, <span class="at">type =</span> <span class="st">&#39;scatter&#39;</span>, </span>
<span id="cb226-8"><a href="compartment.html#cb226-8" aria-hidden="true" tabindex="-1"></a>            <span class="at">mode =</span> <span class="st">&#39;lines+markers&#39;</span>, <span class="at">name =</span> <span class="st">&#39;data&#39;</span>) <span class="sc">%&gt;%</span> </span>
<span id="cb226-9"><a href="compartment.html#cb226-9" aria-hidden="true" tabindex="-1"></a>  <span class="fu">add_trace</span>(<span class="at">x =</span> <span class="sc">~</span>biweek, <span class="at">y =</span> <span class="sc">~</span>I, <span class="at">type =</span> <span class="st">&#39;scatter&#39;</span>, </span>
<span id="cb226-10"><a href="compartment.html#cb226-10" aria-hidden="true" tabindex="-1"></a>            <span class="at">mode =</span> <span class="st">&#39;lines+markers&#39;</span>, <span class="at">name =</span> <span class="st">&#39;fitted&#39;</span>)</span></code></pre></div>
<div id="htmlwidget-e21efc75b7ec9635dd75" style="width:672px;height:480px;" class="plotly html-widget"></div>
<script type="application/json" data-for="htmlwidget-e21efc75b7ec9635dd75">{"x":{"visdat":{"f336ef3a49a":["function () ","plotlyVisDat"]},"cur_data":"f336ef3a49a","attrs":{"f336ef3a49a":{"alpha_stroke":1,"sizes":[10,100],"spans":[1,20],"x":{},"y":{},"type":"scatter","mode":"lines+markers","name":"data","inherit":true},"f336ef3a49a.1":{"alpha_stroke":1,"sizes":[10,100],"spans":[1,20],"x":{},"y":{},"type":"scatter","mode":"lines+markers","name":"fitted","inherit":true}},"layout":{"margin":{"b":40,"l":60,"t":25,"r":10},"xaxis":{"domain":[0,1],"automargin":true,"title":"biweek"},"yaxis":{"domain":[0,1],"automargin":true,"title":"measles"},"hovermode":"closest","showlegend":true},"source":"A","config":{"showSendToCloud":false},"data":[{"x":[1,2,3,4,5,6,7,8,9,10,11,12,13,14,15,16],"y":[22,27,64,84,116,172,173,651,786,1041,842,903,745,211,83,11],"type":"scatter","mode":"lines+markers","name":"data","marker":{"color":"rgba(31,119,180,1)","line":{"color":"rgba(31,119,180,1)"}},"error_y":{"color":"rgba(31,119,180,1)"},"error_x":{"color":"rgba(31,119,180,1)"},"line":{"color":"rgba(31,119,180,1)"},"xaxis":"x","yaxis":"y","frame":null},{"x":[1,2,3,4,5,6,7,8,9,10,11,12,13,14,15,16],"y":[18.1924706862004,32.9386799065054,59.126185831892,104.520495185121,179.911627331567,296.187948097761,454.622086419532,631.179916138036,771.988848115918,822.412895561083,769.493419720646,646.607070630367,501.014885187571,366.476661585129,257.70125215327,176.484390248392],"type":"scatter","mode":"lines+markers","name":"fitted","marker":{"color":"rgba(255,127,14,1)","line":{"color":"rgba(255,127,14,1)"}},"error_y":{"color":"rgba(255,127,14,1)"},"error_x":{"color":"rgba(255,127,14,1)"},"line":{"color":"rgba(255,127,14,1)"},"xaxis":"x","yaxis":"y","frame":null}],"highlight":{"on":"plotly_click","persistent":false,"dynamic":false,"selectize":false,"opacityDim":0.2,"selected":{"opacity":1},"debounce":0},"shinyEvents":["plotly_hover","plotly_click","plotly_selected","plotly_relayout","plotly_brushed","plotly_brushing","plotly_clickannotation","plotly_doubleclick","plotly_deselect","plotly_afterplot","plotly_sunburstclick"],"base_url":"https://plot.ly"},"evals":[],"jsHooks":[]}</script>
<ul>
<li><strong>Optimization algorithm</strong></li>
</ul>
<p>However, this grid-search approach won’t perform well when we have more than one parameter. In that case, we can use the <code>optim</code> function instead.</p>
<div class="sourceCode" id="cb227"><pre class="sourceCode r"><code class="sourceCode r"><span id="cb227-1"><a href="compartment.html#cb227-1" aria-hidden="true" tabindex="-1"></a><span class="co"># General-purpose optimization</span></span>
<span id="cb227-2"><a href="compartment.html#cb227-2" aria-hidden="true" tabindex="-1"></a>f2 <span class="ot">&lt;-</span> <span class="cf">function</span> (par) {</span>
<span id="cb227-3"><a href="compartment.html#cb227-3" aria-hidden="true" tabindex="-1"></a>  params <span class="ot">&lt;-</span> <span class="fu">c</span>(<span class="at">Beta =</span> par[<span class="dv">1</span>], <span class="at">gamma =</span> par[<span class="dv">2</span>], </span>
<span id="cb227-4"><a href="compartment.html#cb227-4" aria-hidden="true" tabindex="-1"></a>              <span class="at">N =</span> <span class="dv">50000</span>, <span class="at">S_0 =</span> <span class="dv">10000</span>, <span class="at">I_0 =</span> par[<span class="dv">3</span>])</span>
<span id="cb227-5"><a href="compartment.html#cb227-5" aria-hidden="true" tabindex="-1"></a>  <span class="fu">sse</span>(params)</span>
<span id="cb227-6"><a href="compartment.html#cb227-6" aria-hidden="true" tabindex="-1"></a>}</span>
<span id="cb227-7"><a href="compartment.html#cb227-7" aria-hidden="true" tabindex="-1"></a>fit2 <span class="ot">&lt;-</span> <span class="fu">optim</span>(<span class="at">fn =</span> f2, <span class="at">par =</span> <span class="fu">c</span>(<span class="dv">8</span>, <span class="dv">1</span>, <span class="dv">10</span>))</span>
<span id="cb227-8"><a href="compartment.html#cb227-8" aria-hidden="true" tabindex="-1"></a>fit2</span></code></pre></div>
<pre><code>## $par
## [1] 9.892048 1.150991 1.042747
## 
## $value
## [1] 164836.4
## 
## $counts
## function gradient 
##      253       NA 
## 
## $convergence
## [1] 0
## 
## $message
## NULL</code></pre>
<div class="sourceCode" id="cb229"><pre class="sourceCode r"><code class="sourceCode r"><span id="cb229-1"><a href="compartment.html#cb229-1" aria-hidden="true" tabindex="-1"></a>beta.hat2 <span class="ot">&lt;-</span> fit2<span class="sc">$</span>par[<span class="dv">1</span>]</span>
<span id="cb229-2"><a href="compartment.html#cb229-2" aria-hidden="true" tabindex="-1"></a>gamma.hat2 <span class="ot">&lt;-</span> fit2<span class="sc">$</span>par[<span class="dv">2</span>]</span>
<span id="cb229-3"><a href="compartment.html#cb229-3" aria-hidden="true" tabindex="-1"></a>I_0.hat2 <span class="ot">&lt;-</span> fit2<span class="sc">$</span>par[<span class="dv">3</span>]</span>
<span id="cb229-4"><a href="compartment.html#cb229-4" aria-hidden="true" tabindex="-1"></a><span class="fu">coef</span>(niameyA) <span class="ot">&lt;-</span> <span class="fu">c</span>(<span class="at">Beta =</span> beta.hat2, <span class="at">gamma =</span> gamma.hat2, </span>
<span id="cb229-5"><a href="compartment.html#cb229-5" aria-hidden="true" tabindex="-1"></a>                   <span class="at">N =</span> <span class="dv">50000</span>, <span class="at">S_0 =</span> <span class="dv">10000</span>, <span class="at">I_0 =</span> I_0.hat2)</span>
<span id="cb229-6"><a href="compartment.html#cb229-6" aria-hidden="true" tabindex="-1"></a>x2 <span class="ot">&lt;-</span> <span class="fu">trajectory</span>(niameyA, <span class="at">format =</span> <span class="st">&quot;data.frame&quot;</span>)</span>
<span id="cb229-7"><a href="compartment.html#cb229-7" aria-hidden="true" tabindex="-1"></a>sir.fit.df <span class="ot">&lt;-</span> <span class="fu">left_join</span>(<span class="fu">as.data.frame</span>(niameyA), x2, <span class="at">by =</span> <span class="st">&#39;biweek&#39;</span>)</span>
<span id="cb229-8"><a href="compartment.html#cb229-8" aria-hidden="true" tabindex="-1"></a></span>
<span id="cb229-9"><a href="compartment.html#cb229-9" aria-hidden="true" tabindex="-1"></a><span class="fu">plot_ly</span>(<span class="at">data =</span> sir.fit.df) <span class="sc">%&gt;%</span> </span>
<span id="cb229-10"><a href="compartment.html#cb229-10" aria-hidden="true" tabindex="-1"></a>  <span class="fu">add_trace</span>(<span class="at">x =</span> <span class="sc">~</span>biweek, <span class="at">y =</span> <span class="sc">~</span>measles, <span class="at">type =</span> <span class="st">&#39;scatter&#39;</span>, </span>
<span id="cb229-11"><a href="compartment.html#cb229-11" aria-hidden="true" tabindex="-1"></a>            <span class="at">mode =</span> <span class="st">&#39;lines+markers&#39;</span>, <span class="at">name =</span> <span class="st">&#39;data&#39;</span>) <span class="sc">%&gt;%</span> </span>
<span id="cb229-12"><a href="compartment.html#cb229-12" aria-hidden="true" tabindex="-1"></a>  <span class="fu">add_trace</span>(<span class="at">x =</span> <span class="sc">~</span>biweek, <span class="at">y =</span> <span class="sc">~</span>I, <span class="at">type =</span> <span class="st">&#39;scatter&#39;</span>, </span>
<span id="cb229-13"><a href="compartment.html#cb229-13" aria-hidden="true" tabindex="-1"></a>            <span class="at">mode =</span> <span class="st">&#39;lines+markers&#39;</span>, <span class="at">name =</span> <span class="st">&#39;fitted&#39;</span>)</span></code></pre></div>
<div id="htmlwidget-585a017cd1dad3a23005" style="width:672px;height:480px;" class="plotly html-widget"></div>
<script type="application/json" data-for="htmlwidget-585a017cd1dad3a23005">{"x":{"visdat":{"f336dfcfffb":["function () ","plotlyVisDat"]},"cur_data":"f336dfcfffb","attrs":{"f336dfcfffb":{"alpha_stroke":1,"sizes":[10,100],"spans":[1,20],"x":{},"y":{},"type":"scatter","mode":"lines+markers","name":"data","inherit":true},"f336dfcfffb.1":{"alpha_stroke":1,"sizes":[10,100],"spans":[1,20],"x":{},"y":{},"type":"scatter","mode":"lines+markers","name":"fitted","inherit":true}},"layout":{"margin":{"b":40,"l":60,"t":25,"r":10},"xaxis":{"domain":[0,1],"automargin":true,"title":"biweek"},"yaxis":{"domain":[0,1],"automargin":true,"title":"measles"},"hovermode":"closest","showlegend":true},"source":"A","config":{"showSendToCloud":false},"data":[{"x":[1,2,3,4,5,6,7,8,9,10,11,12,13,14,15,16],"y":[22,27,64,84,116,172,173,651,786,1041,842,903,745,211,83,11],"type":"scatter","mode":"lines+markers","name":"data","marker":{"color":"rgba(31,119,180,1)","line":{"color":"rgba(31,119,180,1)"}},"error_y":{"color":"rgba(31,119,180,1)"},"error_x":{"color":"rgba(31,119,180,1)"},"line":{"color":"rgba(31,119,180,1)"},"xaxis":"x","yaxis":"y","frame":null},{"x":[1,2,3,4,5,6,7,8,9,10,11,12,13,14,15,16],"y":[2.38453623343713,5.4475298081341,12.4170094779248,28.1585490082853,63.1233954443215,137.937937405317,285.525377847117,531.680315914184,828.832798168307,1018.56396027569,981.66089209138,778.892931882737,541.912753728272,347.715427417774,212.694889900041,126.545242960492],"type":"scatter","mode":"lines+markers","name":"fitted","marker":{"color":"rgba(255,127,14,1)","line":{"color":"rgba(255,127,14,1)"}},"error_y":{"color":"rgba(255,127,14,1)"},"error_x":{"color":"rgba(255,127,14,1)"},"line":{"color":"rgba(255,127,14,1)"},"xaxis":"x","yaxis":"y","frame":null}],"highlight":{"on":"plotly_click","persistent":false,"dynamic":false,"selectize":false,"opacityDim":0.2,"selected":{"opacity":1},"debounce":0},"shinyEvents":["plotly_hover","plotly_click","plotly_selected","plotly_relayout","plotly_brushed","plotly_brushing","plotly_clickannotation","plotly_doubleclick","plotly_deselect","plotly_afterplot","plotly_sunburstclick"],"base_url":"https://plot.ly"},"evals":[],"jsHooks":[]}</script>
<ol start="2" style="list-style-type: decimal">
<li>Maximum likelihood approach</li>
</ol>
<p>Another way to fit the model is using likelihood. Note that the model can be simplified a little bit by defining <span class="math inline">\(b = \beta/N\)</span>.</p>
<div class="sourceCode" id="cb230"><pre class="sourceCode r"><code class="sourceCode r"><span id="cb230-1"><a href="compartment.html#cb230-1" aria-hidden="true" tabindex="-1"></a>niameyA2 <span class="ot">&lt;-</span> <span class="fu">pomp</span>(</span>
<span id="cb230-2"><a href="compartment.html#cb230-2" aria-hidden="true" tabindex="-1"></a>  <span class="at">data =</span> <span class="fu">subset</span>(niamey, community <span class="sc">==</span> <span class="st">&quot;A&quot;</span>, <span class="at">select =</span> <span class="sc">-</span>community),</span>
<span id="cb230-3"><a href="compartment.html#cb230-3" aria-hidden="true" tabindex="-1"></a>  <span class="at">times =</span> <span class="st">&quot;biweek&quot;</span>, <span class="at">t0 =</span> <span class="dv">0</span>,</span>
<span id="cb230-4"><a href="compartment.html#cb230-4" aria-hidden="true" tabindex="-1"></a>  <span class="at">skeleton =</span> <span class="fu">vectorfield</span>(</span>
<span id="cb230-5"><a href="compartment.html#cb230-5" aria-hidden="true" tabindex="-1"></a>    <span class="fu">Csnippet</span>(<span class="st">&quot;</span></span>
<span id="cb230-6"><a href="compartment.html#cb230-6" aria-hidden="true" tabindex="-1"></a><span class="st">      double incidence;</span></span>
<span id="cb230-7"><a href="compartment.html#cb230-7" aria-hidden="true" tabindex="-1"></a><span class="st">      incidence = b*S*I;</span></span>
<span id="cb230-8"><a href="compartment.html#cb230-8" aria-hidden="true" tabindex="-1"></a><span class="st">      DS = -incidence;</span></span>
<span id="cb230-9"><a href="compartment.html#cb230-9" aria-hidden="true" tabindex="-1"></a><span class="st">      DI = incidence - gamma*I;&quot;</span>)),</span>
<span id="cb230-10"><a href="compartment.html#cb230-10" aria-hidden="true" tabindex="-1"></a>  <span class="at">rinit=</span><span class="fu">Csnippet</span>(<span class="st">&quot;</span></span>
<span id="cb230-11"><a href="compartment.html#cb230-11" aria-hidden="true" tabindex="-1"></a><span class="st">      S = S_0;</span></span>
<span id="cb230-12"><a href="compartment.html#cb230-12" aria-hidden="true" tabindex="-1"></a><span class="st">      I = I_0;&quot;</span>),</span>
<span id="cb230-13"><a href="compartment.html#cb230-13" aria-hidden="true" tabindex="-1"></a>  <span class="at">paramnames =</span> <span class="fu">c</span>(<span class="st">&quot;b&quot;</span>, <span class="st">&quot;gamma&quot;</span>, <span class="st">&quot;S_0&quot;</span>, <span class="st">&quot;I_0&quot;</span>),</span>
<span id="cb230-14"><a href="compartment.html#cb230-14" aria-hidden="true" tabindex="-1"></a>  <span class="at">statenames =</span> <span class="fu">c</span>(<span class="st">&quot;S&quot;</span>, <span class="st">&quot;I&quot;</span>))</span>
<span id="cb230-15"><a href="compartment.html#cb230-15" aria-hidden="true" tabindex="-1"></a></span>
<span id="cb230-16"><a href="compartment.html#cb230-16" aria-hidden="true" tabindex="-1"></a>loglik.normal <span class="ot">&lt;-</span> <span class="cf">function</span> (params) {</span>
<span id="cb230-17"><a href="compartment.html#cb230-17" aria-hidden="true" tabindex="-1"></a>  x <span class="ot">&lt;-</span> <span class="fu">trajectory</span>(niameyA2, <span class="at">params =</span> params)</span>
<span id="cb230-18"><a href="compartment.html#cb230-18" aria-hidden="true" tabindex="-1"></a>  <span class="fu">sum</span>(<span class="fu">dnorm</span>(<span class="at">x =</span> <span class="fu">obs</span>(niameyA2), <span class="at">mean =</span> x[<span class="st">&quot;I&quot;</span>,,],</span>
<span id="cb230-19"><a href="compartment.html#cb230-19" aria-hidden="true" tabindex="-1"></a>            <span class="at">sd =</span> params[<span class="st">&quot;sigma&quot;</span>], <span class="at">log =</span> <span class="cn">TRUE</span>))</span>
<span id="cb230-20"><a href="compartment.html#cb230-20" aria-hidden="true" tabindex="-1"></a>}</span>
<span id="cb230-21"><a href="compartment.html#cb230-21" aria-hidden="true" tabindex="-1"></a></span>
<span id="cb230-22"><a href="compartment.html#cb230-22" aria-hidden="true" tabindex="-1"></a>f3 <span class="ot">&lt;-</span> <span class="cf">function</span> (b) {</span>
<span id="cb230-23"><a href="compartment.html#cb230-23" aria-hidden="true" tabindex="-1"></a>  params <span class="ot">&lt;-</span> <span class="fu">c</span>(<span class="at">S_0 =</span> <span class="dv">10000</span>, <span class="at">I_0 =</span> <span class="dv">10</span>, <span class="at">gamma =</span> <span class="dv">1</span>, </span>
<span id="cb230-24"><a href="compartment.html#cb230-24" aria-hidden="true" tabindex="-1"></a>              <span class="at">b =</span> b, <span class="at">sigma =</span> <span class="dv">1</span>)</span>
<span id="cb230-25"><a href="compartment.html#cb230-25" aria-hidden="true" tabindex="-1"></a>  <span class="fu">loglik.normal</span>(params)</span>
<span id="cb230-26"><a href="compartment.html#cb230-26" aria-hidden="true" tabindex="-1"></a>}</span>
<span id="cb230-27"><a href="compartment.html#cb230-27" aria-hidden="true" tabindex="-1"></a></span>
<span id="cb230-28"><a href="compartment.html#cb230-28" aria-hidden="true" tabindex="-1"></a>b <span class="ot">&lt;-</span> <span class="fu">seq</span>(<span class="at">from =</span> <span class="dv">0</span>, <span class="at">to =</span> <span class="fl">0.001</span>, <span class="at">by =</span> <span class="fl">0.00002</span>)</span>
<span id="cb230-29"><a href="compartment.html#cb230-29" aria-hidden="true" tabindex="-1"></a>ll <span class="ot">&lt;-</span> <span class="fu">sapply</span>(b, f3)</span>
<span id="cb230-30"><a href="compartment.html#cb230-30" aria-hidden="true" tabindex="-1"></a></span>
<span id="cb230-31"><a href="compartment.html#cb230-31" aria-hidden="true" tabindex="-1"></a><span class="fu">plot</span>(b, ll, <span class="at">type=</span><span class="st">&#39;l&#39;</span>, <span class="at">ylab =</span> <span class="fu">expression</span>(<span class="fu">log</span>(L)))</span>
<span id="cb230-32"><a href="compartment.html#cb230-32" aria-hidden="true" tabindex="-1"></a>b.hat <span class="ot">&lt;-</span> b[<span class="fu">which.max</span>(ll)]</span>
<span id="cb230-33"><a href="compartment.html#cb230-33" aria-hidden="true" tabindex="-1"></a><span class="fu">abline</span>(<span class="at">v =</span> b.hat, <span class="at">lty =</span> <span class="dv">2</span>)</span></code></pre></div>
<p><img src="SLID_book_files/figure-html/unnamed-chunk-147-1.png" width="672" /></p>
<div class="sourceCode" id="cb231"><pre class="sourceCode r"><code class="sourceCode r"><span id="cb231-1"><a href="compartment.html#cb231-1" aria-hidden="true" tabindex="-1"></a><span class="fu">coef</span>(niameyA2) <span class="ot">&lt;-</span> <span class="fu">c</span>(<span class="at">S_0 =</span> <span class="dv">10000</span>, <span class="at">I_0 =</span> <span class="dv">10</span>, </span>
<span id="cb231-2"><a href="compartment.html#cb231-2" aria-hidden="true" tabindex="-1"></a>                    <span class="at">gamma =</span> <span class="dv">1</span>, <span class="at">b =</span> b.hat, <span class="at">sigma =</span> <span class="dv">1</span>)</span>
<span id="cb231-3"><a href="compartment.html#cb231-3" aria-hidden="true" tabindex="-1"></a>x <span class="ot">&lt;-</span> <span class="fu">trajectory</span>(niameyA2, <span class="at">format =</span> <span class="st">&quot;data.frame&quot;</span>)</span>
<span id="cb231-4"><a href="compartment.html#cb231-4" aria-hidden="true" tabindex="-1"></a>sir.fit.df <span class="ot">&lt;-</span> <span class="fu">left_join</span>(<span class="fu">as.data.frame</span>(niameyA2), </span>
<span id="cb231-5"><a href="compartment.html#cb231-5" aria-hidden="true" tabindex="-1"></a>                        x, <span class="at">by =</span> <span class="st">&#39;biweek&#39;</span>)</span>
<span id="cb231-6"><a href="compartment.html#cb231-6" aria-hidden="true" tabindex="-1"></a></span>
<span id="cb231-7"><a href="compartment.html#cb231-7" aria-hidden="true" tabindex="-1"></a><span class="fu">plot_ly</span>(<span class="at">data =</span> sir.fit.df) <span class="sc">%&gt;%</span> </span>
<span id="cb231-8"><a href="compartment.html#cb231-8" aria-hidden="true" tabindex="-1"></a>  <span class="fu">add_trace</span>(<span class="at">x =</span> <span class="sc">~</span>biweek, <span class="at">y =</span> <span class="sc">~</span>measles, <span class="at">type =</span> <span class="st">&#39;scatter&#39;</span>, </span>
<span id="cb231-9"><a href="compartment.html#cb231-9" aria-hidden="true" tabindex="-1"></a>            <span class="at">mode =</span> <span class="st">&#39;lines+markers&#39;</span>, <span class="at">name =</span> <span class="st">&#39;data&#39;</span>) <span class="sc">%&gt;%</span> </span>
<span id="cb231-10"><a href="compartment.html#cb231-10" aria-hidden="true" tabindex="-1"></a>  <span class="fu">add_trace</span>(<span class="at">x =</span> <span class="sc">~</span>biweek, <span class="at">y =</span> <span class="sc">~</span>I, <span class="at">type =</span> <span class="st">&#39;scatter&#39;</span>, </span>
<span id="cb231-11"><a href="compartment.html#cb231-11" aria-hidden="true" tabindex="-1"></a>            <span class="at">mode =</span> <span class="st">&#39;lines+markers&#39;</span>, <span class="at">name =</span> <span class="st">&#39;fitted&#39;</span>)</span></code></pre></div>
<div id="htmlwidget-8c69328f67609b131dd8" style="width:672px;height:480px;" class="plotly html-widget"></div>
<script type="application/json" data-for="htmlwidget-8c69328f67609b131dd8">{"x":{"visdat":{"f3317758eec":["function () ","plotlyVisDat"]},"cur_data":"f3317758eec","attrs":{"f3317758eec":{"alpha_stroke":1,"sizes":[10,100],"spans":[1,20],"x":{},"y":{},"type":"scatter","mode":"lines+markers","name":"data","inherit":true},"f3317758eec.1":{"alpha_stroke":1,"sizes":[10,100],"spans":[1,20],"x":{},"y":{},"type":"scatter","mode":"lines+markers","name":"fitted","inherit":true}},"layout":{"margin":{"b":40,"l":60,"t":25,"r":10},"xaxis":{"domain":[0,1],"automargin":true,"title":"biweek"},"yaxis":{"domain":[0,1],"automargin":true,"title":"measles"},"hovermode":"closest","showlegend":true},"source":"A","config":{"showSendToCloud":false},"data":[{"x":[1,2,3,4,5,6,7,8,9,10,11,12,13,14,15,16],"y":[22,27,64,84,116,172,173,651,786,1041,842,903,745,211,83,11],"type":"scatter","mode":"lines+markers","name":"data","marker":{"color":"rgba(31,119,180,1)","line":{"color":"rgba(31,119,180,1)"}},"error_y":{"color":"rgba(31,119,180,1)"},"error_x":{"color":"rgba(31,119,180,1)"},"line":{"color":"rgba(31,119,180,1)"},"xaxis":"x","yaxis":"y","frame":null},{"x":[1,2,3,4,5,6,7,8,9,10,11,12,13,14,15,16],"y":[18.1924706862004,32.9386799065053,59.126185831892,104.520495185121,179.911627331567,296.187948097761,454.62208641953,631.179916138031,771.98884811592,822.412895561085,769.493419720649,646.607070630371,501.014885187571,366.476661585124,257.701252153275,176.48439024841],"type":"scatter","mode":"lines+markers","name":"fitted","marker":{"color":"rgba(255,127,14,1)","line":{"color":"rgba(255,127,14,1)"}},"error_y":{"color":"rgba(255,127,14,1)"},"error_x":{"color":"rgba(255,127,14,1)"},"line":{"color":"rgba(255,127,14,1)"},"xaxis":"x","yaxis":"y","frame":null}],"highlight":{"on":"plotly_click","persistent":false,"dynamic":false,"selectize":false,"opacityDim":0.2,"selected":{"opacity":1},"debounce":0},"shinyEvents":["plotly_hover","plotly_click","plotly_selected","plotly_relayout","plotly_brushed","plotly_brushing","plotly_clickannotation","plotly_doubleclick","plotly_deselect","plotly_afterplot","plotly_sunburstclick"],"base_url":"https://plot.ly"},"evals":[],"jsHooks":[]}</script>
<p>Besides a gaussian distribution, it is also possible to choose other random compenent, for example, a poisson distribution.</p>
</div>
<div id="example-2.-covid-19" class="section level3" number="9.4.2">
<h3><span class="header-section-number">9.4.2</span> Example 2. COVID-19</h3>
<p>In the COVID-19 case, the situation becomes slightly more complicated due to the unsatisfying data quality in terms of active cases and recovered cases. Therefore, we modify the algorithm to find the parameters that minimize the distance between the curve of fitted active cases (<span class="math inline">\(I\)</span>) plus removed compartment <span class="math inline">\(R\)</span> and the cumulative positive COVID-19 cases time series. If we use the data observed since the beginning of the pandemic, it is reasonable to set the initial value <span class="math inline">\(I_{0}\)</span> to be 1 and focusing on the estimation of other parameters. However, if we choose a different training period, for example, the most recent 60 days, it is possible the initial value of active cases <span class="math inline">\(I_{0}\)</span> may be unobserved or calculated inaccurately. Therefore, the initial value can also be treated as a parameter and estimated based on collected data. In this case, an optimizing function such as <code>optim()</code> might be preferred than grid search. Here is an example of implementing SIR model to fit the spread of COVID-19 in Los Angeles, California.</p>
<div class="sourceCode" id="cb232"><pre class="sourceCode r"><code class="sourceCode r"><span id="cb232-1"><a href="compartment.html#cb232-1" aria-hidden="true" tabindex="-1"></a><span class="fu">data</span>(<span class="st">&quot;I.county&quot;</span>)</span>
<span id="cb232-2"><a href="compartment.html#cb232-2" aria-hidden="true" tabindex="-1"></a><span class="fu">data</span>(<span class="st">&quot;pop.county&quot;</span>)</span>
<span id="cb232-3"><a href="compartment.html#cb232-3" aria-hidden="true" tabindex="-1"></a><span class="co"># the row storing the data for Los Angeles</span></span>
<span id="cb232-4"><a href="compartment.html#cb232-4" aria-hidden="true" tabindex="-1"></a>i <span class="ot">&lt;-</span> <span class="fu">which</span>(I.county<span class="sc">$</span>County <span class="sc">==</span> <span class="st">&#39;Orange&#39;</span> <span class="sc">&amp;</span> </span>
<span id="cb232-5"><a href="compartment.html#cb232-5" aria-hidden="true" tabindex="-1"></a>             I.county<span class="sc">$</span>State <span class="sc">==</span> <span class="st">&#39;California&#39;</span>) </span>
<span id="cb232-6"><a href="compartment.html#cb232-6" aria-hidden="true" tabindex="-1"></a>N0 <span class="ot">&lt;-</span> pop.county <span class="sc">%&gt;%</span> </span>
<span id="cb232-7"><a href="compartment.html#cb232-7" aria-hidden="true" tabindex="-1"></a>  <span class="fu">filter</span>(County <span class="sc">==</span> <span class="st">&#39;Orange County&#39;</span> <span class="sc">&amp;</span> State <span class="sc">==</span> <span class="st">&#39;California&#39;</span>) <span class="sc">%&gt;%</span> </span>
<span id="cb232-8"><a href="compartment.html#cb232-8" aria-hidden="true" tabindex="-1"></a>  <span class="fu">pull</span>(population)</span>
<span id="cb232-9"><a href="compartment.html#cb232-9" aria-hidden="true" tabindex="-1"></a>est.h <span class="ot">&lt;-</span> <span class="dv">60</span></span>
<span id="cb232-10"><a href="compartment.html#cb232-10" aria-hidden="true" tabindex="-1"></a>pred.h <span class="ot">&lt;-</span> <span class="dv">12</span></span>
<span id="cb232-11"><a href="compartment.html#cb232-11" aria-hidden="true" tabindex="-1"></a>date.start <span class="ot">&lt;-</span> <span class="fu">as.Date</span>(<span class="st">&#39;2020-10-01&#39;</span>)</span>
<span id="cb232-12"><a href="compartment.html#cb232-12" aria-hidden="true" tabindex="-1"></a>dates.train <span class="ot">&lt;-</span> date.start <span class="sc">+</span> <span class="dv">0</span><span class="sc">:</span>(est.h <span class="sc">-</span> <span class="dv">1</span>) <span class="co"># training period</span></span>
<span id="cb232-13"><a href="compartment.html#cb232-13" aria-hidden="true" tabindex="-1"></a>dates.test <span class="ot">&lt;-</span> date.start <span class="sc">+</span> est.h <span class="sc">+</span> <span class="dv">0</span><span class="sc">:</span>(pred.h <span class="sc">-</span> <span class="dv">1</span>) <span class="co"># testing period</span></span>
<span id="cb232-14"><a href="compartment.html#cb232-14" aria-hidden="true" tabindex="-1"></a>dates.all <span class="ot">&lt;-</span> date.start <span class="sc">+</span> <span class="dv">0</span><span class="sc">:</span>(est.h <span class="sc">+</span> pred.h <span class="sc">-</span> <span class="dv">1</span>)</span>
<span id="cb232-15"><a href="compartment.html#cb232-15" aria-hidden="true" tabindex="-1"></a>P.train <span class="ot">&lt;-</span> <span class="fu">data.frame</span>(<span class="at">Date =</span> <span class="dv">0</span><span class="sc">:</span>(est.h <span class="sc">-</span> <span class="dv">1</span>), </span>
<span id="cb232-16"><a href="compartment.html#cb232-16" aria-hidden="true" tabindex="-1"></a>                      <span class="at">P_cases =</span> <span class="fu">as.numeric</span>(I.county[i, </span>
<span id="cb232-17"><a href="compartment.html#cb232-17" aria-hidden="true" tabindex="-1"></a>                      <span class="fu">paste0</span>(<span class="st">&#39;X&#39;</span>, <span class="fu">as.character</span>(dates.train, </span>
<span id="cb232-18"><a href="compartment.html#cb232-18" aria-hidden="true" tabindex="-1"></a>                             <span class="at">format =</span> <span class="st">&#39;%Y.%m.%d&#39;</span>))]))</span>
<span id="cb232-19"><a href="compartment.html#cb232-19" aria-hidden="true" tabindex="-1"></a>P.all <span class="ot">&lt;-</span> <span class="fu">data.frame</span>(<span class="at">Date =</span> <span class="dv">0</span><span class="sc">:</span>(est.h <span class="sc">+</span> pred.h <span class="sc">-</span> <span class="dv">1</span>), </span>
<span id="cb232-20"><a href="compartment.html#cb232-20" aria-hidden="true" tabindex="-1"></a>                    <span class="at">P_cases =</span> <span class="fu">as.numeric</span>(I.county[i, </span>
<span id="cb232-21"><a href="compartment.html#cb232-21" aria-hidden="true" tabindex="-1"></a>                    <span class="fu">paste0</span>(<span class="st">&#39;X&#39;</span>, <span class="fu">as.character</span>(dates.all, </span>
<span id="cb232-22"><a href="compartment.html#cb232-22" aria-hidden="true" tabindex="-1"></a>                           <span class="at">format =</span> <span class="st">&#39;%Y.%m.%d&#39;</span>))]))</span></code></pre></div>
<p>Now we define a <code>pomp</code> object encoding the data and the model and a loss function <code>SSE</code> that evaluate the loss function value based on the simulated trajectories with given parameters.</p>
<div class="sourceCode" id="cb233"><pre class="sourceCode r"><code class="sourceCode r"><span id="cb233-1"><a href="compartment.html#cb233-1" aria-hidden="true" tabindex="-1"></a>process.tmp <span class="ot">&lt;-</span> <span class="fu">pomp</span>(</span>
<span id="cb233-2"><a href="compartment.html#cb233-2" aria-hidden="true" tabindex="-1"></a>  <span class="at">data =</span> P.train, </span>
<span id="cb233-3"><a href="compartment.html#cb233-3" aria-hidden="true" tabindex="-1"></a>  <span class="at">times =</span> <span class="st">&quot;Date&quot;</span>, <span class="at">t0 =</span> <span class="dv">0</span>, </span>
<span id="cb233-4"><a href="compartment.html#cb233-4" aria-hidden="true" tabindex="-1"></a>  <span class="at">skeleton =</span> <span class="fu">vectorfield</span>(</span>
<span id="cb233-5"><a href="compartment.html#cb233-5" aria-hidden="true" tabindex="-1"></a>    <span class="fu">Csnippet</span>(<span class="st">&quot;</span></span>
<span id="cb233-6"><a href="compartment.html#cb233-6" aria-hidden="true" tabindex="-1"></a><span class="st">               DS = - Beta*S*I/N;</span></span>
<span id="cb233-7"><a href="compartment.html#cb233-7" aria-hidden="true" tabindex="-1"></a><span class="st">               DI = Beta*S*I/N - gamma*I;</span></span>
<span id="cb233-8"><a href="compartment.html#cb233-8" aria-hidden="true" tabindex="-1"></a><span class="st">               DR = gamma*I;&quot;</span>)), </span>
<span id="cb233-9"><a href="compartment.html#cb233-9" aria-hidden="true" tabindex="-1"></a>  <span class="at">rinit =</span> <span class="fu">Csnippet</span>(<span class="st">&quot;</span></span>
<span id="cb233-10"><a href="compartment.html#cb233-10" aria-hidden="true" tabindex="-1"></a><span class="st">                   S = S_0;</span></span>
<span id="cb233-11"><a href="compartment.html#cb233-11" aria-hidden="true" tabindex="-1"></a><span class="st">                   I = I_0;</span></span>
<span id="cb233-12"><a href="compartment.html#cb233-12" aria-hidden="true" tabindex="-1"></a><span class="st">                   R = N - S_0 - I_0;&quot;</span>), </span>
<span id="cb233-13"><a href="compartment.html#cb233-13" aria-hidden="true" tabindex="-1"></a>  <span class="at">statenames =</span> <span class="fu">c</span>(<span class="st">&quot;S&quot;</span>, <span class="st">&quot;I&quot;</span>, <span class="st">&quot;R&quot;</span>), </span>
<span id="cb233-14"><a href="compartment.html#cb233-14" aria-hidden="true" tabindex="-1"></a>  <span class="at">paramnames =</span> <span class="fu">c</span>(<span class="st">&quot;Beta&quot;</span>, <span class="st">&quot;gamma&quot;</span>, <span class="st">&quot;N&quot;</span>, <span class="st">&quot;S_0&quot;</span>, <span class="st">&quot;I_0&quot;</span>))</span>
<span id="cb233-15"><a href="compartment.html#cb233-15" aria-hidden="true" tabindex="-1"></a></span>
<span id="cb233-16"><a href="compartment.html#cb233-16" aria-hidden="true" tabindex="-1"></a></span>
<span id="cb233-17"><a href="compartment.html#cb233-17" aria-hidden="true" tabindex="-1"></a>sse <span class="ot">&lt;-</span> <span class="cf">function</span> (params) {</span>
<span id="cb233-18"><a href="compartment.html#cb233-18" aria-hidden="true" tabindex="-1"></a>  x <span class="ot">&lt;-</span> <span class="fu">trajectory</span>(process.tmp, <span class="at">params =</span> params)</span>
<span id="cb233-19"><a href="compartment.html#cb233-19" aria-hidden="true" tabindex="-1"></a>  discrep <span class="ot">&lt;-</span> x[<span class="st">&quot;I&quot;</span>, , ] <span class="sc">+</span> x[<span class="st">&quot;R&quot;</span>, , ] <span class="sc">-</span> <span class="fu">obs</span>(process.tmp)</span>
<span id="cb233-20"><a href="compartment.html#cb233-20" aria-hidden="true" tabindex="-1"></a>  <span class="fu">sum</span>(discrep<span class="sc">^</span><span class="dv">2</span>)</span>
<span id="cb233-21"><a href="compartment.html#cb233-21" aria-hidden="true" tabindex="-1"></a>}</span></code></pre></div>
<p>Next, we can find the parameters that minimize the SSE using <code>optim</code> function.</p>
<div class="sourceCode" id="cb234"><pre class="sourceCode r"><code class="sourceCode r"><span id="cb234-1"><a href="compartment.html#cb234-1" aria-hidden="true" tabindex="-1"></a><span class="co"># set initial value of the process</span></span>
<span id="cb234-2"><a href="compartment.html#cb234-2" aria-hidden="true" tabindex="-1"></a>S0 <span class="ot">&lt;-</span> N0 <span class="sc">-</span> P.train<span class="sc">$</span>P_cases[<span class="dv">1</span>]</span>
<span id="cb234-3"><a href="compartment.html#cb234-3" aria-hidden="true" tabindex="-1"></a><span class="co"># assume that the removal rate is known  </span></span>
<span id="cb234-4"><a href="compartment.html#cb234-4" aria-hidden="true" tabindex="-1"></a>R.rate <span class="ot">&lt;-</span> <span class="fl">0.05</span></span>
<span id="cb234-5"><a href="compartment.html#cb234-5" aria-hidden="true" tabindex="-1"></a>f1 <span class="ot">&lt;-</span> <span class="cf">function</span> (par) {</span>
<span id="cb234-6"><a href="compartment.html#cb234-6" aria-hidden="true" tabindex="-1"></a>  params <span class="ot">&lt;-</span> <span class="fu">c</span>(<span class="at">Beta =</span> par[<span class="dv">2</span>], <span class="at">gamma =</span> R.rate, <span class="at">N =</span> N0, </span>
<span id="cb234-7"><a href="compartment.html#cb234-7" aria-hidden="true" tabindex="-1"></a>              <span class="at">S_0 =</span> S0, <span class="at">I_0 =</span> par[<span class="dv">1</span>])</span>
<span id="cb234-8"><a href="compartment.html#cb234-8" aria-hidden="true" tabindex="-1"></a>  <span class="fu">sse</span>(params)</span>
<span id="cb234-9"><a href="compartment.html#cb234-9" aria-hidden="true" tabindex="-1"></a>}</span>
<span id="cb234-10"><a href="compartment.html#cb234-10" aria-hidden="true" tabindex="-1"></a><span class="co"># initial value for parameters</span></span>
<span id="cb234-11"><a href="compartment.html#cb234-11" aria-hidden="true" tabindex="-1"></a>beta0 <span class="ot">&lt;-</span> <span class="fl">0.07</span></span>
<span id="cb234-12"><a href="compartment.html#cb234-12" aria-hidden="true" tabindex="-1"></a>I0 <span class="ot">&lt;-</span> <span class="dv">1000</span></span>
<span id="cb234-13"><a href="compartment.html#cb234-13" aria-hidden="true" tabindex="-1"></a></span>
<span id="cb234-14"><a href="compartment.html#cb234-14" aria-hidden="true" tabindex="-1"></a>fit1 <span class="ot">&lt;-</span> <span class="fu">optim</span>(<span class="at">fn =</span> f1, <span class="at">par =</span> <span class="fu">c</span>(I0, beta0))</span>
<span id="cb234-15"><a href="compartment.html#cb234-15" aria-hidden="true" tabindex="-1"></a></span>
<span id="cb234-16"><a href="compartment.html#cb234-16" aria-hidden="true" tabindex="-1"></a>I0.hat1 <span class="ot">&lt;-</span> fit1<span class="sc">$</span>par[<span class="dv">1</span>]</span>
<span id="cb234-17"><a href="compartment.html#cb234-17" aria-hidden="true" tabindex="-1"></a>beta.hat1 <span class="ot">&lt;-</span> fit1<span class="sc">$</span>par[<span class="dv">2</span>]</span>
<span id="cb234-18"><a href="compartment.html#cb234-18" aria-hidden="true" tabindex="-1"></a>process.tmp1 <span class="ot">&lt;-</span> process.tmp</span>
<span id="cb234-19"><a href="compartment.html#cb234-19" aria-hidden="true" tabindex="-1"></a>pomp<span class="sc">::</span><span class="fu">coef</span>(process.tmp1) <span class="ot">&lt;-</span> <span class="fu">c</span>(<span class="at">Beta =</span> beta.hat1, <span class="at">gamma =</span> R.rate, </span>
<span id="cb234-20"><a href="compartment.html#cb234-20" aria-hidden="true" tabindex="-1"></a>                              <span class="at">N =</span> N0, <span class="at">S_0 =</span> S0, <span class="at">I_0 =</span> I0.hat1)</span>
<span id="cb234-21"><a href="compartment.html#cb234-21" aria-hidden="true" tabindex="-1"></a>x1 <span class="ot">&lt;-</span> <span class="fu">trajectory</span>(process.tmp1, <span class="at">times =</span> <span class="dv">0</span><span class="sc">:</span>(est.h <span class="sc">+</span> pred.h <span class="sc">-</span> <span class="dv">1</span>), </span>
<span id="cb234-22"><a href="compartment.html#cb234-22" aria-hidden="true" tabindex="-1"></a>                 <span class="at">format =</span> <span class="st">&quot;data.frame&quot;</span>)</span>
<span id="cb234-23"><a href="compartment.html#cb234-23" aria-hidden="true" tabindex="-1"></a></span>
<span id="cb234-24"><a href="compartment.html#cb234-24" aria-hidden="true" tabindex="-1"></a>valid.df <span class="ot">&lt;-</span> <span class="fu">data.frame</span>(<span class="at">Date =</span> dates.all, </span>
<span id="cb234-25"><a href="compartment.html#cb234-25" aria-hidden="true" tabindex="-1"></a>                       <span class="at">P_cases =</span> P.all<span class="sc">$</span>P_cases, </span>
<span id="cb234-26"><a href="compartment.html#cb234-26" aria-hidden="true" tabindex="-1"></a>                       <span class="at">SIR_P =</span> x1<span class="sc">$</span>I <span class="sc">+</span> x1<span class="sc">$</span>R, </span>
<span id="cb234-27"><a href="compartment.html#cb234-27" aria-hidden="true" tabindex="-1"></a>                       <span class="at">type =</span> <span class="fu">c</span>(<span class="fu">rep</span>(<span class="st">&#39;fitted&#39;</span>, est.h), </span>
<span id="cb234-28"><a href="compartment.html#cb234-28" aria-hidden="true" tabindex="-1"></a>                                <span class="fu">rep</span>(<span class="st">&#39;predicted&#39;</span>, pred.h)))</span>
<span id="cb234-29"><a href="compartment.html#cb234-29" aria-hidden="true" tabindex="-1"></a><span class="co"># Visualization of fitting</span></span>
<span id="cb234-30"><a href="compartment.html#cb234-30" aria-hidden="true" tabindex="-1"></a><span class="fu">plot_ly</span>(<span class="at">data =</span> valid.df) <span class="sc">%&gt;%</span> </span>
<span id="cb234-31"><a href="compartment.html#cb234-31" aria-hidden="true" tabindex="-1"></a>  <span class="fu">add_trace</span>(<span class="at">x =</span> <span class="sc">~</span>Date, <span class="at">y =</span> <span class="sc">~</span>P_cases, <span class="at">type =</span> <span class="st">&#39;scatter&#39;</span>, </span>
<span id="cb234-32"><a href="compartment.html#cb234-32" aria-hidden="true" tabindex="-1"></a>            <span class="at">mode =</span> <span class="st">&#39;lines+markers&#39;</span>, <span class="at">name =</span> <span class="st">&#39;infected cases&#39;</span>) <span class="sc">%&gt;%</span></span>
<span id="cb234-33"><a href="compartment.html#cb234-33" aria-hidden="true" tabindex="-1"></a>  <span class="fu">add_trace</span>(<span class="at">x =</span> <span class="sc">~</span>Date, <span class="at">y =</span> <span class="sc">~</span>SIR_P, <span class="at">symbol =</span> <span class="sc">~</span>type, </span>
<span id="cb234-34"><a href="compartment.html#cb234-34" aria-hidden="true" tabindex="-1"></a>            <span class="at">mode =</span> <span class="st">&#39;lines+markers&#39;</span>)</span></code></pre></div>
<pre><code>## No trace type specified:
##   Based on info supplied, a &#39;scatter&#39; trace seems appropriate.
##   Read more about this trace type -&gt; https://plotly.com/r/reference/#scatter</code></pre>
<div id="htmlwidget-34d8e6a1b560e81ec148" style="width:672px;height:480px;" class="plotly html-widget"></div>
<script type="application/json" data-for="htmlwidget-34d8e6a1b560e81ec148">{"x":{"visdat":{"f336b9af5f1":["function () ","plotlyVisDat"]},"cur_data":"f336b9af5f1","attrs":{"f336b9af5f1":{"alpha_stroke":1,"sizes":[10,100],"spans":[1,20],"x":{},"y":{},"type":"scatter","mode":"lines+markers","name":"infected cases","inherit":true},"f336b9af5f1.1":{"alpha_stroke":1,"sizes":[10,100],"spans":[1,20],"x":{},"y":{},"symbol":{},"mode":"lines+markers","inherit":true}},"layout":{"margin":{"b":40,"l":60,"t":25,"r":10},"xaxis":{"domain":[0,1],"automargin":true,"title":"Date"},"yaxis":{"domain":[0,1],"automargin":true,"title":"P_cases"},"hovermode":"closest","showlegend":true},"source":"A","config":{"showSendToCloud":false},"data":[{"x":["2020-10-01","2020-10-02","2020-10-03","2020-10-04","2020-10-05","2020-10-06","2020-10-07","2020-10-08","2020-10-09","2020-10-10","2020-10-11","2020-10-12","2020-10-13","2020-10-14","2020-10-15","2020-10-16","2020-10-17","2020-10-18","2020-10-19","2020-10-20","2020-10-21","2020-10-22","2020-10-23","2020-10-24","2020-10-25","2020-10-26","2020-10-27","2020-10-28","2020-10-29","2020-10-30","2020-10-31","2020-11-01","2020-11-02","2020-11-03","2020-11-04","2020-11-05","2020-11-06","2020-11-07","2020-11-08","2020-11-09","2020-11-10","2020-11-11","2020-11-12","2020-11-13","2020-11-14","2020-11-15","2020-11-16","2020-11-17","2020-11-18","2020-11-19","2020-11-20","2020-11-21","2020-11-22","2020-11-23","2020-11-24","2020-11-25","2020-11-26","2020-11-27","2020-11-28","2020-11-29","2020-11-30","2020-12-01","2020-12-02","2020-12-03","2020-12-04","2020-12-05","2020-12-06","2020-12-07","2020-12-08","2020-12-09","2020-12-10","2020-12-11"],"y":[53909,54118,54357,54640,54760,54898,55042,55183,55345,55531,55775,55892,56070,56283,56436,56587,56672,56868,57071,57373,57635,57848,58010,58326,58573,58725,58980,59213,59442,59718,59882,60115,60298,60604,60841,61112,61421,61743,62255,62563,62830,63165,63460,64058,64586,65225,65605,65957,66585,67167,68336,69142,69694,71116,71953,73152,73152,75095,76761,77819,78553,79343,80551,81653,82887,84853,86878,88842,90513,93126,94647,97302],"type":"scatter","mode":"lines+markers","name":"infected cases","marker":{"color":"rgba(31,119,180,1)","line":{"color":"rgba(31,119,180,1)"}},"error_y":{"color":"rgba(31,119,180,1)"},"error_x":{"color":"rgba(31,119,180,1)"},"line":{"color":"rgba(31,119,180,1)"},"xaxis":"x","yaxis":"y","frame":null},{"x":["2020-10-01","2020-10-02","2020-10-03","2020-10-04","2020-10-05","2020-10-06","2020-10-07","2020-10-08","2020-10-09","2020-10-10","2020-10-11","2020-10-12","2020-10-13","2020-10-14","2020-10-15","2020-10-16","2020-10-17","2020-10-18","2020-10-19","2020-10-20","2020-10-21","2020-10-22","2020-10-23","2020-10-24","2020-10-25","2020-10-26","2020-10-27","2020-10-28","2020-10-29","2020-10-30","2020-10-31","2020-11-01","2020-11-02","2020-11-03","2020-11-04","2020-11-05","2020-11-06","2020-11-07","2020-11-08","2020-11-09","2020-11-10","2020-11-11","2020-11-12","2020-11-13","2020-11-14","2020-11-15","2020-11-16","2020-11-17","2020-11-18","2020-11-19","2020-11-20","2020-11-21","2020-11-22","2020-11-23","2020-11-24","2020-11-25","2020-11-26","2020-11-27","2020-11-28","2020-11-29"],"y":[53909,54009.2552750134,54113.4744244432,54221.816962004,54334.4454304548,54451.5283109777,54573.2408641612,54699.7658370901,54831.2929194766,54968.0190793871,55110.149026347,55257.8954693519,55411.4794319153,55571.130563171,55737.0874588343,55909.598010549,56088.9197618366,56275.3202752049,56469.0775140908,56670.4802381592,56879.8284127951,57097.4336336661,57323.6195665706,57558.7224028964,57803.0913312861,58057.0890260199,58321.0921526058,58595.4918910899,58880.6944776069,59177.1217646944,59485.2118009038,59805.4194302428,60138.2169119883,60484.0945614129,60843.5614119656,61217.1458994517,61605.3965687496,62008.8828036037,62428.1955800214,62863.9482438,63316.7773126925,63787.3433037144,64276.3315860726,64784.4532601812,65312.4460632049,65861.0753015453,66431.1348106531,67023.4479425161,67638.868581131,68278.2821862225,68942.6068654227,69632.7944750656,70349.8317496881,71094.7414602583,71868.5836010717,72672.4566051707,73507.4985880464,74374.8886192743,75275.8480216233,76211.6416970478],"mode":"lines+markers","type":"scatter","name":"fitted","marker":{"color":"rgba(255,127,14,1)","symbol":"circle","line":{"color":"rgba(255,127,14,1)"}},"error_y":{"color":"rgba(255,127,14,1)"},"error_x":{"color":"rgba(255,127,14,1)"},"line":{"color":"rgba(255,127,14,1)"},"xaxis":"x","yaxis":"y","frame":null},{"x":["2020-11-30","2020-12-01","2020-12-02","2020-12-03","2020-12-04","2020-12-05","2020-12-06","2020-12-07","2020-12-08","2020-12-09","2020-12-10","2020-12-11"],"y":[77183.5794788361,78193.0175090379,79241.3596401301,80330.0588597007,81460.6187367423,82634.5948879341,83853.5964620613,85119.2876406556,86433.3891518857,87797.6797959629,89213.9979787582,90684.2432501455],"mode":"lines+markers","type":"scatter","name":"predicted","marker":{"color":"rgba(44,160,44,1)","symbol":"triangle-up","line":{"color":"rgba(44,160,44,1)"}},"error_y":{"color":"rgba(44,160,44,1)"},"error_x":{"color":"rgba(44,160,44,1)"},"line":{"color":"rgba(44,160,44,1)"},"xaxis":"x","yaxis":"y","frame":null}],"highlight":{"on":"plotly_click","persistent":false,"dynamic":false,"selectize":false,"opacityDim":0.2,"selected":{"opacity":1},"debounce":0},"shinyEvents":["plotly_hover","plotly_click","plotly_selected","plotly_relayout","plotly_brushed","plotly_brushing","plotly_clickannotation","plotly_doubleclick","plotly_deselect","plotly_afterplot","plotly_sunburstclick"],"base_url":"https://plot.ly"},"evals":[],"jsHooks":[]}</script>
</div>
</div>
<div id="basic-reproduction-number" class="section level2" number="9.5">
<h2><span class="header-section-number">9.5</span> Basic Reproduction Number</h2>
<p>The <em>basic reproduction number</em> (<span class="math inline">\(R_0\)</span>) is a key concept, which is defined as the number of secondary cases expected from a single (typical) infection in a completely susceptible population.</p>
<p>It is important to note that <span class="math inline">\(R_0\)</span> is a dimensionless number and not a rate, and
<span class="math display">\[
  R_0 \propto \left(\frac{\mathrm{infection}}{\mathrm{contact}} \right) \times \left(\frac{\mathrm{contact}}{\mathrm{time}}\right) \times \left(\frac{\mathrm{time}}{\mathrm{infection}}\right).
\]</span></p>
<ul>
<li><p>If <span class="math inline">\(R_0 &lt; 1\)</span> the disease dies out, however, if <span class="math inline">\(R_0 &gt; 1\)</span> the disease becomes endemic.</p></li>
<li><p>For the SIR model, when <span class="math inline">\(S(t) \approx N\)</span>, <span class="math inline">\(R_0 = \frac{\beta}{\gamma + \mu}\)</span>.</p></li>
<li><p>For the SEIR model, when <span class="math inline">\(S(t) \approx N\)</span>, <span class="math inline">\(R_0 = \frac{\sigma}{\sigma + \mu} \times \frac{\beta}{\gamma + \mu}\)</span>.</p></li>
<li><p>If <span class="math inline">\(R_0 &lt; 1\)</span>, each existing infection results in the formation of fewer new infections. The disease will deteriorate and eventually die out in this case.</p></li>
<li><p>If <span class="math inline">\(R_0 = 1\)</span>, each existing infection results in the emergence of a new infection. The disease will remain alive and stable, but there will not be an outbreak or an epidemic.</p></li>
<li><p>If <span class="math inline">\(R_0 &gt; 1\)</span>, each existing infection multiplies the number of new infections. The disease will spread from person to person, and an outbreak or epidemic may occur.</p></li>
</ul>
<p><strong>COVID-19 <span class="math inline">\(R_0\)</span></strong></p>
<ul>
<li><p>The <span class="math inline">\(R_0\)</span> for SAS-Cov-2 is a median of 5.7, according to a study published online in Emerging Infectious Diseases, which is about double an earlier R0 estimate of 2.2 to 2.7</p></li>
<li><p>In this case, 5.7 means that one person infected with COVID-19 can potentially spread the coronavirus to 5 to 6 people, rather than the 2 to 3 people previously thought by researchers.</p></li>
<li><p>Based on the <span class="math inline">\(R_0\)</span> of 5.7, in order to stop COVID-19 transmission through vaccination and herd immunity, at least 82 percent of the population must be immune to it.</p></li>
</ul>
<div id="seir-model" class="section level3" number="9.5.1">
<h3><span class="header-section-number">9.5.1</span> SEIR Model</h3>
<ul>
<li>Consider the SIR model in a population of size <span class="math inline">\(N\)</span>, and note that <span class="math inline">\(N = S(t) + I(t) + R(t)\)</span>.</li>
</ul>
<p><span class="math display">\[\begin{eqnarray*}
\frac{dS(t)}{dt}&amp; = &amp;\mu\{N - S(t)\} - \beta I(t)\frac{S(t)}{N} + \omega R, \\
\frac{dE(t)}{dt}&amp; = &amp;\beta I(t)\frac{S(t)}{N} - (\mu + \sigma)E(t), \\
\frac{dI(t)}{dt}&amp; = &amp;\sigma E(t) - (\mu + \gamma)I(t), \\
\frac{dR(t)}{dt}&amp; = &amp;\gamma I(t) - (\mu + \omega) R(t), 
\end{eqnarray*}\]</span></p>
<ul>
<li><span class="math inline">\(\omega^{-1}\)</span> is the average duration of immunity;</li>
<li><span class="math inline">\(\sigma^{-1}\)</span> is the average latent period.</li>
</ul>
</div>
</div>
<div id="herd-immunity" class="section level2" number="9.6">
<h2><span class="header-section-number">9.6</span> Herd Immunity</h2>
<p>It is necessary to lower the basic reproduction number <span class="math inline">\(R_0\)</span> below one in order to prevent a disease from becoming endemic. Immunization can sometimes help with this.</p>
<ul>
<li><p>If a fraction <span class="math inline">\(p\)</span> of the population’s newborn members are successfully immunized, the effect is to replace <span class="math inline">\(N\)</span> with <span class="math inline">\(N(1 - p)\)</span>, bringing the basic reproduction number down to <span class="math inline">\(R 0(1 - p)\)</span>. The requirement <span class="math inline">\(R_0(1 - p) &lt; 1\)</span> gives <span class="math inline">\(1 - p &lt; 1/R_0\)</span>, or
<span class="math display">\[
p &gt; 1 - \frac{1}{R_0}.
\]</span></p></li>
<li><p>A population is said to have <strong>herd immunity</strong> if a large enough percentage of its members have been immunized to prevent the disease from becoming endemic.</p></li>
<li><p>The only diseases for which this has been achieved globally are smallpox (<span class="math inline">\(R_0\)</span> is approximately 5) and rinderpest, a cattle disease, for which 80 percent immunization does provide herd immunity.</p></li>
<li><p>In the United States, epidemiological data show that <span class="math inline">\(R_0\)</span> for rural populations ranges from 5.4 to 6.3, implying that 81.5 percent to 84.1 percent of the population must be vaccinated. In urban areas, <span class="math inline">\(R_0\)</span> ranges from 8.3 to 13.0, implying that 88.0 to 92.3 percent of the population must be vaccinated.</p></li>
</ul>
</div>
<div id="exercises-4" class="section level2" number="9.7">
<h2><span class="header-section-number">9.7</span> Exercises</h2>
<ol style="list-style-type: decimal">
<li><p>We have estimated the parameters by minimizing the SSE between model-predicted number of cases and observed data <span class="math inline">\((\text{prediction} - \text{data})^2\)</span>. What would happen if we would like to minimize the squared error on the log scale i.e., <span class="math inline">\((\log(\text{prediction}) - \log(\text{data}))^2\)</span>? What would happen if we would like minimize the square-root scale, i.e., <span class="math inline">\((\sqrt{\text{prediction}} - \sqrt{\text{data}})^2\)</span>? Try to fit the model with different definitions of loss function using the niamey data example. What’s the “correct” scale to choose?</p></li>
<li><p>Using the method argument, change the optimization algorithm used by optim. Examine the impact on your parameter estimations. Try to use other optimizers, such as <code>nlm</code>, <code>nlminb</code>, <code>constrOptim</code>, or the <code>nloptr</code> package, etc.</p></li>
<li><p>Assume instead that the errors are log-normal and have a constant variance. Will least-squares and maximum likelihood parameter estimates be the same under what definition of SSE?</p></li>
<li><p>Simulate and visualize the dynamics using SIR model with births and deaths. Consider <code>time=seq(0,20,by=1/52)</code> in years, <code>N=100000</code>, <code>t_0 = 0</code>, <code>S_0=100000/12</code>, <code>I_0=100</code> and two sets of parameters: (a) <span class="math inline">\(\mu = 1/50\)</span>, <span class="math inline">\(\gamma = 365/13\)</span>, <span class="math inline">\(\beta = 400\)</span> and (b) <span class="math inline">\(\mu = 1/50\)</span>, <span class="math inline">\(\gamma = 365/5\)</span>, <span class="math inline">\(\beta = 1000\)</span>.</p></li>
<li><p>According to the model’s assumptions, the average host lifespan is <span class="math inline">\(1/\mu\)</span>. Explore the differential equations for lifespans of 20 and 200 years to see how the host lifespan affects the dynamics. Consider <code>time=seq(0, 20, by=1/52)</code>, <code>N=100000</code>, <code>t_0 = 0</code>, <code>S_0=100000/12</code>, <code>I_0=100</code> and parameters: <span class="math inline">\(\gamma = 365/13\)</span>, <span class="math inline">\(\beta = 400\)</span>.</p></li>
</ol>
<p>6: Compare and contrast the dynamics of the SIR and SEIR models for the parameters <span class="math inline">\(\mu = 1/50\)</span>, <span class="math inline">\(\gamma = 365/13\)</span>, <span class="math inline">\(\beta = 400\)</span> and assuming that for example, <span class="math inline">\(E(0)=100\)</span>, the latent period has duration 8 days, and immunity lasts for 10 years in the SEIR model.</p>

</div>
</div>
            </section>

          </div>
        </div>
      </div>
<a href="modeling.html" class="navigation navigation-prev " aria-label="Previous page"><i class="fa fa-angle-left"></i></a>
<a href="timeseries.html" class="navigation navigation-next " aria-label="Next page"><i class="fa fa-angle-right"></i></a>
    </div>
  </div>
<script src="libs/gitbook-2.6.7/js/app.min.js"></script>
<script src="libs/gitbook-2.6.7/js/lunr.js"></script>
<script src="libs/gitbook-2.6.7/js/clipboard.min.js"></script>
<script src="libs/gitbook-2.6.7/js/plugin-search.js"></script>
<script src="libs/gitbook-2.6.7/js/plugin-sharing.js"></script>
<script src="libs/gitbook-2.6.7/js/plugin-fontsettings.js"></script>
<script src="libs/gitbook-2.6.7/js/plugin-bookdown.js"></script>
<script src="libs/gitbook-2.6.7/js/jquery.highlight.js"></script>
<script src="libs/gitbook-2.6.7/js/plugin-clipboard.js"></script>
<script>
gitbook.require(["gitbook"], function(gitbook) {
gitbook.start({
"sharing": {
"github": false,
"facebook": true,
"twitter": true,
"linkedin": false,
"weibo": false,
"instapaper": false,
"vk": false,
"all": ["facebook", "twitter", "linkedin", "weibo", "instapaper"]
},
"fontsettings": {
"theme": "white",
"family": "sans",
"size": 2
},
"edit": {
"link": null,
"text": null
},
"history": {
"link": null,
"text": null
},
"view": {
"link": null,
"text": null
},
"download": ["SLID_book.pdf", "SLID_book.epub"],
"toc": {
"collapse": "subsection"
}
});
});
</script>

<!-- dynamically load mathjax for compatibility with self-contained -->
<script>
  (function () {
    var script = document.createElement("script");
    script.type = "text/javascript";
    var src = "true";
    if (src === "" || src === "true") src = "https://mathjax.rstudio.com/latest/MathJax.js?config=TeX-MML-AM_CHTML";
    if (location.protocol !== "file:")
      if (/^https?:/.test(src))
        src = src.replace(/^https?:/, '');
    script.src = src;
    document.getElementsByTagName("head")[0].appendChild(script);
  })();
</script>
</body>

</html>
