<!DOCTYPE html>
<html lang="" xml:lang="">
<head>

  <meta charset="utf-8" />
  <meta http-equiv="X-UA-Compatible" content="IE=edge" />
  <title>Chapter 3 Data Wrangling with dplyr and tidyr | Statistical Learning of Infectious Disease Data Analytics</title>
  <meta name="description" content="The use of statistical models to understand infectious disease dynamics has a very rich history in epidemiology. This book introduces modern statistical models and state-of-the-art learning methods to analyze infectious disease data. Many of the key approaches, examples and case studies will be presented. The primary emphasis will be interpretation, inference and hands-on data analyses. This course also provides practical concepts and R computing skills to perform infectious disease data analysis and visualization." />
  <meta name="generator" content="bookdown 0.20 and GitBook 2.6.7" />

  <meta property="og:title" content="Chapter 3 Data Wrangling with dplyr and tidyr | Statistical Learning of Infectious Disease Data Analytics" />
  <meta property="og:type" content="book" />
  
  
  <meta property="og:description" content="The use of statistical models to understand infectious disease dynamics has a very rich history in epidemiology. This book introduces modern statistical models and state-of-the-art learning methods to analyze infectious disease data. Many of the key approaches, examples and case studies will be presented. The primary emphasis will be interpretation, inference and hands-on data analyses. This course also provides practical concepts and R computing skills to perform infectious disease data analysis and visualization." />
  <meta name="github-repo" content="rstudio/bookdown-demo" />

  <meta name="twitter:card" content="summary" />
  <meta name="twitter:title" content="Chapter 3 Data Wrangling with dplyr and tidyr | Statistical Learning of Infectious Disease Data Analytics" />
  
  <meta name="twitter:description" content="The use of statistical models to understand infectious disease dynamics has a very rich history in epidemiology. This book introduces modern statistical models and state-of-the-art learning methods to analyze infectious disease data. Many of the key approaches, examples and case studies will be presented. The primary emphasis will be interpretation, inference and hands-on data analyses. This course also provides practical concepts and R computing skills to perform infectious disease data analysis and visualization." />
  

<meta name="author" content="Lily Wang" />


<meta name="date" content="2021-03-05" />

  <meta name="viewport" content="width=device-width, initial-scale=1" />
  <meta name="apple-mobile-web-app-capable" content="yes" />
  <meta name="apple-mobile-web-app-status-bar-style" content="black" />
  
  
<link rel="prev" href="intro.html"/>
<link rel="next" href="ggplot2.html"/>
<script src="libs/jquery-2.2.3/jquery.min.js"></script>
<link href="libs/gitbook-2.6.7/css/style.css" rel="stylesheet" />
<link href="libs/gitbook-2.6.7/css/plugin-table.css" rel="stylesheet" />
<link href="libs/gitbook-2.6.7/css/plugin-bookdown.css" rel="stylesheet" />
<link href="libs/gitbook-2.6.7/css/plugin-highlight.css" rel="stylesheet" />
<link href="libs/gitbook-2.6.7/css/plugin-search.css" rel="stylesheet" />
<link href="libs/gitbook-2.6.7/css/plugin-fontsettings.css" rel="stylesheet" />
<link href="libs/gitbook-2.6.7/css/plugin-clipboard.css" rel="stylesheet" />









<script src="libs/accessible-code-block-0.0.1/empty-anchor.js"></script>
<script src="libs/htmlwidgets-1.5.1/htmlwidgets.js"></script>
<script src="libs/plotly-binding-4.9.2.1/plotly.js"></script>
<script src="libs/typedarray-0.1/typedarray.min.js"></script>
<link href="libs/crosstalk-1.1.0.1/css/crosstalk.css" rel="stylesheet" />
<script src="libs/crosstalk-1.1.0.1/js/crosstalk.min.js"></script>
<link href="libs/plotly-htmlwidgets-css-1.52.2/plotly-htmlwidgets.css" rel="stylesheet" />
<script src="libs/plotly-main-1.52.2/plotly-latest.min.js"></script>
<link href="libs/leaflet-1.3.1/leaflet.css" rel="stylesheet" />
<script src="libs/leaflet-1.3.1/leaflet.js"></script>
<link href="libs/leafletfix-1.0.0/leafletfix.css" rel="stylesheet" />
<script src="libs/Proj4Leaflet-1.0.1/proj4-compressed.js"></script>
<script src="libs/Proj4Leaflet-1.0.1/proj4leaflet.js"></script>
<link href="libs/rstudio_leaflet-1.3.1/rstudio_leaflet.css" rel="stylesheet" />
<script src="libs/leaflet-binding-2.0.3/leaflet.js"></script>


<style type="text/css">
code.sourceCode > span { display: inline-block; line-height: 1.25; }
code.sourceCode > span { color: inherit; text-decoration: inherit; }
code.sourceCode > span:empty { height: 1.2em; }
.sourceCode { overflow: visible; }
code.sourceCode { white-space: pre; position: relative; }
pre.sourceCode { margin: 0; }
@media screen {
div.sourceCode { overflow: auto; }
}
@media print {
code.sourceCode { white-space: pre-wrap; }
code.sourceCode > span { text-indent: -5em; padding-left: 5em; }
}
pre.numberSource code
  { counter-reset: source-line 0; }
pre.numberSource code > span
  { position: relative; left: -4em; counter-increment: source-line; }
pre.numberSource code > span > a:first-child::before
  { content: counter(source-line);
    position: relative; left: -1em; text-align: right; vertical-align: baseline;
    border: none; display: inline-block;
    -webkit-touch-callout: none; -webkit-user-select: none;
    -khtml-user-select: none; -moz-user-select: none;
    -ms-user-select: none; user-select: none;
    padding: 0 4px; width: 4em;
    color: #aaaaaa;
  }
pre.numberSource { margin-left: 3em; border-left: 1px solid #aaaaaa;  padding-left: 4px; }
div.sourceCode
  {   }
@media screen {
code.sourceCode > span > a:first-child::before { text-decoration: underline; }
}
code span.al { color: #ff0000; font-weight: bold; } /* Alert */
code span.an { color: #60a0b0; font-weight: bold; font-style: italic; } /* Annotation */
code span.at { color: #7d9029; } /* Attribute */
code span.bn { color: #40a070; } /* BaseN */
code span.bu { } /* BuiltIn */
code span.cf { color: #007020; font-weight: bold; } /* ControlFlow */
code span.ch { color: #4070a0; } /* Char */
code span.cn { color: #880000; } /* Constant */
code span.co { color: #60a0b0; font-style: italic; } /* Comment */
code span.cv { color: #60a0b0; font-weight: bold; font-style: italic; } /* CommentVar */
code span.do { color: #ba2121; font-style: italic; } /* Documentation */
code span.dt { color: #902000; } /* DataType */
code span.dv { color: #40a070; } /* DecVal */
code span.er { color: #ff0000; font-weight: bold; } /* Error */
code span.ex { } /* Extension */
code span.fl { color: #40a070; } /* Float */
code span.fu { color: #06287e; } /* Function */
code span.im { } /* Import */
code span.in { color: #60a0b0; font-weight: bold; font-style: italic; } /* Information */
code span.kw { color: #007020; font-weight: bold; } /* Keyword */
code span.op { color: #666666; } /* Operator */
code span.ot { color: #007020; } /* Other */
code span.pp { color: #bc7a00; } /* Preprocessor */
code span.sc { color: #4070a0; } /* SpecialChar */
code span.ss { color: #bb6688; } /* SpecialString */
code span.st { color: #4070a0; } /* String */
code span.va { color: #19177c; } /* Variable */
code span.vs { color: #4070a0; } /* VerbatimString */
code span.wa { color: #60a0b0; font-weight: bold; font-style: italic; } /* Warning */
</style>

<link rel="stylesheet" href="style.css" type="text/css" />
</head>

<body>



  <div class="book without-animation with-summary font-size-2 font-family-1" data-basepath=".">

    <div class="book-summary">
      <nav role="navigation">

<ul class="summary">
<li><a href="./">A Minimal Book Example</a></li>

<li class="divider"></li>
<li class="chapter" data-level="1" data-path="index.html"><a href="index.html"><i class="fa fa-check"></i><b>1</b> Preface</a><ul>
<li class="chapter" data-level="1.1" data-path="index.html"><a href="index.html#data-sets-used-in-labs-and-exercises"><i class="fa fa-check"></i><b>1.1</b> Data Sets Used in Labs and Exercises</a></li>
<li class="chapter" data-level="1.2" data-path="index.html"><a href="index.html#acknowledgements"><i class="fa fa-check"></i><b>1.2</b> Acknowledgements</a></li>
<li class="chapter" data-level="1.3" data-path="index.html"><a href="index.html#about-the-author"><i class="fa fa-check"></i><b>1.3</b> About the Author</a></li>
</ul></li>
<li class="chapter" data-level="2" data-path="intro.html"><a href="intro.html"><i class="fa fa-check"></i><b>2</b> Introduction</a><ul>
<li class="chapter" data-level="2.1" data-path="intro.html"><a href="intro.html#aims-and-scope-of-this-book"><i class="fa fa-check"></i><b>2.1</b> Aims and Scope of This Book</a></li>
<li class="chapter" data-level="2.2" data-path="intro.html"><a href="intro.html#the-structure-of-this-book"><i class="fa fa-check"></i><b>2.2</b> The Structure of This Book</a><ul>
<li class="chapter" data-level="2.2.1" data-path="intro.html"><a href="intro.html#infectious-disease-data"><i class="fa fa-check"></i><b>2.2.1</b> Infectious disease data</a></li>
<li class="chapter" data-level="2.2.2" data-path="intro.html"><a href="intro.html#basic-characteristics-of-the-infection-process"><i class="fa fa-check"></i><b>2.2.2</b> Basic characteristics of the infection process</a></li>
<li class="chapter" data-level="2.2.3" data-path="intro.html"><a href="intro.html#data-visualization"><i class="fa fa-check"></i><b>2.2.3</b> Data visualization</a></li>
<li class="chapter" data-level="2.2.4" data-path="intro.html"><a href="intro.html#modeling-and-forecasting"><i class="fa fa-check"></i><b>2.2.4</b> Modeling and Forecasting</a></li>
</ul></li>
</ul></li>
<li class="chapter" data-level="3" data-path="dplyr.html"><a href="dplyr.html"><i class="fa fa-check"></i><b>3</b> Data Wrangling with <code>dplyr</code> and <code>tidyr</code></a><ul>
<li class="chapter" data-level="3.1" data-path="dplyr.html"><a href="dplyr.html#learning-dplyr"><i class="fa fa-check"></i><b>3.1</b> Learning <code>dplyr</code></a><ul>
<li class="chapter" data-level="3.1.1" data-path="dplyr.html"><a href="dplyr.html#tibbles"><i class="fa fa-check"></i><b>3.1.1</b> Tibbles</a></li>
<li class="chapter" data-level="3.1.2" data-path="dplyr.html"><a href="dplyr.html#import-data"><i class="fa fa-check"></i><b>3.1.2</b> Import data</a></li>
<li class="chapter" data-level="3.1.3" data-path="dplyr.html"><a href="dplyr.html#common-dplyr-functions"><i class="fa fa-check"></i><b>3.1.3</b> Common <code>dplyr</code> functions</a></li>
</ul></li>
<li class="chapter" data-level="3.2" data-path="dplyr.html"><a href="dplyr.html#selecting-columns-and-filtering-rows"><i class="fa fa-check"></i><b>3.2</b> Selecting Columns and Filtering Rows</a><ul>
<li class="chapter" data-level="3.2.1" data-path="dplyr.html"><a href="dplyr.html#subset-variables-columns"><i class="fa fa-check"></i><b>3.2.1</b> Subset Variables (Columns)</a></li>
<li class="chapter" data-level="3.2.2" data-path="dplyr.html"><a href="dplyr.html#subset-observations-rows"><i class="fa fa-check"></i><b>3.2.2</b> Subset Observations (Rows)</a></li>
<li class="chapter" data-level="3.2.3" data-path="dplyr.html"><a href="dplyr.html#pipes"><i class="fa fa-check"></i><b>3.2.3</b> Pipes</a></li>
<li class="chapter" data-level="3.2.4" data-path="dplyr.html"><a href="dplyr.html#select-and-order-top-n-entries-by-group-if-grouped-data."><i class="fa fa-check"></i><b>3.2.4</b> Select and order top n entries (by group if grouped data).</a></li>
</ul></li>
<li class="chapter" data-level="3.3" data-path="dplyr.html"><a href="dplyr.html#make-new-variables-mutate"><i class="fa fa-check"></i><b>3.3</b> Make New Variables: Mutate</a></li>
<li class="chapter" data-level="3.4" data-path="dplyr.html"><a href="dplyr.html#summarize-data"><i class="fa fa-check"></i><b>3.4</b> Summarize Data</a></li>
<li class="chapter" data-level="3.5" data-path="dplyr.html"><a href="dplyr.html#combine-data-sets"><i class="fa fa-check"></i><b>3.5</b> Combine Data Sets</a><ul>
<li class="chapter" data-level="3.5.1" data-path="dplyr.html"><a href="dplyr.html#the-join-family"><i class="fa fa-check"></i><b>3.5.1</b> The join family</a></li>
<li class="chapter" data-level="3.5.2" data-path="dplyr.html"><a href="dplyr.html#toy-examples-with-joins"><i class="fa fa-check"></i><b>3.5.2</b> Toy examples with joins</a></li>
<li class="chapter" data-level="3.5.3" data-path="dplyr.html"><a href="dplyr.html#practice-with-joins-for-real-data"><i class="fa fa-check"></i><b>3.5.3</b> Practice with joins for real data</a></li>
</ul></li>
<li class="chapter" data-level="3.6" data-path="dplyr.html"><a href="dplyr.html#reshaping-data"><i class="fa fa-check"></i><b>3.6</b> Reshaping Data</a><ul>
<li class="chapter" data-level="3.6.1" data-path="dplyr.html"><a href="dplyr.html#from-wide-to-long"><i class="fa fa-check"></i><b>3.6.1</b> From wide to long</a></li>
<li class="chapter" data-level="3.6.2" data-path="dplyr.html"><a href="dplyr.html#from-long-to-wide"><i class="fa fa-check"></i><b>3.6.2</b> From long to wide</a></li>
</ul></li>
<li class="chapter" data-level="3.7" data-path="dplyr.html"><a href="dplyr.html#exercises"><i class="fa fa-check"></i><b>3.7</b> Exercises</a></li>
</ul></li>
<li class="chapter" data-level="4" data-path="ggplot2.html"><a href="ggplot2.html"><i class="fa fa-check"></i><b>4</b> Data Visualization with ggplot2</a><ul>
<li class="chapter" data-level="4.1" data-path="ggplot2.html"><a href="ggplot2.html#introduction"><i class="fa fa-check"></i><b>4.1</b> Introduction</a></li>
<li class="chapter" data-level="4.2" data-path="ggplot2.html"><a href="ggplot2.html#types-of-variables-and-preparation"><i class="fa fa-check"></i><b>4.2</b> Types of Variables and Preparation</a><ul>
<li class="chapter" data-level="4.2.1" data-path="ggplot2.html"><a href="ggplot2.html#types-of-variables"><i class="fa fa-check"></i><b>4.2.1</b> Types of Variables</a></li>
<li class="chapter" data-level="4.2.2" data-path="ggplot2.html"><a href="ggplot2.html#rules-for-graph-designing"><i class="fa fa-check"></i><b>4.2.2</b> Rules for Graph Designing</a></li>
<li class="chapter" data-level="4.2.3" data-path="ggplot2.html"><a href="ggplot2.html#installing-packages-and-loading-data"><i class="fa fa-check"></i><b>4.2.3</b> Installing packages and loading data</a></li>
<li class="chapter" data-level="4.2.4" data-path="ggplot2.html"><a href="ggplot2.html#your-first-scatterplot"><i class="fa fa-check"></i><b>4.2.4</b> Your first scatterplot</a></li>
</ul></li>
<li class="chapter" data-level="4.3" data-path="ggplot2.html"><a href="ggplot2.html#position-scales-and-axes"><i class="fa fa-check"></i><b>4.3</b> Position Scales and Axes</a><ul>
<li class="chapter" data-level="4.3.1" data-path="ggplot2.html"><a href="ggplot2.html#change-the-labels-of-the-axis-using-xlab-and-ylab"><i class="fa fa-check"></i><b>4.3.1</b> Change the labels of the axis using <code>xlab()</code> and <code>ylab()</code></a></li>
<li class="chapter" data-level="4.3.2" data-path="ggplot2.html"><a href="ggplot2.html#change-the-range-of-the-axis-using-xlim-and-ylim"><i class="fa fa-check"></i><b>4.3.2</b> Change the range of the axis using <code>xlim()</code> and <code>ylim()</code></a></li>
</ul></li>
<li class="chapter" data-level="4.4" data-path="ggplot2.html"><a href="ggplot2.html#color-scales-and-size-of-geom_points"><i class="fa fa-check"></i><b>4.4</b> Color Scales and Size of <code>geom_points()</code></a><ul>
<li class="chapter" data-level="4.4.1" data-path="ggplot2.html"><a href="ggplot2.html#change-the-color-of-all-points"><i class="fa fa-check"></i><b>4.4.1</b> Change the color of all points</a></li>
<li class="chapter" data-level="4.4.2" data-path="ggplot2.html"><a href="ggplot2.html#color-the-observations-by-the-value-of-a-feature"><i class="fa fa-check"></i><b>4.4.2</b> Color the observations by the value of a feature</a></li>
<li class="chapter" data-level="4.4.3" data-path="ggplot2.html"><a href="ggplot2.html#change-the-color-palette"><i class="fa fa-check"></i><b>4.4.3</b> Change the color palette</a></li>
<li class="chapter" data-level="4.4.4" data-path="ggplot2.html"><a href="ggplot2.html#change-the-size-by-the-value-of-a-feature"><i class="fa fa-check"></i><b>4.4.4</b> Change the size by the value of a feature</a></li>
</ul></li>
<li class="chapter" data-level="4.5" data-path="ggplot2.html"><a href="ggplot2.html#individual-geoms"><i class="fa fa-check"></i><b>4.5</b> Individual geoms</a><ul>
<li class="chapter" data-level="4.5.1" data-path="ggplot2.html"><a href="ggplot2.html#histogram"><i class="fa fa-check"></i><b>4.5.1</b> Histogram</a></li>
<li class="chapter" data-level="4.5.2" data-path="ggplot2.html"><a href="ggplot2.html#bar-chart"><i class="fa fa-check"></i><b>4.5.2</b> Bar chart</a></li>
<li class="chapter" data-level="4.5.3" data-path="ggplot2.html"><a href="ggplot2.html#default-bar-chart"><i class="fa fa-check"></i><b>4.5.3</b> Default bar chart</a></li>
<li class="chapter" data-level="4.5.4" data-path="ggplot2.html"><a href="ggplot2.html#bar-chart-with-assigned-value"><i class="fa fa-check"></i><b>4.5.4</b> Bar chart with assigned value</a></li>
<li class="chapter" data-level="4.5.5" data-path="ggplot2.html"><a href="ggplot2.html#legend"><i class="fa fa-check"></i><b>4.5.5</b> Legend</a></li>
<li class="chapter" data-level="4.5.6" data-path="ggplot2.html"><a href="ggplot2.html#boxplots-jittering-and-violin-plots"><i class="fa fa-check"></i><b>4.5.6</b> Boxplots, jittering and violin plots</a></li>
</ul></li>
<li class="chapter" data-level="4.6" data-path="ggplot2.html"><a href="ggplot2.html#collective-geoms"><i class="fa fa-check"></i><b>4.6</b> Collective geoms</a><ul>
<li class="chapter" data-level="4.6.1" data-path="ggplot2.html"><a href="ggplot2.html#smoother"><i class="fa fa-check"></i><b>4.6.1</b> Smoother</a></li>
</ul></li>
<li class="chapter" data-level="4.7" data-path="ggplot2.html"><a href="ggplot2.html#time-series"><i class="fa fa-check"></i><b>4.7</b> Time Series</a><ul>
<li class="chapter" data-level="4.7.1" data-path="ggplot2.html"><a href="ggplot2.html#basic-line-plots"><i class="fa fa-check"></i><b>4.7.1</b> Basic line plots</a></li>
<li class="chapter" data-level="4.7.2" data-path="ggplot2.html"><a href="ggplot2.html#add-a-second-line"><i class="fa fa-check"></i><b>4.7.2</b> Add a second line</a></li>
<li class="chapter" data-level="4.7.3" data-path="ggplot2.html"><a href="ggplot2.html#add-ribbons"><i class="fa fa-check"></i><b>4.7.3</b> Add ribbons</a></li>
<li class="chapter" data-level="4.7.4" data-path="ggplot2.html"><a href="ggplot2.html#adjust-the-scale-of-time-axis"><i class="fa fa-check"></i><b>4.7.4</b> Adjust the scale of time axis</a></li>
<li class="chapter" data-level="4.7.5" data-path="ggplot2.html"><a href="ggplot2.html#add-annotations"><i class="fa fa-check"></i><b>4.7.5</b> Add annotations</a></li>
</ul></li>
<li class="chapter" data-level="4.8" data-path="ggplot2.html"><a href="ggplot2.html#maps"><i class="fa fa-check"></i><b>4.8</b> Maps</a><ul>
<li class="chapter" data-level="4.8.1" data-path="ggplot2.html"><a href="ggplot2.html#making-a-base-map"><i class="fa fa-check"></i><b>4.8.1</b> Making a base map</a></li>
<li class="chapter" data-level="4.8.2" data-path="ggplot2.html"><a href="ggplot2.html#customizing-choropleth-map"><i class="fa fa-check"></i><b>4.8.2</b> Customizing <code>choropleth</code> map</a></li>
<li class="chapter" data-level="4.8.3" data-path="ggplot2.html"><a href="ggplot2.html#overlay-polygon-maps"><i class="fa fa-check"></i><b>4.8.3</b> Overlay polygon maps</a></li>
</ul></li>
<li class="chapter" data-level="4.9" data-path="ggplot2.html"><a href="ggplot2.html#arranging-plots"><i class="fa fa-check"></i><b>4.9</b> Arranging Plots</a><ul>
<li class="chapter" data-level="4.9.1" data-path="ggplot2.html"><a href="ggplot2.html#facet"><i class="fa fa-check"></i><b>4.9.1</b> Facet</a></li>
<li class="chapter" data-level="4.9.2" data-path="ggplot2.html"><a href="ggplot2.html#combining-plots-using-patchwork-package"><i class="fa fa-check"></i><b>4.9.2</b> Combining plots using <code>patchwork</code> package</a></li>
</ul></li>
<li class="chapter" data-level="4.10" data-path="ggplot2.html"><a href="ggplot2.html#output"><i class="fa fa-check"></i><b>4.10</b> Output</a><ul>
<li class="chapter" data-level="4.10.1" data-path="ggplot2.html"><a href="ggplot2.html#save-in-figure-format"><i class="fa fa-check"></i><b>4.10.1</b> Save in figure format</a></li>
<li class="chapter" data-level="4.10.2" data-path="ggplot2.html"><a href="ggplot2.html#save-in-rds-format"><i class="fa fa-check"></i><b>4.10.2</b> Save in RDS format</a></li>
</ul></li>
<li class="chapter" data-level="4.11" data-path="dplyr.html"><a href="dplyr.html#exercises"><i class="fa fa-check"></i><b>4.11</b> Exercises</a></li>
</ul></li>
<li class="chapter" data-level="5" data-path="plotly.html"><a href="plotly.html"><i class="fa fa-check"></i><b>5</b> Interactive Visualization</a><ul>
<li class="chapter" data-level="5.1" data-path="plotly.html"><a href="plotly.html#an-introduction"><i class="fa fa-check"></i><b>5.1</b> An Introduction</a></li>
<li class="chapter" data-level="5.2" data-path="plotly.html"><a href="plotly.html#creating-plotly-objects"><i class="fa fa-check"></i><b>5.2</b> Creating Plotly Objects</a><ul>
<li class="chapter" data-level="5.2.1" data-path="plotly.html"><a href="plotly.html#using-plot_ly-to-create-a-plotly-object"><i class="fa fa-check"></i><b>5.2.1</b> Using <code>plot_ly()</code> to create a plotly object</a></li>
<li class="chapter" data-level="5.2.2" data-path="plotly.html"><a href="plotly.html#use-dplyr-verbs-to-modify-data"><i class="fa fa-check"></i><b>5.2.2</b> Use <code>dplyr</code> verbs to modify data</a></li>
<li class="chapter" data-level="5.2.3" data-path="plotly.html"><a href="plotly.html#using-ggplotly-to-create-a-plotly-object"><i class="fa fa-check"></i><b>5.2.3</b> Using <code>ggplotly()</code> to create a <code>plotly</code> object</a></li>
</ul></li>
<li class="chapter" data-level="5.3" data-path="plotly.html"><a href="plotly.html#scatterplots-and-line-plots"><i class="fa fa-check"></i><b>5.3</b> Scatterplots and Line Plots</a><ul>
<li class="chapter" data-level="5.3.1" data-path="plotly.html"><a href="plotly.html#make-a-scatterplot"><i class="fa fa-check"></i><b>5.3.1</b> Make a scatterplot</a></li>
<li class="chapter" data-level="5.3.2" data-path="plotly.html"><a href="plotly.html#markers"><i class="fa fa-check"></i><b>5.3.2</b> Markers</a></li>
<li class="chapter" data-level="5.3.3" data-path="plotly.html"><a href="plotly.html#a-single-time-series-plot"><i class="fa fa-check"></i><b>5.3.3</b> A single time series plot</a></li>
<li class="chapter" data-level="5.3.4" data-path="plotly.html"><a href="plotly.html#hover-text-and-template"><i class="fa fa-check"></i><b>5.3.4</b> Hover text and template</a></li>
<li class="chapter" data-level="5.3.5" data-path="plotly.html"><a href="plotly.html#multiple-time-series-plots"><i class="fa fa-check"></i><b>5.3.5</b> Multiple time series plots</a></li>
<li class="chapter" data-level="5.3.6" data-path="plotly.html"><a href="plotly.html#more-features-about-the-lines"><i class="fa fa-check"></i><b>5.3.6</b> More features about the lines</a></li>
<li class="chapter" data-level="5.3.7" data-path="ggplot2.html"><a href="ggplot2.html#add-ribbons"><i class="fa fa-check"></i><b>5.3.7</b> Add ribbons</a></li>
</ul></li>
<li class="chapter" data-level="5.4" data-path="plotly.html"><a href="plotly.html#pie-charts"><i class="fa fa-check"></i><b>5.4</b> Pie Charts</a><ul>
<li class="chapter" data-level="5.4.1" data-path="plotly.html"><a href="plotly.html#draw-static-pie-charts-using-ggplot2"><i class="fa fa-check"></i><b>5.4.1</b> Draw static pie charts using ggplot2</a></li>
<li class="chapter" data-level="5.4.2" data-path="plotly.html"><a href="plotly.html#draw-interactive-pie-charts"><i class="fa fa-check"></i><b>5.4.2</b> Draw interactive pie charts</a></li>
</ul></li>
<li class="chapter" data-level="5.5" data-path="plotly.html"><a href="plotly.html#animation"><i class="fa fa-check"></i><b>5.5</b> Animation</a><ul>
<li class="chapter" data-level="5.5.1" data-path="plotly.html"><a href="plotly.html#an-animation-of-the-evolution-of-infected-vs.-death-count"><i class="fa fa-check"></i><b>5.5.1</b> An animation of the evolution of infected vs. death count</a></li>
<li class="chapter" data-level="5.5.2" data-path="plotly.html"><a href="plotly.html#an-animation-of-the-state-level-time-series-plot-of-infected-count"><i class="fa fa-check"></i><b>5.5.2</b> An animation of the state-level time series plot of infected count</a></li>
</ul></li>
<li class="chapter" data-level="5.6" data-path="plotly.html"><a href="plotly.html#saving-html"><i class="fa fa-check"></i><b>5.6</b> Saving HTML</a><ul>
<li class="chapter" data-level="5.6.1" data-path="plotly.html"><a href="plotly.html#save-as-a-standalone-html-file"><i class="fa fa-check"></i><b>5.6.1</b> Save as a standalone HTML file</a></li>
<li class="chapter" data-level="5.6.2" data-path="plotly.html"><a href="plotly.html#save-as-non-selfcontained-html-file"><i class="fa fa-check"></i><b>5.6.2</b> Save as non-selfcontained HTML file</a></li>
</ul></li>
<li class="chapter" data-level="5.7" data-path="dplyr.html"><a href="dplyr.html#exercises"><i class="fa fa-check"></i><b>5.7</b> Exercises</a></li>
</ul></li>
<li class="chapter" data-level="6" data-path="shiny.html"><a href="shiny.html"><i class="fa fa-check"></i><b>6</b> R Shiny</a><ul>
<li class="chapter" data-level="6.1" data-path="shiny.html"><a href="shiny.html#an-introduction-to-shiny"><i class="fa fa-check"></i><b>6.1</b> An Introduction to Shiny</a><ul>
<li class="chapter" data-level="6.1.1" data-path="shiny.html"><a href="shiny.html#your-first-shiny-app"><i class="fa fa-check"></i><b>6.1.1</b> Your first shiny app</a></li>
<li class="chapter" data-level="6.1.2" data-path="shiny.html"><a href="shiny.html#create-a-new-shiny-app-in-rstudio"><i class="fa fa-check"></i><b>6.1.2</b> Create a new shiny app in RStudio</a></li>
<li class="chapter" data-level="6.1.3" data-path="shiny.html"><a href="shiny.html#share-your-app"><i class="fa fa-check"></i><b>6.1.3</b> Share your app</a></li>
</ul></li>
<li class="chapter" data-level="6.2" data-path="shiny.html"><a href="shiny.html#useful-input-widgets"><i class="fa fa-check"></i><b>6.2</b> Useful Input Widgets</a></li>
<li class="chapter" data-level="6.3" data-path="shiny.html"><a href="shiny.html#displaying-reactive-output"><i class="fa fa-check"></i><b>6.3</b> Displaying Reactive Output</a></li>
<li class="chapter" data-level="6.4" data-path="shiny.html"><a href="shiny.html#rendering-plotly-inside-shiny"><i class="fa fa-check"></i><b>6.4</b> Rendering Plotly Inside Shiny</a></li>
</ul></li>
<li class="chapter" data-level="7" data-path="map.html"><a href="map.html"><i class="fa fa-check"></i><b>7</b> Interactive Geospatial Visualization</a><ul>
<li class="chapter" data-level="7.1" data-path="map.html"><a href="map.html#an-introduction-to-leaflet"><i class="fa fa-check"></i><b>7.1</b> An Introduction to Leaflet</a><ul>
<li class="chapter" data-level="7.1.1" data-path="map.html"><a href="map.html#more-references"><i class="fa fa-check"></i><b>7.1.1</b> More References</a></li>
<li class="chapter" data-level="7.1.2" data-path="map.html"><a href="map.html#features-and-installation"><i class="fa fa-check"></i><b>7.1.2</b> Features and installation</a></li>
<li class="chapter" data-level="7.1.3" data-path="map.html"><a href="map.html#basic-usage"><i class="fa fa-check"></i><b>7.1.3</b> Basic Usage</a></li>
</ul></li>
<li class="chapter" data-level="7.2" data-path="map.html"><a href="map.html#the-data-object"><i class="fa fa-check"></i><b>7.2</b> The Data Object</a></li>
<li class="chapter" data-level="7.3" data-path="map.html"><a href="map.html#choropleth-map"><i class="fa fa-check"></i><b>7.3</b> Choropleth map</a><ul>
<li class="chapter" data-level="7.3.1" data-path="map.html"><a href="map.html#create-a-base-map"><i class="fa fa-check"></i><b>7.3.1</b> Create a base map</a></li>
<li class="chapter" data-level="7.3.2" data-path="map.html"><a href="map.html#color-the-map"><i class="fa fa-check"></i><b>7.3.2</b> Color the map</a></li>
<li class="chapter" data-level="7.3.3" data-path="map.html"><a href="map.html#interactive-map"><i class="fa fa-check"></i><b>7.3.3</b> Interactive map</a></li>
</ul></li>
<li class="chapter" data-level="7.4" data-path="ggplot2.html"><a href="ggplot2.html#legend"><i class="fa fa-check"></i><b>7.4</b> Legend</a><ul>
<li class="chapter" data-level="7.4.1" data-path="map.html"><a href="map.html#classification-schemes"><i class="fa fa-check"></i><b>7.4.1</b> Classification schemes</a></li>
<li class="chapter" data-level="7.4.2" data-path="map.html"><a href="map.html#mapping-variables-to-colors"><i class="fa fa-check"></i><b>7.4.2</b> Mapping variables to colors</a></li>
</ul></li>
<li class="chapter" data-level="7.5" data-path="map.html"><a href="map.html#an-example-of-county-level-map"><i class="fa fa-check"></i><b>7.5</b> An Example of County-level Map</a></li>
<li class="chapter" data-level="7.6" data-path="map.html"><a href="map.html#spot-maps"><i class="fa fa-check"></i><b>7.6</b> Spot Maps</a><ul>
<li class="chapter" data-level="7.6.1" data-path="map.html"><a href="map.html#adding-circles"><i class="fa fa-check"></i><b>7.6.1</b> Adding circles</a></li>
<li class="chapter" data-level="7.6.2" data-path="map.html"><a href="map.html#add-popups"><i class="fa fa-check"></i><b>7.6.2</b> Add popups</a></li>
<li class="chapter" data-level="7.6.3" data-path="map.html"><a href="map.html#add-labels"><i class="fa fa-check"></i><b>7.6.3</b> Add labels</a></li>
</ul></li>
<li class="chapter" data-level="7.7" data-path="map.html"><a href="map.html#integrating-leaflet-with-r-shiny"><i class="fa fa-check"></i><b>7.7</b> Integrating Leaflet with R Shiny</a></li>
<li class="chapter" data-level="7.8" data-path="dplyr.html"><a href="dplyr.html#exercises"><i class="fa fa-check"></i><b>7.8</b> Exercises</a></li>
</ul></li>
<li class="chapter" data-level="8" data-path="modeling.html"><a href="modeling.html"><i class="fa fa-check"></i><b>8</b> Epidemic Modeling</a><ul>
<li class="chapter" data-level="8.1" data-path="modeling.html"><a href="modeling.html#an-introduction-to-epidemic-modeling"><i class="fa fa-check"></i><b>8.1</b> An Introduction to Epidemic Modeling</a></li>
<li class="chapter" data-level="8.2" data-path="modeling.html"><a href="modeling.html#mechanistic-models"><i class="fa fa-check"></i><b>8.2</b> Mechanistic Models</a><ul>
<li class="chapter" data-level="8.2.1" data-path="modeling.html"><a href="modeling.html#compartment-modeling"><i class="fa fa-check"></i><b>8.2.1</b> Compartment Modeling</a></li>
<li class="chapter" data-level="8.2.2" data-path="modeling.html"><a href="modeling.html#agent-based-methods"><i class="fa fa-check"></i><b>8.2.2</b> Agent-based Methods</a></li>
</ul></li>
<li class="chapter" data-level="8.3" data-path="modeling.html"><a href="modeling.html#phenomenological-models"><i class="fa fa-check"></i><b>8.3</b> Phenomenological Models</a><ul>
<li class="chapter" data-level="8.3.1" data-path="modeling.html"><a href="modeling.html#time-series-analysis"><i class="fa fa-check"></i><b>8.3.1</b> Time Series Analysis</a></li>
<li class="chapter" data-level="8.3.2" data-path="modeling.html"><a href="modeling.html#regression-methods"><i class="fa fa-check"></i><b>8.3.2</b> Regression methods</a></li>
<li class="chapter" data-level="8.3.3" data-path="modeling.html"><a href="modeling.html#machine-learning-methods"><i class="fa fa-check"></i><b>8.3.3</b> Machine learning methods</a></li>
</ul></li>
<li class="chapter" data-level="8.4" data-path="modeling.html"><a href="modeling.html#hybrid-models-and-ensemble-methods"><i class="fa fa-check"></i><b>8.4</b> Hybrid Models and Ensemble Methods</a></li>
<li class="chapter" data-level="8.5" data-path="modeling.html"><a href="modeling.html#epidemic-modeling-mathematical-and-statistical-perspectives"><i class="fa fa-check"></i><b>8.5</b> Epidemic Modeling: Mathematical and Statistical Perspectives</a></li>
<li class="chapter" data-level="8.6" data-path="modeling.html"><a href="modeling.html#some-terminologies-in-epidemic-modeling"><i class="fa fa-check"></i><b>8.6</b> Some Terminologies in Epidemic Modeling</a></li>
</ul></li>
<li class="chapter" data-level="9" data-path="compartment.html"><a href="compartment.html"><i class="fa fa-check"></i><b>9</b> Compartment Models</a><ul>
<li class="chapter" data-level="9.1" data-path="compartment.html"><a href="compartment.html#a-simple-sis-model-a-model-for-diseases-with-no-immunity"><i class="fa fa-check"></i><b>9.1</b> A Simple SIS Model (A Model for Diseases with No Immunity)</a></li>
<li class="chapter" data-level="9.2" data-path="compartment.html"><a href="compartment.html#an-sir-model"><i class="fa fa-check"></i><b>9.2</b> An SIR Model</a><ul>
<li class="chapter" data-level="9.2.1" data-path="compartment.html"><a href="compartment.html#an-sir-model-with-births-and-deaths"><i class="fa fa-check"></i><b>9.2.1</b> An SIR model with births and deaths</a></li>
</ul></li>
<li class="chapter" data-level="9.3" data-path="compartment.html"><a href="compartment.html#sir-parameter-estimation"><i class="fa fa-check"></i><b>9.3</b> SIR parameter estimation</a></li>
<li class="chapter" data-level="9.4" data-path="compartment.html"><a href="compartment.html#implementation-of-parameter-estimation-in-r"><i class="fa fa-check"></i><b>9.4</b> Implementation of parameter estimation in R</a><ul>
<li class="chapter" data-level="9.4.1" data-path="compartment.html"><a href="compartment.html#example-1.-outbreak-of-measles-in-niamey"><i class="fa fa-check"></i><b>9.4.1</b> Example 1. Outbreak of measles in Niamey</a></li>
<li class="chapter" data-level="9.4.2" data-path="compartment.html"><a href="compartment.html#example-2.-covid-19"><i class="fa fa-check"></i><b>9.4.2</b> Example 2. COVID-19</a></li>
</ul></li>
<li class="chapter" data-level="9.5" data-path="compartment.html"><a href="compartment.html#basic-reproduction-number"><i class="fa fa-check"></i><b>9.5</b> Basic Reproduction Number</a><ul>
<li class="chapter" data-level="9.5.1" data-path="compartment.html"><a href="compartment.html#seir-model"><i class="fa fa-check"></i><b>9.5.1</b> SEIR Model</a></li>
</ul></li>
<li class="chapter" data-level="9.6" data-path="compartment.html"><a href="compartment.html#herd-immunity"><i class="fa fa-check"></i><b>9.6</b> Herd Immunity</a></li>
<li class="chapter" data-level="9.7" data-path="dplyr.html"><a href="dplyr.html#exercises"><i class="fa fa-check"></i><b>9.7</b> Exercises</a></li>
</ul></li>
<li class="chapter" data-level="10" data-path="timeseries.html"><a href="timeseries.html"><i class="fa fa-check"></i><b>10</b> Time Series Analysis of Infectious Disease Data</a><ul>
<li class="chapter" data-level="10.1" data-path="timeseries.html"><a href="timeseries.html#datasets-and-r-packages"><i class="fa fa-check"></i><b>10.1</b> Datasets and R Packages</a></li>
<li class="chapter" data-level="10.2" data-path="timeseries.html"><a href="timeseries.html#time-series-plots"><i class="fa fa-check"></i><b>10.2</b> Time series plots</a></li>
<li class="chapter" data-level="10.3" data-path="timeseries.html"><a href="timeseries.html#time-series-decomposition"><i class="fa fa-check"></i><b>10.3</b> Time Series Decomposition</a></li>
</ul></li>
<li class="chapter" data-level="11" data-path="regression.html"><a href="regression.html"><i class="fa fa-check"></i><b>11</b> Regression Modeling</a><ul>
<li class="chapter" data-level="11.1" data-path="regression.html"><a href="regression.html#principles-of-regression-modeling"><i class="fa fa-check"></i><b>11.1</b> Principles of Regression Modeling</a></li>
<li class="chapter" data-level="11.2" data-path="regression.html"><a href="regression.html#area-level-data"><i class="fa fa-check"></i><b>11.2</b> Area-level Data</a></li>
<li class="chapter" data-level="11.3" data-path="regression.html"><a href="regression.html#variable-selection"><i class="fa fa-check"></i><b>11.3</b> Variable Selection</a></li>
</ul></li>
<li class="chapter" data-level="12" data-path="NN.html"><a href="NN.html"><i class="fa fa-check"></i><b>12</b> Neural Networks</a><ul>
<li class="chapter" data-level="12.1" data-path="NN.html"><a href="NN.html#a-single-neuron"><i class="fa fa-check"></i><b>12.1</b> A Single Neuron</a></li>
<li class="chapter" data-level="12.2" data-path="NN.html"><a href="NN.html#neural-network-structure"><i class="fa fa-check"></i><b>12.2</b> Neural Network Structure</a></li>
</ul></li>
<li class="chapter" data-level="13" data-path="ensemble.html"><a href="ensemble.html"><i class="fa fa-check"></i><b>13</b> Hybrid Mdels</a><ul>
<li class="chapter" data-level="13.1" data-path="ensemble.html"><a href="ensemble.html#ensembling-time-series-models"><i class="fa fa-check"></i><b>13.1</b> Ensembling Time Series Models</a></li>
<li class="chapter" data-level="13.2" data-path="ensemble.html"><a href="ensemble.html#model-diagnostics"><i class="fa fa-check"></i><b>13.2</b> Model Diagnostics</a></li>
<li class="chapter" data-level="13.3" data-path="ensemble.html"><a href="ensemble.html#weights-selection-using-cross-validation"><i class="fa fa-check"></i><b>13.3</b> Weights Selection Using Cross Validation</a></li>
</ul></li>
<li class="chapter" data-level="" data-path="references.html"><a href="references.html"><i class="fa fa-check"></i>References</a></li>
<li class="chapter" data-level="" data-path="appendix.html"><a href="appendix.html"><i class="fa fa-check"></i>Appendix</a></li>
<li class="chapter" data-level="14" data-path="appendix-a.html"><a href="appendix-a.html"><i class="fa fa-check"></i><b>14</b> Appendix A</a><ul>
<li class="chapter" data-level="14.1" data-path="appendix-a.html"><a href="appendix-a.html#r-introduction-and-preliminaries"><i class="fa fa-check"></i><b>14.1</b> R Introduction and Preliminaries</a><ul>
<li class="chapter" data-level="14.1.1" data-path="appendix-a.html"><a href="appendix-a.html#the-r-environment-and-language"><i class="fa fa-check"></i><b>14.1.1</b> The R Environment and Language</a></li>
<li class="chapter" data-level="14.1.2" data-path="appendix-a.html"><a href="appendix-a.html#r-and-statistics"><i class="fa fa-check"></i><b>14.1.2</b> R and Statistics</a></li>
<li class="chapter" data-level="14.1.3" data-path="appendix-a.html"><a href="appendix-a.html#obtaining-r-and-installation"><i class="fa fa-check"></i><b>14.1.3</b> Obtaining R and installation</a></li>
</ul></li>
<li class="chapter" data-level="14.2" data-path="appendix-a.html"><a href="appendix-a.html#starting-r"><i class="fa fa-check"></i><b>14.2</b> Starting R</a><ul>
<li class="chapter" data-level="14.2.1" data-path="appendix-a.html"><a href="appendix-a.html#description-of-three-panels-in-user-interface"><i class="fa fa-check"></i><b>14.2.1</b> Description of three panels in user interface</a></li>
<li class="chapter" data-level="14.2.2" data-path="appendix-a.html"><a href="appendix-a.html#r-help"><i class="fa fa-check"></i><b>14.2.2</b> R help</a></li>
<li class="chapter" data-level="14.2.3" data-path="appendix-a.html"><a href="appendix-a.html#some-mathematical-expressions"><i class="fa fa-check"></i><b>14.2.3</b> Some mathematical expressions</a></li>
<li class="chapter" data-level="14.2.4" data-path="appendix-a.html"><a href="appendix-a.html#r-packages"><i class="fa fa-check"></i><b>14.2.4</b> R Packages</a></li>
<li class="chapter" data-level="14.2.5" data-path="appendix-a.html"><a href="appendix-a.html#creating-a-project-and-setting-working-directory"><i class="fa fa-check"></i><b>14.2.5</b> Creating a project and setting working directory</a></li>
</ul></li>
<li class="chapter" data-level="14.3" data-path="appendix-a.html"><a href="appendix-a.html#exportimport-data"><i class="fa fa-check"></i><b>14.3</b> Export/Import Data</a><ul>
<li class="chapter" data-level="14.3.1" data-path="appendix-a.html"><a href="appendix-a.html#data-export"><i class="fa fa-check"></i><b>14.3.1</b> Data Export</a></li>
<li class="chapter" data-level="14.3.2" data-path="appendix-a.html"><a href="appendix-a.html#data-import"><i class="fa fa-check"></i><b>14.3.2</b> Data Import</a></li>
</ul></li>
</ul></li>
<li class="chapter" data-level="15" data-path="appendix-b.html"><a href="appendix-b.html"><i class="fa fa-check"></i><b>15</b> Appendix B</a><ul>
<li class="chapter" data-level="15.1" data-path="appendix-b.html"><a href="appendix-b.html#epidemic-data"><i class="fa fa-check"></i><b>15.1</b> Epidemic Data</a><ul>
<li class="chapter" data-level="15.1.1" data-path="appendix-b.html"><a href="appendix-b.html#state-level"><i class="fa fa-check"></i><b>15.1.1</b> State level</a></li>
<li class="chapter" data-level="15.1.2" data-path="appendix-b.html"><a href="appendix-b.html#county-level"><i class="fa fa-check"></i><b>15.1.2</b> County level</a></li>
</ul></li>
<li class="chapter" data-level="15.2" data-path="appendix-b.html"><a href="appendix-b.html#other-factors"><i class="fa fa-check"></i><b>15.2</b> Other Factors</a><ul>
<li class="chapter" data-level="15.2.1" data-path="appendix-b.html"><a href="appendix-b.html#policy-data"><i class="fa fa-check"></i><b>15.2.1</b> Policy Data</a></li>
<li class="chapter" data-level="15.2.2" data-path="appendix-b.html"><a href="appendix-b.html#demographic-characteristics"><i class="fa fa-check"></i><b>15.2.2</b> Demographic Characteristics</a></li>
<li class="chapter" data-level="15.2.3" data-path="appendix-b.html"><a href="appendix-b.html#healthcare-infrastructure"><i class="fa fa-check"></i><b>15.2.3</b> Healthcare Infrastructure</a></li>
<li class="chapter" data-level="15.2.4" data-path="appendix-b.html"><a href="appendix-b.html#socioeconomic-status"><i class="fa fa-check"></i><b>15.2.4</b> Socioeconomic Status</a></li>
<li class="chapter" data-level="15.2.5" data-path="appendix-b.html"><a href="appendix-b.html#environmental-factor"><i class="fa fa-check"></i><b>15.2.5</b> Environmental Factor</a></li>
<li class="chapter" data-level="15.2.6" data-path="appendix-b.html"><a href="appendix-b.html#mobility"><i class="fa fa-check"></i><b>15.2.6</b> Mobility</a></li>
<li class="chapter" data-level="15.2.7" data-path="appendix-b.html"><a href="appendix-b.html#geographic-information"><i class="fa fa-check"></i><b>15.2.7</b> Geographic Information</a></li>
</ul></li>
<li class="chapter" data-level="15.3" data-path="appendix-b.html"><a href="appendix-b.html#data-sets"><i class="fa fa-check"></i><b>15.3</b> Data Sets</a><ul>
<li class="chapter" data-level="15.3.1" data-path="appendix-b.html"><a href="appendix-b.html#chapter-2"><i class="fa fa-check"></i><b>15.3.1</b> Chapter 2</a></li>
<li class="chapter" data-level="15.3.2" data-path="appendix-b.html"><a href="appendix-b.html#chapter-3"><i class="fa fa-check"></i><b>15.3.2</b> Chapter 3</a></li>
</ul></li>
</ul></li>
<li class="divider"></li>
<li><a href="https://github.com/rstudio/bookdown" target="blank">Published with bookdown</a></li>

</ul>

      </nav>
    </div>

    <div class="book-body">
      <div class="body-inner">
        <div class="book-header" role="navigation">
          <h1>
            <i class="fa fa-circle-o-notch fa-spin"></i><a href="./">Statistical Learning of Infectious Disease Data Analytics</a>
          </h1>
        </div>

        <div class="page-wrapper" tabindex="-1" role="main">
          <div class="page-inner">

            <section class="normal" id="section-">
<div id="dplyr" class="section level1">
<h1><span class="header-section-number">Chapter 3</span> Data Wrangling with <code>dplyr</code> and <code>tidyr</code></h1>
<p>The package <code>dplyr</code> is an R package for making tabular data wrangling easier by using a limited set of functions that can be combined to extract and summarize insights from your data. It pairs nicely with the package <code>tidyr</code>, enabling you to swiftly convert between different data formats (long vs. wide) for plotting and analysis. It addresses the common problem of reshaping your data for plotting and use by different R functions. Sometimes we want data sets where we have one row per measurement. Sometimes we want a dataframe where each measurement type has its own column, and rows are instead more aggregated groups. Sometimes you may want to select important variables, filter out key observations, create new variables and obtain summary statistics. As illustrated in Figure <a href="dplyr.html#fig:process1">3.1</a>, you may need to work back and forth between these formats, which is nontrivial, and <code>tidyr</code> and <code>dplyr</code> give you the right tools for this and more sophisticated data wrangling.</p>
<div class="figure" style="text-align: center"><span id="fig:process1"></span>
<img src="figures/process_new.png" alt="A typical data science process." width="75%" />
<p class="caption">
Figure 3.1: A typical data science process.
</p>
</div>
<p>The packages <code>dplyr</code> and <code>tidyr</code> are built to work directly with data frames. In this chapter, you will learn how to use these packages to perform data manipulation and transform your data into the appropriate form.</p>
<div id="learning-dplyr" class="section level2">
<h2><span class="header-section-number">3.1</span> Learning <code>dplyr</code></h2>
<div class="sourceCode" id="cb1"><pre class="sourceCode r"><code class="sourceCode r"><span id="cb1-1"><a href="dplyr.html#cb1-1"></a><span class="co"># load the packages</span></span>
<span id="cb1-2"><a href="dplyr.html#cb1-2"></a><span class="kw">library</span>(tidyverse)</span></code></pre></div>
<pre><code>## Warning: replacing previous import &#39;vctrs::data_frame&#39; by
## &#39;tibble::data_frame&#39; when loading &#39;dplyr&#39;</code></pre>
<pre><code>## ── Attaching packages ─────────────────── tidyverse 1.3.0 ──</code></pre>
<pre><code>## ✓ ggplot2 3.3.2.9000     ✓ purrr   0.3.4     
## ✓ tibble  3.0.4          ✓ dplyr   1.0.0     
## ✓ tidyr   1.1.0          ✓ stringr 1.4.0     
## ✓ readr   1.3.1          ✓ forcats 0.5.0</code></pre>
<pre><code>## ── Conflicts ────────────────────── tidyverse_conflicts() ──
## x dplyr::filter() masks stats::filter()
## x dplyr::lag()    masks stats::lag()</code></pre>
<div class="sourceCode" id="cb6"><pre class="sourceCode r"><code class="sourceCode r"><span id="cb6-1"><a href="dplyr.html#cb6-1"></a><span class="kw">library</span>(dplyr)</span></code></pre></div>
<div id="tibbles" class="section level3">
<h3><span class="header-section-number">3.1.1</span> Tibbles</h3>
<p>Throughout this book, we work with “tibbles” instead of R’s traditional “data.frame”. Tibbles are data frames, but they are a modern reimagining of the “data.frame”, keeping what time has proven to be effective, and throwing out what is not. Here we will use the <code>tibble</code> package, which provides opinionated data frames that make working in the <code>tidyverse</code> a little easier.</p>
<div class="sourceCode" id="cb7"><pre class="sourceCode r"><code class="sourceCode r"><span id="cb7-1"><a href="dplyr.html#cb7-1"></a><span class="co"># The easiest way to get tibble is to install the whole tidyverse:</span></span>
<span id="cb7-2"><a href="dplyr.html#cb7-2"></a> <span class="kw">install.packages</span>(<span class="st">&quot;tidyverse&quot;</span>)</span>
<span id="cb7-3"><a href="dplyr.html#cb7-3"></a></span>
<span id="cb7-4"><a href="dplyr.html#cb7-4"></a><span class="co"># Alternatively, install just tibble:</span></span>
<span id="cb7-5"><a href="dplyr.html#cb7-5"></a><span class="kw">install.packages</span>(<span class="st">&quot;tibble&quot;</span>)</span></code></pre></div>
<p>In most places, we will use the term “tibble” and “data frame” interchangeably; when we want to draw particular attention to R’s built-in data frame, we will call them “data.frame”. See <span class="citation">Wickham and Grolemund (<a href="#ref-wickham2016r" role="doc-biblioref">2016</a>)</span> for more details about how to create and use “tibbles”.</p>
</div>
<div id="import-data" class="section level3">
<h3><span class="header-section-number">3.1.2</span> Import data</h3>
<p>Recall R offers many ways to import data:</p>
<ul>
<li><p><code>read_csv()</code> reads comma delimited files, <code>read_csv2()</code> reads semicolon separated files.</p></li>
<li><p><code>read_tsv()</code> reads tab delimited files, and <code>read_delim()</code> reads in files with any delimiter.</p></li>
<li><p><code>read_fwf()</code> reads fixed width files. You can specify fields either by their widths with <code>fwf_widths()</code> or their position with <code>fwf_positions()</code>.</p></li>
<li><p><code>read_table()</code> reads a common variation of fixed width files where columns are separated by white space.</p></li>
<li><p><code>load()</code> loads an <code>.RData</code> file and import all of the objects contained in the <code>.RData</code> file into your current workspace.</p></li>
</ul>
<p>Below we will work on COVID-19 county level infected count data (<code>I.county</code>), and we can obtain the data from Github R package <code>slid</code>. It is a “data frame” which includes “ID” (county-level Federal Information Processing System code), “County” (name of county), “State” (name of state), “XYYYY.MM.DD” (the number of cumulative infected cases in a county related to the date of YYYY.MM.DD) for 3,104 counties in the US. For example, the variable <code>X2020.01.22</code> is the number of cumulative infected cases in a county on 01/22/2020. See Appendix B for more detailed description of the data and its source.</p>
<div class="sourceCode" id="cb8"><pre class="sourceCode r"><code class="sourceCode r"><span id="cb8-1"><a href="dplyr.html#cb8-1"></a><span class="co"># install the slid package from github</span></span>
<span id="cb8-2"><a href="dplyr.html#cb8-2"></a><span class="co"># library(devtools)</span></span>
<span id="cb8-3"><a href="dplyr.html#cb8-3"></a><span class="co"># devtools::install_github(&#39;covid19-dashboard-us/slid&#39;)</span></span>
<span id="cb8-4"><a href="dplyr.html#cb8-4"></a><span class="co"># load objects in I.county into my workspace</span></span>
<span id="cb8-5"><a href="dplyr.html#cb8-5"></a><span class="kw">library</span>(slid)</span>
<span id="cb8-6"><a href="dplyr.html#cb8-6"></a><span class="kw">data</span>(I.county)</span>
<span id="cb8-7"><a href="dplyr.html#cb8-7"></a></span>
<span id="cb8-8"><a href="dplyr.html#cb8-8"></a><span class="co"># make I.county a tibble with as_tibble()</span></span>
<span id="cb8-9"><a href="dplyr.html#cb8-9"></a>I.county &lt;-<span class="st"> </span><span class="kw">as_tibble</span>(I.county)</span>
<span id="cb8-10"><a href="dplyr.html#cb8-10"></a></span>
<span id="cb8-11"><a href="dplyr.html#cb8-11"></a><span class="co"># preview the data</span></span>
<span id="cb8-12"><a href="dplyr.html#cb8-12"></a><span class="co"># View(I.county)</span></span></code></pre></div>
</div>
<div id="common-dplyr-functions" class="section level3">
<h3><span class="header-section-number">3.1.3</span> Common <code>dplyr</code> functions</h3>
<p>Next, we will learn some of the most common <code>dplyr</code> functions:</p>
<ul>
<li><code>select()</code>: subset columns;</li>
<li><code>filter()</code>: subset rows on conditions;</li>
<li><code>mutate()</code>: create new columns by using information from other columns;</li>
<li><code>group_by()</code> and <code>summarize()</code>: create summary statistics on grouped data;</li>
<li><code>arrange()</code>: sort results;</li>
<li><code>join()</code> family: combine datasets.</li>
</ul>
<p>A typical code structure of <code>dplyr</code> is:</p>
<div class="sourceCode" id="cb9"><pre class="sourceCode r"><code class="sourceCode r"><span id="cb9-1"><a href="dplyr.html#cb9-1"></a>data.new &lt;-<span class="st"> </span>data.original <span class="op">%&gt;%</span></span>
<span id="cb9-2"><a href="dplyr.html#cb9-2"></a><span class="st">  </span>select rows or columns to manipulate <span class="op">%&gt;%</span></span>
<span id="cb9-3"><a href="dplyr.html#cb9-3"></a><span class="st">  </span>arrange or group the data <span class="op">%&gt;%</span></span>
<span id="cb9-4"><a href="dplyr.html#cb9-4"></a><span class="st">  </span>summarize the data</span></code></pre></div>
<p>The first argument is a data frame, and the subsequent arguments separated by <code>%&gt;%</code> describe the data manipulation and/or summary, and the result is a new data frame. We will explain more details in the following sections.</p>
</div>
</div>
<div id="selecting-columns-and-filtering-rows" class="section level2">
<h2><span class="header-section-number">3.2</span> Selecting Columns and Filtering Rows</h2>
<div id="subset-variables-columns" class="section level3">
<h3><span class="header-section-number">3.2.1</span> Subset Variables (Columns)</h3>
<p>To select columns of a dataframe, use <code>select()</code>. The first argument to this function is the data frame (<code>I.county</code>), and the subsequent arguments are the columns to keep, separated by commas. Alternatively, if you are selecting columns adjacent to each other, you can use a <code>:</code> to select a range of columns, read as “select columns from __ to __”.</p>
<div class="sourceCode" id="cb10"><pre class="sourceCode r"><code class="sourceCode r"><span id="cb10-1"><a href="dplyr.html#cb10-1"></a><span class="co"># load the tidyverse</span></span>
<span id="cb10-2"><a href="dplyr.html#cb10-2"></a>dplyr<span class="op">::</span><span class="kw">select</span>(I.county, ID, County, State)</span>
<span id="cb10-3"><a href="dplyr.html#cb10-3"></a><span class="co"># select a series of connected columns</span></span>
<span id="cb10-4"><a href="dplyr.html#cb10-4"></a>dplyr<span class="op">::</span><span class="kw">select</span>(I.county, ID, County, State, X2020.<span class="fl">12.11</span><span class="op">:</span>X2020.<span class="fl">12.01</span>)</span></code></pre></div>
</div>
<div id="subset-observations-rows" class="section level3">
<h3><span class="header-section-number">3.2.2</span> Subset Observations (Rows)</h3>
<p>To choose rows based on specific criteria, we can use the <code>filter()</code> function. The arguments after the dataframe are the condition(s) we want for our final dataframe to adhere to (e.g. <code>State</code> name is “Iowa”). We can chain a series of conditions together using commas between each condition.</p>
<div class="sourceCode" id="cb11"><pre class="sourceCode r"><code class="sourceCode r"><span id="cb11-1"><a href="dplyr.html#cb11-1"></a><span class="co"># all Iowa counties</span></span>
<span id="cb11-2"><a href="dplyr.html#cb11-2"></a>dplyr<span class="op">::</span><span class="kw">filter</span>(I.county, State <span class="op">==</span><span class="st"> &quot;Iowa&quot;</span>)</span></code></pre></div>
<p>Here is an example of <code>filter()</code> function with multiple conditions:</p>
<div class="sourceCode" id="cb12"><pre class="sourceCode r"><code class="sourceCode r"><span id="cb12-1"><a href="dplyr.html#cb12-1"></a><span class="co"># all Iowa counties with cumulative infection count &gt; 10000</span></span>
<span id="cb12-2"><a href="dplyr.html#cb12-2"></a>dplyr<span class="op">::</span><span class="kw">filter</span>(I.county, State <span class="op">==</span><span class="st"> &quot;Iowa&quot;</span>, X2020.<span class="fl">12.11</span> <span class="op">&gt;</span><span class="st"> </span><span class="dv">10000</span>)</span></code></pre></div>
<p>To use filtering effectively, it is better to know some of the comparison and logical operators. Figure <a href="dplyr.html#fig:logic">3.2</a> shows some commonly used R logic comparisons:</p>
<div class="figure" style="text-align: center"><span id="fig:logic"></span>
<img src="figures/logic.png" alt="Some commonly used logic comparisons." width="75%" />
<p class="caption">
Figure 3.2: Some commonly used logic comparisons.
</p>
</div>
</div>
<div id="pipes" class="section level3">
<h3><span class="header-section-number">3.2.3</span> Pipes</h3>
<p>What if you want to select and filter at the same time? There are three ways to do this: use intermediate steps, nested functions, or pipes.</p>
<p>With intermediate steps, you create a temporary dataframe and use that as input to the next function, like this:</p>
<div class="sourceCode" id="cb13"><pre class="sourceCode r"><code class="sourceCode r"><span id="cb13-1"><a href="dplyr.html#cb13-1"></a><span class="co"># all Iowa counties from 2020.12.01 to 2020.12.11</span></span>
<span id="cb13-2"><a href="dplyr.html#cb13-2"></a><span class="co"># method 1</span></span>
<span id="cb13-3"><a href="dplyr.html#cb13-3"></a>Iowa.I.county &lt;-<span class="st"> </span>dplyr<span class="op">::</span><span class="kw">filter</span>(I.county, State <span class="op">==</span><span class="st"> &quot;Iowa&quot;</span>)</span>
<span id="cb13-4"><a href="dplyr.html#cb13-4"></a>Iowa.I.county.DEC &lt;-<span class="st"> </span>dplyr<span class="op">::</span><span class="kw">select</span>(Iowa.I.county, </span>
<span id="cb13-5"><a href="dplyr.html#cb13-5"></a>                                   X2020.<span class="fl">12.11</span><span class="op">:</span>X2020.<span class="fl">12.01</span>)</span></code></pre></div>
<p>This is readable, but can clutter up your workspace with lots of objects that you have to name individually. With multiple steps, that can be hard to keep track of.</p>
<p>You can also nest functions (i.e. one function inside of another), like this:</p>
<div class="sourceCode" id="cb14"><pre class="sourceCode r"><code class="sourceCode r"><span id="cb14-1"><a href="dplyr.html#cb14-1"></a><span class="co"># all Iowa counties from 2020.12.01 to 2020.12.11</span></span>
<span id="cb14-2"><a href="dplyr.html#cb14-2"></a><span class="co"># method 2</span></span>
<span id="cb14-3"><a href="dplyr.html#cb14-3"></a>Iowa.I.county.DEC &lt;-<span class="st"> </span></span>
<span id="cb14-4"><a href="dplyr.html#cb14-4"></a><span class="st">  </span>dplyr<span class="op">::</span><span class="kw">select</span>(dplyr<span class="op">::</span><span class="kw">filter</span>(I.county, State <span class="op">==</span><span class="st"> &quot;Iowa&quot;</span>), </span>
<span id="cb14-5"><a href="dplyr.html#cb14-5"></a>                ID, County, State, X2020.<span class="fl">12.11</span><span class="op">:</span>X2020.<span class="fl">12.01</span>)</span></code></pre></div>
<p>This is handy but can be difficult to read if too many functions are nested, as R evaluates the expression from the inside out (in this case, filtering, then selecting).</p>
<p>The last option, <strong>pipes</strong>, are a recent addition to R. <strong>Pipes</strong> let you take the output of one function and send it directly to the next, which is useful when you need to do many things to the same dataset. Pipes in R look like <code>%&gt;%</code> and are made available via the <code>magrittr</code> package, installed automatically with <code>dplyr</code>.</p>
<div class="sourceCode" id="cb15"><pre class="sourceCode r"><code class="sourceCode r"><span id="cb15-1"><a href="dplyr.html#cb15-1"></a><span class="co"># all Iowa counties from 2020.12.01 to 2020.12.11</span></span>
<span id="cb15-2"><a href="dplyr.html#cb15-2"></a><span class="co"># method 3</span></span>
<span id="cb15-3"><a href="dplyr.html#cb15-3"></a>I.county <span class="op">%&gt;%</span></span>
<span id="cb15-4"><a href="dplyr.html#cb15-4"></a><span class="st">  </span>dplyr<span class="op">::</span><span class="kw">filter</span>(State <span class="op">==</span><span class="st"> &quot;Iowa&quot;</span>) <span class="op">%&gt;%</span></span>
<span id="cb15-5"><a href="dplyr.html#cb15-5"></a><span class="st">  </span>dplyr<span class="op">::</span><span class="kw">select</span>(ID, County, X2020.<span class="fl">12.11</span><span class="op">:</span>X2020.<span class="fl">12.01</span>)</span></code></pre></div>
<p>In the above code, we use the <strong>pipe</strong> to send the interviews dataset first through <code>filter()</code> to keep rows for the state of Iowa, then through <code>select()</code> to keep only the count in December. Since <code>%&gt;%</code> takes the object on its left and passes it as the first argument to the function on its right, we don’t need to explicitly include the <code>dataframe</code> as an argument to the <code>filter()</code> and <code>select()</code> functions anymore.</p>
<p>Some may find it helpful to read the pipe like the word “then”. For instance, in the above example, we take the dataframe <code>I.county</code>, then we filter for rows with <code>State == "Iowa"</code>, then we select columns from <code>X2020.12.11</code> to <code>X2020.12.01</code>. The <code>dplyr</code> functions are somewhat simple, but by combining them into linear workflows with the pipe, we can accomplish more complex data wrangling operations.</p>
<p>If we want to create a new object with this smaller version of the data, we can assign it a new name:</p>
<div class="sourceCode" id="cb16"><pre class="sourceCode r"><code class="sourceCode r"><span id="cb16-1"><a href="dplyr.html#cb16-1"></a><span class="co"># assign a name to all Iowa counties </span></span>
<span id="cb16-2"><a href="dplyr.html#cb16-2"></a><span class="co"># from 2020.12.01 to 2020.12.11</span></span>
<span id="cb16-3"><a href="dplyr.html#cb16-3"></a>Iowa.I.county.DEC &lt;-<span class="st"> </span>I.county <span class="op">%&gt;%</span></span>
<span id="cb16-4"><a href="dplyr.html#cb16-4"></a><span class="st">  </span>dplyr<span class="op">::</span><span class="kw">filter</span>(State <span class="op">==</span><span class="st"> &quot;Iowa&quot;</span>) <span class="op">%&gt;%</span></span>
<span id="cb16-5"><a href="dplyr.html#cb16-5"></a><span class="st">    </span>dplyr<span class="op">::</span><span class="kw">select</span>(ID, County, X2020.<span class="fl">12.11</span><span class="op">:</span>X2020.<span class="fl">12.01</span>)</span>
<span id="cb16-6"><a href="dplyr.html#cb16-6"></a></span>
<span id="cb16-7"><a href="dplyr.html#cb16-7"></a><span class="kw">head</span>(Iowa.I.county.DEC)</span></code></pre></div>
<pre><code>## # A tibble: 6 x 13
##      ID County X2020.12.11 X2020.12.10 X2020.12.09
##   &lt;int&gt; &lt;fct&gt;        &lt;int&gt;       &lt;int&gt;       &lt;int&gt;
## 1 19001 Adair          506         503         499
## 2 19003 Adams          208         206         200
## 3 19005 Allam…         995         990         971
## 4 19007 Appan…         868         862         858
## 5 19009 Audub…         326         323         321
## 6 19011 Benton        1852        1847        1826
## # … with 8 more variables: X2020.12.08 &lt;int&gt;,
## #   X2020.12.07 &lt;int&gt;, X2020.12.06 &lt;int&gt;,
## #   X2020.12.05 &lt;int&gt;, X2020.12.04 &lt;int&gt;,
## #   X2020.12.03 &lt;int&gt;, X2020.12.02 &lt;int&gt;, X2020.12.01 &lt;int&gt;</code></pre>
</div>
<div id="select-and-order-top-n-entries-by-group-if-grouped-data." class="section level3">
<h3><span class="header-section-number">3.2.4</span> Select and order top n entries (by group if grouped data).</h3>
<p>The function <code>top_n</code> can be used to select top (or bottom) n rows (by value).</p>
<p>This is a convenient wrapper that uses <code>filter()</code>and <code>min_rank()</code> to select the top or bottom entries in each group, ordered by <code>wt</code>.</p>
<p><strong>Usage</strong></p>
<div class="sourceCode" id="cb18"><pre class="sourceCode r"><code class="sourceCode r"><span id="cb18-1"><a href="dplyr.html#cb18-1"></a><span class="kw">top_n</span>(x, n, wt)</span></code></pre></div>
<p><strong>Arguments</strong></p>
<ul>
<li><code>x</code>: a <code>tbl()</code> to filter</li>
<li><code>n</code>: number of rows to return. If <code>x</code> is grouped, this is the number of rows per group. Will include more than <code>n</code> rows if there are ties. If <code>n</code> is positive, selects the top <code>n</code> rows. If negative, selects the bottom <code>n</code> rows.</li>
<li><code>wt</code> (Optional). The variable to use for ordering. If not specified, defaults to the last variable in the <code>tbl</code>.</li>
</ul>
<p>This argument is automatically quoted and later evaluated in the context of the data frame. It supports unquoting.</p>
<p>Let us find the top ten counties with the largest cumulative infected count on December 11, 2020.</p>
<div class="sourceCode" id="cb19"><pre class="sourceCode r"><code class="sourceCode r"><span id="cb19-1"><a href="dplyr.html#cb19-1"></a><span class="co"># top ten counties with the cum. infected count</span></span>
<span id="cb19-2"><a href="dplyr.html#cb19-2"></a>I.county.top10 &lt;-<span class="st"> </span>I.county <span class="op">%&gt;%</span><span class="st"> </span><span class="kw">top_n</span>(<span class="dv">10</span>, <span class="dt">wt =</span> X2020.<span class="fl">12.11</span>)</span>
<span id="cb19-3"><a href="dplyr.html#cb19-3"></a>I.county.top10<span class="op">$</span>County</span></code></pre></div>
<pre><code>##  [1] Maricopa      LosAngeles    SanBernardino Broward      
##  [5] Miami-Dade    Cook          Clark         Dallas       
##  [9] Harris        Tarrant      
## 1839 Levels: Abbeville AcadiaParish Accomack Ada ... obrien</code></pre>
<p>Let us find the bottom ten counties with the smallest cumulative infected count on December 11, 2020.</p>
<div class="sourceCode" id="cb21"><pre class="sourceCode r"><code class="sourceCode r"><span id="cb21-1"><a href="dplyr.html#cb21-1"></a><span class="co"># bottom ten counties with the cum. infected count</span></span>
<span id="cb21-2"><a href="dplyr.html#cb21-2"></a>I.county.bottom10 &lt;-<span class="st"> </span>I.county <span class="op">%&gt;%</span><span class="st"> </span><span class="kw">top_n</span>(<span class="op">-</span><span class="dv">10</span>, <span class="dt">wt =</span> X2020.<span class="fl">12.11</span>)</span>
<span id="cb21-3"><a href="dplyr.html#cb21-3"></a>I.county.bottom10<span class="op">$</span>County</span></code></pre></div>
<pre><code>##  [1] Dukes        Nantucket    OglalaLakota Beaver      
##  [5] BoxElder     Cache        Carbon       Daggett     
##  [9] Duchesne     Emery        Garfield     Grand       
## [13] Iron         Juab         Kane         Millard     
## [17] Morgan       Piute        Rich         Sanpete     
## [21] Sevier       Uintah       Washington   Wayne       
## [25] Weber       
## 1839 Levels: Abbeville AcadiaParish Accomack Ada ... obrien</code></pre>
<p>Let us find the county with the largest cumulative infected count on December 11, 2020 for each state.</p>
<div class="sourceCode" id="cb23"><pre class="sourceCode r"><code class="sourceCode r"><span id="cb23-1"><a href="dplyr.html#cb23-1"></a><span class="co"># county with the largest cum. infected count for each state</span></span>
<span id="cb23-2"><a href="dplyr.html#cb23-2"></a>I.county.top1 &lt;-<span class="st"> </span>I.county <span class="op">%&gt;%</span><span class="st"> </span></span>
<span id="cb23-3"><a href="dplyr.html#cb23-3"></a><span class="st">  </span><span class="kw">group_by</span>(State) <span class="op">%&gt;%</span></span>
<span id="cb23-4"><a href="dplyr.html#cb23-4"></a><span class="st">  </span><span class="kw">top_n</span>(<span class="dv">1</span>, <span class="dt">wt =</span> X2020.<span class="fl">12.11</span>) <span class="op">%&gt;%</span><span class="st"> </span></span>
<span id="cb23-5"><a href="dplyr.html#cb23-5"></a><span class="st">  </span>dplyr<span class="op">::</span><span class="kw">select</span>(State, County)</span></code></pre></div>
</div>
</div>
<div id="make-new-variables-mutate" class="section level2">
<h2><span class="header-section-number">3.3</span> Make New Variables: Mutate</h2>
<p>Frequently you will want to create new columns based on the values in existing columns, for example, to obtain the number of daily new cases based on the cumulative count. For this, we can use the <code>mutate()</code> function.</p>
<div class="sourceCode" id="cb24"><pre class="sourceCode r"><code class="sourceCode r"><span id="cb24-1"><a href="dplyr.html#cb24-1"></a><span class="co"># create a new variable Y2020.12.11 (new count 2020.12.11)</span></span>
<span id="cb24-2"><a href="dplyr.html#cb24-2"></a>I.county.new &lt;-<span class="st"> </span>I.county <span class="op">%&gt;%</span><span class="st"> </span></span>
<span id="cb24-3"><a href="dplyr.html#cb24-3"></a><span class="st">    </span>dplyr<span class="op">::</span><span class="kw">filter</span>(State <span class="op">==</span><span class="st"> &quot;Iowa&quot;</span>) <span class="op">%&gt;%</span></span>
<span id="cb24-4"><a href="dplyr.html#cb24-4"></a><span class="st">    </span>dplyr<span class="op">::</span><span class="kw">select</span>(ID, County, X2020.<span class="fl">12.11</span><span class="op">:</span>X2020.<span class="fl">12.10</span>) <span class="op">%&gt;%</span><span class="st"> </span></span>
<span id="cb24-5"><a href="dplyr.html#cb24-5"></a><span class="st">    </span><span class="kw">mutate</span>(<span class="dt">Y2020.12.11 =</span> X2020.<span class="fl">12.11</span> <span class="op">-</span><span class="st"> </span>X2020.<span class="fl">12.10</span>)</span>
<span id="cb24-6"><a href="dplyr.html#cb24-6"></a></span>
<span id="cb24-7"><a href="dplyr.html#cb24-7"></a><span class="kw">head</span>(I.county.new)</span></code></pre></div>
<pre><code>## # A tibble: 6 x 5
##      ID County    X2020.12.11 X2020.12.10 Y2020.12.11
##   &lt;int&gt; &lt;fct&gt;           &lt;int&gt;       &lt;int&gt;       &lt;int&gt;
## 1 19001 Adair             506         503           3
## 2 19003 Adams             208         206           2
## 3 19005 Allamakee         995         990           5
## 4 19007 Appanoose         868         862           6
## 5 19009 Audubon           326         323           3
## 6 19011 Benton           1852        1847           5</code></pre>
<p>If we want to obtain the number of daily new cases based on the cumulative count for the dates in December only, we can try the following:</p>
<div class="sourceCode" id="cb26"><pre class="sourceCode r"><code class="sourceCode r"><span id="cb26-1"><a href="dplyr.html#cb26-1"></a><span class="co"># create variables Y2020.12.01 : Y2020.12.11</span></span>
<span id="cb26-2"><a href="dplyr.html#cb26-2"></a><span class="co"># with daily new count</span></span>
<span id="cb26-3"><a href="dplyr.html#cb26-3"></a></span>
<span id="cb26-4"><a href="dplyr.html#cb26-4"></a>I.county.Iowa &lt;-<span class="st"> </span>I.county <span class="op">%&gt;%</span><span class="st"> </span></span>
<span id="cb26-5"><a href="dplyr.html#cb26-5"></a><span class="st">  </span>dplyr<span class="op">::</span><span class="kw">filter</span>(State <span class="op">==</span><span class="st"> &quot;Iowa&quot;</span>)</span>
<span id="cb26-6"><a href="dplyr.html#cb26-6"></a></span>
<span id="cb26-7"><a href="dplyr.html#cb26-7"></a>I.county.tmp &lt;-<span class="st"> </span>I.county.Iowa[, <span class="op">-</span>(<span class="dv">1</span><span class="op">:</span><span class="dv">3</span>)]</span>
<span id="cb26-8"><a href="dplyr.html#cb26-8"></a>I.county.Iowa.new &lt;-<span class="st"> </span>I.county.Iowa</span>
<span id="cb26-9"><a href="dplyr.html#cb26-9"></a>I.county.Iowa.new[, <span class="op">-</span>(<span class="dv">1</span><span class="op">:</span><span class="dv">3</span>)] &lt;-<span class="st"> </span>I.county.tmp <span class="op">-</span><span class="st"> </span></span>
<span id="cb26-10"><a href="dplyr.html#cb26-10"></a><span class="st">  </span><span class="kw">cbind</span>(I.county.tmp[, <span class="dv">-1</span>], <span class="dv">0</span>)</span>
<span id="cb26-11"><a href="dplyr.html#cb26-11"></a></span>
<span id="cb26-12"><a href="dplyr.html#cb26-12"></a>I.county.Iowa.DEC &lt;-<span class="st"> </span>I.county.Iowa.new <span class="op">%&gt;%</span><span class="st"> </span></span>
<span id="cb26-13"><a href="dplyr.html#cb26-13"></a>dplyr<span class="op">::</span><span class="kw">select</span>(ID, County, X2020.<span class="fl">12.11</span><span class="op">:</span>X2020.<span class="fl">12.01</span>)  </span>
<span id="cb26-14"><a href="dplyr.html#cb26-14"></a></span>
<span id="cb26-15"><a href="dplyr.html#cb26-15"></a>name.tmp &lt;-<span class="st"> </span><span class="kw">substring</span>(<span class="kw">names</span>(I.county.Iowa.DEC)[<span class="op">-</span>(<span class="dv">1</span><span class="op">:</span><span class="dv">2</span>)], <span class="dv">2</span>)</span>
<span id="cb26-16"><a href="dplyr.html#cb26-16"></a><span class="kw">names</span>(I.county.Iowa.DEC)[<span class="op">-</span>(<span class="dv">1</span><span class="op">:</span><span class="dv">2</span>)] &lt;-<span class="st"> </span><span class="kw">paste0</span>(<span class="st">&quot;Y&quot;</span>, name.tmp)</span>
<span id="cb26-17"><a href="dplyr.html#cb26-17"></a><span class="kw">head</span>(I.county.Iowa.DEC)</span></code></pre></div>
<pre><code>## # A tibble: 6 x 13
##      ID County Y2020.12.11 Y2020.12.10 Y2020.12.09
##   &lt;int&gt; &lt;fct&gt;        &lt;int&gt;       &lt;int&gt;       &lt;int&gt;
## 1 19001 Adair            3           4          10
## 2 19003 Adams            2           6           4
## 3 19005 Allam…           5          19          17
## 4 19007 Appan…           6           4           5
## 5 19009 Audub…           3           2           6
## 6 19011 Benton           5          21           7
## # … with 8 more variables: Y2020.12.08 &lt;int&gt;,
## #   Y2020.12.07 &lt;int&gt;, Y2020.12.06 &lt;int&gt;,
## #   Y2020.12.05 &lt;int&gt;, Y2020.12.04 &lt;int&gt;,
## #   Y2020.12.03 &lt;int&gt;, Y2020.12.02 &lt;int&gt;, Y2020.12.01 &lt;int&gt;</code></pre>
</div>
<div id="summarize-data" class="section level2">
<h2><span class="header-section-number">3.4</span> Summarize Data</h2>
<p>Many data analysis tasks can be approached using the split-apply-combine paradigm: split the data into groups, apply some analysis to each group, and then combine the results. <code>dplyr</code> makes this very easy via the <code>group_by()</code> function.</p>
<p>The <code>summarize()</code> function uses summary functions, functions that take a vector of values and return a single value, such as:</p>
<ul>
<li><code>dplyr::first</code>: first value of a vector.</li>
<li><code>dplyr::last</code>: last value of a vector.</li>
<li><code>dplyr::nth</code>: nth value of a vector.</li>
<li><code>dplyr::n</code>: number of values in a vector.</li>
<li><code>dplyr::n_distinct</code>: number of distinct values in a vector.</li>
<li><code>IQR</code>: IQR of a vector.</li>
<li><code>min</code>: minimum value in a vector.</li>
<li><code>max</code>: maximum value in a vector.</li>
<li><code>mean</code>: mean value of a vector.</li>
<li><code>median</code>: median value of a vector.</li>
<li><code>var</code>: variance of a vector.</li>
<li><code>sd</code>: standard deviation of a vector.</li>
</ul>
<p>The <code>group_by()</code> function is often used together with <code>summarize()</code>, which collapses each group into a single-row summary of that group. The <code>group_by()</code> takes as arguments the column names that contain the categorical variables for which you want to calculate the summary statistics. Once the data are grouped, you can also summarize multiple variables simultaneously (and not necessarily on the same variable). So to compute the state level cumulative infected count by <code>State</code>:</p>
<div class="sourceCode" id="cb28"><pre class="sourceCode r"><code class="sourceCode r"><span id="cb28-1"><a href="dplyr.html#cb28-1"></a><span class="co"># state level cumulative infected count</span></span>
<span id="cb28-2"><a href="dplyr.html#cb28-2"></a><span class="co"># method 1: summarize()</span></span>
<span id="cb28-3"><a href="dplyr.html#cb28-3"></a>I.state &lt;-<span class="st"> </span>I.county <span class="op">%&gt;%</span></span>
<span id="cb28-4"><a href="dplyr.html#cb28-4"></a><span class="st">  </span><span class="kw">group_by</span>(State) <span class="op">%&gt;%</span></span>
<span id="cb28-5"><a href="dplyr.html#cb28-5"></a><span class="st">  </span><span class="kw">summarize</span>(<span class="kw">across</span>(X2020.<span class="fl">12.11</span><span class="op">:</span>X2020.<span class="fl">01.22</span>, </span>
<span id="cb28-6"><a href="dplyr.html#cb28-6"></a>                   <span class="op">~</span><span class="st"> </span><span class="kw">sum</span>(.x, <span class="dt">na.rm =</span> <span class="ot">TRUE</span>)))</span></code></pre></div>
<pre><code>## `summarise()` ungrouping output (override with `.groups` argument)</code></pre>
<div class="sourceCode" id="cb30"><pre class="sourceCode r"><code class="sourceCode r"><span id="cb30-1"><a href="dplyr.html#cb30-1"></a><span class="kw">head</span>(I.state, <span class="dv">2</span>)</span></code></pre></div>
<pre><code>## # A tibble: 2 x 326
##   State X2020.12.11 X2020.12.10 X2020.12.09 X2020.12.08
##   &lt;fct&gt;       &lt;int&gt;       &lt;int&gt;       &lt;int&gt;       &lt;int&gt;
## 1 Alab…      288775      284922      280187      276665
## 2 Ariz…      394512      387529      382601      378157
## # … with 321 more variables: X2020.12.07 &lt;int&gt;,
## #   X2020.12.06 &lt;int&gt;, X2020.12.05 &lt;int&gt;,
## #   X2020.12.04 &lt;int&gt;, X2020.12.03 &lt;int&gt;,
## #   X2020.12.02 &lt;int&gt;, X2020.12.01 &lt;int&gt;,
## #   X2020.11.30 &lt;int&gt;, X2020.11.29 &lt;int&gt;,
## #   X2020.11.28 &lt;int&gt;, X2020.11.27 &lt;int&gt;,
## #   X2020.11.26 &lt;int&gt;, X2020.11.25 &lt;int&gt;,
## #   X2020.11.24 &lt;int&gt;, X2020.11.23 &lt;int&gt;,
## #   X2020.11.22 &lt;int&gt;, X2020.11.21 &lt;int&gt;,
## #   X2020.11.20 &lt;int&gt;, X2020.11.19 &lt;int&gt;,
## #   X2020.11.18 &lt;int&gt;, X2020.11.17 &lt;int&gt;,
## #   X2020.11.16 &lt;int&gt;, X2020.11.15 &lt;int&gt;,
## #   X2020.11.14 &lt;int&gt;, X2020.11.13 &lt;int&gt;,
## #   X2020.11.12 &lt;int&gt;, X2020.11.11 &lt;int&gt;,
## #   X2020.11.10 &lt;int&gt;, X2020.11.09 &lt;int&gt;,
## #   X2020.11.08 &lt;int&gt;, X2020.11.07 &lt;int&gt;,
## #   X2020.11.06 &lt;int&gt;, X2020.11.05 &lt;int&gt;,
## #   X2020.11.04 &lt;int&gt;, X2020.11.03 &lt;int&gt;,
## #   X2020.11.02 &lt;int&gt;, X2020.11.01 &lt;int&gt;,
## #   X2020.10.31 &lt;int&gt;, X2020.10.30 &lt;int&gt;,
## #   X2020.10.29 &lt;int&gt;, X2020.10.28 &lt;int&gt;,
## #   X2020.10.27 &lt;int&gt;, X2020.10.26 &lt;int&gt;,
## #   X2020.10.25 &lt;int&gt;, X2020.10.24 &lt;int&gt;,
## #   X2020.10.23 &lt;int&gt;, X2020.10.22 &lt;int&gt;,
## #   X2020.10.21 &lt;int&gt;, X2020.10.20 &lt;int&gt;,
## #   X2020.10.19 &lt;int&gt;, X2020.10.18 &lt;int&gt;,
## #   X2020.10.17 &lt;int&gt;, X2020.10.16 &lt;int&gt;,
## #   X2020.10.15 &lt;int&gt;, X2020.10.14 &lt;int&gt;,
## #   X2020.10.13 &lt;int&gt;, X2020.10.12 &lt;int&gt;,
## #   X2020.10.11 &lt;int&gt;, X2020.10.10 &lt;int&gt;,
## #   X2020.10.09 &lt;int&gt;, X2020.10.08 &lt;int&gt;,
## #   X2020.10.07 &lt;int&gt;, X2020.10.06 &lt;int&gt;,
## #   X2020.10.05 &lt;int&gt;, X2020.10.04 &lt;int&gt;,
## #   X2020.10.03 &lt;int&gt;, X2020.10.02 &lt;int&gt;,
## #   X2020.10.01 &lt;int&gt;, X2020.09.30 &lt;int&gt;,
## #   X2020.09.29 &lt;int&gt;, X2020.09.28 &lt;int&gt;,
## #   X2020.09.27 &lt;int&gt;, X2020.09.26 &lt;int&gt;,
## #   X2020.09.25 &lt;int&gt;, X2020.09.24 &lt;int&gt;,
## #   X2020.09.23 &lt;int&gt;, X2020.09.22 &lt;int&gt;,
## #   X2020.09.21 &lt;int&gt;, X2020.09.20 &lt;int&gt;,
## #   X2020.09.19 &lt;int&gt;, X2020.09.18 &lt;int&gt;,
## #   X2020.09.17 &lt;int&gt;, X2020.09.16 &lt;int&gt;,
## #   X2020.09.15 &lt;int&gt;, X2020.09.14 &lt;int&gt;,
## #   X2020.09.13 &lt;int&gt;, X2020.09.12 &lt;int&gt;,
## #   X2020.09.11 &lt;int&gt;, X2020.09.10 &lt;int&gt;,
## #   X2020.09.09 &lt;int&gt;, X2020.09.08 &lt;int&gt;,
## #   X2020.09.07 &lt;int&gt;, X2020.09.06 &lt;int&gt;,
## #   X2020.09.05 &lt;int&gt;, X2020.09.04 &lt;int&gt;,
## #   X2020.09.03 &lt;int&gt;, X2020.09.02 &lt;int&gt;,
## #   X2020.09.01 &lt;int&gt;, X2020.08.31 &lt;int&gt;,
## #   X2020.08.30 &lt;int&gt;, …</code></pre>
<p>or we can use <code>summarize_at()</code>, which affects variables selected with a character vector or <code>vars()</code>:</p>
<div class="sourceCode" id="cb32"><pre class="sourceCode r"><code class="sourceCode r"><span id="cb32-1"><a href="dplyr.html#cb32-1"></a><span class="co"># state level cumulative infected count</span></span>
<span id="cb32-2"><a href="dplyr.html#cb32-2"></a><span class="co"># method 2: summarize_at()</span></span>
<span id="cb32-3"><a href="dplyr.html#cb32-3"></a>I.state &lt;-<span class="st"> </span>I.county <span class="op">%&gt;%</span></span>
<span id="cb32-4"><a href="dplyr.html#cb32-4"></a><span class="st">  </span><span class="kw">group_by</span>(State) <span class="op">%&gt;%</span></span>
<span id="cb32-5"><a href="dplyr.html#cb32-5"></a><span class="st">  </span><span class="kw">summarize_at</span>(<span class="kw">vars</span>(X2020.<span class="fl">12.11</span><span class="op">:</span>X2020.<span class="fl">01.22</span>), </span>
<span id="cb32-6"><a href="dplyr.html#cb32-6"></a>               <span class="op">~</span><span class="st"> </span><span class="kw">sum</span>(.x, <span class="dt">na.rm =</span> <span class="ot">TRUE</span>))</span>
<span id="cb32-7"><a href="dplyr.html#cb32-7"></a></span>
<span id="cb32-8"><a href="dplyr.html#cb32-8"></a><span class="kw">head</span>(I.state, <span class="dv">2</span>)</span></code></pre></div>
<pre><code>## # A tibble: 2 x 326
##   State X2020.12.11 X2020.12.10 X2020.12.09 X2020.12.08
##   &lt;fct&gt;       &lt;int&gt;       &lt;int&gt;       &lt;int&gt;       &lt;int&gt;
## 1 Alab…      288775      284922      280187      276665
## 2 Ariz…      394512      387529      382601      378157
## # … with 321 more variables: X2020.12.07 &lt;int&gt;,
## #   X2020.12.06 &lt;int&gt;, X2020.12.05 &lt;int&gt;,
## #   X2020.12.04 &lt;int&gt;, X2020.12.03 &lt;int&gt;,
## #   X2020.12.02 &lt;int&gt;, X2020.12.01 &lt;int&gt;,
## #   X2020.11.30 &lt;int&gt;, X2020.11.29 &lt;int&gt;,
## #   X2020.11.28 &lt;int&gt;, X2020.11.27 &lt;int&gt;,
## #   X2020.11.26 &lt;int&gt;, X2020.11.25 &lt;int&gt;,
## #   X2020.11.24 &lt;int&gt;, X2020.11.23 &lt;int&gt;,
## #   X2020.11.22 &lt;int&gt;, X2020.11.21 &lt;int&gt;,
## #   X2020.11.20 &lt;int&gt;, X2020.11.19 &lt;int&gt;,
## #   X2020.11.18 &lt;int&gt;, X2020.11.17 &lt;int&gt;,
## #   X2020.11.16 &lt;int&gt;, X2020.11.15 &lt;int&gt;,
## #   X2020.11.14 &lt;int&gt;, X2020.11.13 &lt;int&gt;,
## #   X2020.11.12 &lt;int&gt;, X2020.11.11 &lt;int&gt;,
## #   X2020.11.10 &lt;int&gt;, X2020.11.09 &lt;int&gt;,
## #   X2020.11.08 &lt;int&gt;, X2020.11.07 &lt;int&gt;,
## #   X2020.11.06 &lt;int&gt;, X2020.11.05 &lt;int&gt;,
## #   X2020.11.04 &lt;int&gt;, X2020.11.03 &lt;int&gt;,
## #   X2020.11.02 &lt;int&gt;, X2020.11.01 &lt;int&gt;,
## #   X2020.10.31 &lt;int&gt;, X2020.10.30 &lt;int&gt;,
## #   X2020.10.29 &lt;int&gt;, X2020.10.28 &lt;int&gt;,
## #   X2020.10.27 &lt;int&gt;, X2020.10.26 &lt;int&gt;,
## #   X2020.10.25 &lt;int&gt;, X2020.10.24 &lt;int&gt;,
## #   X2020.10.23 &lt;int&gt;, X2020.10.22 &lt;int&gt;,
## #   X2020.10.21 &lt;int&gt;, X2020.10.20 &lt;int&gt;,
## #   X2020.10.19 &lt;int&gt;, X2020.10.18 &lt;int&gt;,
## #   X2020.10.17 &lt;int&gt;, X2020.10.16 &lt;int&gt;,
## #   X2020.10.15 &lt;int&gt;, X2020.10.14 &lt;int&gt;,
## #   X2020.10.13 &lt;int&gt;, X2020.10.12 &lt;int&gt;,
## #   X2020.10.11 &lt;int&gt;, X2020.10.10 &lt;int&gt;,
## #   X2020.10.09 &lt;int&gt;, X2020.10.08 &lt;int&gt;,
## #   X2020.10.07 &lt;int&gt;, X2020.10.06 &lt;int&gt;,
## #   X2020.10.05 &lt;int&gt;, X2020.10.04 &lt;int&gt;,
## #   X2020.10.03 &lt;int&gt;, X2020.10.02 &lt;int&gt;,
## #   X2020.10.01 &lt;int&gt;, X2020.09.30 &lt;int&gt;,
## #   X2020.09.29 &lt;int&gt;, X2020.09.28 &lt;int&gt;,
## #   X2020.09.27 &lt;int&gt;, X2020.09.26 &lt;int&gt;,
## #   X2020.09.25 &lt;int&gt;, X2020.09.24 &lt;int&gt;,
## #   X2020.09.23 &lt;int&gt;, X2020.09.22 &lt;int&gt;,
## #   X2020.09.21 &lt;int&gt;, X2020.09.20 &lt;int&gt;,
## #   X2020.09.19 &lt;int&gt;, X2020.09.18 &lt;int&gt;,
## #   X2020.09.17 &lt;int&gt;, X2020.09.16 &lt;int&gt;,
## #   X2020.09.15 &lt;int&gt;, X2020.09.14 &lt;int&gt;,
## #   X2020.09.13 &lt;int&gt;, X2020.09.12 &lt;int&gt;,
## #   X2020.09.11 &lt;int&gt;, X2020.09.10 &lt;int&gt;,
## #   X2020.09.09 &lt;int&gt;, X2020.09.08 &lt;int&gt;,
## #   X2020.09.07 &lt;int&gt;, X2020.09.06 &lt;int&gt;,
## #   X2020.09.05 &lt;int&gt;, X2020.09.04 &lt;int&gt;,
## #   X2020.09.03 &lt;int&gt;, X2020.09.02 &lt;int&gt;,
## #   X2020.09.01 &lt;int&gt;, X2020.08.31 &lt;int&gt;,
## #   X2020.08.30 &lt;int&gt;, …</code></pre>
<p>or we can use <code>summarize_if()</code>, which affects variables selected with a predicate function:</p>
<div class="sourceCode" id="cb34"><pre class="sourceCode r"><code class="sourceCode r"><span id="cb34-1"><a href="dplyr.html#cb34-1"></a><span class="co"># state level cumulative infected count</span></span>
<span id="cb34-2"><a href="dplyr.html#cb34-2"></a><span class="co"># method 3: summarize_if()</span></span>
<span id="cb34-3"><a href="dplyr.html#cb34-3"></a>I.state &lt;-<span class="st"> </span>I.county <span class="op">%&gt;%</span></span>
<span id="cb34-4"><a href="dplyr.html#cb34-4"></a><span class="st">  </span><span class="kw">group_by</span>(State) <span class="op">%&gt;%</span></span>
<span id="cb34-5"><a href="dplyr.html#cb34-5"></a><span class="st">  </span><span class="kw">summarize_if</span>(is.numeric, <span class="op">~</span><span class="st"> </span><span class="kw">sum</span>(.x, <span class="dt">na.rm =</span> <span class="ot">TRUE</span>)) </span>
<span id="cb34-6"><a href="dplyr.html#cb34-6"></a></span>
<span id="cb34-7"><a href="dplyr.html#cb34-7"></a><span class="kw">head</span>(I.state, <span class="dv">2</span>)</span></code></pre></div>
<pre><code>## # A tibble: 2 x 327
##   State    ID X2020.12.11 X2020.12.10 X2020.12.09
##   &lt;fct&gt; &lt;int&gt;       &lt;int&gt;       &lt;int&gt;       &lt;int&gt;
## 1 Alab… 71489      288775      284922      280187
## 2 Ariz… 60208      394512      387529      382601
## # … with 322 more variables: X2020.12.08 &lt;int&gt;,
## #   X2020.12.07 &lt;int&gt;, X2020.12.06 &lt;int&gt;,
## #   X2020.12.05 &lt;int&gt;, X2020.12.04 &lt;int&gt;,
## #   X2020.12.03 &lt;int&gt;, X2020.12.02 &lt;int&gt;,
## #   X2020.12.01 &lt;int&gt;, X2020.11.30 &lt;int&gt;,
## #   X2020.11.29 &lt;int&gt;, X2020.11.28 &lt;int&gt;,
## #   X2020.11.27 &lt;int&gt;, X2020.11.26 &lt;int&gt;,
## #   X2020.11.25 &lt;int&gt;, X2020.11.24 &lt;int&gt;,
## #   X2020.11.23 &lt;int&gt;, X2020.11.22 &lt;int&gt;,
## #   X2020.11.21 &lt;int&gt;, X2020.11.20 &lt;int&gt;,
## #   X2020.11.19 &lt;int&gt;, X2020.11.18 &lt;int&gt;,
## #   X2020.11.17 &lt;int&gt;, X2020.11.16 &lt;int&gt;,
## #   X2020.11.15 &lt;int&gt;, X2020.11.14 &lt;int&gt;,
## #   X2020.11.13 &lt;int&gt;, X2020.11.12 &lt;int&gt;,
## #   X2020.11.11 &lt;int&gt;, X2020.11.10 &lt;int&gt;,
## #   X2020.11.09 &lt;int&gt;, X2020.11.08 &lt;int&gt;,
## #   X2020.11.07 &lt;int&gt;, X2020.11.06 &lt;int&gt;,
## #   X2020.11.05 &lt;int&gt;, X2020.11.04 &lt;int&gt;,
## #   X2020.11.03 &lt;int&gt;, X2020.11.02 &lt;int&gt;,
## #   X2020.11.01 &lt;int&gt;, X2020.10.31 &lt;int&gt;,
## #   X2020.10.30 &lt;int&gt;, X2020.10.29 &lt;int&gt;,
## #   X2020.10.28 &lt;int&gt;, X2020.10.27 &lt;int&gt;,
## #   X2020.10.26 &lt;int&gt;, X2020.10.25 &lt;int&gt;,
## #   X2020.10.24 &lt;int&gt;, X2020.10.23 &lt;int&gt;,
## #   X2020.10.22 &lt;int&gt;, X2020.10.21 &lt;int&gt;,
## #   X2020.10.20 &lt;int&gt;, X2020.10.19 &lt;int&gt;,
## #   X2020.10.18 &lt;int&gt;, X2020.10.17 &lt;int&gt;,
## #   X2020.10.16 &lt;int&gt;, X2020.10.15 &lt;int&gt;,
## #   X2020.10.14 &lt;int&gt;, X2020.10.13 &lt;int&gt;,
## #   X2020.10.12 &lt;int&gt;, X2020.10.11 &lt;int&gt;,
## #   X2020.10.10 &lt;int&gt;, X2020.10.09 &lt;int&gt;,
## #   X2020.10.08 &lt;int&gt;, X2020.10.07 &lt;int&gt;,
## #   X2020.10.06 &lt;int&gt;, X2020.10.05 &lt;int&gt;,
## #   X2020.10.04 &lt;int&gt;, X2020.10.03 &lt;int&gt;,
## #   X2020.10.02 &lt;int&gt;, X2020.10.01 &lt;int&gt;,
## #   X2020.09.30 &lt;int&gt;, X2020.09.29 &lt;int&gt;,
## #   X2020.09.28 &lt;int&gt;, X2020.09.27 &lt;int&gt;,
## #   X2020.09.26 &lt;int&gt;, X2020.09.25 &lt;int&gt;,
## #   X2020.09.24 &lt;int&gt;, X2020.09.23 &lt;int&gt;,
## #   X2020.09.22 &lt;int&gt;, X2020.09.21 &lt;int&gt;,
## #   X2020.09.20 &lt;int&gt;, X2020.09.19 &lt;int&gt;,
## #   X2020.09.18 &lt;int&gt;, X2020.09.17 &lt;int&gt;,
## #   X2020.09.16 &lt;int&gt;, X2020.09.15 &lt;int&gt;,
## #   X2020.09.14 &lt;int&gt;, X2020.09.13 &lt;int&gt;,
## #   X2020.09.12 &lt;int&gt;, X2020.09.11 &lt;int&gt;,
## #   X2020.09.10 &lt;int&gt;, X2020.09.09 &lt;int&gt;,
## #   X2020.09.08 &lt;int&gt;, X2020.09.07 &lt;int&gt;,
## #   X2020.09.06 &lt;int&gt;, X2020.09.05 &lt;int&gt;,
## #   X2020.09.04 &lt;int&gt;, X2020.09.03 &lt;int&gt;,
## #   X2020.09.02 &lt;int&gt;, X2020.09.01 &lt;int&gt;,
## #   X2020.08.31 &lt;int&gt;, …</code></pre>
<p>It is sometimes useful to rearrange the result of a query to inspect the values. For instance, we can sort on <code>X2020.12.11</code> to put the group with the largest cumulative infected count first using the <code>arrange()</code> function:</p>
<div class="sourceCode" id="cb36"><pre class="sourceCode r"><code class="sourceCode r"><span id="cb36-1"><a href="dplyr.html#cb36-1"></a><span class="co"># state level cumulative infected count</span></span>
<span id="cb36-2"><a href="dplyr.html#cb36-2"></a><span class="co"># method 4: sort by the cum. infected count</span></span>
<span id="cb36-3"><a href="dplyr.html#cb36-3"></a>I.state &lt;-<span class="st"> </span>I.county <span class="op">%&gt;%</span></span>
<span id="cb36-4"><a href="dplyr.html#cb36-4"></a><span class="st">  </span><span class="kw">group_by</span>(State) <span class="op">%&gt;%</span></span>
<span id="cb36-5"><a href="dplyr.html#cb36-5"></a><span class="st">  </span><span class="kw">summarize_if</span>(is.numeric, <span class="op">~</span><span class="st"> </span><span class="kw">sum</span>(.x, <span class="dt">na.rm =</span> <span class="ot">TRUE</span>)) <span class="op">%&gt;%</span></span>
<span id="cb36-6"><a href="dplyr.html#cb36-6"></a><span class="st">  </span><span class="kw">arrange</span>(<span class="kw">desc</span>(X2020.<span class="fl">12.11</span>))</span>
<span id="cb36-7"><a href="dplyr.html#cb36-7"></a></span>
<span id="cb36-8"><a href="dplyr.html#cb36-8"></a><span class="kw">head</span>(I.state, <span class="dv">2</span>)</span></code></pre></div>
<pre><code>## # A tibble: 2 x 327
##   State     ID X2020.12.11 X2020.12.10 X2020.12.09
##   &lt;fct&gt;  &lt;int&gt;       &lt;int&gt;       &lt;int&gt;       &lt;int&gt;
## 1 Cali… 3.51e5     1516215     1482551     1448987
## 2 Texas 1.23e7     1388909     1374143     1359740
## # … with 322 more variables: X2020.12.08 &lt;int&gt;,
## #   X2020.12.07 &lt;int&gt;, X2020.12.06 &lt;int&gt;,
## #   X2020.12.05 &lt;int&gt;, X2020.12.04 &lt;int&gt;,
## #   X2020.12.03 &lt;int&gt;, X2020.12.02 &lt;int&gt;,
## #   X2020.12.01 &lt;int&gt;, X2020.11.30 &lt;int&gt;,
## #   X2020.11.29 &lt;int&gt;, X2020.11.28 &lt;int&gt;,
## #   X2020.11.27 &lt;int&gt;, X2020.11.26 &lt;int&gt;,
## #   X2020.11.25 &lt;int&gt;, X2020.11.24 &lt;int&gt;,
## #   X2020.11.23 &lt;int&gt;, X2020.11.22 &lt;int&gt;,
## #   X2020.11.21 &lt;int&gt;, X2020.11.20 &lt;int&gt;,
## #   X2020.11.19 &lt;int&gt;, X2020.11.18 &lt;int&gt;,
## #   X2020.11.17 &lt;int&gt;, X2020.11.16 &lt;int&gt;,
## #   X2020.11.15 &lt;int&gt;, X2020.11.14 &lt;int&gt;,
## #   X2020.11.13 &lt;int&gt;, X2020.11.12 &lt;int&gt;,
## #   X2020.11.11 &lt;int&gt;, X2020.11.10 &lt;int&gt;,
## #   X2020.11.09 &lt;int&gt;, X2020.11.08 &lt;int&gt;,
## #   X2020.11.07 &lt;int&gt;, X2020.11.06 &lt;int&gt;,
## #   X2020.11.05 &lt;int&gt;, X2020.11.04 &lt;int&gt;,
## #   X2020.11.03 &lt;int&gt;, X2020.11.02 &lt;int&gt;,
## #   X2020.11.01 &lt;int&gt;, X2020.10.31 &lt;int&gt;,
## #   X2020.10.30 &lt;int&gt;, X2020.10.29 &lt;int&gt;,
## #   X2020.10.28 &lt;int&gt;, X2020.10.27 &lt;int&gt;,
## #   X2020.10.26 &lt;int&gt;, X2020.10.25 &lt;int&gt;,
## #   X2020.10.24 &lt;int&gt;, X2020.10.23 &lt;int&gt;,
## #   X2020.10.22 &lt;int&gt;, X2020.10.21 &lt;int&gt;,
## #   X2020.10.20 &lt;int&gt;, X2020.10.19 &lt;int&gt;,
## #   X2020.10.18 &lt;int&gt;, X2020.10.17 &lt;int&gt;,
## #   X2020.10.16 &lt;int&gt;, X2020.10.15 &lt;int&gt;,
## #   X2020.10.14 &lt;int&gt;, X2020.10.13 &lt;int&gt;,
## #   X2020.10.12 &lt;int&gt;, X2020.10.11 &lt;int&gt;,
## #   X2020.10.10 &lt;int&gt;, X2020.10.09 &lt;int&gt;,
## #   X2020.10.08 &lt;int&gt;, X2020.10.07 &lt;int&gt;,
## #   X2020.10.06 &lt;int&gt;, X2020.10.05 &lt;int&gt;,
## #   X2020.10.04 &lt;int&gt;, X2020.10.03 &lt;int&gt;,
## #   X2020.10.02 &lt;int&gt;, X2020.10.01 &lt;int&gt;,
## #   X2020.09.30 &lt;int&gt;, X2020.09.29 &lt;int&gt;,
## #   X2020.09.28 &lt;int&gt;, X2020.09.27 &lt;int&gt;,
## #   X2020.09.26 &lt;int&gt;, X2020.09.25 &lt;int&gt;,
## #   X2020.09.24 &lt;int&gt;, X2020.09.23 &lt;int&gt;,
## #   X2020.09.22 &lt;int&gt;, X2020.09.21 &lt;int&gt;,
## #   X2020.09.20 &lt;int&gt;, X2020.09.19 &lt;int&gt;,
## #   X2020.09.18 &lt;int&gt;, X2020.09.17 &lt;int&gt;,
## #   X2020.09.16 &lt;int&gt;, X2020.09.15 &lt;int&gt;,
## #   X2020.09.14 &lt;int&gt;, X2020.09.13 &lt;int&gt;,
## #   X2020.09.12 &lt;int&gt;, X2020.09.11 &lt;int&gt;,
## #   X2020.09.10 &lt;int&gt;, X2020.09.09 &lt;int&gt;,
## #   X2020.09.08 &lt;int&gt;, X2020.09.07 &lt;int&gt;,
## #   X2020.09.06 &lt;int&gt;, X2020.09.05 &lt;int&gt;,
## #   X2020.09.04 &lt;int&gt;, X2020.09.03 &lt;int&gt;,
## #   X2020.09.02 &lt;int&gt;, X2020.09.01 &lt;int&gt;,
## #   X2020.08.31 &lt;int&gt;, …</code></pre>
<p>In the above, <code>desc()</code> is used to re-oorder by a column in descending order.</p>
</div>
<div id="combine-data-sets" class="section level2">
<h2><span class="header-section-number">3.5</span> Combine Data Sets</h2>
<p>R has a number of quick, elegant ways to join data frames by a common column. There are at least three ways:</p>
<ul>
<li>Base R’s <code>merge()</code> function,</li>
<li>Join family of functions from <code>dplyr</code>, and</li>
<li>Bracket syntax based on <code>data.table</code>.</li>
</ul>
<div id="the-join-family" class="section level3">
<h3><span class="header-section-number">3.5.1</span> The join family</h3>
<p>The <code>dplyr</code> uses SQL database syntax for its join functions. For example, a <strong>left join</strong> means: Include everything on the left and all rows that match from the right data frame. If the join columns have the same name, all you need is <code>left_join(x, y)</code>. If they don’t have the same name, you need a by argument, such as <code>left_join(x, y, by = c("df1ColName" = "df2ColName"))</code>. See an illustration in Figure <a href="dplyr.html#fig:lrjoin">3.3</a>.</p>
<div class="figure" style="text-align: center"><span id="fig:lrjoin"></span>
<img src="figures/Left.png" alt="An illustration of left join and right join." width="30%" /><img src="figures/Right.png" alt="An illustration of left join and right join." width="30%" />
<p class="caption">
Figure 3.3: An illustration of left join and right join.
</p>
</div>
<p>Different join functions control what happens to rows that exist in one table but not the other.</p>
<ul>
<li><code>left_join</code> keeps all the entries that are present in the left (first) table and excludes any that are only in the right table.</li>
<li><code>right_join</code> keeps all the entries that are present in the right table and excludes any that are only in the left table.</li>
<li><code>inner_join</code> keeps only the entries that are present in both tables. <code>inner_join</code> is the only function that guarantees you won’t generate any missing entries.</li>
<li><code>full_join</code> keeps all of the entries in both tables, regardless of whether or not they appear in the other table.</li>
</ul>
<div class="figure" style="text-align: center"><span id="fig:ifjoin"></span>
<img src="figures/Inner.png" alt="An illustration of inner join and full join." width="30%" /><img src="figures/Full.png" alt="An illustration of inner join and full join." width="30%" />
<p class="caption">
Figure 3.4: An illustration of inner join and full join.
</p>
</div>
<p>The join functions are nicely illustrated in RStudio’s <a href="https://www.rstudio.com/wp-content/uploads/2015/02/data-wrangling-cheatsheet.pdf">Data wrangling cheatsheet</a>.</p>
<div class="figure" style="text-align: center"><span id="fig:join"></span>
<img src="figures/dplyr-joins.png" alt="An illustration of the join functions in RStudio’s Data wrangling cheatsheet." width="75%" />
<p class="caption">
Figure 3.5: An illustration of the join functions in RStudio’s Data wrangling cheatsheet.
</p>
</div>
</div>
<div id="toy-examples-with-joins" class="section level3">
<h3><span class="header-section-number">3.5.2</span> Toy examples with joins</h3>
<div class="sourceCode" id="cb38"><pre class="sourceCode r"><code class="sourceCode r"><span id="cb38-1"><a href="dplyr.html#cb38-1"></a>a &lt;-<span class="st"> </span><span class="kw">tibble</span>(<span class="dt">x1 =</span> LETTERS[<span class="kw">c</span>(<span class="dv">1</span><span class="op">:</span><span class="dv">3</span>)], </span>
<span id="cb38-2"><a href="dplyr.html#cb38-2"></a>                <span class="dt">x2 =</span> <span class="dv">1</span><span class="op">:</span><span class="dv">3</span>)</span>
<span id="cb38-3"><a href="dplyr.html#cb38-3"></a>b &lt;-<span class="st"> </span><span class="kw">tibble</span>(<span class="dt">x1 =</span> LETTERS[<span class="kw">c</span>(<span class="dv">1</span>, <span class="dv">2</span>, <span class="dv">4</span>)], </span>
<span id="cb38-4"><a href="dplyr.html#cb38-4"></a>                <span class="dt">x3 =</span> <span class="kw">c</span>(T, F, T))</span>
<span id="cb38-5"><a href="dplyr.html#cb38-5"></a>a</span>
<span id="cb38-6"><a href="dplyr.html#cb38-6"></a><span class="co">## # A tibble: 3 x 2</span></span>
<span id="cb38-7"><a href="dplyr.html#cb38-7"></a><span class="co">##   x1       x2</span></span>
<span id="cb38-8"><a href="dplyr.html#cb38-8"></a><span class="co">##   &lt;chr&gt; &lt;int&gt;</span></span>
<span id="cb38-9"><a href="dplyr.html#cb38-9"></a><span class="co">## 1 A         1</span></span>
<span id="cb38-10"><a href="dplyr.html#cb38-10"></a><span class="co">## 2 B         2</span></span>
<span id="cb38-11"><a href="dplyr.html#cb38-11"></a><span class="co">## 3 C         3</span></span>
<span id="cb38-12"><a href="dplyr.html#cb38-12"></a>b</span>
<span id="cb38-13"><a href="dplyr.html#cb38-13"></a><span class="co">## # A tibble: 3 x 2</span></span>
<span id="cb38-14"><a href="dplyr.html#cb38-14"></a><span class="co">##   x1    x3   </span></span>
<span id="cb38-15"><a href="dplyr.html#cb38-15"></a><span class="co">##   &lt;chr&gt; &lt;lgl&gt;</span></span>
<span id="cb38-16"><a href="dplyr.html#cb38-16"></a><span class="co">## 1 A     TRUE </span></span>
<span id="cb38-17"><a href="dplyr.html#cb38-17"></a><span class="co">## 2 B     FALSE</span></span>
<span id="cb38-18"><a href="dplyr.html#cb38-18"></a><span class="co">## 3 D     TRUE</span></span></code></pre></div>
<div class="sourceCode" id="cb39"><pre class="sourceCode r"><code class="sourceCode r"><span id="cb39-1"><a href="dplyr.html#cb39-1"></a><span class="co"># include all rows in a and b</span></span>
<span id="cb39-2"><a href="dplyr.html#cb39-2"></a><span class="kw">inner_join</span>(a, b, <span class="dt">by =</span> <span class="st">&quot;x1&quot;</span>)</span>
<span id="cb39-3"><a href="dplyr.html#cb39-3"></a><span class="co">## # A tibble: 2 x 3</span></span>
<span id="cb39-4"><a href="dplyr.html#cb39-4"></a><span class="co">##   x1       x2 x3   </span></span>
<span id="cb39-5"><a href="dplyr.html#cb39-5"></a><span class="co">##   &lt;chr&gt; &lt;int&gt; &lt;lgl&gt;</span></span>
<span id="cb39-6"><a href="dplyr.html#cb39-6"></a><span class="co">## 1 A         1 TRUE </span></span>
<span id="cb39-7"><a href="dplyr.html#cb39-7"></a><span class="co">## 2 B         2 FALSE</span></span></code></pre></div>
<div class="sourceCode" id="cb40"><pre class="sourceCode r"><code class="sourceCode r"><span id="cb40-1"><a href="dplyr.html#cb40-1"></a><span class="co"># return all rows from a</span></span>
<span id="cb40-2"><a href="dplyr.html#cb40-2"></a><span class="kw">left_join</span>(a, b, <span class="dt">by =</span> <span class="st">&quot;x1&quot;</span>)</span>
<span id="cb40-3"><a href="dplyr.html#cb40-3"></a><span class="co">## # A tibble: 3 x 3</span></span>
<span id="cb40-4"><a href="dplyr.html#cb40-4"></a><span class="co">##   x1       x2 x3   </span></span>
<span id="cb40-5"><a href="dplyr.html#cb40-5"></a><span class="co">##   &lt;chr&gt; &lt;int&gt; &lt;lgl&gt;</span></span>
<span id="cb40-6"><a href="dplyr.html#cb40-6"></a><span class="co">## 1 A         1 TRUE </span></span>
<span id="cb40-7"><a href="dplyr.html#cb40-7"></a><span class="co">## 2 B         2 FALSE</span></span>
<span id="cb40-8"><a href="dplyr.html#cb40-8"></a><span class="co">## 3 C         3 NA</span></span></code></pre></div>
<div class="sourceCode" id="cb41"><pre class="sourceCode r"><code class="sourceCode r"><span id="cb41-1"><a href="dplyr.html#cb41-1"></a><span class="co"># return all rows from b</span></span>
<span id="cb41-2"><a href="dplyr.html#cb41-2"></a><span class="kw">right_join</span>(a, b, <span class="dt">by =</span> <span class="st">&quot;x1&quot;</span>)</span>
<span id="cb41-3"><a href="dplyr.html#cb41-3"></a><span class="co">## # A tibble: 3 x 3</span></span>
<span id="cb41-4"><a href="dplyr.html#cb41-4"></a><span class="co">##   x1       x2 x3   </span></span>
<span id="cb41-5"><a href="dplyr.html#cb41-5"></a><span class="co">##   &lt;chr&gt; &lt;int&gt; &lt;lgl&gt;</span></span>
<span id="cb41-6"><a href="dplyr.html#cb41-6"></a><span class="co">## 1 A         1 TRUE </span></span>
<span id="cb41-7"><a href="dplyr.html#cb41-7"></a><span class="co">## 2 B         2 FALSE</span></span>
<span id="cb41-8"><a href="dplyr.html#cb41-8"></a><span class="co">## 3 D        NA TRUE</span></span></code></pre></div>
<div class="sourceCode" id="cb42"><pre class="sourceCode r"><code class="sourceCode r"><span id="cb42-1"><a href="dplyr.html#cb42-1"></a><span class="co"># includes all rows in a or b</span></span>
<span id="cb42-2"><a href="dplyr.html#cb42-2"></a><span class="kw">full_join</span>(a, b, <span class="dt">by =</span> <span class="st">&quot;x1&quot;</span>)</span>
<span id="cb42-3"><a href="dplyr.html#cb42-3"></a><span class="co">## # A tibble: 4 x 3</span></span>
<span id="cb42-4"><a href="dplyr.html#cb42-4"></a><span class="co">##   x1       x2 x3   </span></span>
<span id="cb42-5"><a href="dplyr.html#cb42-5"></a><span class="co">##   &lt;chr&gt; &lt;int&gt; &lt;lgl&gt;</span></span>
<span id="cb42-6"><a href="dplyr.html#cb42-6"></a><span class="co">## 1 A         1 TRUE </span></span>
<span id="cb42-7"><a href="dplyr.html#cb42-7"></a><span class="co">## 2 B         2 FALSE</span></span>
<span id="cb42-8"><a href="dplyr.html#cb42-8"></a><span class="co">## 3 C         3 NA   </span></span>
<span id="cb42-9"><a href="dplyr.html#cb42-9"></a><span class="co">## 4 D        NA TRUE</span></span></code></pre></div>
<div class="sourceCode" id="cb43"><pre class="sourceCode r"><code class="sourceCode r"><span id="cb43-1"><a href="dplyr.html#cb43-1"></a><span class="co"># include the rows in a that are not in b</span></span>
<span id="cb43-2"><a href="dplyr.html#cb43-2"></a><span class="kw">anti_join</span>(a, b, <span class="dt">by =</span> <span class="st">&quot;x1&quot;</span>)</span>
<span id="cb43-3"><a href="dplyr.html#cb43-3"></a><span class="co">## # A tibble: 1 x 2</span></span>
<span id="cb43-4"><a href="dplyr.html#cb43-4"></a><span class="co">##   x1       x2</span></span>
<span id="cb43-5"><a href="dplyr.html#cb43-5"></a><span class="co">##   &lt;chr&gt; &lt;int&gt;</span></span>
<span id="cb43-6"><a href="dplyr.html#cb43-6"></a><span class="co">## 1 C         3</span></span></code></pre></div>
<div class="sourceCode" id="cb44"><pre class="sourceCode r"><code class="sourceCode r"><span id="cb44-1"><a href="dplyr.html#cb44-1"></a><span class="co"># want everything that doesn&#39;t match?</span></span>
<span id="cb44-2"><a href="dplyr.html#cb44-2"></a><span class="kw">full_join</span>(<span class="kw">anti_join</span>(a, b, <span class="dt">by =</span> <span class="st">&quot;x1&quot;</span>), </span>
<span id="cb44-3"><a href="dplyr.html#cb44-3"></a><span class="kw">anti_join</span>(b, a, <span class="dt">by =</span> <span class="st">&quot;x1&quot;</span>), <span class="dt">by =</span> <span class="st">&quot;x1&quot;</span>)</span>
<span id="cb44-4"><a href="dplyr.html#cb44-4"></a><span class="co">## # A tibble: 2 x 3</span></span>
<span id="cb44-5"><a href="dplyr.html#cb44-5"></a><span class="co">##   x1       x2 x3   </span></span>
<span id="cb44-6"><a href="dplyr.html#cb44-6"></a><span class="co">##   &lt;chr&gt; &lt;int&gt; &lt;lgl&gt;</span></span>
<span id="cb44-7"><a href="dplyr.html#cb44-7"></a><span class="co">## 1 C         3 NA   </span></span>
<span id="cb44-8"><a href="dplyr.html#cb44-8"></a><span class="co">## 2 D        NA TRUE</span></span></code></pre></div>
</div>
<div id="practice-with-joins-for-real-data" class="section level3">
<h3><span class="header-section-number">3.5.3</span> Practice with joins for real data</h3>
<ol style="list-style-type: decimal">
<li>Example 1</li>
</ol>
<p>We first get the data named <code>pop.county</code> from the github R package <code>slid</code>. Note that there are four variables in this data: “ID” (county-level Federal Information Processing System code), “County” (name of county matched with “ID”), “State” (name of state matched with “ID”), <code>population</code> (population of county matched with “ID”).</p>
<div class="sourceCode" id="cb45"><pre class="sourceCode r"><code class="sourceCode r"><span id="cb45-1"><a href="dplyr.html#cb45-1"></a><span class="kw">data</span>(I.county)</span>
<span id="cb45-2"><a href="dplyr.html#cb45-2"></a><span class="kw">data</span>(pop.county)</span>
<span id="cb45-3"><a href="dplyr.html#cb45-3"></a><span class="co"># make I.county a tibble with as_tibble()</span></span>
<span id="cb45-4"><a href="dplyr.html#cb45-4"></a>I.county &lt;-<span class="st"> </span><span class="kw">as_tibble</span>(I.county)</span>
<span id="cb45-5"><a href="dplyr.html#cb45-5"></a><span class="kw">dim</span>(I.county)</span>
<span id="cb45-6"><a href="dplyr.html#cb45-6"></a><span class="co">## [1] 3104  328</span></span>
<span id="cb45-7"><a href="dplyr.html#cb45-7"></a><span class="co"># make pop.county a tibble with as_tibble()</span></span>
<span id="cb45-8"><a href="dplyr.html#cb45-8"></a>pop.county &lt;-<span class="st"> </span><span class="kw">as_tibble</span>(pop.county)</span>
<span id="cb45-9"><a href="dplyr.html#cb45-9"></a><span class="kw">dim</span>(pop.county)</span>
<span id="cb45-10"><a href="dplyr.html#cb45-10"></a><span class="co">## [1] 3142    4</span></span></code></pre></div>
<p>Now, we would like to join the two tables: <code>I.county</code> and <code>pop.county</code> using the <code>left_join</code> as follows:</p>
<div class="sourceCode" id="cb46"><pre class="sourceCode r"><code class="sourceCode r"><span id="cb46-1"><a href="dplyr.html#cb46-1"></a>pop.county.tmp &lt;-<span class="st"> </span>pop.county <span class="op">%&gt;%</span><span class="st"> </span>dplyr<span class="op">::</span><span class="kw">select</span>(<span class="op">-</span><span class="kw">c</span>(County, State)) </span>
<span id="cb46-2"><a href="dplyr.html#cb46-2"></a>I.county.w.pop &lt;-<span class="st"> </span><span class="kw">left_join</span>(I.county, pop.county.tmp, <span class="dt">by =</span> <span class="st">&quot;ID&quot;</span>)</span></code></pre></div>
<p>or we can:</p>
<div class="sourceCode" id="cb47"><pre class="sourceCode r"><code class="sourceCode r"><span id="cb47-1"><a href="dplyr.html#cb47-1"></a>I.county.w.pop &lt;-<span class="st"> </span><span class="kw">left_join</span>(I.county, </span>
<span id="cb47-2"><a href="dplyr.html#cb47-2"></a>dplyr<span class="op">::</span><span class="kw">select</span>(pop.county, <span class="kw">c</span>(ID, population)), <span class="dt">by =</span> <span class="st">&quot;ID&quot;</span>)</span></code></pre></div>
<ol start="2" style="list-style-type: decimal">
<li>Example 2</li>
</ol>
<p>In this example, we would like to create a map to show the risk of COVID-19 infection in each state of the US. So, first, we need to have a new dataset that contains infection risk and the geographic information of each state. We will get infected count and state population in the <code>state.long</code> dataset in the <code>slid</code> package. <code>state.long</code> is a tibble with 15,925 rows and 7 columns. Next, we obtain the boundary information of each state downloaded from <a href="https://raw.githubusercontent.com/PublicaMundi/MappingAPI/master/data/geojson/us-states.json">PublicaMundi</a>. Then, we merge the two datasets to create a new dataset. We need the R package <code>geojsonio</code> to read the data from <a href="https://raw.githubusercontent.com/PublicaMundi/MappingAPI/master/data/geojson/us-states.json">PublicaMundi</a>.</p>
<div class="sourceCode" id="cb48"><pre class="sourceCode r"><code class="sourceCode r"><span id="cb48-1"><a href="dplyr.html#cb48-1"></a><span class="kw">library</span>(geojsonio)</span></code></pre></div>
<pre><code>## 
## Attaching package: &#39;geojsonio&#39;</code></pre>
<pre><code>## The following object is masked from &#39;package:base&#39;:
## 
##     pretty</code></pre>
<div class="sourceCode" id="cb51"><pre class="sourceCode r"><code class="sourceCode r"><span id="cb51-1"><a href="dplyr.html#cb51-1"></a><span class="kw">library</span>(slid)</span>
<span id="cb51-2"><a href="dplyr.html#cb51-2"></a><span class="kw">data</span>(state.long)</span>
<span id="cb51-3"><a href="dplyr.html#cb51-3"></a><span class="co"># get the geospatial information from PublicaMundi</span></span>
<span id="cb51-4"><a href="dplyr.html#cb51-4"></a>urlRemote  &lt;-<span class="st"> &quot;https://raw.githubusercontent.com/&quot;</span></span>
<span id="cb51-5"><a href="dplyr.html#cb51-5"></a>pathGithub &lt;-<span class="st"> &quot;PublicaMundi/MappingAPI/master/data/geojson/&quot;</span></span>
<span id="cb51-6"><a href="dplyr.html#cb51-6"></a>fileName   &lt;-<span class="st"> &quot;us-states.json&quot;</span></span>
<span id="cb51-7"><a href="dplyr.html#cb51-7"></a>states0 &lt;-<span class="st"> </span><span class="kw">geojson_read</span>(<span class="dt">x =</span> <span class="kw">paste0</span>(urlRemote, pathGithub, fileName), </span>
<span id="cb51-8"><a href="dplyr.html#cb51-8"></a>                        <span class="dt">what =</span> <span class="st">&quot;sp&quot;</span>)</span>
<span id="cb51-9"><a href="dplyr.html#cb51-9"></a><span class="kw">head</span>(states0<span class="op">@</span>data)</span></code></pre></div>
<pre><code>##   id       name density
## 1 01    Alabama  94.650
## 2 02     Alaska   1.264
## 3 04    Arizona  57.050
## 4 05   Arkansas  56.430
## 5 06 California 241.700
## 6 08   Colorado  49.330</code></pre>
<div class="sourceCode" id="cb53"><pre class="sourceCode r"><code class="sourceCode r"><span id="cb53-1"><a href="dplyr.html#cb53-1"></a>states1 &lt;-<span class="st"> </span>states0</span>
<span id="cb53-2"><a href="dplyr.html#cb53-2"></a>states1<span class="op">@</span>data &lt;-<span class="st"> </span>states0<span class="op">@</span>data <span class="op">%&gt;%</span><span class="st"> </span></span>
<span id="cb53-3"><a href="dplyr.html#cb53-3"></a><span class="co"># remove the space in the name of state if there is one</span></span>
<span id="cb53-4"><a href="dplyr.html#cb53-4"></a><span class="kw">mutate</span>(<span class="dt">name_ns =</span> <span class="kw">sapply</span>(name, gsub, <span class="dt">pattern =</span> <span class="st">&quot; &quot;</span>, <span class="dt">replacement =</span> <span class="st">&quot;&quot;</span>))</span>
<span id="cb53-5"><a href="dplyr.html#cb53-5"></a><span class="co"># the following merge step can be done both using sp::merge </span></span>
<span id="cb53-6"><a href="dplyr.html#cb53-6"></a><span class="co"># or the join functions in dplyr</span></span>
<span id="cb53-7"><a href="dplyr.html#cb53-7"></a><span class="co"># states1 &lt;- sp::merge(states1, state.long %&gt;% </span></span>
<span id="cb53-8"><a href="dplyr.html#cb53-8"></a><span class="co"># filter(DATE == as.Date(&#39;2020-12-11&#39;)), </span></span>
<span id="cb53-9"><a href="dplyr.html#cb53-9"></a><span class="co"># by.x = &quot;name_ns&quot;, by.y = &quot;State&quot;)</span></span>
<span id="cb53-10"><a href="dplyr.html#cb53-10"></a><span class="co"># merge the two datasets</span></span>
<span id="cb53-11"><a href="dplyr.html#cb53-11"></a>states1<span class="op">@</span>data &lt;-<span class="st"> </span><span class="kw">left_join</span>(states1<span class="op">@</span>data, state.long <span class="op">%&gt;%</span><span class="st"> </span></span>
<span id="cb53-12"><a href="dplyr.html#cb53-12"></a><span class="kw">filter</span>(DATE <span class="op">==</span><span class="st"> </span><span class="kw">as.Date</span>(<span class="st">&#39;2020-12-11&#39;</span>)), </span>
<span id="cb53-13"><a href="dplyr.html#cb53-13"></a><span class="dt">by =</span> <span class="kw">c</span>(<span class="st">&#39;name_ns&#39;</span> =<span class="st"> &#39;State&#39;</span>))</span>
<span id="cb53-14"><a href="dplyr.html#cb53-14"></a><span class="co"># calculate the risk of infection</span></span>
<span id="cb53-15"><a href="dplyr.html#cb53-15"></a>states1<span class="op">@</span>data &lt;-<span class="st"> </span>states1<span class="op">@</span>data <span class="op">%&gt;%</span><span class="st"> </span></span>
<span id="cb53-16"><a href="dplyr.html#cb53-16"></a><span class="st">  </span><span class="kw">mutate</span>(<span class="dt">Infect_risk =</span> Infected <span class="op">/</span><span class="st"> </span>pop)</span></code></pre></div>
</div>
</div>
<div id="reshaping-data" class="section level2">
<h2><span class="header-section-number">3.6</span> Reshaping Data</h2>
<p>Sometimes, we want to convert data from a wide format to a long format. Many functions in R expect data to be in a long format rather than a wide format. Programs like SPSS, however, often use wide-formatted data. Take the dataset I.state for example, the column names “XYYYY.MM.DD” are not names of variables, but values of a variable, which contains the values of cumulative infected count.<br />
We need to pivot the column names into new variables.</p>
<p>There are two sets of methods that are explained below:</p>
<ul>
<li><p><code>gather()</code> and <code>spread()</code> from the <code>tidyr</code> package. This is a newer interface to the <code>reshape2</code> package.</p></li>
<li><p><code>pivot_longer</code> and <code>pivot_wider</code> from the <code>tidyr</code> package.</p></li>
</ul>
<p>Many other methods aren’t covered here since they are not as easy to use.</p>
<div id="from-wide-to-long" class="section level3">
<h3><span class="header-section-number">3.6.1</span> From wide to long</h3>
<p>Below we would like to change the data <code>I.state</code> from wide format to long format.</p>
<div class="sourceCode" id="cb54"><pre class="sourceCode r"><code class="sourceCode r"><span id="cb54-1"><a href="dplyr.html#cb54-1"></a><span class="kw">library</span>(slid)</span>
<span id="cb54-2"><a href="dplyr.html#cb54-2"></a><span class="kw">data</span>(I.state)</span>
<span id="cb54-3"><a href="dplyr.html#cb54-3"></a><span class="kw">names</span>(I.state)</span></code></pre></div>
<ol style="list-style-type: decimal">
<li>Use <code>gather(data, key, value, ...)</code></li>
</ol>
<ul>
<li><code>data</code> = the dataframe you want to morph from wide to long</li>
<li><code>key</code> = the name of the new column that is levels of what is represented in the wide format as many columns</li>
<li><code>value</code> = the name of the column that will contain the values</li>
<li><code>...</code> = columns to gather, or leave (use -column to gather all except that one)</li>
</ul>
<p>The <code>gather</code> functions are nicely illustrated in RStudio’s [Data wrangling cheatsheet][<a href="https://rstudio.com/wp-content/uploads/2015/02/data-wrangling-cheatsheet.pdf" class="uri">https://rstudio.com/wp-content/uploads/2015/02/data-wrangling-cheatsheet.pdf</a>] as shown in Figure <a href="dplyr.html#fig:gather">3.6</a>.</p>
<div class="figure" style="text-align: center"><span id="fig:gather"></span>
<img src="figures/gather.png" alt="An illustration of `gather` function." width="50%" />
<p class="caption">
Figure 3.6: An illustration of <code>gather</code> function.
</p>
</div>
<div class="sourceCode" id="cb55"><pre class="sourceCode r"><code class="sourceCode r"><span id="cb55-1"><a href="dplyr.html#cb55-1"></a><span class="co"># method 1</span></span>
<span id="cb55-2"><a href="dplyr.html#cb55-2"></a>I.state.wide &lt;-<span class="st"> </span>I.state </span>
<span id="cb55-3"><a href="dplyr.html#cb55-3"></a><span class="kw">dim</span>(I.state.wide)  </span></code></pre></div>
<pre><code>## [1]  49 326</code></pre>
<div class="sourceCode" id="cb57"><pre class="sourceCode r"><code class="sourceCode r"><span id="cb57-1"><a href="dplyr.html#cb57-1"></a>I.state.long &lt;-<span class="st"> </span><span class="kw">gather</span>(I.state.wide, DATE, Infected, </span>
<span id="cb57-2"><a href="dplyr.html#cb57-2"></a>X2020.<span class="fl">12.11</span><span class="op">:</span>X2020.<span class="fl">01.22</span>, <span class="dt">factor_key =</span> <span class="ot">TRUE</span>) <span class="op">%&gt;%</span><span class="st"> </span></span>
<span id="cb57-3"><a href="dplyr.html#cb57-3"></a><span class="st">                       </span><span class="kw">arrange</span>(State)</span>
<span id="cb57-4"><a href="dplyr.html#cb57-4"></a><span class="kw">dim</span>(I.state.long)</span></code></pre></div>
<pre><code>## [1] 15925     3</code></pre>
<ol start="2" style="list-style-type: decimal">
<li>Use <code>pivot_longer()</code></li>
</ol>
<p>The function <code>pivot_longer()</code> is an updated approach to <code>gather()</code>, designed to be both simpler to use and to handle more use cases. It is recommended to use <code>pivot_longer()</code> for new code; <code>gather()</code> isn’t going away but is no longer under active development.</p>
<div class="sourceCode" id="cb59"><pre class="sourceCode r"><code class="sourceCode r"><span id="cb59-1"><a href="dplyr.html#cb59-1"></a><span class="co"># method 2</span></span>
<span id="cb59-2"><a href="dplyr.html#cb59-2"></a>I.state.wide &lt;-<span class="st"> </span>I.state </span>
<span id="cb59-3"><a href="dplyr.html#cb59-3"></a><span class="kw">dim</span>(I.state.wide) </span></code></pre></div>
<pre><code>## [1]  49 326</code></pre>
<div class="sourceCode" id="cb61"><pre class="sourceCode r"><code class="sourceCode r"><span id="cb61-1"><a href="dplyr.html#cb61-1"></a>I.state.long &lt;-<span class="st"> </span>I.state.wide <span class="op">%&gt;%</span></span>
<span id="cb61-2"><a href="dplyr.html#cb61-2"></a><span class="st">  </span><span class="kw">pivot_longer</span>(X2020.<span class="fl">12.11</span><span class="op">:</span>X2020.<span class="fl">01.22</span>, <span class="dt">names_to =</span> <span class="st">&quot;DATE&quot;</span>, </span>
<span id="cb61-3"><a href="dplyr.html#cb61-3"></a>  <span class="dt">values_to =</span> <span class="st">&quot;Infected&quot;</span>)</span></code></pre></div>
<p>See more complicated examples from the <a href="https://tidyr.tidyverse.org/reference/pivot_longer.html">introduction of ‘tidyr’ package</a>.</p>
</div>
<div id="from-long-to-wide" class="section level3">
<h3><span class="header-section-number">3.6.2</span> From long to wide</h3>
<p>Now let’s change the data back to the wide format, and we can use <code>spread</code>.</p>
<ol style="list-style-type: decimal">
<li>Use <code>Use spread(data, key, value)</code></li>
</ol>
<ul>
<li><code>data</code> = the dataframe you want to morph from long to wide</li>
<li><code>key</code> = the name of the column that contains the key</li>
<li><code>value</code> = the name of the column contains the values</li>
</ul>
<p>The <code>spread</code> functions are nicely illustrated in RStudio’s [Data wrangling cheatsheet][<a href="https://rstudio.com/wp-content/uploads/2015/02/data-wrangling-cheatsheet.pdf" class="uri">https://rstudio.com/wp-content/uploads/2015/02/data-wrangling-cheatsheet.pdf</a>] as shown in Figure <a href="dplyr.html#fig:spread">3.7</a>.</p>
<div class="figure" style="text-align: center"><span id="fig:spread"></span>
<img src="figures/spread.png" alt="An illustration of `spread` function." width="50%" />
<p class="caption">
Figure 3.7: An illustration of <code>spread</code> function.
</p>
</div>
<div class="sourceCode" id="cb62"><pre class="sourceCode r"><code class="sourceCode r"><span id="cb62-1"><a href="dplyr.html#cb62-1"></a><span class="co"># method 1</span></span>
<span id="cb62-2"><a href="dplyr.html#cb62-2"></a>I.state.wide &lt;-<span class="st"> </span><span class="kw">spread</span>(I.state.long, DATE, Infected)</span>
<span id="cb62-3"><a href="dplyr.html#cb62-3"></a><span class="kw">dim</span>(I.state.wide)</span></code></pre></div>
<pre><code>## [1]  49 326</code></pre>
<ol start="2" style="list-style-type: decimal">
<li>Use <code>pivot_wider()</code></li>
</ol>
<p>We can also use the function <code>pivot_wider()</code>, which “widens” data, increasing the number of columns and decreasing the number of rows. The inverse transformation is <code>pivot_longer()</code>.</p>
<div class="sourceCode" id="cb64"><pre class="sourceCode r"><code class="sourceCode r"><span id="cb64-1"><a href="dplyr.html#cb64-1"></a><span class="co"># method 2</span></span>
<span id="cb64-2"><a href="dplyr.html#cb64-2"></a>I.state.wide &lt;-<span class="st"> </span>I.state.long <span class="op">%&gt;%</span></span>
<span id="cb64-3"><a href="dplyr.html#cb64-3"></a><span class="kw">pivot_wider</span>(<span class="dt">names_from =</span> DATE, <span class="dt">values_from =</span> Infected)</span>
<span id="cb64-4"><a href="dplyr.html#cb64-4"></a><span class="kw">dim</span>(I.state.wide)</span></code></pre></div>
<pre><code>## [1]  49 326</code></pre>
<p>See more complicated examples from the <a href="https://tidyr.tidyverse.org/reference/pivot_longer.html">introduction of ‘tidyr’ package</a>.</p>
</div>
</div>
<div id="exercises" class="section level2">
<h2><span class="header-section-number">3.7</span> Exercises</h2>
<ol style="list-style-type: decimal">
<li>We are going to explore the basic data manipulation verbs of <code>dplyr</code> using <code>I.county</code>. Install the github R package <code>slid</code>.</li>
</ol>
<div class="sourceCode" id="cb66"><pre class="sourceCode r"><code class="sourceCode r"><span id="cb66-1"><a href="dplyr.html#cb66-1"></a><span class="kw">library</span>(slid)</span>
<span id="cb66-2"><a href="dplyr.html#cb66-2"></a><span class="kw">data</span>(I.county)</span></code></pre></div>
<ol style="list-style-type: lower-alpha">
<li><p>Obtain a subset of the <code>I.county</code> by selecting <code>ID</code>, <code>County</code>, <code>State</code>.</p></li>
<li><p>Obtain a subset of the <code>I.county</code> by including all counties in California.</p></li>
<li><p>Obtain a subset of the <code>I.county</code> by including all counties that in the midwest states.</p></li>
</ol>
<div class="sourceCode" id="cb67"><pre class="sourceCode r"><code class="sourceCode r"><span id="cb67-1"><a href="dplyr.html#cb67-1"></a>Midwest  =<span class="st"> </span><span class="kw">c</span>( <span class="st">&quot;Illinois&quot;</span>, <span class="st">&quot;Michigan&quot;</span>, <span class="st">&quot;Indiana&quot;</span> ,<span class="st">&quot;Ohio&quot;</span>, </span>
<span id="cb67-2"><a href="dplyr.html#cb67-2"></a><span class="st">&quot;Wisconsin&quot;</span>, <span class="st">&quot;Iowa&quot;</span>, <span class="st">&quot;Kansas&quot;</span>, <span class="st">&quot;Minnesota&quot;</span>, <span class="st">&quot;Missouri&quot;</span>, </span>
<span id="cb67-3"><a href="dplyr.html#cb67-3"></a><span class="st">&quot;Nebraska&quot;</span> , <span class="st">&quot;SouthDakota&quot;</span> , <span class="st">&quot;NorthDakota&quot;</span>)</span></code></pre></div>
<ol start="4" style="list-style-type: lower-alpha">
<li><p>Obtain a subset of the <code>I.county</code> by including the top ten counties from each midwest state based on the cumulative infected count on December 11, 2020.</p></li>
<li><p>Obtain a subset of the <code>I.county</code> by including all the counties California with the culumative infected counts up till Judy 31, 2020.</p></li>
<li><p>Create new columns of <code>I.county</code> by taking the logarithm of each of the count column.</p></li>
<li><p>Sort the cumulative infected count on December 11, 2020 to find the state with the largest cumulative infected count.</p></li>
</ol>
<ol start="2" style="list-style-type: decimal">
<li><p>Downlad the data <code>pop.county</code> from the github R package <code>slid</code>.</p>
<ol style="list-style-type: lower-alpha">
<li><p>Join the tables of <code>I.county</code> and <code>pop.county</code> using <code>inner_join</code>, <code>left_join</code> , <code>right_join</code>, <code>full_join</code>. Do you get same or different tables?</p></li>
<li><p>Based on the <code>inner_join</code> create a table and name it as <code>I.pop.county</code>, then create new columns of <code>I.pop.county</code> by dividing each of the count column by the popolation in the corresponding county, for example, <code>risk.2020.12.11 = X.2020.12.11 / pop</code>.</p></li>
<li><p>For each state, list the top ten county with the highest risk based on <code>risk.2020.12.11</code></p></li>
</ol></li>
</ol>

</div>
</div>
<h3>References</h3>
<div id="refs" class="references">
<div id="ref-wickham2016r">
<p>Wickham, Hadley, and Garrett Grolemund. 2016. <em>R for Data Science: Import, Tidy, Transform, Visualize, and Model Data</em>. " O’Reilly Media, Inc.".</p>
</div>
</div>
            </section>

          </div>
        </div>
      </div>
<a href="intro.html" class="navigation navigation-prev " aria-label="Previous page"><i class="fa fa-angle-left"></i></a>
<a href="ggplot2.html" class="navigation navigation-next " aria-label="Next page"><i class="fa fa-angle-right"></i></a>
    </div>
  </div>
<script src="libs/gitbook-2.6.7/js/app.min.js"></script>
<script src="libs/gitbook-2.6.7/js/lunr.js"></script>
<script src="libs/gitbook-2.6.7/js/clipboard.min.js"></script>
<script src="libs/gitbook-2.6.7/js/plugin-search.js"></script>
<script src="libs/gitbook-2.6.7/js/plugin-sharing.js"></script>
<script src="libs/gitbook-2.6.7/js/plugin-fontsettings.js"></script>
<script src="libs/gitbook-2.6.7/js/plugin-bookdown.js"></script>
<script src="libs/gitbook-2.6.7/js/jquery.highlight.js"></script>
<script src="libs/gitbook-2.6.7/js/plugin-clipboard.js"></script>
<script>
gitbook.require(["gitbook"], function(gitbook) {
gitbook.start({
"sharing": {
"github": false,
"facebook": true,
"twitter": true,
"linkedin": false,
"weibo": false,
"instapaper": false,
"vk": false,
"all": ["facebook", "twitter", "linkedin", "weibo", "instapaper"]
},
"fontsettings": {
"theme": "white",
"family": "sans",
"size": 2
},
"edit": {
"link": null,
"text": null
},
"history": {
"link": null,
"text": null
},
"view": {
"link": null,
"text": null
},
"download": ["SLID_book.pdf", "SLID_book.epub"],
"toc": {
"collapse": "subsection"
}
});
});
</script>

<!-- dynamically load mathjax for compatibility with self-contained -->
<script>
  (function () {
    var script = document.createElement("script");
    script.type = "text/javascript";
    var src = "true";
    if (src === "" || src === "true") src = "https://mathjax.rstudio.com/latest/MathJax.js?config=TeX-MML-AM_CHTML";
    if (location.protocol !== "file:")
      if (/^https?:/.test(src))
        src = src.replace(/^https?:/, '');
    script.src = src;
    document.getElementsByTagName("head")[0].appendChild(script);
  })();
</script>
</body>

</html>
