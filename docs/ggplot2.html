<!DOCTYPE html>
<html lang="" xml:lang="">
<head>

  <meta charset="utf-8" />
  <meta http-equiv="X-UA-Compatible" content="IE=edge" />
  <title>Chapter 4 Data Visualization with ggplot2 | Statistical Learning of Infectious Disease Data Analytics</title>
  <meta name="description" content="The use of statistical models to understand infectious disease dynamics has a very rich history in epidemiology. This book introduces modern statistical models and state-of-the-art learning methods to analyze infectious disease data. Many of the key approaches, examples and case studies will be presented. The primary emphasis will be interpretation, inference and hands-on data analyses. This course also provides practical concepts and R computing skills to perform infectious disease data analysis and visualization." />
  <meta name="generator" content="bookdown 0.20 and GitBook 2.6.7" />

  <meta property="og:title" content="Chapter 4 Data Visualization with ggplot2 | Statistical Learning of Infectious Disease Data Analytics" />
  <meta property="og:type" content="book" />
  
  
  <meta property="og:description" content="The use of statistical models to understand infectious disease dynamics has a very rich history in epidemiology. This book introduces modern statistical models and state-of-the-art learning methods to analyze infectious disease data. Many of the key approaches, examples and case studies will be presented. The primary emphasis will be interpretation, inference and hands-on data analyses. This course also provides practical concepts and R computing skills to perform infectious disease data analysis and visualization." />
  <meta name="github-repo" content="rstudio/bookdown-demo" />

  <meta name="twitter:card" content="summary" />
  <meta name="twitter:title" content="Chapter 4 Data Visualization with ggplot2 | Statistical Learning of Infectious Disease Data Analytics" />
  
  <meta name="twitter:description" content="The use of statistical models to understand infectious disease dynamics has a very rich history in epidemiology. This book introduces modern statistical models and state-of-the-art learning methods to analyze infectious disease data. Many of the key approaches, examples and case studies will be presented. The primary emphasis will be interpretation, inference and hands-on data analyses. This course also provides practical concepts and R computing skills to perform infectious disease data analysis and visualization." />
  

<meta name="author" content="Lily Wang" />


<meta name="date" content="2021-02-27" />

  <meta name="viewport" content="width=device-width, initial-scale=1" />
  <meta name="apple-mobile-web-app-capable" content="yes" />
  <meta name="apple-mobile-web-app-status-bar-style" content="black" />
  
  
<link rel="prev" href="dplyr.html"/>
<link rel="next" href="plotly.html"/>
<script src="libs/jquery-2.2.3/jquery.min.js"></script>
<link href="libs/gitbook-2.6.7/css/style.css" rel="stylesheet" />
<link href="libs/gitbook-2.6.7/css/plugin-table.css" rel="stylesheet" />
<link href="libs/gitbook-2.6.7/css/plugin-bookdown.css" rel="stylesheet" />
<link href="libs/gitbook-2.6.7/css/plugin-highlight.css" rel="stylesheet" />
<link href="libs/gitbook-2.6.7/css/plugin-search.css" rel="stylesheet" />
<link href="libs/gitbook-2.6.7/css/plugin-fontsettings.css" rel="stylesheet" />
<link href="libs/gitbook-2.6.7/css/plugin-clipboard.css" rel="stylesheet" />









<script src="libs/accessible-code-block-0.0.1/empty-anchor.js"></script>
<script src="libs/htmlwidgets-1.5.1/htmlwidgets.js"></script>
<script src="libs/plotly-binding-4.9.2.1/plotly.js"></script>
<script src="libs/typedarray-0.1/typedarray.min.js"></script>
<link href="libs/crosstalk-1.1.0.1/css/crosstalk.css" rel="stylesheet" />
<script src="libs/crosstalk-1.1.0.1/js/crosstalk.min.js"></script>
<link href="libs/plotly-htmlwidgets-css-1.52.2/plotly-htmlwidgets.css" rel="stylesheet" />
<script src="libs/plotly-main-1.52.2/plotly-latest.min.js"></script>
<link href="libs/leaflet-1.3.1/leaflet.css" rel="stylesheet" />
<script src="libs/leaflet-1.3.1/leaflet.js"></script>
<link href="libs/leafletfix-1.0.0/leafletfix.css" rel="stylesheet" />
<script src="libs/Proj4Leaflet-1.0.1/proj4-compressed.js"></script>
<script src="libs/Proj4Leaflet-1.0.1/proj4leaflet.js"></script>
<link href="libs/rstudio_leaflet-1.3.1/rstudio_leaflet.css" rel="stylesheet" />
<script src="libs/leaflet-binding-2.0.3/leaflet.js"></script>


<style type="text/css">
code.sourceCode > span { display: inline-block; line-height: 1.25; }
code.sourceCode > span { color: inherit; text-decoration: inherit; }
code.sourceCode > span:empty { height: 1.2em; }
.sourceCode { overflow: visible; }
code.sourceCode { white-space: pre; position: relative; }
pre.sourceCode { margin: 0; }
@media screen {
div.sourceCode { overflow: auto; }
}
@media print {
code.sourceCode { white-space: pre-wrap; }
code.sourceCode > span { text-indent: -5em; padding-left: 5em; }
}
pre.numberSource code
  { counter-reset: source-line 0; }
pre.numberSource code > span
  { position: relative; left: -4em; counter-increment: source-line; }
pre.numberSource code > span > a:first-child::before
  { content: counter(source-line);
    position: relative; left: -1em; text-align: right; vertical-align: baseline;
    border: none; display: inline-block;
    -webkit-touch-callout: none; -webkit-user-select: none;
    -khtml-user-select: none; -moz-user-select: none;
    -ms-user-select: none; user-select: none;
    padding: 0 4px; width: 4em;
    color: #aaaaaa;
  }
pre.numberSource { margin-left: 3em; border-left: 1px solid #aaaaaa;  padding-left: 4px; }
div.sourceCode
  {   }
@media screen {
code.sourceCode > span > a:first-child::before { text-decoration: underline; }
}
code span.al { color: #ff0000; font-weight: bold; } /* Alert */
code span.an { color: #60a0b0; font-weight: bold; font-style: italic; } /* Annotation */
code span.at { color: #7d9029; } /* Attribute */
code span.bn { color: #40a070; } /* BaseN */
code span.bu { } /* BuiltIn */
code span.cf { color: #007020; font-weight: bold; } /* ControlFlow */
code span.ch { color: #4070a0; } /* Char */
code span.cn { color: #880000; } /* Constant */
code span.co { color: #60a0b0; font-style: italic; } /* Comment */
code span.cv { color: #60a0b0; font-weight: bold; font-style: italic; } /* CommentVar */
code span.do { color: #ba2121; font-style: italic; } /* Documentation */
code span.dt { color: #902000; } /* DataType */
code span.dv { color: #40a070; } /* DecVal */
code span.er { color: #ff0000; font-weight: bold; } /* Error */
code span.ex { } /* Extension */
code span.fl { color: #40a070; } /* Float */
code span.fu { color: #06287e; } /* Function */
code span.im { } /* Import */
code span.in { color: #60a0b0; font-weight: bold; font-style: italic; } /* Information */
code span.kw { color: #007020; font-weight: bold; } /* Keyword */
code span.op { color: #666666; } /* Operator */
code span.ot { color: #007020; } /* Other */
code span.pp { color: #bc7a00; } /* Preprocessor */
code span.sc { color: #4070a0; } /* SpecialChar */
code span.ss { color: #bb6688; } /* SpecialString */
code span.st { color: #4070a0; } /* String */
code span.va { color: #19177c; } /* Variable */
code span.vs { color: #4070a0; } /* VerbatimString */
code span.wa { color: #60a0b0; font-weight: bold; font-style: italic; } /* Warning */
</style>

<link rel="stylesheet" href="style.css" type="text/css" />
</head>

<body>



  <div class="book without-animation with-summary font-size-2 font-family-1" data-basepath=".">

    <div class="book-summary">
      <nav role="navigation">

<ul class="summary">
<li><a href="./">A Minimal Book Example</a></li>

<li class="divider"></li>
<li class="chapter" data-level="1" data-path="index.html"><a href="index.html"><i class="fa fa-check"></i><b>1</b> Preface</a><ul>
<li class="chapter" data-level="1.1" data-path="index.html"><a href="index.html#data-sets-used-in-labs-and-exercises"><i class="fa fa-check"></i><b>1.1</b> Data Sets Used in Labs and Exercises</a></li>
<li class="chapter" data-level="1.2" data-path="index.html"><a href="index.html#acknowledgements"><i class="fa fa-check"></i><b>1.2</b> Acknowledgements</a></li>
<li class="chapter" data-level="1.3" data-path="index.html"><a href="index.html#about-the-author"><i class="fa fa-check"></i><b>1.3</b> About the Author</a></li>
</ul></li>
<li class="chapter" data-level="2" data-path="intro.html"><a href="intro.html"><i class="fa fa-check"></i><b>2</b> Introduction</a><ul>
<li class="chapter" data-level="2.1" data-path="intro.html"><a href="intro.html#aims-and-scope-of-this-book"><i class="fa fa-check"></i><b>2.1</b> Aims and Scope of This Book</a></li>
<li class="chapter" data-level="2.2" data-path="intro.html"><a href="intro.html#the-structure-of-this-book"><i class="fa fa-check"></i><b>2.2</b> The Structure of This Book</a><ul>
<li class="chapter" data-level="2.2.1" data-path="intro.html"><a href="intro.html#infectious-disease-data"><i class="fa fa-check"></i><b>2.2.1</b> Infectious disease data</a></li>
<li class="chapter" data-level="2.2.2" data-path="intro.html"><a href="intro.html#basic-characteristics-of-the-infection-process"><i class="fa fa-check"></i><b>2.2.2</b> Basic characteristics of the infection process</a></li>
<li class="chapter" data-level="2.2.3" data-path="intro.html"><a href="intro.html#data-visualization"><i class="fa fa-check"></i><b>2.2.3</b> Data visualization</a></li>
<li class="chapter" data-level="2.2.4" data-path="intro.html"><a href="intro.html#modeling-and-forecasting"><i class="fa fa-check"></i><b>2.2.4</b> Modeling and Forecasting</a></li>
</ul></li>
</ul></li>
<li class="chapter" data-level="3" data-path="dplyr.html"><a href="dplyr.html"><i class="fa fa-check"></i><b>3</b> Data Wrangling with <code>dplyr</code> and <code>tidyr</code></a><ul>
<li class="chapter" data-level="3.1" data-path="dplyr.html"><a href="dplyr.html#learning-dplyr"><i class="fa fa-check"></i><b>3.1</b> Learning <code>dplyr</code></a><ul>
<li class="chapter" data-level="3.1.1" data-path="dplyr.html"><a href="dplyr.html#tibbles"><i class="fa fa-check"></i><b>3.1.1</b> Tibbles</a></li>
<li class="chapter" data-level="3.1.2" data-path="dplyr.html"><a href="dplyr.html#import-data"><i class="fa fa-check"></i><b>3.1.2</b> Import data</a></li>
<li class="chapter" data-level="3.1.3" data-path="dplyr.html"><a href="dplyr.html#common-dplyr-functions"><i class="fa fa-check"></i><b>3.1.3</b> Common <code>dplyr</code> functions</a></li>
</ul></li>
<li class="chapter" data-level="3.2" data-path="dplyr.html"><a href="dplyr.html#selecting-columns-and-filtering-rows"><i class="fa fa-check"></i><b>3.2</b> Selecting Columns and Filtering Rows</a><ul>
<li class="chapter" data-level="3.2.1" data-path="dplyr.html"><a href="dplyr.html#subset-variables-columns"><i class="fa fa-check"></i><b>3.2.1</b> Subset Variables (Columns)</a></li>
<li class="chapter" data-level="3.2.2" data-path="dplyr.html"><a href="dplyr.html#subset-observations-rows"><i class="fa fa-check"></i><b>3.2.2</b> Subset Observations (Rows)</a></li>
<li class="chapter" data-level="3.2.3" data-path="dplyr.html"><a href="dplyr.html#pipes"><i class="fa fa-check"></i><b>3.2.3</b> Pipes</a></li>
<li class="chapter" data-level="3.2.4" data-path="dplyr.html"><a href="dplyr.html#select-and-order-top-n-entries-by-group-if-grouped-data."><i class="fa fa-check"></i><b>3.2.4</b> Select and order top n entries (by group if grouped data).</a></li>
</ul></li>
<li class="chapter" data-level="3.3" data-path="dplyr.html"><a href="dplyr.html#make-new-variables-mutate"><i class="fa fa-check"></i><b>3.3</b> Make New Variables: Mutate</a></li>
<li class="chapter" data-level="3.4" data-path="dplyr.html"><a href="dplyr.html#summarize-data"><i class="fa fa-check"></i><b>3.4</b> Summarize Data</a></li>
<li class="chapter" data-level="3.5" data-path="dplyr.html"><a href="dplyr.html#combine-data-sets"><i class="fa fa-check"></i><b>3.5</b> Combine Data Sets</a><ul>
<li class="chapter" data-level="3.5.1" data-path="dplyr.html"><a href="dplyr.html#the-join-family"><i class="fa fa-check"></i><b>3.5.1</b> The join family</a></li>
<li class="chapter" data-level="3.5.2" data-path="dplyr.html"><a href="dplyr.html#toy-examples-with-joins"><i class="fa fa-check"></i><b>3.5.2</b> Toy examples with joins</a></li>
<li class="chapter" data-level="3.5.3" data-path="dplyr.html"><a href="dplyr.html#practice-with-joins-for-real-data"><i class="fa fa-check"></i><b>3.5.3</b> Practice with joins for real data</a></li>
</ul></li>
<li class="chapter" data-level="3.6" data-path="dplyr.html"><a href="dplyr.html#reshaping-data"><i class="fa fa-check"></i><b>3.6</b> Reshaping Data</a><ul>
<li class="chapter" data-level="3.6.1" data-path="dplyr.html"><a href="dplyr.html#from-wide-to-long"><i class="fa fa-check"></i><b>3.6.1</b> From wide to long</a></li>
<li class="chapter" data-level="3.6.2" data-path="dplyr.html"><a href="dplyr.html#from-long-to-wide"><i class="fa fa-check"></i><b>3.6.2</b> From long to wide</a></li>
</ul></li>
<li class="chapter" data-level="3.7" data-path="dplyr.html"><a href="dplyr.html#exercises"><i class="fa fa-check"></i><b>3.7</b> Exercises</a></li>
</ul></li>
<li class="chapter" data-level="4" data-path="ggplot2.html"><a href="ggplot2.html"><i class="fa fa-check"></i><b>4</b> Data Visualization with ggplot2</a><ul>
<li class="chapter" data-level="4.1" data-path="ggplot2.html"><a href="ggplot2.html#introduction"><i class="fa fa-check"></i><b>4.1</b> Introduction</a></li>
<li class="chapter" data-level="4.2" data-path="ggplot2.html"><a href="ggplot2.html#types-of-variables-and-preparation"><i class="fa fa-check"></i><b>4.2</b> Types of Variables and Preparation</a><ul>
<li class="chapter" data-level="4.2.1" data-path="ggplot2.html"><a href="ggplot2.html#types-of-variables"><i class="fa fa-check"></i><b>4.2.1</b> Types of Variables</a></li>
<li class="chapter" data-level="4.2.2" data-path="ggplot2.html"><a href="ggplot2.html#rules-for-graph-designing"><i class="fa fa-check"></i><b>4.2.2</b> Rules for Graph Designing</a></li>
<li class="chapter" data-level="4.2.3" data-path="ggplot2.html"><a href="ggplot2.html#installing-packages-and-loading-data"><i class="fa fa-check"></i><b>4.2.3</b> Installing packages and loading data</a></li>
<li class="chapter" data-level="4.2.4" data-path="ggplot2.html"><a href="ggplot2.html#your-first-scatterplot"><i class="fa fa-check"></i><b>4.2.4</b> Your first scatterplot</a></li>
</ul></li>
<li class="chapter" data-level="4.3" data-path="ggplot2.html"><a href="ggplot2.html#position-scales-and-axes"><i class="fa fa-check"></i><b>4.3</b> Position Scales and Axes</a><ul>
<li class="chapter" data-level="4.3.1" data-path="ggplot2.html"><a href="ggplot2.html#change-the-labels-of-the-axis-using-xlab-and-ylab"><i class="fa fa-check"></i><b>4.3.1</b> Change the labels of the axis using <code>xlab()</code> and <code>ylab()</code></a></li>
<li class="chapter" data-level="4.3.2" data-path="ggplot2.html"><a href="ggplot2.html#change-the-range-of-the-axis-using-xlim-and-ylim"><i class="fa fa-check"></i><b>4.3.2</b> Change the range of the axis using <code>xlim()</code> and <code>ylim()</code></a></li>
</ul></li>
<li class="chapter" data-level="4.4" data-path="ggplot2.html"><a href="ggplot2.html#color-scales-and-size-of-geom_points"><i class="fa fa-check"></i><b>4.4</b> Color Scales and Size of <code>geom_points()</code></a><ul>
<li class="chapter" data-level="4.4.1" data-path="ggplot2.html"><a href="ggplot2.html#change-the-color-of-all-points"><i class="fa fa-check"></i><b>4.4.1</b> Change the color of all points</a></li>
<li class="chapter" data-level="4.4.2" data-path="ggplot2.html"><a href="ggplot2.html#color-the-observations-by-the-value-of-a-feature"><i class="fa fa-check"></i><b>4.4.2</b> Color the observations by the value of a feature</a></li>
<li class="chapter" data-level="4.4.3" data-path="ggplot2.html"><a href="ggplot2.html#change-the-color-palette"><i class="fa fa-check"></i><b>4.4.3</b> Change the color palette</a></li>
<li class="chapter" data-level="4.4.4" data-path="ggplot2.html"><a href="ggplot2.html#change-the-size-by-the-value-of-a-feature"><i class="fa fa-check"></i><b>4.4.4</b> Change the size by the value of a feature</a></li>
</ul></li>
<li class="chapter" data-level="4.5" data-path="ggplot2.html"><a href="ggplot2.html#individual-geoms"><i class="fa fa-check"></i><b>4.5</b> Individual geoms</a><ul>
<li class="chapter" data-level="4.5.1" data-path="ggplot2.html"><a href="ggplot2.html#histogram"><i class="fa fa-check"></i><b>4.5.1</b> Histogram</a></li>
<li class="chapter" data-level="4.5.2" data-path="ggplot2.html"><a href="ggplot2.html#bar-chart"><i class="fa fa-check"></i><b>4.5.2</b> Bar chart</a></li>
<li class="chapter" data-level="4.5.3" data-path="ggplot2.html"><a href="ggplot2.html#default-bar-chart"><i class="fa fa-check"></i><b>4.5.3</b> Default bar chart</a></li>
<li class="chapter" data-level="4.5.4" data-path="ggplot2.html"><a href="ggplot2.html#bar-chart-with-assigned-value"><i class="fa fa-check"></i><b>4.5.4</b> Bar chart with assigned value</a></li>
<li class="chapter" data-level="4.5.5" data-path="ggplot2.html"><a href="ggplot2.html#legend"><i class="fa fa-check"></i><b>4.5.5</b> Legend</a></li>
<li class="chapter" data-level="4.5.6" data-path="ggplot2.html"><a href="ggplot2.html#boxplots-jittering-and-violin-plots"><i class="fa fa-check"></i><b>4.5.6</b> Boxplots, jittering and violin plots</a></li>
</ul></li>
<li class="chapter" data-level="4.6" data-path="ggplot2.html"><a href="ggplot2.html#collective-geoms"><i class="fa fa-check"></i><b>4.6</b> Collective geoms</a><ul>
<li class="chapter" data-level="4.6.1" data-path="ggplot2.html"><a href="ggplot2.html#smoother"><i class="fa fa-check"></i><b>4.6.1</b> Smoother</a></li>
</ul></li>
<li class="chapter" data-level="4.7" data-path="ggplot2.html"><a href="ggplot2.html#time-series"><i class="fa fa-check"></i><b>4.7</b> Time Series</a><ul>
<li class="chapter" data-level="4.7.1" data-path="ggplot2.html"><a href="ggplot2.html#basic-line-plots"><i class="fa fa-check"></i><b>4.7.1</b> Basic line plots</a></li>
<li class="chapter" data-level="4.7.2" data-path="ggplot2.html"><a href="ggplot2.html#add-a-second-line"><i class="fa fa-check"></i><b>4.7.2</b> Add a second line</a></li>
<li class="chapter" data-level="4.7.3" data-path="ggplot2.html"><a href="ggplot2.html#add-ribbons"><i class="fa fa-check"></i><b>4.7.3</b> Add ribbons</a></li>
<li class="chapter" data-level="4.7.4" data-path="ggplot2.html"><a href="ggplot2.html#adjust-the-scale-of-time-axis"><i class="fa fa-check"></i><b>4.7.4</b> Adjust the scale of time axis</a></li>
<li class="chapter" data-level="4.7.5" data-path="ggplot2.html"><a href="ggplot2.html#add-annotations"><i class="fa fa-check"></i><b>4.7.5</b> Add annotations</a></li>
</ul></li>
<li class="chapter" data-level="4.8" data-path="ggplot2.html"><a href="ggplot2.html#maps"><i class="fa fa-check"></i><b>4.8</b> Maps</a><ul>
<li class="chapter" data-level="4.8.1" data-path="ggplot2.html"><a href="ggplot2.html#making-a-base-map"><i class="fa fa-check"></i><b>4.8.1</b> Making a base map</a></li>
<li class="chapter" data-level="4.8.2" data-path="ggplot2.html"><a href="ggplot2.html#customizing-choropleth-map"><i class="fa fa-check"></i><b>4.8.2</b> Customizing <code>choropleth</code> map</a></li>
<li class="chapter" data-level="4.8.3" data-path="ggplot2.html"><a href="ggplot2.html#overlay-polygon-maps"><i class="fa fa-check"></i><b>4.8.3</b> Overlay polygon maps</a></li>
</ul></li>
<li class="chapter" data-level="4.9" data-path="ggplot2.html"><a href="ggplot2.html#arranging-plots"><i class="fa fa-check"></i><b>4.9</b> Arranging Plots</a><ul>
<li class="chapter" data-level="4.9.1" data-path="ggplot2.html"><a href="ggplot2.html#facet"><i class="fa fa-check"></i><b>4.9.1</b> Facet</a></li>
<li class="chapter" data-level="4.9.2" data-path="ggplot2.html"><a href="ggplot2.html#combining-plots-using-patchwork-package"><i class="fa fa-check"></i><b>4.9.2</b> Combining plots using <code>patchwork</code> package</a></li>
</ul></li>
<li class="chapter" data-level="4.10" data-path="ggplot2.html"><a href="ggplot2.html#output"><i class="fa fa-check"></i><b>4.10</b> Output</a><ul>
<li class="chapter" data-level="4.10.1" data-path="ggplot2.html"><a href="ggplot2.html#save-in-figure-format"><i class="fa fa-check"></i><b>4.10.1</b> Save in figure format</a></li>
<li class="chapter" data-level="4.10.2" data-path="ggplot2.html"><a href="ggplot2.html#save-in-rds-format"><i class="fa fa-check"></i><b>4.10.2</b> Save in RDS format</a></li>
</ul></li>
<li class="chapter" data-level="4.11" data-path="dplyr.html"><a href="dplyr.html#exercises"><i class="fa fa-check"></i><b>4.11</b> Exercises</a></li>
</ul></li>
<li class="chapter" data-level="5" data-path="plotly.html"><a href="plotly.html"><i class="fa fa-check"></i><b>5</b> Interactive Visualization</a><ul>
<li class="chapter" data-level="5.1" data-path="plotly.html"><a href="plotly.html#an-introduction"><i class="fa fa-check"></i><b>5.1</b> An Introduction</a></li>
<li class="chapter" data-level="5.2" data-path="plotly.html"><a href="plotly.html#creating-plotly-objects"><i class="fa fa-check"></i><b>5.2</b> Creating Plotly Objects</a><ul>
<li class="chapter" data-level="5.2.1" data-path="plotly.html"><a href="plotly.html#using-plot_ly-to-create-a-plotly-object"><i class="fa fa-check"></i><b>5.2.1</b> Using <code>plot_ly()</code> to create a plotly object</a></li>
<li class="chapter" data-level="5.2.2" data-path="plotly.html"><a href="plotly.html#use-dplyr-verbs-to-modify-data"><i class="fa fa-check"></i><b>5.2.2</b> Use <code>dplyr</code> verbs to modify data</a></li>
<li class="chapter" data-level="5.2.3" data-path="plotly.html"><a href="plotly.html#using-ggplotly-to-create-a-plotly-object"><i class="fa fa-check"></i><b>5.2.3</b> Using <code>ggplotly()</code> to create a <code>plotly</code> object</a></li>
</ul></li>
<li class="chapter" data-level="5.3" data-path="plotly.html"><a href="plotly.html#scatterplots-and-line-plots"><i class="fa fa-check"></i><b>5.3</b> Scatterplots and Line Plots</a><ul>
<li class="chapter" data-level="5.3.1" data-path="plotly.html"><a href="plotly.html#make-a-scatterplot"><i class="fa fa-check"></i><b>5.3.1</b> Make a scatterplot</a></li>
<li class="chapter" data-level="5.3.2" data-path="plotly.html"><a href="plotly.html#markers"><i class="fa fa-check"></i><b>5.3.2</b> Markers</a></li>
<li class="chapter" data-level="5.3.3" data-path="plotly.html"><a href="plotly.html#a-single-time-series-plot"><i class="fa fa-check"></i><b>5.3.3</b> A single time series plot</a></li>
<li class="chapter" data-level="5.3.4" data-path="plotly.html"><a href="plotly.html#hover-text-and-template"><i class="fa fa-check"></i><b>5.3.4</b> Hover text and template</a></li>
<li class="chapter" data-level="5.3.5" data-path="plotly.html"><a href="plotly.html#multiple-time-series-plots"><i class="fa fa-check"></i><b>5.3.5</b> Multiple time series plots</a></li>
<li class="chapter" data-level="5.3.6" data-path="plotly.html"><a href="plotly.html#more-features-about-the-lines"><i class="fa fa-check"></i><b>5.3.6</b> More features about the lines</a></li>
<li class="chapter" data-level="5.3.7" data-path="ggplot2.html"><a href="ggplot2.html#add-ribbons"><i class="fa fa-check"></i><b>5.3.7</b> Add ribbons</a></li>
</ul></li>
<li class="chapter" data-level="5.4" data-path="plotly.html"><a href="plotly.html#pie-charts"><i class="fa fa-check"></i><b>5.4</b> Pie Charts</a><ul>
<li class="chapter" data-level="5.4.1" data-path="plotly.html"><a href="plotly.html#draw-static-pie-charts-using-ggplot2"><i class="fa fa-check"></i><b>5.4.1</b> Draw static pie charts using ggplot2</a></li>
<li class="chapter" data-level="5.4.2" data-path="plotly.html"><a href="plotly.html#draw-interactive-pie-charts"><i class="fa fa-check"></i><b>5.4.2</b> Draw interactive pie charts</a></li>
</ul></li>
<li class="chapter" data-level="5.5" data-path="plotly.html"><a href="plotly.html#animation"><i class="fa fa-check"></i><b>5.5</b> Animation</a><ul>
<li class="chapter" data-level="5.5.1" data-path="plotly.html"><a href="plotly.html#an-animation-of-the-evolution-of-infected-vs.-death-count"><i class="fa fa-check"></i><b>5.5.1</b> An animation of the evolution of infected vs. death count</a></li>
<li class="chapter" data-level="5.5.2" data-path="plotly.html"><a href="plotly.html#an-animation-of-the-state-level-time-series-plot-of-infected-count"><i class="fa fa-check"></i><b>5.5.2</b> An animation of the state-level time series plot of infected count</a></li>
</ul></li>
<li class="chapter" data-level="5.6" data-path="plotly.html"><a href="plotly.html#saving-html"><i class="fa fa-check"></i><b>5.6</b> Saving HTML</a><ul>
<li class="chapter" data-level="5.6.1" data-path="plotly.html"><a href="plotly.html#save-as-a-standalone-html-file"><i class="fa fa-check"></i><b>5.6.1</b> Save as a standalone HTML file</a></li>
<li class="chapter" data-level="5.6.2" data-path="plotly.html"><a href="plotly.html#save-as-non-selfcontained-html-file"><i class="fa fa-check"></i><b>5.6.2</b> Save as non-selfcontained HTML file</a></li>
</ul></li>
<li class="chapter" data-level="5.7" data-path="dplyr.html"><a href="dplyr.html#exercises"><i class="fa fa-check"></i><b>5.7</b> Exercises</a></li>
</ul></li>
<li class="chapter" data-level="6" data-path="shiny.html"><a href="shiny.html"><i class="fa fa-check"></i><b>6</b> R Shiny</a><ul>
<li class="chapter" data-level="6.1" data-path="shiny.html"><a href="shiny.html#an-introduction-to-shiny"><i class="fa fa-check"></i><b>6.1</b> An Introduction to Shiny</a><ul>
<li class="chapter" data-level="6.1.1" data-path="shiny.html"><a href="shiny.html#your-first-shiny-app"><i class="fa fa-check"></i><b>6.1.1</b> Your first shiny app</a></li>
<li class="chapter" data-level="6.1.2" data-path="shiny.html"><a href="shiny.html#create-a-new-shiny-app-in-rstudio"><i class="fa fa-check"></i><b>6.1.2</b> Create a new shiny app in RStudio</a></li>
<li class="chapter" data-level="6.1.3" data-path="shiny.html"><a href="shiny.html#share-your-app"><i class="fa fa-check"></i><b>6.1.3</b> Share your app</a></li>
</ul></li>
<li class="chapter" data-level="6.2" data-path="shiny.html"><a href="shiny.html#useful-input-widgets"><i class="fa fa-check"></i><b>6.2</b> Useful Input Widgets</a></li>
<li class="chapter" data-level="6.3" data-path="shiny.html"><a href="shiny.html#displaying-reactive-output"><i class="fa fa-check"></i><b>6.3</b> Displaying Reactive Output</a></li>
<li class="chapter" data-level="6.4" data-path="shiny.html"><a href="shiny.html#rendering-plotly-inside-shiny"><i class="fa fa-check"></i><b>6.4</b> Rendering Plotly Inside Shiny</a></li>
</ul></li>
<li class="chapter" data-level="7" data-path="map.html"><a href="map.html"><i class="fa fa-check"></i><b>7</b> Interactive Geospatial Visualization</a><ul>
<li class="chapter" data-level="7.1" data-path="map.html"><a href="map.html#an-introduction-to-leaflet"><i class="fa fa-check"></i><b>7.1</b> An Introduction to Leaflet</a><ul>
<li class="chapter" data-level="7.1.1" data-path="map.html"><a href="map.html#more-references"><i class="fa fa-check"></i><b>7.1.1</b> More References</a></li>
<li class="chapter" data-level="7.1.2" data-path="map.html"><a href="map.html#features-and-installation"><i class="fa fa-check"></i><b>7.1.2</b> Features and installation</a></li>
<li class="chapter" data-level="7.1.3" data-path="map.html"><a href="map.html#basic-usage"><i class="fa fa-check"></i><b>7.1.3</b> Basic Usage</a></li>
</ul></li>
<li class="chapter" data-level="7.2" data-path="map.html"><a href="map.html#the-data-object"><i class="fa fa-check"></i><b>7.2</b> The Data Object</a></li>
<li class="chapter" data-level="7.3" data-path="map.html"><a href="map.html#choropleth-map"><i class="fa fa-check"></i><b>7.3</b> Choropleth map</a><ul>
<li class="chapter" data-level="7.3.1" data-path="map.html"><a href="map.html#create-a-base-map"><i class="fa fa-check"></i><b>7.3.1</b> Create a base map</a></li>
<li class="chapter" data-level="7.3.2" data-path="map.html"><a href="map.html#color-the-map"><i class="fa fa-check"></i><b>7.3.2</b> Color the map</a></li>
<li class="chapter" data-level="7.3.3" data-path="map.html"><a href="map.html#interactive-map"><i class="fa fa-check"></i><b>7.3.3</b> Interactive map</a></li>
</ul></li>
<li class="chapter" data-level="7.4" data-path="ggplot2.html"><a href="ggplot2.html#legend"><i class="fa fa-check"></i><b>7.4</b> Legend</a><ul>
<li class="chapter" data-level="7.4.1" data-path="map.html"><a href="map.html#classification-schemes"><i class="fa fa-check"></i><b>7.4.1</b> Classification schemes</a></li>
<li class="chapter" data-level="7.4.2" data-path="map.html"><a href="map.html#mapping-variables-to-colors"><i class="fa fa-check"></i><b>7.4.2</b> Mapping variables to colors</a></li>
</ul></li>
<li class="chapter" data-level="7.5" data-path="map.html"><a href="map.html#an-example-of-county-level-map"><i class="fa fa-check"></i><b>7.5</b> An Example of County-level Map</a></li>
<li class="chapter" data-level="7.6" data-path="map.html"><a href="map.html#spot-maps"><i class="fa fa-check"></i><b>7.6</b> Spot Maps</a><ul>
<li class="chapter" data-level="7.6.1" data-path="map.html"><a href="map.html#adding-circles"><i class="fa fa-check"></i><b>7.6.1</b> Adding circles</a></li>
<li class="chapter" data-level="7.6.2" data-path="map.html"><a href="map.html#add-popups"><i class="fa fa-check"></i><b>7.6.2</b> Add popups</a></li>
<li class="chapter" data-level="7.6.3" data-path="map.html"><a href="map.html#add-labels"><i class="fa fa-check"></i><b>7.6.3</b> Add labels</a></li>
</ul></li>
<li class="chapter" data-level="7.7" data-path="map.html"><a href="map.html#integrating-leaflet-with-r-shiny"><i class="fa fa-check"></i><b>7.7</b> Integrating Leaflet with R Shiny</a></li>
<li class="chapter" data-level="7.8" data-path="dplyr.html"><a href="dplyr.html#exercises"><i class="fa fa-check"></i><b>7.8</b> Exercises</a></li>
</ul></li>
<li class="chapter" data-level="8" data-path="modeling.html"><a href="modeling.html"><i class="fa fa-check"></i><b>8</b> Epidemic Modeling</a><ul>
<li class="chapter" data-level="8.1" data-path="modeling.html"><a href="modeling.html#an-introduction-to-epidemic-modeling"><i class="fa fa-check"></i><b>8.1</b> An Introduction to Epidemic Modeling</a></li>
<li class="chapter" data-level="8.2" data-path="modeling.html"><a href="modeling.html#mechanistic-models"><i class="fa fa-check"></i><b>8.2</b> Mechanistic Models</a><ul>
<li class="chapter" data-level="8.2.1" data-path="modeling.html"><a href="modeling.html#compartment-modeling"><i class="fa fa-check"></i><b>8.2.1</b> Compartment Modeling</a></li>
<li class="chapter" data-level="8.2.2" data-path="modeling.html"><a href="modeling.html#agent-based-methods"><i class="fa fa-check"></i><b>8.2.2</b> Agent-based Methods</a></li>
</ul></li>
<li class="chapter" data-level="8.3" data-path="modeling.html"><a href="modeling.html#phenomenological-models"><i class="fa fa-check"></i><b>8.3</b> Phenomenological Models</a><ul>
<li class="chapter" data-level="8.3.1" data-path="modeling.html"><a href="modeling.html#time-series-analysis"><i class="fa fa-check"></i><b>8.3.1</b> Time Series Analysis</a></li>
<li class="chapter" data-level="8.3.2" data-path="modeling.html"><a href="modeling.html#machine-learning-methods"><i class="fa fa-check"></i><b>8.3.2</b> Machine learning methods</a></li>
</ul></li>
<li class="chapter" data-level="8.4" data-path="modeling.html"><a href="modeling.html#epidemic-modeling-mathematical-and-statistical-perspectives"><i class="fa fa-check"></i><b>8.4</b> Epidemic Modeling: Mathematical and Statistical Perspectives</a></li>
</ul></li>
<li class="chapter" data-level="9" data-path="compartment.html"><a href="compartment.html"><i class="fa fa-check"></i><b>9</b> Compartment Models</a><ul>
<li class="chapter" data-level="9.1" data-path="compartment.html"><a href="compartment.html#a-simple-sis-model-a-model-for-diseases-with-no-immunity"><i class="fa fa-check"></i><b>9.1</b> A Simple SIS Model (A Model for Diseases with No Immunity)</a></li>
<li class="chapter" data-level="9.2" data-path="compartment.html"><a href="compartment.html#an-sir-model"><i class="fa fa-check"></i><b>9.2</b> An SIR Model</a><ul>
<li class="chapter" data-level="9.2.1" data-path="compartment.html"><a href="compartment.html#an-sir-model-with-births-and-deaths"><i class="fa fa-check"></i><b>9.2.1</b> An SIR model with births and deaths</a></li>
</ul></li>
<li class="chapter" data-level="9.3" data-path="compartment.html"><a href="compartment.html#sir-parameter-estimation"><i class="fa fa-check"></i><b>9.3</b> SIR parameter estimation</a></li>
<li class="chapter" data-level="9.4" data-path="compartment.html"><a href="compartment.html#implementation-of-parameter-estimation-in-r"><i class="fa fa-check"></i><b>9.4</b> Implementation of parameter estimation in R</a><ul>
<li class="chapter" data-level="9.4.1" data-path="compartment.html"><a href="compartment.html#example-1.-outbreak-of-measles-in-niamey"><i class="fa fa-check"></i><b>9.4.1</b> Example 1. Outbreak of measles in Niamey</a></li>
<li class="chapter" data-level="9.4.2" data-path="compartment.html"><a href="compartment.html#example-2.-covid-19"><i class="fa fa-check"></i><b>9.4.2</b> Example 2. COVID-19</a></li>
</ul></li>
<li class="chapter" data-level="9.5" data-path="compartment.html"><a href="compartment.html#basic-reproduction-number"><i class="fa fa-check"></i><b>9.5</b> Basic Reproduction Number</a><ul>
<li class="chapter" data-level="9.5.1" data-path="compartment.html"><a href="compartment.html#seir-model"><i class="fa fa-check"></i><b>9.5.1</b> SEIR Model</a></li>
</ul></li>
<li class="chapter" data-level="9.6" data-path="compartment.html"><a href="compartment.html#herd-immunity"><i class="fa fa-check"></i><b>9.6</b> Herd Immunity</a></li>
</ul></li>
<li class="chapter" data-level="10" data-path="timeseries.html"><a href="timeseries.html"><i class="fa fa-check"></i><b>10</b> Time Series Analysis of Infectious Disease Data</a><ul>
<li class="chapter" data-level="10.1" data-path="timeseries.html"><a href="timeseries.html#datasets-and-r-packages"><i class="fa fa-check"></i><b>10.1</b> Datasets and R Packages</a></li>
<li class="chapter" data-level="10.2" data-path="timeseries.html"><a href="timeseries.html#time-series-plots"><i class="fa fa-check"></i><b>10.2</b> Time series plots</a></li>
<li class="chapter" data-level="10.3" data-path="timeseries.html"><a href="timeseries.html#time-series-decomposition"><i class="fa fa-check"></i><b>10.3</b> Time Series Decomposition</a></li>
</ul></li>
<li class="chapter" data-level="11" data-path="regression.html"><a href="regression.html"><i class="fa fa-check"></i><b>11</b> Regression Modeling</a><ul>
<li class="chapter" data-level="11.1" data-path="regression.html"><a href="regression.html#principles-of-regression-modeling"><i class="fa fa-check"></i><b>11.1</b> Principles of Regression Modeling</a></li>
<li class="chapter" data-level="11.2" data-path="regression.html"><a href="regression.html#area-level-data"><i class="fa fa-check"></i><b>11.2</b> Area-level Data</a></li>
<li class="chapter" data-level="11.3" data-path="regression.html"><a href="regression.html#variable-selection"><i class="fa fa-check"></i><b>11.3</b> Variable Selection</a></li>
</ul></li>
<li class="chapter" data-level="12" data-path="NN.html"><a href="NN.html"><i class="fa fa-check"></i><b>12</b> Neural Networks</a><ul>
<li class="chapter" data-level="12.1" data-path="NN.html"><a href="NN.html#a-single-neuron"><i class="fa fa-check"></i><b>12.1</b> A Single Neuron</a></li>
<li class="chapter" data-level="12.2" data-path="NN.html"><a href="NN.html#neural-network-structure"><i class="fa fa-check"></i><b>12.2</b> Neural Network Structure</a></li>
</ul></li>
<li class="chapter" data-level="13" data-path="ensemble.html"><a href="ensemble.html"><i class="fa fa-check"></i><b>13</b> Hybrid Mdels</a><ul>
<li class="chapter" data-level="13.1" data-path="ensemble.html"><a href="ensemble.html#ensembling-time-series-models"><i class="fa fa-check"></i><b>13.1</b> Ensembling Time Series Models</a></li>
<li class="chapter" data-level="13.2" data-path="ensemble.html"><a href="ensemble.html#model-diagnostics"><i class="fa fa-check"></i><b>13.2</b> Model Diagnostics</a></li>
<li class="chapter" data-level="13.3" data-path="ensemble.html"><a href="ensemble.html#weights-selection-using-cross-validation"><i class="fa fa-check"></i><b>13.3</b> Weights Selection Using Cross Validation</a></li>
</ul></li>
<li class="chapter" data-level="" data-path="references.html"><a href="references.html"><i class="fa fa-check"></i>References</a></li>
<li class="chapter" data-level="" data-path="appendix.html"><a href="appendix.html"><i class="fa fa-check"></i>Appendix</a></li>
<li class="chapter" data-level="14" data-path="appendix-a.html"><a href="appendix-a.html"><i class="fa fa-check"></i><b>14</b> Appendix A</a><ul>
<li class="chapter" data-level="14.1" data-path="appendix-a.html"><a href="appendix-a.html#r-introduction-and-preliminaries"><i class="fa fa-check"></i><b>14.1</b> R Introduction and Preliminaries</a><ul>
<li class="chapter" data-level="14.1.1" data-path="appendix-a.html"><a href="appendix-a.html#the-r-environment-and-language"><i class="fa fa-check"></i><b>14.1.1</b> The R Environment and Language</a></li>
<li class="chapter" data-level="14.1.2" data-path="appendix-a.html"><a href="appendix-a.html#r-and-statistics"><i class="fa fa-check"></i><b>14.1.2</b> R and Statistics</a></li>
<li class="chapter" data-level="14.1.3" data-path="appendix-a.html"><a href="appendix-a.html#obtaining-r-and-installation"><i class="fa fa-check"></i><b>14.1.3</b> Obtaining R and installation</a></li>
</ul></li>
<li class="chapter" data-level="14.2" data-path="appendix-a.html"><a href="appendix-a.html#starting-r"><i class="fa fa-check"></i><b>14.2</b> Starting R</a><ul>
<li class="chapter" data-level="14.2.1" data-path="appendix-a.html"><a href="appendix-a.html#description-of-three-panels-in-user-interface"><i class="fa fa-check"></i><b>14.2.1</b> Description of three panels in user interface</a></li>
<li class="chapter" data-level="14.2.2" data-path="appendix-a.html"><a href="appendix-a.html#r-help"><i class="fa fa-check"></i><b>14.2.2</b> R help</a></li>
<li class="chapter" data-level="14.2.3" data-path="appendix-a.html"><a href="appendix-a.html#some-mathematical-expressions"><i class="fa fa-check"></i><b>14.2.3</b> Some mathematical expressions</a></li>
<li class="chapter" data-level="14.2.4" data-path="appendix-a.html"><a href="appendix-a.html#r-packages"><i class="fa fa-check"></i><b>14.2.4</b> R Packages</a></li>
<li class="chapter" data-level="14.2.5" data-path="appendix-a.html"><a href="appendix-a.html#creating-a-project-and-setting-working-directory"><i class="fa fa-check"></i><b>14.2.5</b> Creating a project and setting working directory</a></li>
</ul></li>
<li class="chapter" data-level="14.3" data-path="appendix-a.html"><a href="appendix-a.html#exportimport-data"><i class="fa fa-check"></i><b>14.3</b> Export/Import Data</a><ul>
<li class="chapter" data-level="14.3.1" data-path="appendix-a.html"><a href="appendix-a.html#data-export"><i class="fa fa-check"></i><b>14.3.1</b> Data Export</a></li>
<li class="chapter" data-level="14.3.2" data-path="appendix-a.html"><a href="appendix-a.html#data-import"><i class="fa fa-check"></i><b>14.3.2</b> Data Import</a></li>
</ul></li>
</ul></li>
<li class="chapter" data-level="15" data-path="appendix-b.html"><a href="appendix-b.html"><i class="fa fa-check"></i><b>15</b> Appendix B</a><ul>
<li class="chapter" data-level="15.1" data-path="appendix-b.html"><a href="appendix-b.html#epidemic-data"><i class="fa fa-check"></i><b>15.1</b> Epidemic Data</a><ul>
<li class="chapter" data-level="15.1.1" data-path="appendix-b.html"><a href="appendix-b.html#state-level"><i class="fa fa-check"></i><b>15.1.1</b> State level</a></li>
<li class="chapter" data-level="15.1.2" data-path="appendix-b.html"><a href="appendix-b.html#county-level"><i class="fa fa-check"></i><b>15.1.2</b> County level</a></li>
</ul></li>
<li class="chapter" data-level="15.2" data-path="appendix-b.html"><a href="appendix-b.html#other-factors"><i class="fa fa-check"></i><b>15.2</b> Other Factors</a><ul>
<li class="chapter" data-level="15.2.1" data-path="appendix-b.html"><a href="appendix-b.html#policy-data"><i class="fa fa-check"></i><b>15.2.1</b> Policy Data</a></li>
<li class="chapter" data-level="15.2.2" data-path="appendix-b.html"><a href="appendix-b.html#demographic-characteristics"><i class="fa fa-check"></i><b>15.2.2</b> Demographic Characteristics</a></li>
<li class="chapter" data-level="15.2.3" data-path="appendix-b.html"><a href="appendix-b.html#healthcare-infrastructure"><i class="fa fa-check"></i><b>15.2.3</b> Healthcare Infrastructure</a></li>
<li class="chapter" data-level="15.2.4" data-path="appendix-b.html"><a href="appendix-b.html#socioeconomic-status"><i class="fa fa-check"></i><b>15.2.4</b> Socioeconomic Status</a></li>
<li class="chapter" data-level="15.2.5" data-path="appendix-b.html"><a href="appendix-b.html#environmental-factor"><i class="fa fa-check"></i><b>15.2.5</b> Environmental Factor</a></li>
<li class="chapter" data-level="15.2.6" data-path="appendix-b.html"><a href="appendix-b.html#mobility"><i class="fa fa-check"></i><b>15.2.6</b> Mobility</a></li>
<li class="chapter" data-level="15.2.7" data-path="appendix-b.html"><a href="appendix-b.html#geographic-information"><i class="fa fa-check"></i><b>15.2.7</b> Geographic Information</a></li>
</ul></li>
<li class="chapter" data-level="15.3" data-path="appendix-b.html"><a href="appendix-b.html#data-sets"><i class="fa fa-check"></i><b>15.3</b> Data Sets</a><ul>
<li class="chapter" data-level="15.3.1" data-path="appendix-b.html"><a href="appendix-b.html#chapter-2"><i class="fa fa-check"></i><b>15.3.1</b> Chapter 2</a></li>
<li class="chapter" data-level="15.3.2" data-path="appendix-b.html"><a href="appendix-b.html#chapter-3"><i class="fa fa-check"></i><b>15.3.2</b> Chapter 3</a></li>
</ul></li>
</ul></li>
<li class="divider"></li>
<li><a href="https://github.com/rstudio/bookdown" target="blank">Published with bookdown</a></li>

</ul>

      </nav>
    </div>

    <div class="book-body">
      <div class="body-inner">
        <div class="book-header" role="navigation">
          <h1>
            <i class="fa fa-circle-o-notch fa-spin"></i><a href="./">Statistical Learning of Infectious Disease Data Analytics</a>
          </h1>
        </div>

        <div class="page-wrapper" tabindex="-1" role="main">
          <div class="page-inner">

            <section class="normal" id="section-">
<div id="ggplot2" class="section level1">
<h1><span class="header-section-number">Chapter 4</span> Data Visualization with ggplot2</h1>
<div id="introduction" class="section level2">
<h2><span class="header-section-number">4.1</span> Introduction</h2>
<p>The first thing to do in the epidemiologic data analysis task is to plot the data. Data visualization enables many features of the data to be displayed or summarized in a graphical format, including patterns, unusual observations, changes over time, spatial variations, and relationships among variables. The features that are seen in graphs of the data must then be incorporated, as much as possible, into the modeling or forecasting methods.</p>
<p>There are many types of graphs available, each with its own strengths and use cases. One of the challenges in the statistical learning process is choosing the appropriate visualization method to represent the data. Before constructing any display of epidemiologic data, it is important to understand the type of task that we want to perform and determine the information to convey. Some common roles for data visualization include:</p>
<ul>
<li>highlighting a change from past patterns in the data;</li>
<li>displaying a part-to-whole composition;</li>
<li>showing how data is distributed;</li>
<li>showing a difference or similarity between groups;</li>
<li>displaying the spatial variation in geographical data;</li>
<li>illustrating relationships among variables.</li>
</ul>
<p>When the data are more complex, graphs can help visualize broader patterns and trends and identify variations from those trends. Variations in data may represent important new findings or only errors in typing or coding which need to be corrected. Thus, graphs can be helpful tools to aid in verifying and analyzing the data. Once an analysis is complete, graphs further serve as useful visual aids for describing the data to others.</p>
<p>This chapter will introduce the <code>ggplot2</code>, and we will gain insight and practical skills for visualization of infectious disease data.</p>
<p>Recommended Reading:</p>
<ol style="list-style-type: decimal">
<li><a href="https://ggplot2.tidyverse.org" class="uri">https://ggplot2.tidyverse.org</a></li>
<li><a href="https://opr.princeton.edu/workshops/Downloads/" class="uri">https://opr.princeton.edu/workshops/Downloads/</a></li>
<li><a href="https://ggplot2-book.org/introduction.html" class="uri">https://ggplot2-book.org/introduction.html</a></li>
</ol>
<p><code>ggplot2</code> builds on <a href="https://stanford.idm.oclc.org/login?url=http://www.myilibrary.com?id=46066">Leland Wilkinson’s The Grammar of Graphics</a> and focuses on the primacy of layers and adapts it for R.</p>
<blockquote>
<p>In brief, the grammar tells us that a graphic maps the data to the aesthetic attributes (color, shape, size) of geometric objects (points, lines, bars). The plot may also include statistical transformations of the data and information about the plot’s coordinate system. Facetting can be used to plot for different subsets of the data. The combination of these independent components is what makes up a graphic.</p>
</blockquote>
<p>In this chapter, we will introduce the basics of <code>ggplot2</code> grammar and some of the key features, including the use of <code>geom</code>, <code>stat</code>, <code>scale</code>, <code>coord</code>, and <code>facet</code>.</p>
</div>
<div id="types-of-variables-and-preparation" class="section level2">
<h2><span class="header-section-number">4.2</span> Types of Variables and Preparation</h2>
<p>When preparing graphs, keep in mind that the primary purpose is to communicate information. The types of variables we are analyzing and the media for the visualization can also affect your graphics practice.</p>
<div id="types-of-variables" class="section level3">
<h3><span class="header-section-number">4.2.1</span> Types of Variables</h3>
<p>In examining data, you must know which data type you are dealing with to choose the appropriate display format. The data are ususally in one of the following categories:</p>
<ol style="list-style-type: decimal">
<li>Categorical (Qualitative) variables</li>
</ol>
<ul>
<li><p>A <strong>nominal</strong> variable is one whose values are categories without any numerical ranking. Good examples are occupation, place of birth, county of residence and diagnosis. Nominal variable is called <strong>dichotomous</strong> when it is characterised by only two classes. In epidemiology, it is common to see dichotomous variables: sex (male/female), exposure history (yes/no), alive or dead, ill or well, vaccinated or unvaccinated.</p></li>
<li><p>An <strong>ordinale</strong> variable has values that can be ranked but are not necessarily evenly spaced. For example, severity of illness may be categorised and ordered as “mild”, “moderate” or “severe”.</p></li>
</ul>
<ol start="2" style="list-style-type: decimal">
<li>Numerical (Quantitative) variables</li>
</ol>
<p>There are two types of <strong>quantitative</strong> variables:</p>
<ul>
<li><p><strong>Discrete</strong> variables have values that are distinct and separate. Discrete data can’t be measured but can be counted.
For example, the number of new cases of a certain disease in a given year.</p></li>
<li><p><strong>Continuous</strong> variables represents measurements and can have any value in a range. Examples of continuous data would be the amount of the time period between when you catch a virus and when your symptoms start. Discrete data can’t be counted but can be measured.</p></li>
<li><p>An <strong>interval-scale</strong> variable is measured on a scale of equally spaced units, but without a true zero point. An example of interval data is date of birth.</p></li>
<li><p>A <strong>ratio-scale</strong> variable is the same as interval values, with the difference that they do have an absolute zero. Good examples are be height in centimeters or duration of illness.</p></li>
</ul>
</div>
<div id="rules-for-graph-designing" class="section level3">
<h3><span class="header-section-number">4.2.2</span> Rules for Graph Designing</h3>
<p>When designing graphs, we need to follow some rules to achieve the best practices, and <span class="citation">Dicker and Gathany (<a href="#ref-dicker1992principles" role="doc-biblioref">1992</a>)</span> suggests the following:</p>
<ul>
<li><p>Ensure that a graphic can stand alone by clear labeling of title, source, axes, scales, and legends;</p></li>
<li><p>Clearly identify variables portrayed (legends or keys), including units of measure;</p></li>
<li><p>Minimize number of lines on a graph;</p></li>
<li><p>Generally, portray frequency on the vertical scale, starting at zero, and classification variable on horizontal scale;</p></li>
<li><p>Ensure that scales for each axis are appropriate for data presented;</p></li>
<li><p>Define any abbreviations or symbols; and</p></li>
<li><p>Specify any data excluded.</p></li>
</ul>
</div>
<div id="installing-packages-and-loading-data" class="section level3">
<h3><span class="header-section-number">4.2.3</span> Installing packages and loading data</h3>
<p>Before we begin, please get ready by installing the <code>ggplot2</code> package by any of the following method.</p>
<div class="sourceCode" id="cb68"><pre class="sourceCode r"><code class="sourceCode r"><span id="cb68-1"><a href="ggplot2.html#cb68-1"></a><span class="co"># The easiest way to get ggplot2 is to install the whole tidyverse:</span></span>
<span id="cb68-2"><a href="ggplot2.html#cb68-2"></a><span class="kw">install.packages</span>(<span class="st">&quot;tidyverse&quot;</span>)</span>
<span id="cb68-3"><a href="ggplot2.html#cb68-3"></a></span>
<span id="cb68-4"><a href="ggplot2.html#cb68-4"></a><span class="co"># Alternatively, install just ggplot2:</span></span>
<span id="cb68-5"><a href="ggplot2.html#cb68-5"></a><span class="kw">install.packages</span>(<span class="st">&quot;ggplot2&quot;</span>)</span>
<span id="cb68-6"><a href="ggplot2.html#cb68-6"></a></span>
<span id="cb68-7"><a href="ggplot2.html#cb68-7"></a><span class="co"># Or the development version from GitHub:</span></span>
<span id="cb68-8"><a href="ggplot2.html#cb68-8"></a><span class="co"># install.packages(&quot;devtools&quot;)</span></span>
<span id="cb68-9"><a href="ggplot2.html#cb68-9"></a>devtools<span class="op">::</span><span class="kw">install_github</span>(<span class="st">&quot;tidyverse/ggplot2&quot;</span>)</span></code></pre></div>
<p><strong>Note:</strong> <code>devtools</code> downloads and installs the package from GitHub. By default, <code>install.packages()</code> is only able to install packages that are available in Comprehensive R Archive Network (CRAN). In that case, the developer’s tool, <code>devtools::install_github()</code> enables users to install packages that have not been submitted to CRAN, but is available in GitHub.</p>
<p>In addition, we need to library the required packages as following.</p>
<p>In the rest of this section, we demonstrate how to create a basic scatter plot and output the figure in “png” and “rds” format. To create a <code>ggplot2</code> plot, we need to know three key components: (1) A dataframe with each column being an attribute/variable, each row being an individual; (2) A set of aesthetic mappings between variables in the data and visual properties, and (3) At least one layer which describes how to render each observation. Layers are usually created with a <code>geom</code> function.</p>
<p>“ggplot” generally likes data in the “long” format: i.e., a column for every dimension, and a row for every observation. For illustration, we are going to use the <code>state.long</code> dataset in the R package <code>slid</code>. To prepare the data, install the R package <code>slid</code> from Github using the following command, which includes the datasets that we use for this book.</p>
<p>Open the <code>state.long</code> dataset, which includes the variables, cumulative infected cases (<code>Infected</code>), cumulative death counts (<code>Death</code>), <code>Region</code>, <code>Division</code>, <code>State</code>, population (<code>pop</code>), and <code>DATE</code>, starting from Jan 22, 2020. Take a look at the first few lines using <code>head()</code>.</p>
<div class="sourceCode" id="cb69"><pre class="sourceCode r"><code class="sourceCode r"><span id="cb69-1"><a href="ggplot2.html#cb69-1"></a>df &lt;-<span class="st"> </span>slid<span class="op">::</span>state.long</span>
<span id="cb69-2"><a href="ggplot2.html#cb69-2"></a></span>
<span id="cb69-3"><a href="ggplot2.html#cb69-3"></a><span class="kw">head</span>(df)</span></code></pre></div>
<pre><code>## # A tibble: 6 x 7
##   State  Region Division       pop DATE       Infected Death
##   &lt;fct&gt;  &lt;fct&gt;  &lt;fct&gt;        &lt;int&gt; &lt;date&gt;        &lt;int&gt; &lt;int&gt;
## 1 Alaba… South  East South… 4.89e6 2020-12-11   288775  4086
## 2 Alaba… South  East South… 4.89e6 2020-12-10   284922  4034
## 3 Alaba… South  East South… 4.89e6 2020-12-09   280187  3985
## 4 Alaba… South  East South… 4.89e6 2020-12-08   276665  3940
## 5 Alaba… South  East South… 4.89e6 2020-12-07   272228  3891
## 6 Alaba… South  East South… 4.89e6 2020-12-06   269877  3888</code></pre>
</div>
<div id="your-first-scatterplot" class="section level3">
<h3><span class="header-section-number">4.2.4</span> Your first scatterplot</h3>
<p>Here we introduce how to draw a simple scatter plot using the data of ‘2020-12-11’. Treat <code>log(Infected)</code> as the x-axis, and <code>log(Death)</code> as the y-axis. We create it by telling “ggplot” the data <code>df</code>, the aesthetic mapping <code>aes(log(Infected), log(Death))</code>, and the layer <code>geom_point()</code>. The structure <code>ggplot() + geom_point()</code> is the typical way to create a plot, in which “ggplot” is told the data and mapping, and <code>geom_point</code> is a layer of a picture using the information embedded in “ggplot”. Later in this chapter, you will see how we can use <code>+</code> to assign additional adjustments and add multiple layers to the existing figure.</p>
<div class="sourceCode" id="cb71"><pre class="sourceCode r"><code class="sourceCode r"><span id="cb71-1"><a href="ggplot2.html#cb71-1"></a><span class="co"># Select the date</span></span>
<span id="cb71-2"><a href="ggplot2.html#cb71-2"></a>df &lt;-<span class="st"> </span>slid<span class="op">::</span>state.long <span class="op">%&gt;%</span><span class="st"> </span></span>
<span id="cb71-3"><a href="ggplot2.html#cb71-3"></a><span class="st">  </span>dplyr<span class="op">::</span><span class="kw">filter</span>(DATE <span class="op">==</span><span class="st"> </span><span class="kw">as.Date</span>(<span class="st">&#39;2020-12-11&#39;</span>)) </span>
<span id="cb71-4"><a href="ggplot2.html#cb71-4"></a></span>
<span id="cb71-5"><a href="ggplot2.html#cb71-5"></a><span class="co"># Create scatter plot</span></span>
<span id="cb71-6"><a href="ggplot2.html#cb71-6"></a><span class="co"># Data: df</span></span>
<span id="cb71-7"><a href="ggplot2.html#cb71-7"></a><span class="co"># Aesthetic: first mapped to x, second mapped to y</span></span>
<span id="cb71-8"><a href="ggplot2.html#cb71-8"></a><span class="co"># Layer: render the plot as a scatterplot</span></span>
<span id="cb71-9"><a href="ggplot2.html#cb71-9"></a>p &lt;-<span class="st"> </span><span class="kw">ggplot</span>(df, <span class="kw">aes</span>(<span class="kw">log</span>(Infected <span class="op">+</span><span class="st"> </span><span class="dv">1</span>), <span class="kw">log</span>(Death <span class="op">+</span><span class="st"> </span><span class="dv">1</span>)))</span>
<span id="cb71-10"><a href="ggplot2.html#cb71-10"></a>p <span class="op">+</span><span class="st"> </span><span class="kw">geom_point</span>()         </span></code></pre></div>
<div class="figure" style="text-align: center"><span id="fig:ggplotscatter1"></span>
<img src="SLID_book_files/figure-html/ggplotscatter1-1.png" alt="Scatterplot of log cumulative death against log cumulative infected" width="50%" />
<p class="caption">
Figure 4.1: Scatterplot of log cumulative death against log cumulative infected
</p>
</div>
<p><strong>Remarks:</strong></p>
<p>In the above example, the dataframe <code>df</code> is the first parameter in the above <code>ggplot()</code>, and aesthetics are defined within an <code>aes()</code> function. We need to place <code>+</code> at the end of the previous line instead of the beginning of new line.</p>
<p><strong>Aesthetics</strong> are properties of the plot that can show certain elements of the data. The following is a list of some common plot aesthetics you might want to specify in your <code>geom_point()</code>:</p>
<ul>
<li><code>x</code>: position on x-axis</li>
<li><code>y</code>: position on y-axis</li>
<li><code>alpha</code>: transparency (1: opaque; 0: transparent)</li>
<li><code>color</code>: color of border of elements</li>
<li><code>fill</code>: color of inside of elements</li>
<li><code>shape</code>: shape</li>
<li><code>group</code>: group</li>
<li><code>size</code>: size</li>
<li><code>stroke</code>: border size of points</li>
</ul>
<p>We will explain more details in the following sections.</p>
</div>
</div>
<div id="position-scales-and-axes" class="section level2">
<h2><span class="header-section-number">4.3</span> Position Scales and Axes</h2>
<div id="change-the-labels-of-the-axis-using-xlab-and-ylab" class="section level3">
<h3><span class="header-section-number">4.3.1</span> Change the labels of the axis using <code>xlab()</code> and <code>ylab()</code></h3>
<p>See Figure <a href="ggplot2.html#fig:xlabggplot">4.2</a> for the customized labels and title.</p>
<div class="sourceCode" id="cb72"><pre class="sourceCode r"><code class="sourceCode r"><span id="cb72-1"><a href="ggplot2.html#cb72-1"></a><span class="co"># Change the transparency using alpha</span></span>
<span id="cb72-2"><a href="ggplot2.html#cb72-2"></a>p &lt;-<span class="st"> </span>p <span class="op">+</span><span class="st"> </span><span class="kw">geom_point</span>(<span class="dt">alpha =</span> <span class="fl">0.7</span>) <span class="op">+</span><span class="st"> </span></span>
<span id="cb72-3"><a href="ggplot2.html#cb72-3"></a><span class="st">   </span><span class="co"># Change the label of horizontal axis</span></span>
<span id="cb72-4"><a href="ggplot2.html#cb72-4"></a><span class="st">  </span><span class="kw">xlab</span>(<span class="st">&#39;log Infected&#39;</span>) <span class="op">+</span></span>
<span id="cb72-5"><a href="ggplot2.html#cb72-5"></a><span class="st">  </span><span class="co"># Change the label of vertical axis</span></span>
<span id="cb72-6"><a href="ggplot2.html#cb72-6"></a><span class="st">  </span><span class="kw">ylab</span>(<span class="st">&#39;log Death&#39;</span>) <span class="op">+</span><span class="st"> </span></span>
<span id="cb72-7"><a href="ggplot2.html#cb72-7"></a><span class="st">  </span><span class="co"># Change the title</span></span>
<span id="cb72-8"><a href="ggplot2.html#cb72-8"></a><span class="st">  </span><span class="kw">labs</span>(<span class="dt">title =</span> <span class="st">&#39;Log death against infected cases in US&#39;</span>)</span>
<span id="cb72-9"><a href="ggplot2.html#cb72-9"></a>p</span></code></pre></div>
<div class="figure" style="text-align: center"><span id="fig:xlabggplot"></span>
<img src="SLID_book_files/figure-html/xlabggplot-1.png" alt="Scatterplot with customized lables and title" width="50%" />
<p class="caption">
Figure 4.2: Scatterplot with customized lables and title
</p>
</div>
<!-- ### Reverse the scale 

We can use `scale_x_reverse()` and `scale_y_reverse()` to change the order of the values on axis. -->
<div class="sourceCode" id="cb73"><pre class="sourceCode r"><code class="sourceCode r"><span id="cb73-1"><a href="ggplot2.html#cb73-1"></a><span class="co">#p + scale_x_reverse()</span></span>
<span id="cb73-2"><a href="ggplot2.html#cb73-2"></a><span class="co">#p + scale_y_reverse()</span></span></code></pre></div>
</div>
<div id="change-the-range-of-the-axis-using-xlim-and-ylim" class="section level3">
<h3><span class="header-section-number">4.3.2</span> Change the range of the axis using <code>xlim()</code> and <code>ylim()</code></h3>
<p>For continuous variables, we can provide the lower and upper limits. For categorical variables, we can provide the names of categories desired. To suppress the warning “Removed XXX rows containing missing values”, use <code>na.rm</code>. This needs to be carefully used because the data outside the range are converted to <code>NA</code>, which will affect later manipulations, such as calculating the mean or sum.</p>
<div class="sourceCode" id="cb74"><pre class="sourceCode r"><code class="sourceCode r"><span id="cb74-1"><a href="ggplot2.html#cb74-1"></a><span class="co"># For continuous variable, provide the lower and upper limits</span></span>
<span id="cb74-2"><a href="ggplot2.html#cb74-2"></a>p &lt;-<span class="st"> </span>p <span class="op">+</span><span class="st"> </span><span class="kw">geom_point</span>() <span class="op">+</span><span class="st"> </span><span class="kw">ylim</span>(<span class="dv">4</span>, <span class="dv">12</span>) </span>
<span id="cb74-3"><a href="ggplot2.html#cb74-3"></a>p</span></code></pre></div>
<div class="figure" style="text-align: center"><span id="fig:xlimggplot"></span>
<img src="SLID_book_files/figure-html/xlimggplot-1.png" alt="Scatterplot with customized axis range for continuous features" width="50%" />
<p class="caption">
Figure 4.3: Scatterplot with customized axis range for continuous features
</p>
</div>
<div class="sourceCode" id="cb75"><pre class="sourceCode r"><code class="sourceCode r"><span id="cb75-1"><a href="ggplot2.html#cb75-1"></a><span class="co"># For discrete variable, provide the names of categories desired</span></span>
<span id="cb75-2"><a href="ggplot2.html#cb75-2"></a><span class="co"># To suppress the warning &#39;Removed XXX rows containing...&#39;, use `na.rm`. </span></span>
<span id="cb75-3"><a href="ggplot2.html#cb75-3"></a>df &lt;-<span class="st"> </span>slid<span class="op">::</span>state.long <span class="op">%&gt;%</span><span class="st"> </span></span>
<span id="cb75-4"><a href="ggplot2.html#cb75-4"></a><span class="st">  </span>dplyr<span class="op">::</span><span class="kw">filter</span>(DATE <span class="op">==</span><span class="st"> </span><span class="kw">as.Date</span>(<span class="st">&#39;2020-12-11&#39;</span>)) </span>
<span id="cb75-5"><a href="ggplot2.html#cb75-5"></a></span>
<span id="cb75-6"><a href="ggplot2.html#cb75-6"></a><span class="kw">ggplot</span>(df, <span class="kw">aes</span>(Region, <span class="kw">log</span>(Death <span class="op">+</span><span class="st"> </span><span class="dv">1</span>))) <span class="op">+</span><span class="st"> </span></span>
<span id="cb75-7"><a href="ggplot2.html#cb75-7"></a><span class="st">  </span><span class="kw">geom_point</span>(<span class="dt">na.rm =</span> <span class="ot">TRUE</span>) <span class="op">+</span></span>
<span id="cb75-8"><a href="ggplot2.html#cb75-8"></a><span class="st">  </span><span class="kw">xlim</span>(<span class="st">&#39;West&#39;</span>, <span class="st">&#39;Midwest&#39;</span>, <span class="st">&#39;South&#39;</span>) </span></code></pre></div>
<div class="figure" style="text-align: center"><span id="fig:xlimggplot2"></span>
<img src="SLID_book_files/figure-html/xlimggplot2-1.png" alt="Scatterplot with customized axis range for discrete features" width="50%" />
<p class="caption">
Figure 4.4: Scatterplot with customized axis range for discrete features
</p>
</div>
</div>
</div>
<div id="color-scales-and-size-of-geom_points" class="section level2">
<h2><span class="header-section-number">4.4</span> Color Scales and Size of <code>geom_points()</code></h2>
<p>There are two ways of coloring. One approach is to color all points with the same color. The other method is to color the points according to a particular feature of the observation.</p>
<div id="change-the-color-of-all-points" class="section level3">
<h3><span class="header-section-number">4.4.1</span> Change the color of all points</h3>
<div class="sourceCode" id="cb76"><pre class="sourceCode r"><code class="sourceCode r"><span id="cb76-1"><a href="ggplot2.html#cb76-1"></a>p <span class="op">+</span><span class="st"> </span><span class="kw">geom_point</span>(<span class="dt">color =</span> <span class="st">&quot;blue&quot;</span>)</span></code></pre></div>
<div class="figure" style="text-align: center"><span id="fig:unnamed-chunk-44"></span>
<img src="SLID_book_files/figure-html/unnamed-chunk-44-1.png" alt="Scatterplot with all points colored blue" width="50%" />
<p class="caption">
Figure 4.5: Scatterplot with all points colored blue
</p>
</div>
</div>
<div id="color-the-observations-by-the-value-of-a-feature" class="section level3">
<h3><span class="header-section-number">4.4.2</span> Color the observations by the value of a feature</h3>
<div class="sourceCode" id="cb77"><pre class="sourceCode r"><code class="sourceCode r"><span id="cb77-1"><a href="ggplot2.html#cb77-1"></a><span class="co"># Use Region as the feature for coloring</span></span>
<span id="cb77-2"><a href="ggplot2.html#cb77-2"></a>p <span class="op">+</span><span class="st"> </span><span class="kw">geom_point</span>(<span class="kw">aes</span>(<span class="dt">color =</span> Region)) </span>
<span id="cb77-3"><a href="ggplot2.html#cb77-3"></a><span class="co"># p + aes(color = Region) </span></span>
<span id="cb77-4"><a href="ggplot2.html#cb77-4"></a></span>
<span id="cb77-5"><a href="ggplot2.html#cb77-5"></a><span class="co"># Use population for coloring</span></span>
<span id="cb77-6"><a href="ggplot2.html#cb77-6"></a>p <span class="op">+</span><span class="st"> </span><span class="kw">geom_point</span>(<span class="kw">aes</span>(<span class="dt">color =</span> pop))</span></code></pre></div>
<div class="figure"><span id="fig:unnamed-chunk-45"></span>
<img src="SLID_book_files/figure-html/unnamed-chunk-45-1.png" alt="Scatterplot with points colored by Region or Population" width="50%" /><img src="SLID_book_files/figure-html/unnamed-chunk-45-2.png" alt="Scatterplot with points colored by Region or Population" width="50%" />
<p class="caption">
Figure 4.6: Scatterplot with points colored by Region or Population
</p>
</div>
<p><strong>Remarks:</strong> the <code>color</code> feature is located at different layers in three figures. In the first figure, it is under <code>geom_point()</code>, while in the latter two figures it is under <code>geom_point(aes())</code>. Because we only have one layer in this example, we can equivalently use <code>aes()</code>, i.e., the aesthetic mapping for the whole scatterplot.</p>
</div>
<div id="change-the-color-palette" class="section level3">
<h3><span class="header-section-number">4.4.3</span> Change the color palette</h3>
<p>In addition, we can personalize the color palette using <code>scale_fill_brewer()</code> for a discrete color scale, and <code>scale_fill_distiller()</code> for a continuous color scale.</p>
<div class="sourceCode" id="cb78"><pre class="sourceCode r"><code class="sourceCode r"><span id="cb78-1"><a href="ggplot2.html#cb78-1"></a><span class="co"># Change the palette</span></span>
<span id="cb78-2"><a href="ggplot2.html#cb78-2"></a><span class="co"># For discrete scale</span></span>
<span id="cb78-3"><a href="ggplot2.html#cb78-3"></a>p <span class="op">+</span><span class="st"> </span><span class="kw">geom_point</span>(<span class="kw">aes</span>(<span class="dt">color =</span> Region)) <span class="op">+</span><span class="st"> </span></span>
<span id="cb78-4"><a href="ggplot2.html#cb78-4"></a><span class="st">   </span><span class="kw">scale_fill_brewer</span>(<span class="dt">palette =</span> <span class="st">&quot;Set1&quot;</span>, <span class="dt">aesthetics =</span> <span class="st">&quot;color&quot;</span>)</span>
<span id="cb78-5"><a href="ggplot2.html#cb78-5"></a><span class="co"># For continuous scale</span></span>
<span id="cb78-6"><a href="ggplot2.html#cb78-6"></a>p <span class="op">+</span><span class="st"> </span><span class="kw">geom_point</span>(<span class="kw">aes</span>(<span class="dt">color =</span> pop)) <span class="op">+</span></span>
<span id="cb78-7"><a href="ggplot2.html#cb78-7"></a><span class="st"> </span><span class="kw">scale_fill_distiller</span>(<span class="dt">palette =</span> <span class="dv">2</span>, <span class="dt">aesthetics =</span> <span class="st">&quot;color&quot;</span>)</span></code></pre></div>
<div class="figure"><span id="fig:unnamed-chunk-46"></span>
<img src="SLID_book_files/figure-html/unnamed-chunk-46-1.png" alt="Scatterplot with customized color palette" width="50%" /><img src="SLID_book_files/figure-html/unnamed-chunk-46-2.png" alt="Scatterplot with customized color palette" width="50%" />
<p class="caption">
Figure 4.7: Scatterplot with customized color palette
</p>
</div>
</div>
<div id="change-the-size-by-the-value-of-a-feature" class="section level3">
<h3><span class="header-section-number">4.4.4</span> Change the size by the value of a feature</h3>
<div class="sourceCode" id="cb79"><pre class="sourceCode r"><code class="sourceCode r"><span id="cb79-1"><a href="ggplot2.html#cb79-1"></a>p &lt;-<span class="st"> </span><span class="kw">ggplot</span>(df, <span class="kw">aes</span>(<span class="kw">log</span>(Infected <span class="op">+</span><span class="st"> </span><span class="dv">1</span>), <span class="kw">log</span>(Death <span class="op">+</span><span class="st"> </span><span class="dv">1</span>))) <span class="op">+</span></span>
<span id="cb79-2"><a href="ggplot2.html#cb79-2"></a><span class="st">  </span><span class="kw">xlab</span>(<span class="st">&#39;log Infected&#39;</span>) <span class="op">+</span></span>
<span id="cb79-3"><a href="ggplot2.html#cb79-3"></a><span class="st">  </span><span class="kw">ylab</span>(<span class="st">&#39;log Death&#39;</span>) <span class="op">+</span><span class="st"> </span></span>
<span id="cb79-4"><a href="ggplot2.html#cb79-4"></a><span class="st">  </span><span class="kw">labs</span>(<span class="dt">title =</span> <span class="st">&#39;Log death against infected cases in US&#39;</span>)</span>
<span id="cb79-5"><a href="ggplot2.html#cb79-5"></a></span>
<span id="cb79-6"><a href="ggplot2.html#cb79-6"></a><span class="co"># Change the point size</span></span>
<span id="cb79-7"><a href="ggplot2.html#cb79-7"></a>p <span class="op">+</span><span class="st"> </span><span class="kw">geom_point</span>(<span class="kw">aes</span> (<span class="dt">size =</span> pop))</span>
<span id="cb79-8"><a href="ggplot2.html#cb79-8"></a></span>
<span id="cb79-9"><a href="ggplot2.html#cb79-9"></a><span class="co"># Change the point color and size</span></span>
<span id="cb79-10"><a href="ggplot2.html#cb79-10"></a>p <span class="op">+</span><span class="st"> </span><span class="kw">geom_point</span>(<span class="kw">aes</span> (<span class="dt">size =</span> pop , <span class="dt">color =</span> pop))</span></code></pre></div>
<div class="figure"><span id="fig:unnamed-chunk-47"></span>
<img src="SLID_book_files/figure-html/unnamed-chunk-47-1.png" alt="Scatterplot with customized point size or color" width="50%" /><img src="SLID_book_files/figure-html/unnamed-chunk-47-2.png" alt="Scatterplot with customized point size or color" width="50%" />
<p class="caption">
Figure 4.8: Scatterplot with customized point size or color
</p>
</div>
<div class="sourceCode" id="cb80"><pre class="sourceCode r"><code class="sourceCode r"><span id="cb80-1"><a href="ggplot2.html#cb80-1"></a><span class="co"># Combine the color and size in legend</span></span>
<span id="cb80-2"><a href="ggplot2.html#cb80-2"></a><span class="co"># Method 1: keep the size and color the same limits and breaks</span></span>
<span id="cb80-3"><a href="ggplot2.html#cb80-3"></a>p <span class="op">+</span><span class="st"> </span><span class="kw">geom_point</span>(<span class="kw">aes</span> (<span class="dt">size =</span> pop, <span class="dt">color =</span> pop)) <span class="op">+</span></span>
<span id="cb80-4"><a href="ggplot2.html#cb80-4"></a><span class="st">  </span><span class="kw">scale_color_continuous</span>(<span class="dt">limits =</span> <span class="kw">c</span>(<span class="fl">0e7</span>, <span class="fl">4e7</span>), </span>
<span id="cb80-5"><a href="ggplot2.html#cb80-5"></a>                         <span class="dt">breaks =</span> <span class="kw">seq</span>(<span class="dv">0</span>, <span class="fl">4e7</span>, <span class="dt">by =</span> <span class="fl">1e7</span>)) <span class="op">+</span></span>
<span id="cb80-6"><a href="ggplot2.html#cb80-6"></a><span class="st">  </span><span class="kw">scale_size_area</span>(<span class="dt">limits =</span> <span class="kw">c</span>(<span class="fl">0e7</span>, <span class="fl">4e7</span>), </span>
<span id="cb80-7"><a href="ggplot2.html#cb80-7"></a>                  <span class="dt">breaks =</span> <span class="kw">seq</span>(<span class="dv">0</span>, <span class="fl">4e7</span>, <span class="dt">by =</span> <span class="fl">1e7</span>), <span class="dt">max_size =</span> <span class="dv">12</span>) <span class="op">+</span></span>
<span id="cb80-8"><a href="ggplot2.html#cb80-8"></a><span class="st">  </span><span class="kw">guides</span>(<span class="dt">color =</span> <span class="kw">guide_legend</span>(), <span class="dt">size =</span> <span class="kw">guide_legend</span>()) </span>
<span id="cb80-9"><a href="ggplot2.html#cb80-9"></a></span>
<span id="cb80-10"><a href="ggplot2.html#cb80-10"></a><span class="co"># Method 2: use scale_color_gradient and scale_size</span></span>
<span id="cb80-11"><a href="ggplot2.html#cb80-11"></a>p &lt;-<span class="st"> </span>p <span class="op">+</span><span class="st"> </span><span class="kw">geom_point</span>(<span class="kw">aes</span>(<span class="dt">size =</span> pop, <span class="dt">color =</span> pop), <span class="dt">alpha =</span> <span class="fl">0.7</span>) <span class="op">+</span></span>
<span id="cb80-12"><a href="ggplot2.html#cb80-12"></a><span class="st">   </span><span class="kw">scale_color_gradient</span>(<span class="dt">low =</span> <span class="st">&quot;lightblue&quot;</span>, <span class="dt">high =</span> <span class="st">&quot;red&quot;</span>) <span class="op">+</span></span>
<span id="cb80-13"><a href="ggplot2.html#cb80-13"></a><span class="st">   </span><span class="kw">scale_size_area</span>(<span class="dt">max_size =</span> <span class="dv">12</span>) <span class="op">+</span></span>
<span id="cb80-14"><a href="ggplot2.html#cb80-14"></a><span class="st">   </span><span class="kw">guides</span>(<span class="dt">color =</span> <span class="kw">guide_legend</span>(), <span class="dt">size =</span> <span class="kw">guide_legend</span>())</span>
<span id="cb80-15"><a href="ggplot2.html#cb80-15"></a></span>
<span id="cb80-16"><a href="ggplot2.html#cb80-16"></a>p</span></code></pre></div>
<div class="figure"><span id="fig:unnamed-chunk-48"></span>
<img src="SLID_book_files/figure-html/unnamed-chunk-48-1.png" alt="Scatterplot with customized point color and point size" width="50%" /><img src="SLID_book_files/figure-html/unnamed-chunk-48-2.png" alt="Scatterplot with customized point color and point size" width="50%" />
<p class="caption">
Figure 4.9: Scatterplot with customized point color and point size
</p>
</div>
<p><strong>Remarks:</strong> For Method 1, the key to combining two aesthetic settings of the layer to one legend, in this case, <code>color</code> and <code>size</code>, is to set the <code>limits</code> and <code>breaks</code> to be the same in <code>guides</code>. For both methods, <code>guides(color = guide_legend(), size = guide_legend())</code> is needed.</p>
</div>
</div>
<div id="individual-geoms" class="section level2">
<h2><span class="header-section-number">4.5</span> Individual geoms</h2>
<p>Apart from the scatter plot, there are many individual geoms, for example:</p>
<ul>
<li><code>geom_line()</code>: line graphs</li>
<li><code>geom_boxplot()</code>:boxplots</li>
<li><code>geom_bar()</code>: bar chart</li>
<li><code>geom_histogram()</code>: histogram plots</li>
<li><code>geom_smooth()</code>: regression lines or curves</li>
</ul>
<p>We introduce a few of them in detail as follows.</p>
<!-- ### Path, line and step plots -->
<!-- It is important to note there are three line and step plotting functions we can use. -->
<!-- > - Line plots, `geom_line()` connects them in order of the variable on the x axis.  -->
<!-- > - Path plots, `geom_path()` connects the observations in the order in which they appear in the data. -->
<!-- > - Step plots, `geom_step()` creates a stairstep plot, highlighting exactly when changes occur.  -->
<!-- ```{r Timeseries3, fig.show="hold", out.width="33%", fig.cap='Line plot, path plot and step plot examples'} -->
<!-- d <- as.Date('2020-12-11') -->
<!-- df <- slid::state.long %>%  -->
<!--   dplyr::filter(DATE == d)  -->
<!-- p <- ggplot(df, aes(pop, Infected)) + -->
<!--   labs(title = 'Cum. Infected vs population on 2020-12-11') -->
<!-- p + geom_line() -->
<!-- p + geom_path() -->
<!-- p + geom_step() -->
<!-- ``` -->
<div id="histogram" class="section level3">
<h3><span class="header-section-number">4.5.1</span> Histogram</h3>
<p>The histogram is an important tool to summarize the range and frequency of observations. Here we plot the histogram of log daily new infected cases counts using using <code>geom_histogram</code>. We can adjust the option <code>binwidth</code> to control the widths of the bins.</p>
<div class="sourceCode" id="cb81"><pre class="sourceCode r"><code class="sourceCode r"><span id="cb81-1"><a href="ggplot2.html#cb81-1"></a><span class="co"># Prepare the daily new Infected for each state </span></span>
<span id="cb81-2"><a href="ggplot2.html#cb81-2"></a><span class="co"># in the period 2020-11-12 to 2020-12-11</span></span>
<span id="cb81-3"><a href="ggplot2.html#cb81-3"></a>df &lt;-<span class="st"> </span>slid<span class="op">::</span>state.long <span class="op">%&gt;%</span><span class="st"> </span></span>
<span id="cb81-4"><a href="ggplot2.html#cb81-4"></a><span class="st">  </span>dplyr<span class="op">::</span><span class="kw">filter</span>(DATE <span class="op">&lt;=</span><span class="st"> &#39;2020-12-11&#39;</span> <span class="op">&amp;</span><span class="st"> </span>DATE <span class="op">&gt;</span><span class="st"> &#39;2020-11-11&#39;</span>) <span class="op">%&gt;%</span></span>
<span id="cb81-5"><a href="ggplot2.html#cb81-5"></a><span class="st">  </span><span class="kw">group_by</span>(State) <span class="op">%&gt;%</span><span class="st"> </span><span class="co"># Group by State</span></span>
<span id="cb81-6"><a href="ggplot2.html#cb81-6"></a><span class="st">  </span><span class="kw">mutate</span>(<span class="dt">Y.Infected =</span> </span>
<span id="cb81-7"><a href="ggplot2.html#cb81-7"></a>           <span class="kw">c</span>(Infected[<span class="op">-</span><span class="kw">length</span>(Infected)] <span class="op">-</span><span class="st"> </span>Infected[<span class="op">-</span><span class="dv">1</span>], <span class="dv">0</span>)) </span>
<span id="cb81-8"><a href="ggplot2.html#cb81-8"></a>df</span></code></pre></div>
<pre><code>## # A tibble: 1,470 x 8
## # Groups:   State [49]
##    State Region Division    pop DATE       Infected Death
##    &lt;fct&gt; &lt;fct&gt;  &lt;fct&gt;     &lt;int&gt; &lt;date&gt;        &lt;int&gt; &lt;int&gt;
##  1 Alab… South  East So… 4.89e6 2020-12-11   288775  4086
##  2 Alab… South  East So… 4.89e6 2020-12-10   284922  4034
##  3 Alab… South  East So… 4.89e6 2020-12-09   280187  3985
##  4 Alab… South  East So… 4.89e6 2020-12-08   276665  3940
##  5 Alab… South  East So… 4.89e6 2020-12-07   272228  3891
##  6 Alab… South  East So… 4.89e6 2020-12-06   269877  3888
##  7 Alab… South  East So… 4.89e6 2020-12-05   267589  3876
##  8 Alab… South  East So… 4.89e6 2020-12-04   264199  3831
##  9 Alab… South  East So… 4.89e6 2020-12-03   260359  3776
## 10 Alab… South  East So… 4.89e6 2020-12-02   256828  3711
## # … with 1,460 more rows, and 1 more variable:
## #   Y.Infected &lt;dbl&gt;</code></pre>
<div class="sourceCode" id="cb83"><pre class="sourceCode r"><code class="sourceCode r"><span id="cb83-1"><a href="ggplot2.html#cb83-1"></a>p &lt;-<span class="st"> </span><span class="kw">ggplot</span>(df, <span class="kw">aes</span>(<span class="kw">log</span>(Y.Infected <span class="op">+</span><span class="st"> </span><span class="dv">1</span>))) </span>
<span id="cb83-2"><a href="ggplot2.html#cb83-2"></a>p <span class="op">+</span><span class="st"> </span><span class="kw">geom_histogram</span>(<span class="dt">binwidth =</span> <span class="dv">1</span>)</span>
<span id="cb83-3"><a href="ggplot2.html#cb83-3"></a>p <span class="op">+</span><span class="st"> </span><span class="kw">geom_histogram</span>(<span class="dt">binwidth =</span> <span class="dv">1</span>) <span class="op">+</span><span class="st"> </span><span class="kw">aes</span>(<span class="dt">fill =</span> Region) </span></code></pre></div>
<div class="figure"><span id="fig:Histogram"></span>
<img src="SLID_book_files/figure-html/Histogram-1.png" alt="Histogram examples" width="50%" /><img src="SLID_book_files/figure-html/Histogram-2.png" alt="Histogram examples" width="50%" />
<p class="caption">
Figure 4.10: Histogram examples
</p>
</div>
</div>
<div id="bar-chart" class="section level3">
<h3><span class="header-section-number">4.5.2</span> Bar chart</h3>
<p>The discrete analogue of histogram is the bar chart.</p>
</div>
<div id="default-bar-chart" class="section level3">
<h3><span class="header-section-number">4.5.3</span> Default bar chart</h3>
<p>The default <code>geom_bar()</code>, or equivalently <code>geom_bar(stat='count')</code>, counts the number of observations in each category shown as following. This plot essentially tells us how many states there are in each region.</p>
<div class="sourceCode" id="cb84"><pre class="sourceCode r"><code class="sourceCode r"><span id="cb84-1"><a href="ggplot2.html#cb84-1"></a>df &lt;-<span class="st"> </span>slid<span class="op">::</span>state.long <span class="op">%&gt;%</span><span class="st"> </span></span>
<span id="cb84-2"><a href="ggplot2.html#cb84-2"></a><span class="st">  </span>dplyr<span class="op">::</span><span class="kw">filter</span>(DATE <span class="op">==</span><span class="st"> </span><span class="kw">as.Date</span>(<span class="st">&#39;2020-12-11&#39;</span>)) </span>
<span id="cb84-3"><a href="ggplot2.html#cb84-3"></a>p &lt;-<span class="st"> </span><span class="kw">ggplot</span>(df, <span class="kw">aes</span>(Region))</span>
<span id="cb84-4"><a href="ggplot2.html#cb84-4"></a>p <span class="op">+</span><span class="st"> </span><span class="kw">geom_bar</span>()</span></code></pre></div>
<div class="figure" style="text-align: center"><span id="fig:Boxplot1"></span>
<img src="SLID_book_files/figure-html/Boxplot1-1.png" alt="Bar plot example" width="50%" />
<p class="caption">
Figure 4.11: Bar plot example
</p>
</div>
</div>
<div id="bar-chart-with-assigned-value" class="section level3">
<h3><span class="header-section-number">4.5.4</span> Bar chart with assigned value</h3>
<p>In addition to the previous example, we can assign the height of the bars by ourselves by using the option <code>geom_bar(stat = 'identity')</code>. In that case, we tell <code>geom_bar</code> to use <code>y</code> value in the data frame as the height of the bars.</p>
<div class="sourceCode" id="cb85"><pre class="sourceCode r"><code class="sourceCode r"><span id="cb85-1"><a href="ggplot2.html#cb85-1"></a>df &lt;-<span class="st"> </span>slid<span class="op">::</span>state.long <span class="op">%&gt;%</span><span class="st"> </span></span>
<span id="cb85-2"><a href="ggplot2.html#cb85-2"></a><span class="st">  </span>dplyr<span class="op">::</span><span class="kw">filter</span>(DATE <span class="op">==</span><span class="st"> </span><span class="kw">as.Date</span>(<span class="st">&#39;2020-12-11&#39;</span>)) </span>
<span id="cb85-3"><a href="ggplot2.html#cb85-3"></a>p &lt;-<span class="st"> </span><span class="kw">ggplot</span>(df, <span class="kw">aes</span>(Region, Infected)) </span>
<span id="cb85-4"><a href="ggplot2.html#cb85-4"></a>p <span class="op">+</span><span class="st"> </span><span class="kw">geom_bar</span>(<span class="dt">stat =</span> <span class="st">&#39;identity&#39;</span>) </span>
<span id="cb85-5"><a href="ggplot2.html#cb85-5"></a>p <span class="op">+</span><span class="st"> </span><span class="kw">geom_bar</span>(<span class="dt">stat =</span> <span class="st">&#39;identity&#39;</span>, <span class="kw">aes</span>(<span class="dt">fill =</span> Division))</span></code></pre></div>
<div class="figure"><span id="fig:Boxplot2"></span>
<img src="SLID_book_files/figure-html/Boxplot2-1.png" alt="Bar plot with assigned values" width="50%" /><img src="SLID_book_files/figure-html/Boxplot2-2.png" alt="Bar plot with assigned values" width="50%" />
<p class="caption">
Figure 4.12: Bar plot with assigned values
</p>
</div>
</div>
<div id="legend" class="section level3">
<h3><span class="header-section-number">4.5.5</span> Legend</h3>
<ol style="list-style-type: decimal">
<li>Legend position</li>
</ol>
<p>We can adjust the position of the legends using <code>theme(legend.position = 'left/right/bottom/none')</code>.</p>
<div class="sourceCode" id="cb86"><pre class="sourceCode r"><code class="sourceCode r"><span id="cb86-1"><a href="ggplot2.html#cb86-1"></a>p &lt;-<span class="st"> </span><span class="kw">ggplot</span>(df, <span class="kw">aes</span>(Region, <span class="dt">fill =</span> Region)) <span class="op">+</span></span>
<span id="cb86-2"><a href="ggplot2.html#cb86-2"></a><span class="st">  </span><span class="kw">ylab</span>(<span class="st">&#39;Number of states&#39;</span>) <span class="op">+</span><span class="st"> </span></span>
<span id="cb86-3"><a href="ggplot2.html#cb86-3"></a><span class="st">  </span><span class="kw">geom_bar</span>()</span>
<span id="cb86-4"><a href="ggplot2.html#cb86-4"></a></span>
<span id="cb86-5"><a href="ggplot2.html#cb86-5"></a>p <span class="op">+</span><span class="st"> </span><span class="kw">theme</span>(<span class="dt">legend.position =</span> <span class="st">&#39;bottom&#39;</span>)</span></code></pre></div>
<div class="figure" style="text-align: center"><span id="fig:unnamed-chunk-49"></span>
<img src="SLID_book_files/figure-html/unnamed-chunk-49-1.png" alt="Scatterplot with legend at bottom" width="50%" />
<p class="caption">
Figure 4.13: Scatterplot with legend at bottom
</p>
</div>
<ol start="2" style="list-style-type: decimal">
<li>Legend guide <code>guide_legend()</code></li>
</ol>
<p>We can also assign individual keys to the legend using options of <code>guide_legend()</code>. Here we introduce the most useful options.</p>
<ul>
<li><code>nrow</code> and <code>ncol</code>: specify the dimensions of the table. <code>byrow</code>: fills the rows, set to <code>FALSE</code> by default.</li>
</ul>
<div class="sourceCode" id="cb87"><pre class="sourceCode r"><code class="sourceCode r"><span id="cb87-1"><a href="ggplot2.html#cb87-1"></a>p <span class="op">+</span><span class="st"> </span><span class="kw">guides</span>(<span class="dt">fill =</span> <span class="kw">guide_legend</span>(<span class="dt">ncol =</span> <span class="dv">2</span>, <span class="dt">byrow =</span> <span class="ot">TRUE</span>))</span></code></pre></div>
<div class="figure" style="text-align: center"><span id="fig:unnamed-chunk-50"></span>
<img src="SLID_book_files/figure-html/unnamed-chunk-50-1.png" alt="Bar plots of number of states in each region" width="50%" />
<p class="caption">
Figure 4.14: Bar plots of number of states in each region
</p>
</div>
<ul>
<li><code>reverse</code>: reverse the order of the keys</li>
</ul>
<div class="sourceCode" id="cb88"><pre class="sourceCode r"><code class="sourceCode r"><span id="cb88-1"><a href="ggplot2.html#cb88-1"></a>p <span class="op">+</span><span class="st"> </span><span class="kw">guides</span>(<span class="dt">fill =</span> <span class="kw">guide_legend</span>(<span class="dt">reverse =</span> <span class="ot">TRUE</span>))</span></code></pre></div>
<div class="figure" style="text-align: center"><span id="fig:unnamed-chunk-51"></span>
<img src="SLID_book_files/figure-html/unnamed-chunk-51-1.png" alt="Bar plots of number of states in each region" width="50%" />
<p class="caption">
Figure 4.15: Bar plots of number of states in each region
</p>
</div>
</div>
<div id="boxplots-jittering-and-violin-plots" class="section level3">
<h3><span class="header-section-number">4.5.6</span> Boxplots, jittering and violin plots</h3>
<p>Conditioning on a categorical feature, or conditioning on groups, we may want to conduct a side-by-side comparison for a certain variable. We can use the following tools.</p>
<blockquote>
<ul>
<li>Jittering, <code>geom_jitter()</code>, adds a little random noise to the data, which can help avoid overplotting.</li>
<li>Boxplots, <code>geom_boxplot()</code>, summarize the shape of the distribution with a handful of summary statistics.</li>
<li>Violin plots, <code>geom_violin()</code>, show a compact representation of the “density” of the distribution, highlighting the areas where more points are found.</li>
</ul>
</blockquote>
<div class="sourceCode" id="cb89"><pre class="sourceCode r"><code class="sourceCode r"><span id="cb89-1"><a href="ggplot2.html#cb89-1"></a>df &lt;-<span class="st"> </span>slid<span class="op">::</span>state.long <span class="op">%&gt;%</span><span class="st"> </span></span>
<span id="cb89-2"><a href="ggplot2.html#cb89-2"></a><span class="st">  </span>dplyr<span class="op">::</span><span class="kw">filter</span>(DATE <span class="op">==</span><span class="st"> </span><span class="kw">as.Date</span>(<span class="st">&#39;2020-12-11&#39;</span>)) <span class="op">%&gt;%</span></span>
<span id="cb89-3"><a href="ggplot2.html#cb89-3"></a><span class="st">  </span><span class="kw">mutate</span>(<span class="dt">Risk =</span> Infected <span class="op">/</span><span class="st"> </span>pop)</span>
<span id="cb89-4"><a href="ggplot2.html#cb89-4"></a></span>
<span id="cb89-5"><a href="ggplot2.html#cb89-5"></a>p &lt;-<span class="st"> </span><span class="kw">ggplot</span>(df, <span class="kw">aes</span>(Region, Risk, <span class="dt">color =</span> Region)) </span>
<span id="cb89-6"><a href="ggplot2.html#cb89-6"></a>p <span class="op">+</span><span class="st"> </span><span class="kw">geom_point</span>()</span>
<span id="cb89-7"><a href="ggplot2.html#cb89-7"></a>p <span class="op">+</span><span class="st"> </span><span class="kw">geom_jitter</span>()</span>
<span id="cb89-8"><a href="ggplot2.html#cb89-8"></a>p <span class="op">+</span><span class="st"> </span><span class="kw">geom_boxplot</span>()</span>
<span id="cb89-9"><a href="ggplot2.html#cb89-9"></a>p <span class="op">+</span><span class="st"> </span><span class="kw">geom_violin</span>()</span></code></pre></div>
<div class="figure"><span id="fig:Boxplot3"></span>
<img src="SLID_book_files/figure-html/Boxplot3-1.png" alt="Points, jittering, boxplot, and violin plot examples" width="50%" /><img src="SLID_book_files/figure-html/Boxplot3-2.png" alt="Points, jittering, boxplot, and violin plot examples" width="50%" /><img src="SLID_book_files/figure-html/Boxplot3-3.png" alt="Points, jittering, boxplot, and violin plot examples" width="50%" /><img src="SLID_book_files/figure-html/Boxplot3-4.png" alt="Points, jittering, boxplot, and violin plot examples" width="50%" />
<p class="caption">
Figure 4.16: Points, jittering, boxplot, and violin plot examples
</p>
</div>
</div>
</div>
<div id="collective-geoms" class="section level2">
<h2><span class="header-section-number">4.6</span> Collective geoms</h2>
<p>An individual “geom” draws a distinct graphical object for each observation (row). For example, the “point geom” draws one point per row.
Several geoms can be added to the same ggplot object, which allows you to build up layers to create complex graphs and displays multiple observations with one geometric object. For example, we previously have created a scatter plot, and we can add regressed lines on the top of the scatter plot layer. You can add more information from a statistical summary, or add a text geom to annotate your plot.</p>
<div id="smoother" class="section level3">
<h3><span class="header-section-number">4.6.1</span> Smoother</h3>
<p>On top of the scatter plot, we can add regressed lines and prediction band to it using <code>geom_smooth()</code>.</p>
<ol style="list-style-type: decimal">
<li>The “loess” method</li>
</ol>
<p>By default, the model for small data is “loess”, we can call the layer either by <code>geom_smooth()</code> or <code>geom_smooth(method ='loess')</code>. In addition, we can adjust option <code>span</code> to control the wiggliness of the line. The higher <code>span</code> is, the less wiggle the line will be.</p>
<div class="sourceCode" id="cb90"><pre class="sourceCode r"><code class="sourceCode r"><span id="cb90-1"><a href="ggplot2.html#cb90-1"></a>df &lt;-<span class="st"> </span>slid<span class="op">::</span>state.long <span class="op">%&gt;%</span><span class="st"> </span></span>
<span id="cb90-2"><a href="ggplot2.html#cb90-2"></a><span class="st">  </span>dplyr<span class="op">::</span><span class="kw">filter</span>(DATE <span class="op">==</span><span class="st"> </span><span class="kw">as.Date</span>(<span class="st">&#39;2020-12-11&#39;</span>)) </span>
<span id="cb90-3"><a href="ggplot2.html#cb90-3"></a>p &lt;-<span class="st"> </span><span class="kw">ggplot</span>(df, <span class="kw">aes</span>(<span class="kw">log</span>(Infected <span class="op">+</span><span class="st"> </span><span class="dv">1</span>), <span class="kw">log</span>(Death <span class="op">+</span><span class="st"> </span><span class="dv">1</span>))) <span class="op">+</span></span>
<span id="cb90-4"><a href="ggplot2.html#cb90-4"></a><span class="st">  </span><span class="kw">geom_point</span>()</span>
<span id="cb90-5"><a href="ggplot2.html#cb90-5"></a><span class="co"># Use `span` to control the wiggliness of the line</span></span>
<span id="cb90-6"><a href="ggplot2.html#cb90-6"></a><span class="co"># The higher `span` is, the less wiggle the line is</span></span>
<span id="cb90-7"><a href="ggplot2.html#cb90-7"></a>p <span class="op">+</span><span class="st"> </span><span class="kw">geom_smooth</span>(<span class="dt">method =</span> <span class="st">&#39;loess&#39;</span>, <span class="dt">span =</span> <span class="fl">0.5</span>) </span>
<span id="cb90-8"><a href="ggplot2.html#cb90-8"></a>p <span class="op">+</span><span class="st"> </span><span class="kw">geom_smooth</span>(<span class="dt">method =</span> <span class="st">&#39;loess&#39;</span>, <span class="dt">span =</span> <span class="dv">1</span>) </span></code></pre></div>
<div class="figure"><span id="fig:unnamed-chunk-52"></span>
<img src="SLID_book_files/figure-html/unnamed-chunk-52-1.png" alt="loess smoother examples" width="50%" /><img src="SLID_book_files/figure-html/unnamed-chunk-52-2.png" alt="loess smoother examples" width="50%" />
<p class="caption">
Figure 4.17: loess smoother examples
</p>
</div>
<ol start="2" style="list-style-type: decimal">
<li>Linear regression method</li>
</ol>
<p>We can also use <code>method = 'lm'</code> to fit a simple linear model:
<!-- , and use `method = 'gam', formula = y ~s(x)` to fit a generalized additive model. --></p>
<div class="sourceCode" id="cb91"><pre class="sourceCode r"><code class="sourceCode r"><span id="cb91-1"><a href="ggplot2.html#cb91-1"></a><span class="co"># Fit a linear model</span></span>
<span id="cb91-2"><a href="ggplot2.html#cb91-2"></a>p <span class="op">+</span><span class="st"> </span><span class="kw">geom_smooth</span>(<span class="dt">method =</span> <span class="st">&#39;lm&#39;</span>)  </span></code></pre></div>
<div class="figure"><span id="fig:unnamed-chunk-53"></span>
<img src="SLID_book_files/figure-html/unnamed-chunk-53-1.png" alt="Linear regression estimator." width="50%" />
<p class="caption">
Figure 4.18: Linear regression estimator.
</p>
</div>
<p>After introducing the idea of individual and collective geoms, we would like to spend the rest of the chapter discussing two important collective plots, time series plots and maps. We will build them step by step from scratch.</p>
</div>
</div>
<div id="time-series" class="section level2">
<h2><span class="header-section-number">4.7</span> Time Series</h2>
<div id="basic-line-plots" class="section level3">
<h3><span class="header-section-number">4.7.1</span> Basic line plots</h3>
<p>In traditional time series plots, we use time as the x-axis variable, and plot the time series using <code>geom_line()</code>.</p>
<p>We consider the time series of the daily new infected count for Iowa.</p>
<div class="sourceCode" id="cb92"><pre class="sourceCode r"><code class="sourceCode r"><span id="cb92-1"><a href="ggplot2.html#cb92-1"></a>df &lt;-<span class="st"> </span>slid<span class="op">::</span>state.long <span class="op">%&gt;%</span></span>
<span id="cb92-2"><a href="ggplot2.html#cb92-2"></a><span class="st">  </span>dplyr<span class="op">::</span><span class="kw">filter</span>(State <span class="op">==</span><span class="st"> &quot;Iowa&quot;</span>) <span class="op">%&gt;%</span></span>
<span id="cb92-3"><a href="ggplot2.html#cb92-3"></a><span class="st">  </span><span class="kw">arrange</span>(DATE) <span class="op">%&gt;%</span></span>
<span id="cb92-4"><a href="ggplot2.html#cb92-4"></a><span class="st">  </span><span class="kw">mutate</span>(<span class="dt">Y.Infected =</span> Infected <span class="op">-</span><span class="st"> </span><span class="kw">lag</span>(Infected)) <span class="op">%&gt;%</span></span>
<span id="cb92-5"><a href="ggplot2.html#cb92-5"></a><span class="st">  </span>dplyr<span class="op">::</span><span class="kw">filter</span>(<span class="op">!</span><span class="kw">is.na</span>(Y.Infected))</span></code></pre></div>
<p>To visualize the data, we draw a time series plot first.</p>
<div class="sourceCode" id="cb93"><pre class="sourceCode r"><code class="sourceCode r"><span id="cb93-1"><a href="ggplot2.html#cb93-1"></a>p &lt;-<span class="st"> </span><span class="kw">ggplot</span>(df, <span class="kw">aes</span>(DATE, Y.Infected)) <span class="op">+</span><span class="st"> </span></span>
<span id="cb93-2"><a href="ggplot2.html#cb93-2"></a><span class="st">  </span><span class="kw">geom_line</span>() <span class="op">+</span><span class="st"> </span></span>
<span id="cb93-3"><a href="ggplot2.html#cb93-3"></a><span class="st">  </span><span class="kw">labs</span>(<span class="dt">x =</span> <span class="st">&quot;Days&quot;</span>, <span class="dt">y =</span> <span class="st">&quot;Count&quot;</span>, </span>
<span id="cb93-4"><a href="ggplot2.html#cb93-4"></a>       <span class="dt">title =</span> <span class="st">&#39;Daily new infected cases in Iowa&#39;</span>) </span>
<span id="cb93-5"><a href="ggplot2.html#cb93-5"></a>p</span></code></pre></div>
<div class="figure" style="text-align: center"><span id="fig:Timeseries2"></span>
<img src="SLID_book_files/figure-html/Timeseries2-1.png" alt="Basic time series" width="80%" />
<p class="caption">
Figure 4.19: Basic time series
</p>
</div>
</div>
<div id="add-a-second-line" class="section level3">
<h3><span class="header-section-number">4.7.2</span> Add a second line</h3>
<p>Next, we display the prediction results on the time series plot. The prediction and prediction intervals for the next 14 days are saved in the dataset: <code>slid::fore</code>.</p>
<div class="sourceCode" id="cb94"><pre class="sourceCode r"><code class="sourceCode r"><span id="cb94-1"><a href="ggplot2.html#cb94-1"></a><span class="co"># Data Preparation</span></span>
<span id="cb94-2"><a href="ggplot2.html#cb94-2"></a><span class="cf">if</span>(<span class="op">!</span><span class="kw">require</span>(<span class="st">&#39;lubridate&#39;</span>)) <span class="kw">install.packages</span>(<span class="st">&#39;lubridate&#39;</span>)</span></code></pre></div>
<div class="sourceCode" id="cb95"><pre class="sourceCode r"><code class="sourceCode r"><span id="cb95-1"><a href="ggplot2.html#cb95-1"></a><span class="kw">library</span>(lubridate)</span>
<span id="cb95-2"><a href="ggplot2.html#cb95-2"></a>df.pred &lt;-<span class="st"> </span><span class="kw">as.data.frame</span>(slid<span class="op">::</span>fore[<span class="kw">c</span>(<span class="st">&#39;mean&#39;</span>, <span class="st">&#39;lower&#39;</span>, <span class="st">&#39;upper&#39;</span>)])</span>
<span id="cb95-3"><a href="ggplot2.html#cb95-3"></a><span class="kw">names</span>(df.pred) &lt;-<span class="st"> </span><span class="kw">c</span>(<span class="st">&#39;mean&#39;</span>, <span class="st">&#39;lower&#39;</span>, <span class="st">&#39;upper&#39;</span>)</span>
<span id="cb95-4"><a href="ggplot2.html#cb95-4"></a>df.pred<span class="op">$</span>DATE &lt;-<span class="st"> </span><span class="kw">tail</span>(df<span class="op">$</span>DATE,<span class="dv">1</span>) <span class="op">+</span><span class="st"> </span></span>
<span id="cb95-5"><a href="ggplot2.html#cb95-5"></a><span class="st">  </span><span class="kw">c</span>(<span class="dv">1</span><span class="op">:</span><span class="kw">length</span>(slid<span class="op">::</span>fore<span class="op">$</span>mean))</span></code></pre></div>
<div class="sourceCode" id="cb96"><pre class="sourceCode r"><code class="sourceCode r"><span id="cb96-1"><a href="ggplot2.html#cb96-1"></a><span class="co"># Add a line for predicted value</span></span>
<span id="cb96-2"><a href="ggplot2.html#cb96-2"></a>p <span class="op">+</span><span class="st"> </span><span class="kw">geom_line</span>(<span class="dt">mapping =</span> <span class="kw">aes</span>(<span class="dt">x =</span> DATE, </span>
<span id="cb96-3"><a href="ggplot2.html#cb96-3"></a>                            <span class="dt">y =</span> mean,</span>
<span id="cb96-4"><a href="ggplot2.html#cb96-4"></a>                            <span class="dt">color =</span> <span class="st">&#39;Predicted Value&#39;</span>),</span>
<span id="cb96-5"><a href="ggplot2.html#cb96-5"></a>              <span class="dt">linetype =</span> <span class="st">&quot;dashed&quot;</span>,</span>
<span id="cb96-6"><a href="ggplot2.html#cb96-6"></a>              <span class="co"># Set the line type in legend</span></span>
<span id="cb96-7"><a href="ggplot2.html#cb96-7"></a>              <span class="dt">key_glyph =</span> <span class="st">&quot;timeseries&quot;</span>,</span>
<span id="cb96-8"><a href="ggplot2.html#cb96-8"></a>              <span class="dt">data =</span> df.pred) <span class="op">+</span><span class="st"> </span></span>
<span id="cb96-9"><a href="ggplot2.html#cb96-9"></a><span class="st">  </span><span class="kw">scale_color_manual</span>(<span class="st">&quot;&quot;</span>, <span class="dt">values =</span> <span class="st">&quot;red&quot;</span>)</span></code></pre></div>
<div class="figure" style="text-align: center"><span id="fig:tspred0"></span>
<img src="SLID_book_files/figure-html/tspred0-1.png" alt="Time series with added predictions" width="100%" />
<p class="caption">
Figure 4.20: Time series with added predictions
</p>
</div>
</div>
<div id="add-ribbons" class="section level3">
<h3><span class="header-section-number">4.7.3</span> Add ribbons</h3>
<p>Next, we show the prediction intervals. On top of the line plots, we can add another layer to the existing line, and create a line with two parts.</p>
<div class="sourceCode" id="cb97"><pre class="sourceCode r"><code class="sourceCode r"><span id="cb97-1"><a href="ggplot2.html#cb97-1"></a><span class="co"># Add prediction intervals</span></span>
<span id="cb97-2"><a href="ggplot2.html#cb97-2"></a>p &lt;-<span class="st"> </span>p <span class="op">+</span><span class="st"> </span></span>
<span id="cb97-3"><a href="ggplot2.html#cb97-3"></a><span class="st">  </span><span class="kw">geom_ribbon</span>(<span class="dt">mapping =</span> <span class="kw">aes</span>(<span class="dt">x =</span> DATE, </span>
<span id="cb97-4"><a href="ggplot2.html#cb97-4"></a>                            <span class="dt">y =</span> mean, </span>
<span id="cb97-5"><a href="ggplot2.html#cb97-5"></a>                            <span class="dt">ymin =</span> lower, </span>
<span id="cb97-6"><a href="ggplot2.html#cb97-6"></a>                            <span class="dt">ymax =</span> upper,</span>
<span id="cb97-7"><a href="ggplot2.html#cb97-7"></a>                            <span class="dt">fill =</span> <span class="st">&#39;95% Prediction Intervals&#39;</span>), </span>
<span id="cb97-8"><a href="ggplot2.html#cb97-8"></a>              <span class="dt">data =</span> df.pred, <span class="dt">alpha =</span> <span class="fl">0.2</span>) <span class="op">+</span><span class="st"> </span></span>
<span id="cb97-9"><a href="ggplot2.html#cb97-9"></a><span class="co"># Add line for predicted value</span></span>
<span id="cb97-10"><a href="ggplot2.html#cb97-10"></a><span class="kw">geom_line</span>(<span class="dt">mapping =</span> <span class="kw">aes</span>(<span class="dt">x =</span> DATE,</span>
<span id="cb97-11"><a href="ggplot2.html#cb97-11"></a><span class="dt">y =</span> mean,</span>
<span id="cb97-12"><a href="ggplot2.html#cb97-12"></a><span class="dt">color =</span> <span class="st">&#39;Predicted Value&#39;</span>),</span>
<span id="cb97-13"><a href="ggplot2.html#cb97-13"></a><span class="dt">linetype =</span> <span class="st">&quot;dashed&quot;</span>, <span class="dt">data =</span> df.pred,</span>
<span id="cb97-14"><a href="ggplot2.html#cb97-14"></a><span class="co"># Set the line type in legend</span></span>
<span id="cb97-15"><a href="ggplot2.html#cb97-15"></a><span class="dt">key_glyph =</span> <span class="st">&quot;timeseries&quot;</span>) <span class="op">+</span></span>
<span id="cb97-16"><a href="ggplot2.html#cb97-16"></a><span class="kw">scale_color_manual</span>(<span class="st">&quot;&quot;</span>, <span class="dt">values =</span> <span class="st">&quot;red&quot;</span>)<span class="op">+</span></span>
<span id="cb97-17"><a href="ggplot2.html#cb97-17"></a><span class="kw">scale_fill_manual</span>(<span class="st">&quot;&quot;</span>, <span class="dt">values =</span> <span class="st">&quot;pink&quot;</span>)</span>
<span id="cb97-18"><a href="ggplot2.html#cb97-18"></a></span>
<span id="cb97-19"><a href="ggplot2.html#cb97-19"></a>p</span></code></pre></div>
<div class="figure" style="text-align: center"><span id="fig:tspred"></span>
<img src="SLID_book_files/figure-html/tspred-1.png" alt="Time series with ribbons and second line" width="100%" />
<p class="caption">
Figure 4.21: Time series with ribbons and second line
</p>
</div>
<p><strong>Remarks:</strong> the layer added later is put on the top, therefore it is important to keep track of the order you add the layers.</p>
</div>
<div id="adjust-the-scale-of-time-axis" class="section level3">
<h3><span class="header-section-number">4.7.4</span> Adjust the scale of time axis</h3>
<p>There are several ways to define the axis ticks of dates and times. There are the labeled <strong>major breaks</strong> and further the <strong>minor breaks</strong>, which are not labeled but marked by grid lines. These can be customized with the arguments <code>date_breaks</code> and <code>date_minor_breaks</code>, respectively.</p>
<div class="sourceCode" id="cb98"><pre class="sourceCode r"><code class="sourceCode r"><span id="cb98-1"><a href="ggplot2.html#cb98-1"></a><span class="co"># Adjust the scale of time axis</span></span>
<span id="cb98-2"><a href="ggplot2.html#cb98-2"></a>p <span class="op">+</span><span class="st"> </span><span class="kw">scale_x_date</span>(</span>
<span id="cb98-3"><a href="ggplot2.html#cb98-3"></a>  <span class="dt">limits =</span> <span class="kw">as.Date</span>(<span class="kw">c</span>(<span class="st">&quot;2020-10-01&quot;</span>, <span class="st">&quot;2021-01-01&quot;</span>)),</span>
<span id="cb98-4"><a href="ggplot2.html#cb98-4"></a>  <span class="dt">date_breaks =</span> <span class="st">&quot;1 month&quot;</span>,</span>
<span id="cb98-5"><a href="ggplot2.html#cb98-5"></a>  <span class="dt">date_minor_breaks =</span> <span class="st">&quot;1 week&quot;</span>,</span>
<span id="cb98-6"><a href="ggplot2.html#cb98-6"></a>  <span class="dt">date_labels =</span> <span class="st">&quot;%B %Y&quot;</span></span>
<span id="cb98-7"><a href="ggplot2.html#cb98-7"></a>)</span></code></pre></div>
<div class="figure" style="text-align: center"><span id="fig:unnamed-chunk-57"></span>
<img src="SLID_book_files/figure-html/unnamed-chunk-57-1.png" alt="Time series plot with adjusted time range and format" width="100%" />
<p class="caption">
Figure 4.22: Time series plot with adjusted time range and format
</p>
</div>
<p>In the above syntax, <code>date_labels</code> set to a string of formatting codes, defining order, format and elements to be displayed:</p>
<ul>
<li><code>%d</code>: day of the month (01-31)</li>
<li><code>%m</code>: month, numeric (01-12)</li>
<li><code>%b</code>: month, abbreviated (Jan-Dec)</li>
<li><code>%B</code>: month, full (January-December)</li>
<li><code>%y</code>: year, without century (00-99)</li>
<li><code>%Y</code>: year, with century (0000-9999)</li>
</ul>
</div>
<div id="add-annotations" class="section level3">
<h3><span class="header-section-number">4.7.5</span> Add annotations</h3>
<p>When constructing a data visualization, it is often necessary to make annotations to the data displayed. An annotation supplies additional information about the data being displayed. For example, adding text to a plot is one of the most common forms of annotation. The primary tool for labeling plots is <code>geom_text()</code>, which adds label text at the specified <code>x</code> and <code>y</code> positions. We can also add reference lines to the plot using <code>geom_vline</code> or <code>geom_hline</code>. Figure <a href="#annotate1"><strong>??</strong></a> shows an annotated time series plot with shades and reference lines for each quarter.</p>
<div class="sourceCode" id="cb99"><pre class="sourceCode r"><code class="sourceCode r"><span id="cb99-1"><a href="ggplot2.html#cb99-1"></a><span class="co"># Prepare the data</span></span>
<span id="cb99-2"><a href="ggplot2.html#cb99-2"></a>df &lt;-<span class="st"> </span>df <span class="op">%&gt;%</span></span>
<span id="cb99-3"><a href="ggplot2.html#cb99-3"></a><span class="st">  </span><span class="kw">mutate</span>(<span class="dt">start =</span> <span class="kw">floor_date</span>(DATE, <span class="st">&quot;quarter&quot;</span>)) <span class="op">%&gt;%</span></span>
<span id="cb99-4"><a href="ggplot2.html#cb99-4"></a><span class="st">  </span><span class="kw">mutate</span>(<span class="dt">end =</span> <span class="kw">ceiling_date</span>(DATE, <span class="st">&quot;quarter&quot;</span>)) <span class="op">%&gt;%</span></span>
<span id="cb99-5"><a href="ggplot2.html#cb99-5"></a><span class="st">  </span><span class="kw">mutate</span>(<span class="dt">quarters =</span> <span class="kw">as.factor</span>(<span class="kw">quarter</span>(DATE))) </span>
<span id="cb99-6"><a href="ggplot2.html#cb99-6"></a>  </span>
<span id="cb99-7"><a href="ggplot2.html#cb99-7"></a>df.quarters &lt;-<span class="st"> </span>df <span class="op">%&gt;%</span><span class="st"> </span></span>
<span id="cb99-8"><a href="ggplot2.html#cb99-8"></a><span class="st">  </span>dplyr<span class="op">::</span><span class="kw">select</span>(start, end, quarters) <span class="op">%&gt;%</span></span>
<span id="cb99-9"><a href="ggplot2.html#cb99-9"></a><span class="st">  </span><span class="kw">unique</span>()</span>
<span id="cb99-10"><a href="ggplot2.html#cb99-10"></a></span>
<span id="cb99-11"><a href="ggplot2.html#cb99-11"></a><span class="co"># Draw the base ggplot</span></span>
<span id="cb99-12"><a href="ggplot2.html#cb99-12"></a><span class="kw">ggplot</span>(df, <span class="kw">aes</span>(DATE, Y.Infected)) <span class="op">+</span></span>
<span id="cb99-13"><a href="ggplot2.html#cb99-13"></a><span class="st">  </span><span class="kw">labs</span>(<span class="dt">x =</span> <span class="st">&quot;Days&quot;</span>, <span class="dt">y =</span> <span class="st">&quot;Count&quot;</span>, </span>
<span id="cb99-14"><a href="ggplot2.html#cb99-14"></a>       <span class="dt">title =</span> <span class="st">&#39;Daily new infected cases in Iowa&#39;</span>) <span class="op">+</span></span>
<span id="cb99-15"><a href="ggplot2.html#cb99-15"></a><span class="st">  </span></span>
<span id="cb99-16"><a href="ggplot2.html#cb99-16"></a><span class="st">  </span><span class="co"># Add rectangle for each quarter</span></span>
<span id="cb99-17"><a href="ggplot2.html#cb99-17"></a><span class="st">  </span><span class="kw">geom_rect</span>(</span>
<span id="cb99-18"><a href="ggplot2.html#cb99-18"></a>    <span class="kw">aes</span>(<span class="dt">xmin =</span> (start), <span class="dt">xmax =</span> (end), <span class="dt">fill =</span> quarters),</span>
<span id="cb99-19"><a href="ggplot2.html#cb99-19"></a>    <span class="dt">inherit.aes =</span> F, <span class="dt">ymin =</span> <span class="op">-</span><span class="ot">Inf</span>, <span class="dt">ymax =</span> <span class="ot">Inf</span>, </span>
<span id="cb99-20"><a href="ggplot2.html#cb99-20"></a>    <span class="dt">alpha =</span> <span class="fl">.5</span>, <span class="dt">data =</span> df.quarters) <span class="op">+</span><span class="st"> </span></span>
<span id="cb99-21"><a href="ggplot2.html#cb99-21"></a><span class="st">  </span><span class="kw">scale_fill_brewer</span>(<span class="dt">palette =</span> <span class="st">&quot;Blues&quot;</span>, <span class="dt">aesthetics =</span> <span class="st">&quot;fill&quot;</span>) <span class="op">+</span></span>
<span id="cb99-22"><a href="ggplot2.html#cb99-22"></a><span class="st">  </span></span>
<span id="cb99-23"><a href="ggplot2.html#cb99-23"></a><span class="st">  </span><span class="co"># Add vertical line</span></span>
<span id="cb99-24"><a href="ggplot2.html#cb99-24"></a><span class="st">  </span><span class="kw">geom_vline</span>(<span class="kw">aes</span>(<span class="dt">xintercept =</span> <span class="kw">as.numeric</span>(start)), </span>
<span id="cb99-25"><a href="ggplot2.html#cb99-25"></a>    <span class="dt">data =</span> df, <span class="dt">color =</span> <span class="st">&quot;gray&quot;</span>,</span>
<span id="cb99-26"><a href="ggplot2.html#cb99-26"></a>    <span class="dt">linetype =</span> <span class="st">&#39;dashed&#39;</span>, <span class="dt">size =</span> <span class="fl">0.5</span>) <span class="op">+</span><span class="st"> </span></span>
<span id="cb99-27"><a href="ggplot2.html#cb99-27"></a><span class="st">  </span></span>
<span id="cb99-28"><a href="ggplot2.html#cb99-28"></a><span class="st">  </span><span class="co"># Add text</span></span>
<span id="cb99-29"><a href="ggplot2.html#cb99-29"></a><span class="st">  </span><span class="kw">geom_text</span>(</span>
<span id="cb99-30"><a href="ggplot2.html#cb99-30"></a>    <span class="kw">aes</span>(<span class="dt">x =</span> start, <span class="dt">y =</span> <span class="dv">0</span> , <span class="dt">label =</span> <span class="kw">paste0</span>(<span class="st">&#39;Quarter:&#39;</span>, quarters)), </span>
<span id="cb99-31"><a href="ggplot2.html#cb99-31"></a>    <span class="dt">data =</span> df.quarters, <span class="dt">inherit.aes =</span> F,</span>
<span id="cb99-32"><a href="ggplot2.html#cb99-32"></a>    <span class="dt">size =</span> <span class="dv">3</span>, <span class="dt">vjust =</span> <span class="dv">0</span>, <span class="dt">hjust =</span> <span class="dv">0</span>, <span class="dt">nudge_x =</span> <span class="dv">20</span>) <span class="op">+</span></span>
<span id="cb99-33"><a href="ggplot2.html#cb99-33"></a><span class="st">  </span></span>
<span id="cb99-34"><a href="ggplot2.html#cb99-34"></a><span class="st">  </span><span class="co"># Add time series lines</span></span>
<span id="cb99-35"><a href="ggplot2.html#cb99-35"></a><span class="st">  </span><span class="kw">geom_line</span>() <span class="op">+</span></span>
<span id="cb99-36"><a href="ggplot2.html#cb99-36"></a><span class="st">  </span><span class="kw">geom_line</span>(<span class="dt">mapping =</span> <span class="kw">aes</span>(<span class="dt">x =</span> DATE, <span class="dt">y =</span> mean,</span>
<span id="cb99-37"><a href="ggplot2.html#cb99-37"></a>                          <span class="dt">color =</span> <span class="st">&#39;Predicted Value&#39;</span>),</span>
<span id="cb99-38"><a href="ggplot2.html#cb99-38"></a>            <span class="dt">linetype =</span> <span class="st">&quot;dashed&quot;</span>, <span class="dt">data =</span> df.pred ,</span>
<span id="cb99-39"><a href="ggplot2.html#cb99-39"></a>            <span class="dt">key_glyph =</span> <span class="st">&quot;timeseries&quot;</span>) </span></code></pre></div>
<div class="figure" style="text-align: center"><span id="fig:annotate1"></span>
<img src="SLID_book_files/figure-html/annotate1-1.png" alt="Time series plot with shades and reference lines." width="100%" />
<p class="caption">
Figure 4.23: Time series plot with shades and reference lines.
</p>
</div>
</div>
</div>
<div id="maps" class="section level2">
<h2><span class="header-section-number">4.8</span> Maps</h2>
<p>In epidemilogy, data often includes geographical information such as latitude and longitude or regions like country, state or county. To plot these types of data, we can extend an existing visualization onto a map background. We will learn how to make choropleth maps, sometimes called heat maps, using the <code>ggplot2</code> package. A <strong>choropleth map</strong> is a map that shows a geographic landscape with units such as countries, states, or watersheds where each unit is colored according to a particular value.</p>
<div class="sourceCode" id="cb100"><pre class="sourceCode r"><code class="sourceCode r"><span id="cb100-1"><a href="ggplot2.html#cb100-1"></a><span class="co"># Read map and data</span></span>
<span id="cb100-2"><a href="ggplot2.html#cb100-2"></a><span class="kw">library</span>(ggplot2)</span>
<span id="cb100-3"><a href="ggplot2.html#cb100-3"></a><span class="kw">library</span>(maps)</span></code></pre></div>
<pre><code>## 
## Attaching package: &#39;maps&#39;</code></pre>
<pre><code>## The following object is masked from &#39;package:purrr&#39;:
## 
##     map</code></pre>
<div class="sourceCode" id="cb103"><pre class="sourceCode r"><code class="sourceCode r"><span id="cb103-1"><a href="ggplot2.html#cb103-1"></a><span class="kw">library</span>(dplyr)</span>
<span id="cb103-2"><a href="ggplot2.html#cb103-2"></a></span>
<span id="cb103-3"><a href="ggplot2.html#cb103-3"></a><span class="co"># Load United States state map data</span></span>
<span id="cb103-4"><a href="ggplot2.html#cb103-4"></a>MainStates &lt;-<span class="st"> </span><span class="kw">map_data</span>(<span class="st">&quot;state&quot;</span>)</span>
<span id="cb103-5"><a href="ggplot2.html#cb103-5"></a><span class="kw">head</span>(MainStates, <span class="dv">3</span>)</span></code></pre></div>
<pre><code>##        long      lat group order  region subregion
## 1 -87.46201 30.38968     1     1 alabama      &lt;NA&gt;
## 2 -87.48493 30.37249     1     2 alabama      &lt;NA&gt;
## 3 -87.52503 30.37249     1     3 alabama      &lt;NA&gt;</code></pre>
<div class="sourceCode" id="cb105"><pre class="sourceCode r"><code class="sourceCode r"><span id="cb105-1"><a href="ggplot2.html#cb105-1"></a>MainStates &lt;-<span class="st"> </span>MainStates <span class="op">%&gt;%</span></span>
<span id="cb105-2"><a href="ggplot2.html#cb105-2"></a><span class="st">  </span><span class="kw">mutate</span>(<span class="st">&#39;state&#39;</span> =<span class="st"> </span><span class="kw">gsub</span>(<span class="st">&#39; &#39;</span>, <span class="st">&#39;&#39;</span>, MainStates<span class="op">$</span>region)) <span class="op">%&gt;%</span></span>
<span id="cb105-3"><a href="ggplot2.html#cb105-3"></a><span class="st">  </span><span class="kw">select</span>(<span class="op">-</span><span class="kw">c</span>(<span class="st">&#39;region&#39;</span>,<span class="st">&#39;subregion&#39;</span>))</span>
<span id="cb105-4"><a href="ggplot2.html#cb105-4"></a><span class="kw">head</span>(MainStates, <span class="dv">3</span>)</span></code></pre></div>
<pre><code>##        long      lat group order   state
## 1 -87.46201 30.38968     1     1 alabama
## 2 -87.48493 30.37249     1     2 alabama
## 3 -87.52503 30.37249     1     3 alabama</code></pre>
<div class="sourceCode" id="cb107"><pre class="sourceCode r"><code class="sourceCode r"><span id="cb107-1"><a href="ggplot2.html#cb107-1"></a>state.long.shape &lt;-<span class="st"> </span>slid<span class="op">::</span>state.long <span class="op">%&gt;%</span><span class="st"> </span></span>
<span id="cb107-2"><a href="ggplot2.html#cb107-2"></a><span class="st">  </span><span class="kw">mutate</span>(<span class="st">&#39;state&#39;</span> =<span class="st"> </span><span class="kw">tolower</span>(slid<span class="op">::</span>state.long<span class="op">$</span>State)) <span class="op">%&gt;%</span></span>
<span id="cb107-3"><a href="ggplot2.html#cb107-3"></a><span class="st">  </span><span class="kw">right_join</span>(MainStates, <span class="dt">by =</span> <span class="st">&#39;state&#39;</span>) <span class="op">%&gt;%</span></span>
<span id="cb107-4"><a href="ggplot2.html#cb107-4"></a><span class="st">  </span><span class="kw">select</span>(<span class="op">-</span>state)</span>
<span id="cb107-5"><a href="ggplot2.html#cb107-5"></a>state.long.shape</span></code></pre></div>
<pre><code>## # A tibble: 5,049,525 x 11
##    State Region Division    pop DATE       Infected Death
##    &lt;fct&gt; &lt;fct&gt;  &lt;fct&gt;     &lt;int&gt; &lt;date&gt;        &lt;int&gt; &lt;int&gt;
##  1 Alab… South  East So… 4.89e6 2020-12-11   288775  4086
##  2 Alab… South  East So… 4.89e6 2020-12-11   288775  4086
##  3 Alab… South  East So… 4.89e6 2020-12-11   288775  4086
##  4 Alab… South  East So… 4.89e6 2020-12-11   288775  4086
##  5 Alab… South  East So… 4.89e6 2020-12-11   288775  4086
##  6 Alab… South  East So… 4.89e6 2020-12-11   288775  4086
##  7 Alab… South  East So… 4.89e6 2020-12-11   288775  4086
##  8 Alab… South  East So… 4.89e6 2020-12-11   288775  4086
##  9 Alab… South  East So… 4.89e6 2020-12-11   288775  4086
## 10 Alab… South  East So… 4.89e6 2020-12-11   288775  4086
## # … with 5,049,515 more rows, and 4 more variables:
## #   long &lt;dbl&gt;, lat &lt;dbl&gt;, group &lt;dbl&gt;, order &lt;int&gt;</code></pre>
<div class="sourceCode" id="cb109"><pre class="sourceCode r"><code class="sourceCode r"><span id="cb109-1"><a href="ggplot2.html#cb109-1"></a>df &lt;-<span class="st"> </span>state.long.shape <span class="op">%&gt;%</span><span class="st"> </span></span>
<span id="cb109-2"><a href="ggplot2.html#cb109-2"></a><span class="st">  </span>dplyr<span class="op">::</span><span class="kw">filter</span>(DATE <span class="op">==</span><span class="st"> &#39;2020-12-11&#39;</span>)  <span class="op">%&gt;%</span><span class="st"> </span></span>
<span id="cb109-3"><a href="ggplot2.html#cb109-3"></a><span class="st">  </span><span class="kw">mutate</span> (<span class="dt">Risk =</span> Infected <span class="op">/</span><span class="st"> </span>pop <span class="op">*</span><span class="st"> </span><span class="dv">1000</span>)</span></code></pre></div>
<div id="making-a-base-map" class="section level3">
<h3><span class="header-section-number">4.8.1</span> Making a base map</h3>
<p>Using <code>qplot()</code>, we can obtain our first map like this:</p>
<div class="sourceCode" id="cb110"><pre class="sourceCode r"><code class="sourceCode r"><span id="cb110-1"><a href="ggplot2.html#cb110-1"></a><span class="kw">qplot</span>(long, lat, <span class="dt">geom =</span> <span class="st">&quot;point&quot;</span>, <span class="dt">data =</span> df)</span></code></pre></div>
<div class="figure" style="text-align: center"><span id="fig:unnamed-chunk-59"></span>
<img src="SLID_book_files/figure-html/unnamed-chunk-59-1.png" alt="Basic US map with dotted state boundaries" width="75%" />
<p class="caption">
Figure 4.24: Basic US map with dotted state boundaries
</p>
</div>
<p>We can use the <code>geom_polygon()</code> function to create a map with black borders and add light blue to fill in the map.</p>
<div class="sourceCode" id="cb111"><pre class="sourceCode r"><code class="sourceCode r"><span id="cb111-1"><a href="ggplot2.html#cb111-1"></a><span class="co"># Plot all states with ggplot2, black borders and light blue fill</span></span>
<span id="cb111-2"><a href="ggplot2.html#cb111-2"></a><span class="kw">ggplot</span>() <span class="op">+</span><span class="st"> </span></span>
<span id="cb111-3"><a href="ggplot2.html#cb111-3"></a><span class="st">  </span><span class="kw">geom_polygon</span>(<span class="dt">data =</span> df, </span>
<span id="cb111-4"><a href="ggplot2.html#cb111-4"></a>               <span class="kw">aes</span>(<span class="dt">x =</span> long, <span class="dt">y =</span> lat, <span class="dt">group =</span> group),</span>
<span id="cb111-5"><a href="ggplot2.html#cb111-5"></a>                <span class="dt">color =</span> <span class="st">&quot;black&quot;</span>, <span class="dt">fill =</span> <span class="st">&quot;lightblue&quot;</span>)</span></code></pre></div>
<div class="figure" style="text-align: center"><span id="fig:unnamed-chunk-60"></span>
<img src="SLID_book_files/figure-html/unnamed-chunk-60-1.png" alt="US map with colored state areas" width="75%" />
<p class="caption">
Figure 4.25: US map with colored state areas
</p>
</div>
</div>
<div id="customizing-choropleth-map" class="section level3">
<h3><span class="header-section-number">4.8.2</span> Customizing <code>choropleth</code> map</h3>
<p>Now that we have created a base map of the mainland states, we will color each state according to its the risk. Make the use of <code>slid::ggplot_map_state</code> dataset.</p>
<div class="sourceCode" id="cb112"><pre class="sourceCode r"><code class="sourceCode r"><span id="cb112-1"><a href="ggplot2.html#cb112-1"></a><span class="co"># Create a Choropleth map of the United States</span></span>
<span id="cb112-2"><a href="ggplot2.html#cb112-2"></a>p &lt;-<span class="st"> </span><span class="kw">ggplot</span>() <span class="op">+</span><span class="st"> </span><span class="kw">geom_polygon</span>(<span class="dt">data =</span> df, </span>
<span id="cb112-3"><a href="ggplot2.html#cb112-3"></a>          <span class="kw">aes</span>(<span class="dt">x =</span> long, <span class="dt">y =</span> lat, <span class="dt">group =</span> group, </span>
<span id="cb112-4"><a href="ggplot2.html#cb112-4"></a>              <span class="dt">fill =</span> Risk), </span>
<span id="cb112-5"><a href="ggplot2.html#cb112-5"></a>          <span class="dt">color =</span> <span class="st">&quot;white&quot;</span>, <span class="dt">size =</span> <span class="fl">0.2</span>) </span>
<span id="cb112-6"><a href="ggplot2.html#cb112-6"></a>p</span></code></pre></div>
<div class="figure" style="text-align: center"><span id="fig:unnamed-chunk-61"></span>
<img src="SLID_book_files/figure-html/unnamed-chunk-61-1.png" alt="US map with colored state areas according to infected per thousand population" width="100%" />
<p class="caption">
Figure 4.26: US map with colored state areas according to infected per thousand population
</p>
</div>
<p><strong>Remarks</strong></p>
<ul>
<li><p>Each state is colored by “Infected per 1000 people” to make the legend easier to read.</p></li>
<li><p>Border color (<code>white</code>) and line thickness (<code>size = 0.2</code>) are specifically defined within this <code>geom_polygon()</code>.</p></li>
</ul>
<p>Once a map is created, it is often helpful to modify color schemes, determine how to address missing values (<code>na.values</code>), and formalize labels. Notice that we assigned the graph a name, <code>p</code>. This is particularly useful as we add new components to the map.</p>
<div class="sourceCode" id="cb113"><pre class="sourceCode r"><code class="sourceCode r"><span id="cb113-1"><a href="ggplot2.html#cb113-1"></a>p <span class="op">+</span><span class="st"> </span><span class="kw">scale_fill_continuous</span>(<span class="dt">name =</span> <span class="st">&quot;Infected per 1000 pop&quot;</span>,</span>
<span id="cb113-2"><a href="ggplot2.html#cb113-2"></a>                          <span class="dt">low =</span> <span class="st">&quot;yellow&quot;</span>, <span class="dt">high =</span> <span class="st">&quot;darkred&quot;</span>,</span>
<span id="cb113-3"><a href="ggplot2.html#cb113-3"></a>                          <span class="dt">limits =</span> <span class="kw">c</span>(<span class="dv">0</span>, <span class="dv">125</span>), </span>
<span id="cb113-4"><a href="ggplot2.html#cb113-4"></a>                          <span class="dt">breaks =</span> <span class="kw">c</span>(<span class="dv">5</span>, <span class="dv">25</span>, <span class="dv">50</span>, <span class="dv">75</span>, <span class="dv">100</span>, <span class="dv">125</span>), </span>
<span id="cb113-5"><a href="ggplot2.html#cb113-5"></a>                          <span class="dt">na.value =</span> <span class="st">&quot;grey50&quot;</span>) <span class="op">+</span></span>
<span id="cb113-6"><a href="ggplot2.html#cb113-6"></a><span class="st">  </span><span class="kw">labs</span>(<span class="dt">title =</span> <span class="st">&quot;Infected per 1000 population on 2020-12-11&quot;</span>)</span></code></pre></div>
<div class="figure" style="text-align: center"><span id="fig:unnamed-chunk-62"></span>
<img src="SLID_book_files/figure-html/unnamed-chunk-62-1.png" alt="US map with colored state areas with limits on the values" width="672" />
<p class="caption">
Figure 4.27: US map with colored state areas with limits on the values
</p>
</div>
</div>
<div id="overlay-polygon-maps" class="section level3">
<h3><span class="header-section-number">4.8.3</span> Overlay polygon maps</h3>
<p>It is also possible to overlay two polygon maps. The code below creates county borders with a small line size and then adds a thicker line to represent state borders. The <code>alpha = .3</code> causes the fill in the state map to be transparent, allowing us to see the county map behind the state map.</p>
<div class="sourceCode" id="cb114"><pre class="sourceCode r"><code class="sourceCode r"><span id="cb114-1"><a href="ggplot2.html#cb114-1"></a><span class="kw">ggplot</span>() <span class="op">+</span><span class="st"> </span><span class="kw">geom_polygon</span>(<span class="dt">data =</span> <span class="kw">map_data</span>(<span class="st">&quot;county&quot;</span>), </span>
<span id="cb114-2"><a href="ggplot2.html#cb114-2"></a>                <span class="kw">aes</span>(<span class="dt">x =</span> long, <span class="dt">y =</span> lat, <span class="dt">group =</span> group),</span>
<span id="cb114-3"><a href="ggplot2.html#cb114-3"></a>                <span class="dt">color =</span> <span class="st">&quot;darkblue&quot;</span>, </span>
<span id="cb114-4"><a href="ggplot2.html#cb114-4"></a>                <span class="dt">fill =</span> <span class="st">&quot;lightblue&quot;</span>, <span class="dt">size =</span> <span class="fl">.1</span>) <span class="op">+</span><span class="st"> </span></span>
<span id="cb114-5"><a href="ggplot2.html#cb114-5"></a><span class="st">  </span></span>
<span id="cb114-6"><a href="ggplot2.html#cb114-6"></a><span class="st">            </span><span class="kw">geom_polygon</span>(<span class="dt">data =</span> <span class="kw">map_data</span>(<span class="st">&#39;state&#39;</span>), </span>
<span id="cb114-7"><a href="ggplot2.html#cb114-7"></a>                       <span class="kw">aes</span>(<span class="dt">x =</span> long, <span class="dt">y =</span> lat, <span class="dt">group =</span> group),</span>
<span id="cb114-8"><a href="ggplot2.html#cb114-8"></a>                <span class="dt">color =</span> <span class="st">&quot;black&quot;</span>, <span class="dt">fill =</span> <span class="st">&quot;lightblue&quot;</span>,  </span>
<span id="cb114-9"><a href="ggplot2.html#cb114-9"></a>                <span class="dt">size =</span> <span class="fl">.5</span>, <span class="dt">alpha =</span> <span class="fl">.3</span>) </span></code></pre></div>
<div class="figure" style="text-align: center"><span id="fig:unnamed-chunk-63"></span>
<img src="SLID_book_files/figure-html/unnamed-chunk-63-1.png" alt="US map with colored state areas and county boundaries" width="480" />
<p class="caption">
Figure 4.28: US map with colored state areas and county boundaries
</p>
</div>
</div>
</div>
<div id="arranging-plots" class="section level2">
<h2><span class="header-section-number">4.9</span> Arranging Plots</h2>
<div id="facet" class="section level3">
<h3><span class="header-section-number">4.9.1</span> Facet</h3>
<p>Sometimes, we wish to look that the scatterplot within each factor of categorical variables. For example, we may want to look at the situation within each <code>Region</code> in our case. We can split a single plot into many related plots using the function <code>facet_wrap()</code> or <code>facet_grid()</code>:</p>
<ul>
<li><p><code>facet_wrap(~variable)</code> will return a symmetrical matrix of plots for the number of levels of variable;</p></li>
<li><p><code>facet_grid(. ~variable)</code> will return facets equal to the levels of variable distributed horizontally.</p></li>
<li><p><code>facet_grid(variable~.)</code> will return facets equal to the levels of variable distributed vertically.</p></li>
</ul>
<div class="sourceCode" id="cb115"><pre class="sourceCode r"><code class="sourceCode r"><span id="cb115-1"><a href="ggplot2.html#cb115-1"></a>df &lt;-<span class="st"> </span>slid<span class="op">::</span>state.long <span class="op">%&gt;%</span><span class="st"> </span></span>
<span id="cb115-2"><a href="ggplot2.html#cb115-2"></a><span class="st">  </span>dplyr<span class="op">::</span><span class="kw">filter</span>(DATE <span class="op">==</span><span class="st"> </span><span class="kw">as.Date</span>(<span class="st">&#39;2020-12-11&#39;</span>)) </span>
<span id="cb115-3"><a href="ggplot2.html#cb115-3"></a>p &lt;-<span class="st"> </span><span class="kw">ggplot</span>(df, <span class="kw">aes</span>(<span class="kw">log</span>(Infected <span class="op">+</span><span class="st"> </span><span class="dv">1</span>), <span class="kw">log</span>(Death <span class="op">+</span><span class="st"> </span><span class="dv">1</span>))) <span class="op">+</span><span class="st"> </span></span>
<span id="cb115-4"><a href="ggplot2.html#cb115-4"></a><span class="st">  </span><span class="kw">geom_point</span>(<span class="dt">na.rm =</span> <span class="ot">TRUE</span>) <span class="op">+</span></span>
<span id="cb115-5"><a href="ggplot2.html#cb115-5"></a><span class="st">  </span><span class="kw">aes</span>(<span class="dt">color =</span> Region) </span>
<span id="cb115-6"><a href="ggplot2.html#cb115-6"></a></span>
<span id="cb115-7"><a href="ggplot2.html#cb115-7"></a>p</span></code></pre></div>
<div class="figure" style="text-align: center"><span id="fig:unnamed-chunk-64-1"></span>
<img src="SLID_book_files/figure-html/unnamed-chunk-64-1.png" alt="Facetting examples" width="75%" />
<p class="caption">
Figure 4.29: Facetting examples
</p>
</div>
<div class="sourceCode" id="cb116"><pre class="sourceCode r"><code class="sourceCode r"><span id="cb116-1"><a href="ggplot2.html#cb116-1"></a>p <span class="op">+</span><span class="st"> </span><span class="kw">facet_grid</span>(.<span class="op">~</span>Region)</span></code></pre></div>
<div class="figure" style="text-align: center"><span id="fig:unnamed-chunk-64-2"></span>
<img src="SLID_book_files/figure-html/unnamed-chunk-64-2.png" alt="Facetting examples" width="75%" />
<p class="caption">
Figure 4.30: Facetting examples
</p>
</div>
<div class="sourceCode" id="cb117"><pre class="sourceCode r"><code class="sourceCode r"><span id="cb117-1"><a href="ggplot2.html#cb117-1"></a>p <span class="op">+</span><span class="st"> </span><span class="kw">facet_grid</span>(Region<span class="op">~</span>.)</span></code></pre></div>
<div class="figure" style="text-align: center"><span id="fig:unnamed-chunk-64-3"></span>
<img src="SLID_book_files/figure-html/unnamed-chunk-64-3.png" alt="Facetting examples" width="75%" />
<p class="caption">
Figure 4.31: Facetting examples
</p>
</div>
<div class="sourceCode" id="cb118"><pre class="sourceCode r"><code class="sourceCode r"><span id="cb118-1"><a href="ggplot2.html#cb118-1"></a>p <span class="op">+</span><span class="st"> </span><span class="kw">facet_wrap</span>(<span class="op">~</span>Region)</span></code></pre></div>
<div class="figure" style="text-align: center"><span id="fig:unnamed-chunk-64-4"></span>
<img src="SLID_book_files/figure-html/unnamed-chunk-64-4.png" alt="Facetting examples" width="75%" />
<p class="caption">
Figure 4.32: Facetting examples
</p>
</div>
</div>
<div id="combining-plots-using-patchwork-package" class="section level3">
<h3><span class="header-section-number">4.9.2</span> Combining plots using <code>patchwork</code> package</h3>
<p>Before plots can be laid out, they have to be assembled. The goal of <code>patchwork</code> is to make it simple to combine separate ggplots into the same graphic. We can install patchwork from CRAN using</p>
<div class="sourceCode" id="cb119"><pre class="sourceCode r"><code class="sourceCode r"><span id="cb119-1"><a href="ggplot2.html#cb119-1"></a><span class="cf">if</span> (<span class="op">!</span><span class="kw">require</span>(<span class="st">&#39;patchwork&#39;</span>)) <span class="kw">install.packages</span>(<span class="st">&#39;patchwork&#39;</span>)</span>
<span id="cb119-2"><a href="ggplot2.html#cb119-2"></a><span class="kw">library</span>(patchwork)</span></code></pre></div>
<p>Let us consider some simple examples.</p>
<div class="sourceCode" id="cb120"><pre class="sourceCode r"><code class="sourceCode r"><span id="cb120-1"><a href="ggplot2.html#cb120-1"></a>df  &lt;-<span class="st"> </span>slid<span class="op">::</span>state.long <span class="op">%&gt;%</span><span class="st"> </span></span>
<span id="cb120-2"><a href="ggplot2.html#cb120-2"></a><span class="st">  </span>dplyr<span class="op">::</span><span class="kw">filter</span>(DATE <span class="op">==</span><span class="st"> </span><span class="kw">as.Date</span>(<span class="st">&#39;2020-12-11&#39;</span>)) </span>
<span id="cb120-3"><a href="ggplot2.html#cb120-3"></a>p1 &lt;-<span class="st"> </span><span class="kw">ggplot</span>(df, <span class="kw">aes</span>(<span class="kw">log</span>(Infected<span class="op">+</span><span class="dv">1</span>), <span class="kw">log</span>(Death <span class="op">+</span><span class="st"> </span><span class="dv">1</span>))) <span class="op">+</span><span class="st"> </span></span>
<span id="cb120-4"><a href="ggplot2.html#cb120-4"></a><span class="st">  </span><span class="kw">geom_point</span>(<span class="dt">na.rm =</span> <span class="ot">TRUE</span>) </span>
<span id="cb120-5"><a href="ggplot2.html#cb120-5"></a></span>
<span id="cb120-6"><a href="ggplot2.html#cb120-6"></a>p2 &lt;-<span class="st"> </span><span class="kw">ggplot</span>(df, <span class="kw">aes</span>(<span class="kw">log</span>(Death <span class="op">+</span><span class="st"> </span><span class="dv">1</span>))) <span class="op">+</span><span class="st"> </span></span>
<span id="cb120-7"><a href="ggplot2.html#cb120-7"></a><span class="st">  </span><span class="kw">geom_histogram</span>(<span class="dt">binwidth =</span> <span class="dv">1</span>) <span class="op">+</span><span class="st"> </span><span class="kw">aes</span>(<span class="dt">fill =</span> Region) </span>
<span id="cb120-8"><a href="ggplot2.html#cb120-8"></a></span>
<span id="cb120-9"><a href="ggplot2.html#cb120-9"></a>p3 &lt;-<span class="st"> </span><span class="kw">ggplot</span>(df, <span class="kw">aes</span>(<span class="kw">log</span>(Infected <span class="op">+</span><span class="st"> </span><span class="dv">1</span>))) <span class="op">+</span><span class="st"> </span></span>
<span id="cb120-10"><a href="ggplot2.html#cb120-10"></a><span class="st">  </span><span class="kw">geom_histogram</span>(<span class="dt">binwidth =</span> <span class="dv">1</span>) <span class="op">+</span><span class="st"> </span><span class="kw">aes</span>(<span class="dt">fill =</span> Region) </span>
<span id="cb120-11"><a href="ggplot2.html#cb120-11"></a></span>
<span id="cb120-12"><a href="ggplot2.html#cb120-12"></a><span class="co"># Horizontal arrangement</span></span>
<span id="cb120-13"><a href="ggplot2.html#cb120-13"></a>p1 <span class="op">+</span><span class="st"> </span>p2</span></code></pre></div>
<div class="figure" style="text-align: center"><span id="fig:unnamed-chunk-66-1"></span>
<img src="SLID_book_files/figure-html/unnamed-chunk-66-1.png" alt="Patchwork examples" width="75%" />
<p class="caption">
Figure 4.33: Patchwork examples
</p>
</div>
<div class="sourceCode" id="cb121"><pre class="sourceCode r"><code class="sourceCode r"><span id="cb121-1"><a href="ggplot2.html#cb121-1"></a><span class="co"># Vertical arrangement</span></span>
<span id="cb121-2"><a href="ggplot2.html#cb121-2"></a>p1 <span class="op">/</span><span class="st"> </span>p2</span></code></pre></div>
<div class="figure" style="text-align: center"><span id="fig:unnamed-chunk-66-2"></span>
<img src="SLID_book_files/figure-html/unnamed-chunk-66-2.png" alt="Patchwork examples" width="75%" />
<p class="caption">
Figure 4.34: Patchwork examples
</p>
</div>
<div class="sourceCode" id="cb122"><pre class="sourceCode r"><code class="sourceCode r"><span id="cb122-1"><a href="ggplot2.html#cb122-1"></a><span class="co"># Grouped arrangements</span></span>
<span id="cb122-2"><a href="ggplot2.html#cb122-2"></a>p1 <span class="op">|</span><span class="st"> </span>(p2 <span class="op">/</span><span class="st"> </span>p3)</span></code></pre></div>
<div class="figure" style="text-align: center"><span id="fig:unnamed-chunk-66-3"></span>
<img src="SLID_book_files/figure-html/unnamed-chunk-66-3.png" alt="Patchwork examples" width="75%" />
<p class="caption">
Figure 4.35: Patchwork examples
</p>
</div>
<div class="sourceCode" id="cb123"><pre class="sourceCode r"><code class="sourceCode r"><span id="cb123-1"><a href="ggplot2.html#cb123-1"></a><span class="co"># Combine three plots</span></span>
<span id="cb123-2"><a href="ggplot2.html#cb123-2"></a>p1 <span class="op">+</span><span class="st"> </span>p2 <span class="op">+</span><span class="st"> </span>p3 </span></code></pre></div>
<div class="figure" style="text-align: center"><span id="fig:unnamed-chunk-66-4"></span>
<img src="SLID_book_files/figure-html/unnamed-chunk-66-4.png" alt="Patchwork examples" width="75%" />
<p class="caption">
Figure 4.36: Patchwork examples
</p>
</div>
<div class="sourceCode" id="cb124"><pre class="sourceCode r"><code class="sourceCode r"><span id="cb124-1"><a href="ggplot2.html#cb124-1"></a><span class="co"># Set the number of plots per row</span></span>
<span id="cb124-2"><a href="ggplot2.html#cb124-2"></a>p1 <span class="op">+</span><span class="st"> </span>p2 <span class="op">+</span><span class="st"> </span>p3 <span class="op">+</span><span class="st"> </span><span class="kw">plot_layout</span>(<span class="dt">ncol =</span> <span class="dv">2</span>)</span></code></pre></div>
<div class="figure" style="text-align: center"><span id="fig:unnamed-chunk-66-5"></span>
<img src="SLID_book_files/figure-html/unnamed-chunk-66-5.png" alt="Patchwork examples" width="75%" />
<p class="caption">
Figure 4.37: Patchwork examples
</p>
</div>
<div class="sourceCode" id="cb125"><pre class="sourceCode r"><code class="sourceCode r"><span id="cb125-1"><a href="ggplot2.html#cb125-1"></a><span class="co"># Combine the duplicate legends</span></span>
<span id="cb125-2"><a href="ggplot2.html#cb125-2"></a>p1 <span class="op">+</span><span class="st"> </span>p2 <span class="op">+</span><span class="st"> </span>p3 <span class="op">+</span><span class="st"> </span><span class="kw">plot_layout</span>(<span class="dt">ncol =</span> <span class="dv">2</span>, <span class="dt">guides =</span> <span class="st">&quot;collect&quot;</span>)</span></code></pre></div>
<div class="figure" style="text-align: center"><span id="fig:unnamed-chunk-66-6"></span>
<img src="SLID_book_files/figure-html/unnamed-chunk-66-6.png" alt="Patchwork examples" width="75%" />
<p class="caption">
Figure 4.38: Patchwork examples
</p>
</div>
<div class="sourceCode" id="cb126"><pre class="sourceCode r"><code class="sourceCode r"><span id="cb126-1"><a href="ggplot2.html#cb126-1"></a><span class="co"># Add title and subtitles</span></span>
<span id="cb126-2"><a href="ggplot2.html#cb126-2"></a>p123 &lt;-<span class="st"> </span>(p1 <span class="op">|</span><span class="st"> </span>(p2 <span class="op">/</span><span class="st"> </span>p3))<span class="op">+</span><span class="st"> </span><span class="kw">plot_annotation</span>(</span>
<span id="cb126-3"><a href="ggplot2.html#cb126-3"></a>  <span class="dt">title =</span> <span class="st">&quot;Add title here&quot;</span>,</span>
<span id="cb126-4"><a href="ggplot2.html#cb126-4"></a>  <span class="dt">caption =</span> <span class="st">&quot;Add caption here&quot;</span></span>
<span id="cb126-5"><a href="ggplot2.html#cb126-5"></a>)</span>
<span id="cb126-6"><a href="ggplot2.html#cb126-6"></a>p123</span></code></pre></div>
<div class="figure" style="text-align: center"><span id="fig:unnamed-chunk-66-7"></span>
<img src="SLID_book_files/figure-html/unnamed-chunk-66-7.png" alt="Patchwork examples" width="75%" />
<p class="caption">
Figure 4.39: Patchwork examples
</p>
</div>
</div>
</div>
<div id="output" class="section level2">
<h2><span class="header-section-number">4.10</span> Output</h2>
<p>After polishing the figure, we need to save the figure and output it as a readable file for later use. We can either output it in a standard figure format, such as png, tiff, jpeg; or we can save it as an R readable data file, usually referred to as <code>XXX.rds</code>, <code>XXX.rda</code> or <code>XXX.RData</code>, and read by <code>readRDS('XXX.rds')</code>.</p>
<div id="save-in-figure-format" class="section level3">
<h3><span class="header-section-number">4.10.1</span> Save in figure format</h3>
<div class="sourceCode" id="cb127"><pre class="sourceCode r"><code class="sourceCode r"><span id="cb127-1"><a href="ggplot2.html#cb127-1"></a><span class="co"># Take a look at the figure before saving</span></span>
<span id="cb127-2"><a href="ggplot2.html#cb127-2"></a><span class="co"># print(p) </span></span>
<span id="cb127-3"><a href="ggplot2.html#cb127-3"></a><span class="kw">ggsave</span>(<span class="st">&#39;example_ggplot2.png&#39;</span>, p) <span class="co"># Save the figure in png format</span></span></code></pre></div>
<pre><code>## Saving 7 x 5 in image</code></pre>
</div>
<div id="save-in-rds-format" class="section level3">
<h3><span class="header-section-number">4.10.2</span> Save in RDS format</h3>
<div class="sourceCode" id="cb129"><pre class="sourceCode r"><code class="sourceCode r"><span id="cb129-1"><a href="ggplot2.html#cb129-1"></a><span class="co"># Save the figure in .rda format</span></span>
<span id="cb129-2"><a href="ggplot2.html#cb129-2"></a><span class="kw">saveRDS</span>(p, <span class="st">&#39;example_ggplot2.rds&#39;</span>) </span>
<span id="cb129-3"><a href="ggplot2.html#cb129-3"></a><span class="co"># Read the figure in .rda format</span></span>
<span id="cb129-4"><a href="ggplot2.html#cb129-4"></a>q &lt;-<span class="st"> </span><span class="kw">readRDS</span>(<span class="st">&#39;example_ggplot2.rds&#39;</span>)</span>
<span id="cb129-5"><a href="ggplot2.html#cb129-5"></a><span class="co"># print(q)</span></span></code></pre></div>
</div>
</div>
<div id="exercises" class="section level2">
<h2><span class="header-section-number">4.11</span> Exercises</h2>
<ol style="list-style-type: decimal">
<li>Scatter plot using <code>slid::state.long</code> on 2020-11-01.</li>
</ol>
<ol style="list-style-type: lower-alpha">
<li>Create a scatter plot. Treat <code>Infected/1000</code> as x-axis, and <code>Death/1000</code> as y-axis.</li>
<li>Color the points according to <code>Division</code>. Hint: use <code>aes(color = )</code>.</li>
<li>Change the size of the points to be proportional to population. Hint: use <code>aes(size = )</code>.</li>
<li>Change the label of x-axis to ‘Infected (in thousands)’, the label of y-axis to ‘Death(in thousands)’.</li>
<li>Change the title of the figure as ‘Infected against death on 2020-11-01’.</li>
<li>Save the plot to file ‘q1.png’.</li>
</ol>
<ol start="2" style="list-style-type: decimal">
<li>Time series plot using <code>slid::state.ts</code> for Florida.</li>
</ol>
<ol style="list-style-type: lower-alpha">
<li>Obtain the daily new death count for Florida.</li>
<li>Create a line plot, time as x-axis, daily new death as y-axis. Add the title “Daily new death count for Florida” to the plot.</li>
<li>Using the data up till 2020-11-27, a model obtained the following prediction and 80% prediction intervals for the period from 2020-11-28 to 2020-12-11.</li>
</ol>
<pre><code>    DATE   Y.Death    PI
1 2020-11-28   72  [33, 111]
2 2020-11-29   56  [17,  96]
3 2020-11-30   74  [34, 114]
4 2020-12-01   88  [48, 128]
5 2020-12-02   91  [50, 131]
6 2020-12-03   59  [18, 101]
7 2020-12-04  104  [62, 146]
8 2020-12-05   79  [31, 128]
9 2020-12-06   64  [14, 113]
10 2020-12-07  81  [31, 132]
11 2020-12-08  95  [43, 148]
12 2020-12-09  98  [44, 152]
13 2020-12-10  67  [12, 122]
14 2020-12-11 111  [54, 168]</code></pre>
<p>Add another line on your time series plot indicating the predicted daily new death data. Change the title to “Two weeks ahead forecast of the daily new death count for Florida” your plot.</p>
<ol start="4" style="list-style-type: lower-alpha">
<li><p>Add ribbons on your time series plot in part c to illustrate the prediction intervals in part c. Change the title to “Two weeks ahead forecast of the daily new death count for Florida with 80% prediction intervals”.</p></li>
<li><p>Save the plot to file ‘q2.png’.</p></li>
</ol>
<ol start="3" style="list-style-type: decimal">
<li>For the data <code>slid::state.long</code> and focus on 2020-11-01, do the following:</li>
</ol>
<ol style="list-style-type: lower-alpha">
<li>Create a map using Death per 1000 population as the coloring feature.</li>
<li>Save the plot to file ‘q3.png’.</li>
</ol>
<ol start="4" style="list-style-type: decimal">
<li>Combine the three figures and save the plot to file ‘q4.png’.
Hint: In <code>R</code>, save each plot with different names (e.g. <code>p1</code>, <code>p2</code>, <code>p3</code>), and then use the <code>patchwork</code> package.</li>
</ol>

</div>
</div>
<h3>References</h3>
<div id="refs" class="references">
<div id="ref-dicker1992principles">
<p>Dicker, R, and NC Gathany. 1992. “Principles of Epidemiology, 2nd Edn., Us Department of Health and Human Services.” <em>Public Health Service, Centre for Disease Control and Prevention (CDC), Atlanta</em>.</p>
</div>
</div>
            </section>

          </div>
        </div>
      </div>
<a href="dplyr.html" class="navigation navigation-prev " aria-label="Previous page"><i class="fa fa-angle-left"></i></a>
<a href="plotly.html" class="navigation navigation-next " aria-label="Next page"><i class="fa fa-angle-right"></i></a>
    </div>
  </div>
<script src="libs/gitbook-2.6.7/js/app.min.js"></script>
<script src="libs/gitbook-2.6.7/js/lunr.js"></script>
<script src="libs/gitbook-2.6.7/js/clipboard.min.js"></script>
<script src="libs/gitbook-2.6.7/js/plugin-search.js"></script>
<script src="libs/gitbook-2.6.7/js/plugin-sharing.js"></script>
<script src="libs/gitbook-2.6.7/js/plugin-fontsettings.js"></script>
<script src="libs/gitbook-2.6.7/js/plugin-bookdown.js"></script>
<script src="libs/gitbook-2.6.7/js/jquery.highlight.js"></script>
<script src="libs/gitbook-2.6.7/js/plugin-clipboard.js"></script>
<script>
gitbook.require(["gitbook"], function(gitbook) {
gitbook.start({
"sharing": {
"github": false,
"facebook": true,
"twitter": true,
"linkedin": false,
"weibo": false,
"instapaper": false,
"vk": false,
"all": ["facebook", "twitter", "linkedin", "weibo", "instapaper"]
},
"fontsettings": {
"theme": "white",
"family": "sans",
"size": 2
},
"edit": {
"link": null,
"text": null
},
"history": {
"link": null,
"text": null
},
"view": {
"link": null,
"text": null
},
"download": ["SLID_book.pdf", "SLID_book.epub"],
"toc": {
"collapse": "subsection"
}
});
});
</script>

<!-- dynamically load mathjax for compatibility with self-contained -->
<script>
  (function () {
    var script = document.createElement("script");
    script.type = "text/javascript";
    var src = "true";
    if (src === "" || src === "true") src = "https://mathjax.rstudio.com/latest/MathJax.js?config=TeX-MML-AM_CHTML";
    if (location.protocol !== "file:")
      if (/^https?:/.test(src))
        src = src.replace(/^https?:/, '');
    script.src = src;
    document.getElementsByTagName("head")[0].appendChild(script);
  })();
</script>
</body>

</html>
